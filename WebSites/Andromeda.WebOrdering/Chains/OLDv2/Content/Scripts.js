/* jQuery v1.7.1 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);if(!cm||!cl.createElement){cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close()}d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)}ck[a]=e}return ck[a]}function cu(a,b){var c={};f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a});return c}function ct(){cr=b}function cs(){setTimeout(ct,0);return cr=f.now()}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ci(){try{return new a.XMLHttpRequest}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1){for(h in a.converters){typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h])}}l=k,k=d[g];if(k==="*"){k=l}else{if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}}return c}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g){i in d&&(c[g[i]]=d[i])}while(f[0]==="*"){f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"))}if(h){for(i in e){if(e[i]&&e[i].test(h)){f.unshift(i);break}}}if(f[0] in d){j=f[0]}else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function ca(a,b,c,d){if(f.isArray(b)){f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)})}else{if(!c&&b!=null&&typeof b=="object"){for(var e in b){ca(a+"["+e+"]",b[e],c,d)}}else{d(a,b)}}}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c){c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d])}e&&f.extend(!0,a,e)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;for(;i<j&&(k||!l);i++){l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)))}(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));return l}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;for(;e<g;e++){h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;if(d>0){if(c!=="border"){for(;g<h;g++){c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0}}return d+"px"}d=bz(a,b,b);if(d<0||d==null){d=a.style[b]||0}d=parseFloat(d)||0;if(c){for(;g<h;g++){d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0)}}return d+"px"}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio"){a.defaultChecked=a.checked}}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object"){b.outerHTML=a.outerHTML}else{if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option"){b.selected=a.defaultSelected}else{if(c==="input"||c==="textarea"){b.defaultValue=a.defaultValue}}}else{a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)}}b.removeAttribute(f.expando)}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i){for(d=0,e=i[c].length;d<e;d++){f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}}}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement){while(b.length){c.createElement(b.pop())}}return c}function T(a,b,c){b=b||0;if(f.isFunction(b)){return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c})}if(b.nodeType){return f.grep(a,function(a,d){return a===b===c})}if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b)){return f.filter(b,d,!c)}b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return !a||!a.parentNode||a.parentNode.nodeType===11}function K(){return !0}function J(){return !1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b])){continue}if(b!=="toJSON"){return !1}}return !0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else{d=b}}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++){b[a[c]]=!0}return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a){return this}if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2]){return f.find(a)}this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return !d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a)){return f.ready(a)}a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++){if((a=arguments[j])!=null){for(c in a){d=i[c],f=a[c];if(i===f){continue}l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}}}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body){return setTimeout(e.ready,1)}e.isReady=!0;if(a!==!0&&--e.readyWait>0){return}A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete"){return setTimeout(e.ready,1)}if(c.addEventListener){c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1)}else{if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval" in a},isNumeric:function(a){return !isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a)){return !1}try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf")){return !1}}catch(c){return !1}var d;for(d in a){}return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a){return !1}return !0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b){return null}b=e.trim(b);if(a.JSON&&a.JSON.parse){return a.JSON.parse(b)}if(n.test(b.replace(o,"@").replace(p,"]").replace(q,""))){return(new Function("return "+b))()}e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a){if(c.apply(a[f],d)===!1){break}}}else{for(;g<h;){if(c.apply(a[g++],d)===!1){break}}}}else{if(i){for(f in a){if(c.call(a[f],f,a[f])===!1){break}}}else{for(;g<h;){if(c.call(a[g],g,a[g++])===!1){break}}}}return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H){return H.call(b,a,c)}d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++){if(c in b&&b[c]===a){return c}}}return -1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number"){for(var f=c.length;e<f;e++){a[d++]=c[e]}}else{while(c[e]!==b){a[d++]=c[e++]}}a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++){e=!!b(a[f],f),c!==e&&d.push(a[f])}return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k){for(;i<j;i++){f=c(a[i],i,d),f!=null&&(h[h.length]=f)}}else{for(g in a){f=c(a[g],g,d),f!=null&&(h[h.length]=f)}}return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a)){return b}var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c){e.access(a,j,c[j],f,g,d)}return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++){g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h)}return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++){g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)}},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;for(;c&&l<k;l++){if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))},o={add:function(){if(c){var a=c.length;m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++){for(var f=0;f<c.length;f++){if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);if(a.unique){break}}}}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++){if(a===c[b]){return !0}}}return !1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return !c},lock:function(){d=b,(!e||e===!0)&&o.disable();return this},locked:function(){return !d},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));return this},fire:function(){o.fireWith(this,arguments);return this},fired:function(){return !!e}};return o};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null){a=h}else{for(var b in h){a[b]=h[b]}}return a}},i=h.promise({}),j;for(j in g){i[j]=g[j].fire,i[j+"With"]=g[j].fireWith}i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++){b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g}g||j.resolveWith(j,b)}else{j!==a&&j.resolveWith(j,d?[a]:[])}return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];if(!d||!d.length||!e){return{}}g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete q.test}catch(s){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(q.attachEvent){for(o in {submit:1,change:1,focusin:1}){n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p}}k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div><table "+n+" cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return !!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b){return}n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function"){e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c)}g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c]){return g.events}k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k]){return}if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++){delete d[b[e]]}if(!(c?m:f.isEmptyObject)(d)){return}}}if(!c){delete j[k].data;if(!m(j[k])){return}}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b){return b!==!0&&a.getAttribute("classid")===b}}return !0}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var i=0,j=e.length;i<j;i++){g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]))}f._data(this[0],"parsedAttrs",!0)}}return h}if(typeof a=="object"){return this.each(function(){f.data(this,a)})}d=a.split("."),d[1]=d[1]?"."+d[1]:"";if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));return h===b&&d[1]?this.data(d[0]):h}return this.each(function(){var b=f(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b){return f.queue(this[0],a)}return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--){if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0)){h++,l.add(m)}}m();return d.promise()}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a)){return this.each(function(b){f(this).addClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1){if(!e.className&&b.length===1){e.className=a}else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++){~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ")}e.className=f.trim(g)}}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a)){return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className){if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++){h=h.replace(" "+c[i]+" "," ")}g.className=f.trim(h)}else{g.className=""}}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a)){return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)})}return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++]){i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}}else{if(c==="undefined"||c==="boolean"){this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""}}})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++){if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1){return !0}}return !1},val:function(a){var c,d,e,g=this[0];if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set" in c)||c.set(this,h,"value")===b){this.value=h}}})}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];if(c&&"get" in c&&(d=c.get(g,"value"))!==b){return d}d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return !b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0){return null}c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j){return b}h.push(b)}}if(j&&!h.length&&i.length){return f(i[g]).val()}return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn){return f(a)[c](d)}if(typeof a.getAttribute=="undefined"){return f.prop(a,c,d)}i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set" in h&&i&&(g=h.set(a,d,c))!==b){return g}a.setAttribute(c,""+d);return d}if(h&&"get" in h&&i&&(g=h.get(a,c))!==null){return g}g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;h<g;h++){e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))}}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode){f.error("type property can't be changed")}else{if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button")){return w.get(a,b)}return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button")){return w.set(a,b,c)}a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set" in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get" in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b)){return a.checked=f.inArray(f(a).val(),b)>=0}}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1){a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o){f.event.remove(a,j+b[h],c,d,!0)}continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++){s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s))}r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered)){return}h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h]){return}c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j){j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0)}return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1){return}r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode){r.push([m,s]),n=m}n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++){m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault()}c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;g[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this){o={},q=[],m[0]=l;for(j=0;j<e;j++){r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r)}q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace)){c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando]){return a}var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;){e=i[--d],a[e]=g[e]}a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event)){return new f.Event(a,b)}a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d)){a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b}return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form")){return !1}f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(f.nodeName(this,"form")){return !1}f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))})}return !1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox"){return a.handleObj.handler.apply(this,arguments)}},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(i in a){this.on(i,c,d,a[i],g)}return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1){e=J}else{if(!e){return this}}g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a){this.off(g,c,a[g])}return this}if(c===!1||typeof c=="function"){d=c,c=b}d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){return f.event.trigger(a,b,this[0],!0)}},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length){b[d++].guid=c}return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else{if(m.filter(b,[j]).length>0){k=j;break}}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9){return[]}if(!b||typeof b!="string"){return e}var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b)){if(w.length===2&&o.relative[w[0]]){j=y(w[0]+w[1],d,f)}else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length){b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}}}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length){q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}}else{k=w=[]}}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]"){if(!u){e.push.apply(e,k)}else{if(d&&d.nodeType===1){for(t=0;k[t]!=null;t++){k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t])}}else{for(t=0;k[t]!=null;t++){k[t]&&k[t].nodeType===1&&e.push(j[t])}}}}else{s(k,e)}l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h){for(var b=1;b<a.length;b++){a[b]===a[b-1]&&a.splice(b--,1)}}}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a){return[]}for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter){if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\"){continue}s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f){g=i=!0}else{if(f===!0){continue}}}if(f){for(n=0;(j=s[n])!=null;n++){j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0))}}if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g){return[]}break}}}if(a===q){if(g==null){m.error(a)}else{break}}q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string"){return a.textContent}if(typeof a.innerText=="string"){return a.innerText.replace(k,"")}for(a=a.firstChild;a;a=a.nextSibling){e+=n(a)}}else{if(d===3||d===4){return a.nodeValue}}}else{for(b=0;c=a[b];b++){c.nodeType!==8&&(e+=n(c))}}return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++){if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1){}a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++){c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b)}d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++){d[e].getAttribute("name")===a[1]&&c.push(d[e])}return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined"){return b.getElementsByTagName(a[1])}}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f){return a}for(var g=0,h;(h=b[g])!=null;g++){h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1))}return !1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else{a[2]&&m.error(a[0])}a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not"){if((a.exec(b[3])||"").length>1||/^\w/.test(b[3])){b[3]=m(b[3],null,null,c)}else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return !1}}else{if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0])){return !0}}return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return !!a.firstChild},empty:function(a){return !a.firstChild},has:function(a,b,c){return !!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f){return f(a,c,b,d)}if(e==="contains"){return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0}if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++){if(g[h]===a){return !1}}return !0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling){if(l.nodeType===1){return !1}}if(k==="first"){return !0}l=a;case"last":while(l=l.nextSibling){if(l.nodeType===1){return !1}}return !0;case"nth":c=b[2],e=b[3];if(c===1&&e===0){return !0}f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling){l.nodeType===1&&(l.nodeIndex=++i)}g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f){return f(a,c,b,d)}}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match){o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q))}var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]"){Array.prototype.push.apply(d,a)}else{if(typeof a.length=="number"){for(var e=a.length;c<e;c++){d.push(a[c])}}else{for(;a[c];c++){d.push(a[c])}}}return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition){return a.compareDocumentPosition?-1:1}return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex}var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i){return v(a,b)}if(!g){return -1}if(!i){return 1}while(j){e.unshift(j),j=j.parentNode}j=i;while(j){f.unshift(j),j=j.parentNode}c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++){if(e[k]!==f[k]){return v(e[k],f[k])}}return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b){return c}var d=a.nextSibling;while(d){if(d===b){return -1}d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++){c[e].nodeType===1&&d.push(c[e])}c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1]){return s(e.getElementsByTagName(b),f)}if(h[2]&&o.find.CLASS&&e.getElementsByClassName){return s(e.getElementsByClassName(h[2]),f)}}if(e.nodeType===9){if(b==="body"&&e.body){return s([e.body],f)}if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode){return s([],f)}if(i.id===h[3]){return s([i],f)}}try{return s(e.querySelectorAll(b),f)}catch(j){}}else{if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p){return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}}catch(r){}finally{l||k.removeAttribute("id")}}}}return a(b,e,f,g)};for(var e in a){m[e]=a[e]}b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a)){try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11){return f}}}catch(g){}}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1){return}o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c){return b.getElementsByClassName(a[1])}},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return !!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return !1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a)){f+=d[0],a=a.replace(o.match.PSEUDO,"")}a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++){m(a,g[h],e,c)}return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string"){return f(a).filter(function(){for(c=0,d=b.length;c<d;c++){if(f.contains(b[c],this)){return !0}}})}var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0){for(h=g;h<e.length;h++){for(i=0;i<g;i++){if(e[i]===e[h]){e.splice(h--,1);break}}}}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++){if(f.contains(this,b[a])){return !0}}})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return !!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++){f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h})}g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11){break}}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a){return this[0]&&this[0].parentNode?this.prevAll().length:-1}if(typeof a=="string"){return f.inArray(this[0],f(a))}return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d))){g.nodeType===1&&e.push(g),g=g[c]}return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c]){if(a.nodeType===1&&++e===b){break}}return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling){a.nodeType===1&&a!==b&&c.push(a)}return c}});var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a)){return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))})}if(typeof a!="object"&&a!==b){return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a))}return f.text(this)},wrapAll:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapAll(a.call(this,b))})}if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1){a=a.firstChild}return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapInner(a.call(this,b))})}return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)})}if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)})}if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++){if(!a||f.filter(a,[d]).length){!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d)}}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild){b.removeChild(b.firstChild)}}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null}if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++){this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}}catch(e){this.empty().append(a)}}else{f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a)}return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a)){return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))})}typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j)){return this.each(function(){f(this).domManip(a,c,d,!0)})}if(f.isFunction(j)){return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)})}if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++){d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}}k.length&&f.each(k,bp)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g){e[g]&&bk(d[g],e[g])}}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g){bj(d[g],e[g])}}}d=e=null;return h},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k){continue}if(typeof k=="string"){if(!_.test(k)){k=b.createTextNode(k)}else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--){o=o.lastChild}if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i){f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}}var r;if(!f.support.appendChecked){if(k[0]&&typeof(r=k.length)=="number"){for(i=0;i<r;i++){bn(k[i])}}else{bn(k)}}k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return !a.type||be.test(a.type)};for(j=0;h[j];j++){if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript")){e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j])}else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()]){continue}c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events){e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle)}b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;f.fn.css=function(a,c){if(arguments.length===2&&c===b){return this}return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get" in k&&(g=k.get(a,!1,e))!==b){return g}return j[c]}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d)){return}h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set" in k)||(d=k.set(a,d))!==b){try{j[c]=d}catch(l){}}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get" in g&&(e=g.get(a,!0,d))!==b){return e}if(bz){return bz(a,c)}},swap:function(a,b,c){var d={};for(var e in b){d[e]=a.style[e],a.style[e]=b[e]}c.call(a);for(e in b){a.style[e]=d[e]}}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0){return bC(a,b,d)}f.swap(a,bw,function(){e=bC(a,b,d)});return e}},set:function(a,b){if(!bt.test(b)){return b}b=parseFloat(b);if(b>=0){return b+"px"}}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");if(d&&!d.filter){return}}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));return c}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return !f.expr.filters.hidden(a)});var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];try{bV=e.href}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS){return bS.apply(this,arguments)}if(!this.length){return this}var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}}):{name:b.name,value:c.replace(bF,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);return a},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified")){f.lastModified[k]=y}if(z=v.getResponseHeader("Etag")){f.etag[k]=z}}if(a===304){w="notmodified",o=!0}else{try{r=cc(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}}else{u=w;if(!w||a){w="error",a<0&&(a=0)}}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bH.exec(n)){o[c[1].toLowerCase()]=c[2]}}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2){for(b in a){j[b]=[j[b],a[b]]}}else{b=a[v.status],v.then(b,b)}}return this},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);if(s===2){return !1}t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);for(u in d.headers){v.setRequestHeader(u,d.headers[u])}if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return !1}for(u in {success:1,error:1,complete:1}){v[u](d[u])}p=b$(bU,d,c,v);if(!p){w(-1,"No Transport")}else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2){w(-1,z)}else{throw z}}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a)){f.each(a,function(){e(this.name,this.value)})}else{for(var g in a){ca(g,a[g],c,e)}}return d.join("&").replace(bD,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState)){d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")}},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cf=a.ActiveXObject?function(){for(var a in ch){ch[a](0,1)}}:!1,cg=0,ch;f.ajaxSettings.xhr=a.ActiveXObject?function(){return !this.isLocal&&ci()||cj()}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials" in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields){for(j in c.xhrFields){h[j]=c.xhrFields[j]}}c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e){h.setRequestHeader(j,e[j])}}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);if(e){h.readyState!==4&&h.abort()}else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0){return this.animate(cu("show",3),a,b,c)}for(var g=0,h=this.length;g<h;g++){d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)))}for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none"){d.style.display=f._data(d,"olddisplay")||""}}}return this},hide:function(a,b,c){if(a||a===0){return this.animate(cu("hide",3),a,b,c)}var d,e,g=0,h=this.length;for(;g<h;g++){d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e))}for(g=0;g<h;g++){this[g].style&&(this[g].style.display="none")}return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d){return b.complete.call(this)}c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a){j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""))}return !0}var e=f.speed(b,c,d);if(f.isEmptyObject(a)){return this.each(e.complete,[!1])}a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null){for(b in g){g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b)}}else{g[b=a+".run"]&&g[b].stop&&h(this,g,b)}for(b=e.length;b--;){e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1))}(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0){d.queue="fx"}d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+0.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties){i.animatedProperties[b]!==!0&&(g=!1)}if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show){for(b in i.animatedProperties){f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0)}}d=i.complete,d&&(i.complete=!1,d.call(h))}return !1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return !0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++){a=b[c],!a()&&b[c]===a&&b.splice(c--,1)}b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cp),cp=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect" in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a){return this.each(function(b){f.offset.setOffset(this,a,b)})}if(!b||!b.ownerDocument){return null}if(b===b.ownerDocument.body){return f.offset.bodyOffset(b)}try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b)){return c?{top:c.top,left:c.left}:{top:0,left:0}}var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a){return this.each(function(b){f.offset.setOffset(this,a,b)})}if(!b||!b.ownerDocument){return null}if(b===b.ownerDocument.body){return f.offset.bodyOffset(b)}var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed"){break}c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static"){l+=i.offsetTop,m+=i.offsetLeft}f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using" in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0]){return null}var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static"){a=a.offsetParent}return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e){return null}g=cy(e);return g?"pageXOffset" in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null},f.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null},f.fn[d]=function(a){var e=this[0];if(!e){return a==null?null:this}if(f.isFunction(a)){return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))})}if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9){return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c])}if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNumeric(j)?j:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);/*
 * AmplifyJS 1.1.0 - Core, Store, Request
 * 
 * Copyright 2011 appendTo LLC. (http://appendto.com/team)
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 * 
 * http://amplifyjs.com
 */
(function(f,g){var h=[].slice,i={},j=f.amplify={publish:function(c){var d=h.call(arguments,1),k,l,m,n=0,o;if(!i[c]){return !0}k=i[c].slice();for(m=k.length;n<m;n++){l=k[n],o=l.callback.apply(l.context,d);if(o===!1){break}}return o!==!1},subscribe:function(d,l,m,n){arguments.length===3&&typeof m=="number"&&(n=m,m=l,l=null),arguments.length===2&&(m=l,l=null),n=n||10;var o=0,p=d.split(/\s/),q=p.length,r;for(;o<q;o++){d=p[o],r=!1,i[d]||(i[d]=[]);var s=i[d].length-1,t={callback:m,context:l,priority:n};for(;s>=0;s--){if(i[d][s].priority<=n){i[d].splice(s+1,0,t),r=!0;break}}r||i[d].unshift(t)}return m},unsubscribe:function(d,k){if(!!i[d]){var l=i[d].length,m=0;for(;m<l;m++){if(i[d][m].callback===k){i[d].splice(m,1);break}}}}}})(this),function(h,i){function l(b,c){j.addType(b,function(a,d,e){var p,q,r,s,t=d,u=(new Date).getTime();if(!a){t={},s=[],r=0;try{a=c.length;while(a=c.key(r++)){k.test(a)&&(q=JSON.parse(c.getItem(a)),q.expires&&q.expires<=u?s.push(a):t[a.replace(k,"")]=q.data)}while(a=s.pop()){c.removeItem(a)}}catch(v){}return t}a="__amplify__"+a;if(d===i){p=c.getItem(a),q=p?JSON.parse(p):{expires:-1};if(q.expires&&q.expires<=u){c.removeItem(a)}else{return q.data}}else{if(d===null){c.removeItem(a)}else{q=JSON.stringify({data:d,expires:e.expires?u+e.expires:null});try{c.setItem(a,q)}catch(v){j[b]();try{c.setItem(a,q)}catch(v){throw j.error()}}}}return t})}var j=h.store=function(c,f,g,o){var o=j.type;g&&g.type&&g.type in j.types&&(o=g.type);return j.types[o](c,f,g||{})};j.types={},j.type=null,j.addType=function(c,d){j.type||(j.type=c),j.types[c]=d,j[c]=function(a,f,g){g=g||{},g.type=c;return j(a,f,g)}},j.error=function(){return"amplify.store quota exceeded"};var k=/^__amplify__/;for(var m in {localStorage:1,sessionStorage:1}){try{window[m].getItem&&l(m,window[m])}catch(n){}}if(window.globalStorage){try{l("globalStorage",window.globalStorage[window.location.hostname]),j.type==="sessionStorage"&&(j.type="globalStorage")}catch(n){}}(function(){if(!j.types.localStorage){var b=document.createElement("div"),c="amplify";b.style.display="none",document.getElementsByTagName("head")[0].appendChild(b);try{b.addBehavior("#default#userdata"),b.load(c)}catch(f){b.parentNode.removeChild(b);return}j.addType("userData",function(a,d,p){b.load(c);var q,r,s,t,u,v=d,w=(new Date).getTime();if(!a){v={},u=[],t=0;while(q=b.XMLDocument.documentElement.attributes[t++]){r=JSON.parse(q.value),r.expires&&r.expires<=w?u.push(q.name):v[q.name]=r.data}while(a=u.pop()){b.removeAttribute(a)}b.save(c);return v}a=a.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");if(d===i){q=b.getAttribute(a),r=q?JSON.parse(q):{expires:-1};if(r.expires&&r.expires<=w){b.removeAttribute(a)}else{return r.data}}else{d===null?b.removeAttribute(a):(s=b.getAttribute(a),r=JSON.stringify({data:d,expires:p.expires?w+p.expires:null}),b.setAttribute(a,r))}try{b.save(c)}catch(x){s===null?b.removeAttribute(a):b.setAttribute(a,s),j.userData();try{b.setAttribute(a,r),b.save(c)}catch(x){s===null?b.removeAttribute(a):b.setAttribute(a,s);throw j.error()}}return v})}})(),function(){function f(d){return d===i?i:JSON.parse(JSON.stringify(d))}var b={},c={};j.addType("memory",function(a,d,e){if(!a){return f(b)}if(d===i){return f(b[a])}c[a]&&(clearTimeout(c[a]),delete c[a]);if(d===null){delete b[a];return null}b[a]=d,e.expires&&(c[a]=setTimeout(function(){delete b[a],delete c[a]},e.expires));return d})}()}(this.amplify=this.amplify||{}),function(f,g){function j(c){var d=!1;setTimeout(function(){d=!0},1);return function(){var a=this,b=arguments;d?c.apply(a,b):setTimeout(function(){c.apply(a,b)},1)}}function i(b){return{}.toString.call(b)==="[object Function]"}function h(){}f.request=function(a,c,d){var e=a||{};typeof e=="string"&&(i(c)&&(d=c,c={}),e={resourceId:a,data:c||{},success:d});var m={abort:h},n=f.request.resources[e.resourceId],o=e.success||h,p=e.error||h;e.success=j(function(k,l){l=l||"success",f.publish("request.success",e,k,l),f.publish("request.complete",e,k,l),o(k,l)}),e.error=j(function(k,l){l=l||"error",f.publish("request.error",e,k,l),f.publish("request.complete",e,k,l),p(k,l)});if(!n){if(!e.resourceId){throw"amplify.request: no resourceId provided"}throw"amplify.request: unknown resourceId: "+e.resourceId}if(!f.publish("request.before",e)){e.error(null,"abort")}else{f.request.resources[e.resourceId](e,m);return m}},f.request.types={},f.request.resources={},f.request.define=function(a,e,k){if(typeof e=="string"){if(!(e in f.request.types)){throw"amplify.request.define: unknown type: "+e}k.resourceId=a,f.request.resources[a]=f.request.types[e](k)}else{f.request.resources[a]=e}}}(amplify),function(g,h,i){var j=["status","statusText","responseText","responseXML","readyState"],k=/\{([^\}]+)\}/g;g.request.types.ajax=function(a){a=h.extend({type:"GET"},a);return function(b,c){function s(f,m){h.each(j,function(n,t){try{r[t]=d[t]}catch(u){}}),/OK$/.test(r.statusText)&&(r.statusText="success"),f===i&&(f=null),q&&(m="abort"),/timeout|error|abort/.test(m)?r.error(f,m):r.success(f,m),s=h.noop}var d,e=a.url,o=c.abort,p=h.extend(!0,{},a,{data:b.data}),q=!1,r={readyState:0,setRequestHeader:function(f,m){return d.setRequestHeader(f,m)},getAllResponseHeaders:function(){return d.getAllResponseHeaders()},getResponseHeader:function(f){return d.getResponseHeader(f)},overrideMimeType:function(f){return d.overrideMideType(f)},abort:function(){q=!0;try{d.abort()}catch(f){}s(null,"abort")},success:function(f,m){b.success(f,m)},error:function(f,m){b.error(f,m)}};g.publish("request.ajax.preprocess",a,b,p,r),h.extend(p,{success:function(f,m){s(f,m)},error:function(f,m){s(null,m)},beforeSend:function(f,m){d=f,p=m;var n=a.beforeSend?a.beforeSend.call(this,r,p):!0;return n&&g.publish("request.before.ajax",a,b,p,r)}}),h.ajax(p),c.abort=function(){r.abort(),o.call(this)}}},g.subscribe("request.ajax.preprocess",function(b,e,m){var n=[],o=m.data;typeof o!="string"&&(o=h.extend(!0,{},b.data,o),m.url=m.url.replace(k,function(c,d){if(d in o){n.push(d);return o[d]}}),h.each(n,function(c,d){delete o[d]}),m.data=o)}),g.subscribe("request.ajax.preprocess",function(b,m,n){var o=n.data,p=b.dataMap;!!p&&typeof o!="string"&&(h.isFunction(p)?n.data=p(o):(h.each(b.dataMap,function(c,d){c in o&&(o[d]=o[c],delete o[c])}),n.data=o))});var l=g.request.cache={_key:function(m,n,o){function s(){return o.charCodeAt(q++)<<24|o.charCodeAt(q++)<<16|o.charCodeAt(q++)<<8|o.charCodeAt(q++)<<0}o=n+o;var p=o.length,q=0,r=s();while(q<p){r^=s()}return"request-"+m+"-"+r},_default:function(){var b={};return function(a,f,m,n){var o=l._key(f.resourceId,m.url,m.data),p=a.cache;if(o in b){n.success(b[o]);return !1}var q=n.success;n.success=function(c){b[o]=c,typeof p=="number"&&setTimeout(function(){delete b[o]},p),q.apply(this,arguments)}}}()};g.store&&(h.each(g.store.types,function(a){l[a]=function(b,f,m,n){var o=l._key(f.resourceId,m.url,m.data),p=g.store[a](o);if(p){m.success(p);return !1}var q=n.success;n.success=function(c){g.store[a](o,c,{expires:b.cache.expires}),q.apply(this,arguments)}}}),l.persist=l[g.store.type]),g.subscribe("request.before.ajax",function(c){var d=c.cache;if(d){d=d.type||d;return l[d in l?d:"_default"].apply(this,arguments)}}),g.request.decoders={jsend:function(f,m,n,o,p){f.status==="success"?o(f.data):f.status==="fail"?p(f.data,"fail"):f.status==="error"&&(delete f.status,p(f,"error"))}},g.subscribe("request.before.ajax",function(a,b,m,n){function s(c,d){p(c,d)}function r(c,d){o(c,d)}var o=n.success,p=n.error,q=h.isFunction(a.decoder)?a.decoder:a.decoder in g.request.decoders?g.request.decoders[a.decoder]:g.request.decoders._default;!q||(n.success=function(c,d){q(c,d,n,r,s)},n.error=function(c,d){q(c,d,n,r,s)})})}(amplify,jQuery);window.JSON||(window.JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i){return"null"}gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1){h[c]=str(c,i)||"null"}return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1){d=rep[c],typeof d=="string"&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}}else{for(d in i){Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}}return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var JSON=window.JSON,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number"){for(d=0;d<c;d+=1){indent+=" "}}else{typeof c=="string"&&(indent=c)}rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number"){return str("",{"":a})}throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object"){for(c in e){Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c])}}return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}(),function(e,f){var g=e.History=e.History||{},h=e.jQuery;if(typeof g.Adapter!="undefined"){throw new Error("History.js Adapter has already been loaded...")}g.Adapter={bind:function(d,i,j){h(d).bind(i,j)},trigger:function(d,i,j){h(d).trigger(i,j)},extractEventData:function(b,i,j){var k=i&&i.originalEvent&&i.originalEvent[b]||j&&j[b]||f;return k},onDomLoad:function(b){h(b)}},typeof g.init!="undefined"&&g.init()}(window),function(h,i){var j=h.document,k=h.setTimeout||k,l=h.clearTimeout||l,m=h.setInterval||m,n=h.History=h.History||{};if(typeof n.initHtml4!="undefined"){throw new Error("History.js HTML4 Support has already been loaded...")}n.initHtml4=function(){if(typeof n.initHtml4.initialized!="undefined"){return !1}n.initHtml4.initialized=!0,n.enabled=!0,n.savedHashes=[],n.isLastHash=function(d){var e=n.getHashByIndex(),f;return f=d===e,f},n.saveHash=function(b){return n.isLastHash(b)?!1:(n.savedHashes.push(b),!0)},n.getHashByIndex=function(c){var d=null;return typeof c=="undefined"?d=n.savedHashes[n.savedHashes.length-1]:c<0?d=n.savedHashes[n.savedHashes.length+c]:d=n.savedHashes[c],d},n.discardedHashes={},n.discardedStates={},n.discardState=function(f,g,o){var p=n.getHashByState(f),q;return q={discardedState:f,backState:o,forwardState:g},n.discardedStates[p]=q,!0},n.discardHash=function(e,f,g){var o={discardedHash:e,backState:g,forwardState:f};return n.discardedHashes[e]=o,!0},n.discardedState=function(d){var e=n.getHashByState(d),f;return f=n.discardedStates[e]||!1,f},n.discardedHash=function(c){var d=n.discardedHashes[c]||!1;return d},n.recycleState=function(c){var d=n.getHashByState(c);return n.discardedState(c)&&delete n.discardedStates[d],!0},n.emulated.hashChange&&(n.hashChangeInit=function(){n.checkerFunction=null;var a="",c,f,g,o;return n.isInternetExplorer()?(c="historyjs-iframe",f=j.createElement("iframe"),f.setAttribute("id",c),f.style.display="none",j.body.appendChild(f),f.contentWindow.document.open(),f.contentWindow.document.close(),g="",o=!1,n.checkerFunction=function(){if(o){return !1}o=!0;var b=n.getHash()||"",e=n.unescapeHash(f.contentWindow.document.location.hash)||"";return b!==a?(a=b,e!==b&&(g=e=b,f.contentWindow.document.open(),f.contentWindow.document.close(),f.contentWindow.document.location.hash=n.escapeHash(b)),n.Adapter.trigger(h,"hashchange")):e!==g&&(g=e,n.setHash(e,!1)),o=!1,!0}):n.checkerFunction=function(){var b=n.getHash();return b!==a&&(a=b,n.Adapter.trigger(h,"hashchange")),!0},n.intervalList.push(m(n.checkerFunction,n.options.hashChangeInterval)),!0},n.Adapter.onDomLoad(n.hashChangeInit)),n.emulated.pushState&&(n.onHashChange=function(a){var c=a&&a.newURL||j.location.href,g=n.getHashByUrl(c),o=null,p=null,q=null,r;return n.isLastHash(g)?(n.busy(!1),!1):(n.doubleCheckComplete(),n.saveHash(g),g&&n.isTraditionalAnchor(g)?(n.Adapter.trigger(h,"anchorchange"),n.busy(!1),!1):(o=n.extractState(n.getFullUrl(g||j.location.href,!1),!0),n.isLastSavedState(o)?(n.busy(!1),!1):(p=n.getHashByState(o),r=n.discardedState(o),r?(n.getHashByIndex(-2)===n.getHashByState(r.forwardState)?n.back(!1):n.forward(!1),!1):(n.pushState(o.data,o.title,o.url,!1),!0))))},n.Adapter.bind(h,"hashchange",n.onHashChange),n.pushState=function(a,c,g,o){if(n.getHashByUrl(g)){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(o!==!1&&n.busy()){return n.pushQueue({scope:n,callback:n.pushState,args:arguments,queue:o}),!1}n.busy(!0);var p=n.createStateObject(a,c,g),q=n.getHashByState(p),r=n.getState(!1),s=n.getHashByState(r),t=n.getHash();return n.storeState(p),n.expectedStateId=p.id,n.recycleState(p),n.setTitle(p),q===s?(n.busy(!1),!1):q!==t&&q!==n.getShortUrl(j.location.href)?(n.setHash(q,!1),!1):(n.saveState(p),n.Adapter.trigger(h,"statechange"),n.busy(!1),!0)},n.replaceState=function(g,o,p,q){if(n.getHashByUrl(p)){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(q!==!1&&n.busy()){return n.pushQueue({scope:n,callback:n.replaceState,args:arguments,queue:q}),!1}n.busy(!0);var r=n.createStateObject(g,o,p),s=n.getState(!1),t=n.getStateByIndex(-2);return n.discardState(s,r,t),n.pushState(r.data,r.title,r.url,!1),!0}),n.emulated.pushState&&n.getHash()&&!n.emulated.hashChange&&n.Adapter.onDomLoad(function(){n.Adapter.trigger(h,"hashchange")})},typeof n.init!="undefined"&&n.init()}(window),function(o,p){var q=o.console||p,r=o.document,s=o.navigator,t=o.sessionStorage||!1,u=o.setTimeout,v=o.clearTimeout,w=o.setInterval,x=o.clearInterval,y=o.JSON,z=o.alert,A=o.History=o.History||{},B=o.history;y.stringify=y.stringify||y.encode,y.parse=y.parse||y.decode;if(typeof A.init!="undefined"){throw new Error("History.js Core has already been loaded...")}A.init=function(){return typeof A.Adapter=="undefined"?!1:(typeof A.initCore!="undefined"&&A.initCore(),typeof A.initHtml4!="undefined"&&A.initHtml4(),!0)},A.initCore=function(){if(typeof A.initCore.initialized!="undefined"){return !1}A.initCore.initialized=!0,A.options=A.options||{},A.options.hashChangeInterval=A.options.hashChangeInterval||100,A.options.safariPollInterval=A.options.safariPollInterval||500,A.options.doubleCheckInterval=A.options.doubleCheckInterval||500,A.options.storeInterval=A.options.storeInterval||1000,A.options.busyDelay=A.options.busyDelay||250,A.options.debug=A.options.debug||!1,A.options.initialTitle=A.options.initialTitle||r.title,A.intervalList=[],A.clearAllIntervals=function(){var c,d=A.intervalList;if(typeof d!="undefined"&&d!==null){for(c=0;c<d.length;c++){x(d[c])}A.intervalList=null}},A.debug=function(){(A.options.debug||!1)&&A.log.apply(A,arguments)},A.log=function(){var c=typeof q!="undefined"&&typeof q.log!="undefined"&&typeof q.log.apply!="undefined",d=r.getElementById("log"),k,l,m,n,C;c?(n=Array.prototype.slice.call(arguments),k=n.shift(),typeof q.debug!="undefined"?q.debug.apply(q,[k,n]):q.log.apply(q,[k,n])):k="\n"+arguments[0]+"\n";for(l=1,m=arguments.length;l<m;++l){C=arguments[l];if(typeof C=="object"&&typeof y!="undefined"){try{C=y.stringify(C)}catch(D){}}k+="\n"+C+"\n"}return d?(d.value+=k+"\n-----\n",d.scrollTop=d.scrollHeight-d.clientHeight):c||z(k),!0},A.getInternetExplorerMajorVersion=function(){var c=A.getInternetExplorerMajorVersion.cached=typeof A.getInternetExplorerMajorVersion.cached!="undefined"?A.getInternetExplorerMajorVersion.cached:function(){var d=3,e=r.createElement("div"),f=e.getElementsByTagName("i");while((e.innerHTML="<!--[if gt IE "+ ++d+"]><i></i><![endif]-->")&&f[0]){}return d>4?d:!1}();return c},A.isInternetExplorer=function(){var c=A.isInternetExplorer.cached=typeof A.isInternetExplorer.cached!="undefined"?A.isInternetExplorer.cached:Boolean(A.getInternetExplorerMajorVersion());return c},A.emulated={pushState:!Boolean(o.history&&o.history.pushState&&o.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(s.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(s.userAgent)),hashChange:Boolean(!("onhashchange" in o||"onhashchange" in r)||A.isInternetExplorer()&&A.getInternetExplorerMajorVersion()<8)},A.enabled=!A.emulated.pushState,A.bugs={setHash:Boolean(!A.emulated.pushState&&s.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(s.userAgent)),safariPoll:Boolean(!A.emulated.pushState&&s.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(s.userAgent)),ieDoubleCheck:Boolean(A.isInternetExplorer()&&A.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(A.isInternetExplorer()&&A.getInternetExplorerMajorVersion()<7)},A.isEmptyObject=function(c){for(var d in c){return !1}return !0},A.cloneObject=function(d){var e,f;return d?(e=y.stringify(d),f=y.parse(e)):f={},f},A.getRootUrl=function(){var c=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1){c+=":"+r.location.port}return c+="/",c},A.getBaseHref=function(){var d=r.getElementsByTagName("base"),e=null,f="";return d.length===1&&(e=d[0],f=e.href.replace(/[^\/]+$/,"")),f=f.replace(/\/+$/,""),f&&(f+="/"),f},A.getBaseUrl=function(){var c=A.getBaseHref()||A.getBasePageUrl()||A.getRootUrl();return c},A.getPageUrl=function(){var d=A.getState(!1,!1),e=(d||{}).url||r.location.href,f;return f=e.replace(/\/+$/,"").replace(/[^\/]+$/,function(g,h,i){return/\./.test(g)?g:g+"/"}),f},A.getBasePageUrl=function(){var c=r.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(d,e,f){return/[^\/]$/.test(d)?"":d}).replace(/\/+$/,"")+"/";return c},A.getFullUrl=function(e,f){var g=e,h=e.substring(0,1);return f=typeof f=="undefined"?!0:f,/[a-z]+\:\/\//.test(e)||(h==="/"?g=A.getRootUrl()+e.replace(/^\/+/,""):h==="#"?g=A.getPageUrl().replace(/#.*/,"")+e:h==="?"?g=A.getPageUrl().replace(/[\?#].*/,"")+e:f?g=A.getBaseUrl()+e.replace(/^(\.\/)+/,""):g=A.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),g.replace(/\#$/,"")},A.getShortUrl=function(e){var f=e,g=A.getBaseUrl(),h=A.getRootUrl();return A.emulated.pushState&&(f=f.replace(g,"")),f=f.replace(h,"/"),A.isTraditionalAnchor(f)&&(f="./"+f),f=f.replace(/^(\.\/)+/g,"./").replace(/\#$/,""),f},A.store={},A.idToState=A.idToState||{},A.stateToId=A.stateToId||{},A.urlToId=A.urlToId||{},A.storedStates=A.storedStates||[],A.savedStates=A.savedStates||[],A.normalizeStore=function(){A.store.idToState=A.store.idToState||{},A.store.urlToId=A.store.urlToId||{},A.store.stateToId=A.store.stateToId||{}},A.getState=function(d,e){typeof d=="undefined"&&(d=!0),typeof e=="undefined"&&(e=!0);var f=A.getLastSavedState();return !f&&e&&(f=A.createStateObject()),d&&(f=A.cloneObject(f),f.url=f.cleanUrl||f.url),f},A.getIdByState=function(d){var e=A.extractId(d.url),f;if(!e){f=A.getStateString(d);if(typeof A.stateToId[f]!="undefined"){e=A.stateToId[f]}else{if(typeof A.store.stateToId[f]!="undefined"){e=A.store.stateToId[f]}else{for(;;){e=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof A.idToState[e]=="undefined"&&typeof A.store.idToState[e]=="undefined"){break}}A.stateToId[f]=e,A.idToState[e]=d}}}return e},A.normalizeState=function(d){var e,f;if(!d||typeof d!="object"){d={}}if(typeof d.normalized!="undefined"){return d}if(!d.data||typeof d.data!="object"){d.data={}}e={},e.normalized=!0,e.title=d.title||"",e.url=A.getFullUrl(A.unescapeString(d.url||r.location.href)),e.hash=A.getShortUrl(e.url),e.data=A.cloneObject(d.data),e.id=A.getIdByState(e),e.cleanUrl=e.url.replace(/\??\&_suid.*/,""),e.url=e.cleanUrl,f=!A.isEmptyObject(e.data);if(e.title||f){e.hash=A.getShortUrl(e.url).replace(/\??\&_suid.*/,""),/\?/.test(e.hash)||(e.hash+="?"),e.hash+="&_suid="+e.id}return e.hashedUrl=A.getFullUrl(e.hash),(A.emulated.pushState||A.bugs.safariPoll)&&A.hasUrlDuplicate(e)&&(e.url=e.hashedUrl),e},A.createStateObject=function(e,f,g){var h={data:e,title:f,url:g};return h=A.normalizeState(h),h},A.getStateById=function(d){d=String(d);var e=A.idToState[d]||A.store.idToState[d]||p;return e},A.getStateString=function(e){var f,g,h;return f=A.normalizeState(e),g={data:f.data,title:e.title,url:e.url},h=y.stringify(g),h},A.getStateId=function(d){var e,f;return e=A.normalizeState(d),f=e.id,f},A.getHashByState=function(d){var e,f;return e=A.normalizeState(d),f=e.hash,f},A.extractId=function(e){var f,g,h;return g=/(.*)\&_suid=([0-9]+)$/.exec(e),h=g?g[1]||e:e,f=g?String(g[2]||""):"",f||!1},A.isTraditionalAnchor=function(c){var d=!/[\/\?\.]/.test(c);return d},A.extractState=function(f,g){var h=null,i,j;return g=g||!1,i=A.extractId(f),i&&(h=A.getStateById(i)),h||(j=A.getFullUrl(f),i=A.getIdByUrl(j)||!1,i&&(h=A.getStateById(i)),!h&&g&&!A.isTraditionalAnchor(f)&&(h=A.createStateObject(null,null,j))),h},A.getIdByUrl=function(d){var e=A.urlToId[d]||A.store.urlToId[d]||p;return e},A.getLastSavedState=function(){return A.savedStates[A.savedStates.length-1]||p},A.getLastStoredState=function(){return A.storedStates[A.storedStates.length-1]||p},A.hasUrlDuplicate=function(d){var e=!1,f;return f=A.extractState(d.url),e=f&&f.id!==d.id,e},A.storeState=function(c){return A.urlToId[c.url]=c.id,A.storedStates.push(A.cloneObject(c)),c},A.isLastSavedState=function(f){var g=!1,h,i,j;return A.savedStates.length&&(h=f.id,i=A.getLastSavedState(),j=i.id,g=h===j),g},A.saveState=function(c){return A.isLastSavedState(c)?!1:(A.savedStates.push(A.cloneObject(c)),!0)},A.getStateByIndex=function(c){var d=null;return typeof c=="undefined"?d=A.savedStates[A.savedStates.length-1]:c<0?d=A.savedStates[A.savedStates.length+c]:d=A.savedStates[c],d},A.getHash=function(){var c=A.unescapeHash(r.location.hash);return c},A.unescapeString=function(e){var f=e,g;for(;;){g=o.unescape(f);if(g===f){break}f=g}return f},A.unescapeHash=function(c){var d=A.normalizeHash(c);return d=A.unescapeString(d),d},A.normalizeHash=function(c){var d=c.replace(/[^#]*#/,"").replace(/#.*/,"");return d},A.setHash=function(d,g){var h,i,j;return g!==!1&&A.busy()?(A.pushQueue({scope:A,callback:A.setHash,args:arguments,queue:g}),!1):(h=A.escapeHash(d),A.busy(!0),i=A.extractState(d,!0),i&&!A.emulated.pushState?A.pushState(i.data,i.title,i.url,!1):r.location.hash!==h&&(A.bugs.setHash?(j=A.getPageUrl(),A.pushState(null,null,j+"#"+h,!1)):r.location.hash=h),A)},A.escapeHash=function(d){var e=A.normalizeHash(d);return e=o.escape(e),A.bugs.hashEscape||(e=e.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),e},A.getHashByUrl=function(c){var d=String(c).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return d=A.unescapeHash(d),d},A.setTitle=function(d){var f=d.title,g;f||(g=A.getStateByIndex(0),g&&g.url===d.url&&(f=g.title||A.options.initialTitle));try{r.getElementsByTagName("title")[0].innerHTML=f.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(h){}return r.title=f,A},A.queues=[],A.busy=function(c){typeof c!="undefined"?A.busy.flag=c:typeof A.busy.flag=="undefined"&&(A.busy.flag=!1);if(!A.busy.flag){v(A.busy.timeout);var d=function(){var e,f,g;if(A.busy.flag){return}for(e=A.queues.length-1;e>=0;--e){f=A.queues[e];if(f.length===0){continue}g=f.shift(),A.fireQueueItem(g),A.busy.timeout=u(d,A.options.busyDelay)}};A.busy.timeout=u(d,A.options.busyDelay)}return A.busy.flag},A.busy.flag=!1,A.fireQueueItem=function(c){return c.callback.apply(c.scope||A,c.args||[])},A.pushQueue=function(c){return A.queues[c.queue||0]=A.queues[c.queue||0]||[],A.queues[c.queue||0].push(c),A},A.queue=function(c,d){return typeof c=="function"&&(c={callback:c}),typeof d!="undefined"&&(c.queue=d),A.busy()?A.pushQueue(c):A.fireQueueItem(c),A},A.clearQueue=function(){return A.busy.flag=!1,A.queues=[],A},A.stateChanged=!1,A.doubleChecker=!1,A.doubleCheckComplete=function(){return A.stateChanged=!0,A.doubleCheckClear(),A},A.doubleCheckClear=function(){return A.doubleChecker&&(v(A.doubleChecker),A.doubleChecker=!1),A},A.doubleCheck=function(c){return A.stateChanged=!1,A.doubleCheckClear(),A.bugs.ieDoubleCheck&&(A.doubleChecker=u(function(){return A.doubleCheckClear(),A.stateChanged||c(),!0},A.options.doubleCheckInterval)),A},A.safariStatePoll=function(){var d=A.extractState(r.location.href),e;if(!A.isLastSavedState(d)){e=d}else{return}return e||(e=A.createStateObject()),A.Adapter.trigger(o,"popstate"),A},A.back=function(c){return c!==!1&&A.busy()?(A.pushQueue({scope:A,callback:A.back,args:arguments,queue:c}),!1):(A.busy(!0),A.doubleCheck(function(){A.back(!1)}),B.go(-1),!0)},A.forward=function(c){return c!==!1&&A.busy()?(A.pushQueue({scope:A,callback:A.forward,args:arguments,queue:c}),!1):(A.busy(!0),A.doubleCheck(function(){A.forward(!1)}),B.go(1),!0)},A.go=function(d,e){var f;if(d>0){for(f=1;f<=d;++f){A.forward(e)}}else{if(!(d<0)){throw new Error("History.go: History.go requires a positive or negative integer passed.")}for(f=-1;f>=d;--f){A.back(e)}}return A};if(A.emulated.pushState){var a=function(){};A.pushState=A.pushState||a,A.replaceState=A.replaceState||a}else{A.onPopState=function(d,i){var j=!1,k=!1,l,m;return A.doubleCheckComplete(),l=A.getHash(),l?(m=A.extractState(l||r.location.href,!0),m?A.replaceState(m.data,m.title,m.url,!1):(A.Adapter.trigger(o,"anchorchange"),A.busy(!1)),A.expectedStateId=!1,!1):(j=A.Adapter.extractEventData("state",d,i)||!1,j?k=A.getStateById(j):A.expectedStateId?k=A.getStateById(A.expectedStateId):k=A.extractState(r.location.href),k||(k=A.createStateObject(null,null,r.location.href)),A.expectedStateId=!1,A.isLastSavedState(k)?(A.busy(!1),!1):(A.storeState(k),A.saveState(k),A.setTitle(k),A.Adapter.trigger(o,"statechange"),A.busy(!1),!0))},A.Adapter.bind(o,"popstate",A.onPopState),A.pushState=function(g,h,i,j){if(A.getHashByUrl(i)&&A.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(j!==!1&&A.busy()){return A.pushQueue({scope:A,callback:A.pushState,args:arguments,queue:j}),!1}A.busy(!0);var k=A.createStateObject(g,h,i);return A.isLastSavedState(k)?A.busy(!1):(A.storeState(k),A.expectedStateId=k.id,B.pushState(k.id,k.title,k.url),A.Adapter.trigger(o,"popstate")),!0},A.replaceState=function(g,h,i,j){if(A.getHashByUrl(i)&&A.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(j!==!1&&A.busy()){return A.pushQueue({scope:A,callback:A.replaceState,args:arguments,queue:j}),!1}A.busy(!0);var k=A.createStateObject(g,h,i);return A.isLastSavedState(k)?A.busy(!1):(A.storeState(k),A.expectedStateId=k.id,B.replaceState(k.id,k.title,k.url),A.Adapter.trigger(o,"popstate")),!0}}if(t){try{A.store=y.parse(t.getItem("History.store"))||{}}catch(b){A.store={}}A.normalizeStore()}else{A.store={},A.normalizeStore()}A.Adapter.bind(o,"beforeunload",A.clearAllIntervals),A.Adapter.bind(o,"unload",A.clearAllIntervals),A.saveState(A.storeState(A.extractState(r.location.href,!0))),t&&(A.onUnload=function(){var d,e;try{d=y.parse(t.getItem("History.store"))||{}}catch(f){d={}}d.idToState=d.idToState||{},d.urlToId=d.urlToId||{},d.stateToId=d.stateToId||{};for(e in A.idToState){if(!A.idToState.hasOwnProperty(e)){continue}d.idToState[e]=A.idToState[e]}for(e in A.urlToId){if(!A.urlToId.hasOwnProperty(e)){continue}d.urlToId[e]=A.urlToId[e]}for(e in A.stateToId){if(!A.stateToId.hasOwnProperty(e)){continue}d.stateToId[e]=A.stateToId[e]}A.store=d,A.normalizeStore(),t.setItem("History.store",y.stringify(d))},A.intervalList.push(w(A.onUnload,A.options.storeInterval)),A.Adapter.bind(o,"beforeunload",A.onUnload),A.Adapter.bind(o,"unload",A.onUnload));if(!A.emulated.pushState){A.bugs.safariPoll&&A.intervalList.push(w(A.safariStatePoll,A.options.safariPollInterval));if(s.vendor==="Apple Computer, Inc."||(s.appCodeName||"")==="Mozilla"){A.Adapter.bind(o,"hashchange",function(){A.Adapter.trigger(o,"popstate")}),A.getHash()&&A.Adapter.onDomLoad(function(){A.Adapter.trigger(o,"hashchange")})}}},A.init()}(window);(function(){function d(j){throw j}var f=!0,g=null,h=!1;function i(j){return function(){return j}}var k=window,l=document,b=navigator,a=window.jQuery,c=void 0;function e(an){function y(w,C,B,E,H){var K=[];w=n.j(function(){var M=C(B,H)||[];0<K.length&&(n.a.Ya(I(K),M),E&&n.r.K(E,g,[B,M,H]));K.splice(0,K.length);n.a.P(K,M)},g,{W:w,Ka:function(){return 0==K.length||!n.a.X(K[0])}});return{M:K,j:w.pa()?w:c}}function I(w){for(;w.length&&!n.a.X(w[0]);){w.splice(0,1)}if(1<w.length){for(var C=w[0],B=w[w.length-1],E=[C];C!==B;){C=C.nextSibling;if(!C){return}E.push(C)}Array.prototype.splice.apply(w,[0,w.length].concat(E))}return w}function aj(w,C,E,H,K){var M=Math.min,O=Math.max,Q=[],R,S=w.length,T,U=C.length,W=U-S||1,N=S+U+1,P,B,X;for(R=0;R<=S;R++){B=P;Q.push(P=[]);X=M(U,R+W);for(T=O(0,R-1);T<=X;T++){P[T]=T?R?w[R-1]===C[T-1]?B[T-1]:M(B[T]||N,P[T-1]||N)+1:T+1:R+1}}M=[];O=[];W=[];R=S;for(T=U;R||T;){U=Q[R][T]-1,T&&U===Q[R][T-1]?O.push(M[M.length]={status:E,value:C[--T],index:T}):R&&U===Q[R-1][T]?W.push(M[M.length]={status:H,value:w[--R],index:R}):(M.push({status:"retained",value:C[--T]}),--R)}if(O.length&&W.length){w=10*S;var V;for(C=E=0;(K||C<w)&&(V=O[E]);E++){for(H=0;Q=W[H];H++){if(V.value===Q.value){V.moved=Q.index;Q.moved=V.index;W.splice(H,1);C=H=0;break}}C+=H}}return M.reverse()}function ak(w,C,B,E,H){H=H||{};var K=w&&L(w),K=K&&K.ownerDocument,M=H.templateEngine||ab;n.za.vb(B,M,K);B=M.renderTemplate(B,E,H,K);("number"!=typeof B.length||0<B.length&&"number"!=typeof B[0].nodeType)&&d(Error("Template engine must return an array of DOM nodes"));K=h;switch(C){case"replaceChildren":n.e.N(w,B);K=f;break;case"replaceNode":n.a.Ya(w,B);K=f;break;case"ignoreTargetNode":break;default:d(Error("Unknown renderMode: "+C))}K&&(al(B,E),H.afterRender&&n.r.K(H.afterRender,g,[B,E.$data]));return B}function L(w){return w.nodeType?w:0<w.length?w[0]:g}function al(w,C){if(w.length){var B=w[0],E=w[w.length-1];am(B,E,function(H){n.Da(C,H)});am(B,E,function(H){n.s.ib(H,[C])})}}function am(w,C,B){var E;for(C=n.e.nextSibling(C);w&&(E=w)!==C;){w=n.e.nextSibling(E),(1===E.nodeType||8===E.nodeType)&&B(E)}}function ao(w,C,B){w=n.g.aa(w);for(var E=n.g.Q,H=0;H<w.length;H++){var K=w[H].key;if(E.hasOwnProperty(K)){var M=E[K];"function"===typeof M?(K=M(w[H].value))&&d(Error(K)):M||d(Error("This template engine does not support the '"+K+"' binding within its templates"))}}w="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+n.g.ba(w)+" } })()})";return B.createJavaScriptEvaluatorBlock(w)+C}function ap(w,C,B,E){function H(P){return function(){return N[P]}}function K(){return N}var M=0,N,O;n.j(function(){var P=B&&B instanceof n.z?B:new n.z(n.a.d(B)),Q=P.$data;E&&n.eb(w,P);if(N=("function"==typeof C?C(P,w):C)||n.J.instance.getBindings(w,P)){if(0===M){M=1;for(var R in N){var S=n.c[R];S&&8===w.nodeType&&!n.e.I[R]&&d(Error("The binding '"+R+"' cannot be used with virtual elements"));if(S&&"function"==typeof S.init&&(S=(0,S.init)(w,H(R),K,Q,P))&&S.controlsDescendantBindings){O!==c&&d(Error("Multiple bindings ("+O+" and "+R+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.")),O=R}}M=2}if(2===M){for(R in N){(S=n.c[R])&&"function"==typeof S.update&&(0,S.update)(w,H(R),K,Q,P)}}}},g,{W:w});return{Nb:O===c}}function aq(w,C,B){var E=f,H=1===C.nodeType;H&&n.e.Ta(C);if(H&&B||n.J.instance.nodeHasBindings(C)){E=ap(C,g,w,B).Nb}E&&ar(w,C,!H)}function ar(w,C,B){for(var E=n.e.firstChild(C);C=E;){E=n.e.nextSibling(C),aq(w,C,B)}}function j(w,B){var C=m(w,B);return C?0<C.length?C[C.length-1].nextSibling:w.nextSibling:g}function m(w,B){for(var C=w,E=1,H=[];C=C.nextSibling;){if(x(C)&&(E--,0===E)){return H}H.push(C);o(C)&&E++}B||d(Error("Cannot find closing comment tag to match: "+w.nodeValue));return g}function x(w){return 8==w.nodeType&&(D?w.text:w.nodeValue).match(z)}function o(w){return 8==w.nodeType&&(D?w.text:w.nodeValue).match(A)}function ad(w,B){for(var C=g;w!=C;){C=w,w=w.replace(F,function(E,H){return B[H]})}return w}function G(){var w=[],B=[];this.save=function(C,E){var H=n.a.i(w,C);0<=H?B[H]=E:(w.push(C),B.push(E))};this.get=function(C){C=n.a.i(w,C);return 0<=C?B[C]:c}}function p(w,B,C){function E(N){var O=B(w[N]);switch(typeof O){case"boolean":case"number":case"string":case"function":H[N]=O;break;case"object":case"undefined":var P=C.get(O);H[N]=P!==c?P:p(O,B,C)}}C=C||new G;w=B(w);if(!("object"==typeof w&&w!==g&&w!==c&&!(w instanceof Date))){return w}var H=w instanceof Array?[]:{};C.save(w,H);var K=w;if(K instanceof Array){for(var M=0;M<K.length;M++){E(M)}"function"==typeof K.toJSON&&E("toJSON")}else{for(M in K){E(M)}}return H}function r(w,C){if(w){if(8==w.nodeType){var B=n.s.Ua(w.nodeValue);B!=g&&C.push({sb:w,Fb:B})}else{if(1==w.nodeType){for(var B=0,E=w.childNodes,H=E.length;B<H;B++){r(E[B],C)}}}}}function af(w,C,B,E){n.c[w]={init:function(H){n.a.f.set(H,s,{});return{controlsDescendantBindings:f}},update:function(H,K,M,N,O){M=n.a.f.get(H,s);K=n.a.d(K());N=!B!==!K;var P=!M.Za;if(P||C||N!==M.qb){P&&(M.Za=n.a.Ia(n.e.childNodes(H),f)),N?(P||n.e.N(H,n.a.Ia(M.Za)),n.Ea(E?E(O,K):O,H)):n.e.Y(H),M.qb=N}}};n.g.Q[w]=h;n.e.I[w]=f}function u(w,C,B){B&&C!==n.k.q(w)&&n.k.T(w,C);C!==n.k.q(w)&&n.r.K(n.a.Ba,g,[w,"change"])}var n="undefined"!==typeof an?an:{};n.b=function(w,C){for(var B=w.split("."),E=n,H=0;H<B.length-1;H++){E=E[B[H]]}E[B[B.length-1]]=C};n.p=function(w,B,C){w[B]=C};n.version="2.2.1";n.b("version",n.version);n.a=new function(){function w(Q,S){if("input"!==n.a.u(Q)||!Q.type||"click"!=S.toLowerCase()){return h}var R=Q.type;return"checkbox"==R||"radio"==R}var C=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,B={},E={};B[/Firefox\/2/i.test(b.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];B.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");for(var H in B){var K=B[H];if(K.length){for(var M=0,N=K.length;M<N;M++){E[K[M]]=H}}}var O={propertychange:f},P,B=3;H=l.createElement("div");for(K=H.getElementsByTagName("i");H.innerHTML="\x3c!--[if gt IE "+ ++B+"]><i></i><![endif]--\x3e",K[0];){}P=4<B?B:c;return{Na:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],o:function(Q,R){for(var T=0,S=Q.length;T<S;T++){R(Q[T])}},i:function(Q,R){if("function"==typeof Array.prototype.indexOf){return Array.prototype.indexOf.call(Q,R)}for(var T=0,S=Q.length;T<S;T++){if(Q[T]===R){return T}}return -1},lb:function(Q,R,T){for(var S=0,U=Q.length;S<U;S++){if(R.call(T,Q[S])){return Q[S]}}return g},ga:function(Q,S){var R=n.a.i(Q,S);0<=R&&Q.splice(R,1)},Ga:function(Q){Q=Q||[];for(var S=[],R=0,T=Q.length;R<T;R++){0>n.a.i(S,Q[R])&&S.push(Q[R])}return S},V:function(Q,R){Q=Q||[];for(var T=[],S=0,U=Q.length;S<U;S++){T.push(R(Q[S]))}return T},fa:function(Q,R){Q=Q||[];for(var T=[],S=0,U=Q.length;S<U;S++){R(Q[S])&&T.push(Q[S])}return T},P:function(Q,R){if(R instanceof Array){Q.push.apply(Q,R)}else{for(var T=0,S=R.length;T<S;T++){Q.push(R[T])}}return Q},extend:function(Q,R){if(R){for(var S in R){R.hasOwnProperty(S)&&(Q[S]=R[S])}}return Q},ka:function(Q){for(;Q.firstChild;){n.removeNode(Q.firstChild)}},Hb:function(Q){Q=n.a.L(Q);for(var S=l.createElement("div"),R=0,T=Q.length;R<T;R++){S.appendChild(n.A(Q[R]))}return S},Ia:function(Q,S){for(var R=0,T=Q.length,V=[];R<T;R++){var U=Q[R].cloneNode(f);V.push(S?n.A(U):U)}return V},N:function(Q,S){n.a.ka(Q);if(S){for(var R=0,T=S.length;R<T;R++){Q.appendChild(S[R])}}},Ya:function(Q,S){var R=Q.nodeType?[Q]:Q;if(0<R.length){for(var T=R[0],V=T.parentNode,U=0,W=S.length;U<W;U++){V.insertBefore(S[U],T)}U=0;for(W=R.length;U<W;U++){n.removeNode(R[U])}}},bb:function(Q,R){7>P?Q.setAttribute("selected",R):Q.selected=R},D:function(Q){return(Q||"").replace(C,"")},Rb:function(Q,S){for(var R=[],T=(Q||"").split(S),U=0,V=T.length;U<V;U++){var W=n.a.D(T[U]);""!==W&&R.push(W)}return R},Ob:function(Q,R){Q=Q||"";return R.length>Q.length?h:Q.substring(0,R.length)===R},tb:function(Q,R){if(R.compareDocumentPosition){return 16==(R.compareDocumentPosition(Q)&16)}for(;Q!=g;){if(Q==R){return f}Q=Q.parentNode}return h},X:function(Q){return n.a.tb(Q,Q.ownerDocument)},u:function(Q){return Q&&Q.tagName&&Q.tagName.toLowerCase()},n:function(Q,S,R){var T=P&&O[S];if(!T&&"undefined"!=typeof a){if(w(Q,S)){var U=R;R=function(V,W){var X=this.checked;W&&(this.checked=W.nb!==f);U.call(this,V);this.checked=X}}a(Q).bind(S,R)}else{!T&&"function"==typeof Q.addEventListener?Q.addEventListener(S,R,h):"undefined"!=typeof Q.attachEvent?Q.attachEvent("on"+S,function(V){R.call(Q,V)}):d(Error("Browser doesn't support addEventListener or attachEvent"))}},Ba:function(Q,S){(!Q||!Q.nodeType)&&d(Error("element must be a DOM node when calling triggerEvent"));if("undefined"!=typeof a){var R=[];w(Q,S)&&R.push({nb:Q.checked});a(Q).trigger(S,R)}else{"function"==typeof l.createEvent?"function"==typeof Q.dispatchEvent?(R=l.createEvent(E[S]||"HTMLEvents"),R.initEvent(S,f,f,k,0,0,0,0,0,h,h,h,h,0,Q),Q.dispatchEvent(R)):d(Error("The supplied element doesn't support dispatchEvent")):"undefined"!=typeof Q.fireEvent?(w(Q,S)&&(Q.checked=Q.checked!==f),Q.fireEvent("on"+S)):d(Error("Browser doesn't support triggering events"))}},d:function(Q){return n.$(Q)?Q():Q},ua:function(Q){return n.$(Q)?Q.t():Q},da:function(Q,S,R){if(S){var T=/[\w-]+/g,U=Q.className.match(T)||[];n.a.o(S.match(T),function(V){var W=n.a.i(U,V);0<=W?R||U.splice(W,1):R&&U.push(V)});Q.className=U.join(" ")}},cb:function(Q,S){var R=n.a.d(S);if(R===g||R===c){R=""}if(3===Q.nodeType){Q.data=R}else{var T=n.e.firstChild(Q);!T||3!=T.nodeType||n.e.nextSibling(T)?n.e.N(Q,[l.createTextNode(R)]):T.data=R;n.a.wb(Q)}},ab:function(Q,R){Q.name=R;if(7>=P){try{Q.mergeAttributes(l.createElement("<input name='"+Q.name+"'/>"),h)}catch(S){}}},wb:function(Q){9<=P&&(Q=1==Q.nodeType?Q:Q.parentNode,Q.style&&(Q.style.zoom=Q.style.zoom))},ub:function(Q){if(9<=P){var R=Q.style.width;Q.style.width=0;Q.style.width=R}},Lb:function(Q,S){Q=n.a.d(Q);S=n.a.d(S);for(var R=[],T=Q;T<=S;T++){R.push(T)}return R},L:function(Q){for(var R=[],T=0,S=Q.length;T<S;T++){R.push(Q[T])}return R},Pb:6===P,Qb:7===P,Z:P,Oa:function(Q,S){for(var R=n.a.L(Q.getElementsByTagName("input")).concat(n.a.L(Q.getElementsByTagName("textarea"))),T="string"==typeof S?function(W){return W.name===S}:function(W){return S.test(W.name)},U=[],V=R.length-1;0<=V;V--){T(R[V])&&U.push(R[V])}return U},Ib:function(Q){return"string"==typeof Q&&(Q=n.a.D(Q))?k.JSON&&k.JSON.parse?k.JSON.parse(Q):(new Function("return "+Q))():g},xa:function(Q,S,R){("undefined"==typeof JSON||"undefined"==typeof JSON.stringify)&&d(Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js"));return JSON.stringify(n.a.d(Q),S,R)},Jb:function(Q,S,R){R=R||{};var T=R.params||{},U=R.includeFields||this.Na,V=Q;if("object"==typeof Q&&"form"===n.a.u(Q)){for(var V=Q.action,W=U.length-1;0<=W;W--){for(var X=n.a.Oa(Q,U[W]),Y=X.length-1;0<=Y;Y--){T[X[Y].name]=X[Y].value}}}S=n.a.d(S);var Z=l.createElement("form");Z.style.display="none";Z.action=V;Z.method="post";for(var at in S){Q=l.createElement("input"),Q.name=at,Q.value=n.a.xa(n.a.d(S[at])),Z.appendChild(Q)}for(at in T){Q=l.createElement("input"),Q.name=at,Q.value=T[at],Z.appendChild(Q)}l.body.appendChild(Z);R.submitter?R.submitter(Z):Z.submit();setTimeout(function(){Z.parentNode.removeChild(Z)},0)}}};n.b("utils",n.a);n.b("utils.arrayForEach",n.a.o);n.b("utils.arrayFirst",n.a.lb);n.b("utils.arrayFilter",n.a.fa);n.b("utils.arrayGetDistinctValues",n.a.Ga);n.b("utils.arrayIndexOf",n.a.i);n.b("utils.arrayMap",n.a.V);n.b("utils.arrayPushAll",n.a.P);n.b("utils.arrayRemoveItem",n.a.ga);n.b("utils.extend",n.a.extend);n.b("utils.fieldsIncludedWithJsonPost",n.a.Na);n.b("utils.getFormFields",n.a.Oa);n.b("utils.peekObservable",n.a.ua);n.b("utils.postJson",n.a.Jb);n.b("utils.parseJson",n.a.Ib);n.b("utils.registerEventHandler",n.a.n);n.b("utils.stringifyJson",n.a.xa);n.b("utils.range",n.a.Lb);n.b("utils.toggleDomNodeCssClass",n.a.da);n.b("utils.triggerEvent",n.a.Ba);n.b("utils.unwrapObservable",n.a.d);Function.prototype.bind||(Function.prototype.bind=function(w){var B=this,C=Array.prototype.slice.call(arguments);w=C.shift();return function(){return B.apply(w,C.concat(Array.prototype.slice.call(arguments)))}});n.a.f=new function(){var w=0,C="__ko__"+(new Date).getTime(),B={};return{get:function(E,K){var H=n.a.f.la(E,h);return H===c?c:H[K]},set:function(E,K,H){H===c&&n.a.f.la(E,h)===c||(n.a.f.la(E,f)[K]=H)},la:function(E,H){var K=E[C];if(!K||!("null"!==K&&B[K])){if(!H){return c}K=E[C]="ko"+w++;B[K]={}}return B[K]},clear:function(E){var H=E[C];return H?(delete B[H],E[C]=g,f):h}}};n.b("utils.domData",n.a.f);n.b("utils.domData.clear",n.a.f.clear);n.a.F=new function(){function w(K,M){var N=n.a.f.get(K,B);N===c&&M&&(N=[],n.a.f.set(K,B,N));return N}function C(K){var M=w(K,h);if(M){for(var M=M.slice(0),N=0;N<M.length;N++){M[N](K)}}n.a.f.clear(K);"function"==typeof a&&"function"==typeof a.cleanData&&a.cleanData([K]);if(H[K.nodeType]){for(M=K.firstChild;K=M;){M=K.nextSibling,8===K.nodeType&&C(K)}}}var B="__ko_domNodeDisposal__"+(new Date).getTime(),E={1:f,8:f,9:f},H={1:f,9:f};return{Ca:function(K,M){"function"!=typeof M&&d(Error("Callback must be a function"));w(K,f).push(M)},Xa:function(K,M){var N=w(K,h);N&&(n.a.ga(N,M),0==N.length&&n.a.f.set(K,B,c))},A:function(K){if(E[K.nodeType]&&(C(K),H[K.nodeType])){var M=[];n.a.P(M,K.getElementsByTagName("*"));for(var N=0,O=M.length;N<O;N++){C(M[N])}}return K},removeNode:function(K){n.A(K);K.parentNode&&K.parentNode.removeChild(K)}}};n.A=n.a.F.A;n.removeNode=n.a.F.removeNode;n.b("cleanNode",n.A);n.b("removeNode",n.removeNode);n.b("utils.domNodeDisposal",n.a.F);n.b("utils.domNodeDisposal.addDisposeCallback",n.a.F.Ca);n.b("utils.domNodeDisposal.removeDisposeCallback",n.a.F.Xa);n.a.ta=function(w){var C;if("undefined"!=typeof a){if(a.parseHTML){C=a.parseHTML(w)}else{if((C=a.clean([w]))&&C[0]){for(w=C[0];w.parentNode&&11!==w.parentNode.nodeType;){w=w.parentNode}w.parentNode&&w.parentNode.removeChild(w)}}}else{var B=n.a.D(w).toLowerCase();C=l.createElement("div");B=B.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!B.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!B.indexOf("<td")||!B.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""];w="ignored<div>"+B[1]+w+B[2]+"</div>";for("function"==typeof k.innerShiv?C.appendChild(k.innerShiv(w)):C.innerHTML=w;B[0]--;){C=C.lastChild}C=n.a.L(C.lastChild.childNodes)}return C};n.a.ca=function(w,C){n.a.ka(w);C=n.a.d(C);if(C!==g&&C!==c){if("string"!=typeof C&&(C=C.toString()),"undefined"!=typeof a){a(w).html(C)}else{for(var B=n.a.ta(C),E=0;E<B.length;E++){w.appendChild(B[E])}}}};n.b("utils.parseHtmlFragment",n.a.ta);n.b("utils.setHtml",n.a.ca);var ah={};n.s={ra:function(w){"function"!=typeof w&&d(Error("You can only pass a function to ko.memoization.memoize()"));var B=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);ah[B]=w;return"\x3c!--[ko_memo:"+B+"]--\x3e"},hb:function(w,B){var C=ah[w];C===c&&d(Error("Couldn't find any memo with ID "+w+". Perhaps it's already been unmemoized."));try{return C.apply(g,B||[]),f}finally{delete ah[w]}},ib:function(w,C){var B=[];r(w,B);for(var E=0,H=B.length;E<H;E++){var K=B[E].sb,M=[K];C&&n.a.P(M,C);n.s.hb(B[E].Fb,M);K.nodeValue="";K.parentNode&&K.parentNode.removeChild(K)}},Ua:function(w){return(w=w.match(/^\[ko_memo\:(.*?)\]$/))?w[1]:g}};n.b("memoization",n.s);n.b("memoization.memoize",n.s.ra);n.b("memoization.unmemoize",n.s.hb);n.b("memoization.parseMemoText",n.s.Ua);n.b("memoization.unmemoizeDomNodeAndDescendants",n.s.ib);n.Ma={throttle:function(w,C){w.throttleEvaluation=C;var B=g;return n.j({read:w,write:function(E){clearTimeout(B);B=setTimeout(function(){w(E)},C)}})},notify:function(w,B){w.equalityComparer="always"==B?i(h):n.m.fn.equalityComparer;return w}};n.b("extenders",n.Ma);n.fb=function(w,C,B){this.target=w;this.ha=C;this.rb=B;n.p(this,"dispose",this.B)};n.fb.prototype.B=function(){this.Cb=f;this.rb()};n.S=function(){this.w={};n.a.extend(this,n.S.fn);n.p(this,"subscribe",this.ya);n.p(this,"extend",this.extend);n.p(this,"getSubscriptionsCount",this.yb)};n.S.fn={ya:function(w,C,B){B=B||"change";var E=new n.fb(this,C?w.bind(C):w,function(){n.a.ga(this.w[B],E)}.bind(this));this.w[B]||(this.w[B]=[]);this.w[B].push(E);return E},notifySubscribers:function(w,B){B=B||"change";this.w[B]&&n.r.K(function(){n.a.o(this.w[B].slice(0),function(C){C&&C.Cb!==f&&C.ha(w)})},this)},yb:function(){var w=0,B;for(B in this.w){this.w.hasOwnProperty(B)&&(w+=this.w[B].length)}return w},extend:function(w){var C=this;if(w){for(var B in w){var E=n.Ma[B];"function"==typeof E&&(C=E(C,w[B]))}}return C}};n.Qa=function(w){return"function"==typeof w.ya&&"function"==typeof w.notifySubscribers};n.b("subscribable",n.S);n.b("isSubscribable",n.Qa);var q=[];n.r={mb:function(w){q.push({ha:w,La:[]})},end:function(){q.pop()},Wa:function(w){n.Qa(w)||d(Error("Only subscribable things can act as dependencies"));if(0<q.length){var B=q[q.length-1];B&&!(0<=n.a.i(B.La,w))&&(B.La.push(w),B.ha(w))}},K:function(w,B,C){try{return q.push(g),w.apply(B,C||[])}finally{q.pop()}}};var J={undefined:f,"boolean":f,number:f,string:f};n.m=function(w){function C(){if(0<arguments.length){if(!C.equalityComparer||!C.equalityComparer(B,arguments[0])){C.H(),B=arguments[0],C.G()}return this}n.r.Wa(C);return B}var B=w;n.S.call(C);C.t=function(){return B};C.G=function(){C.notifySubscribers(B)};C.H=function(){C.notifySubscribers(B,"beforeChange")};n.a.extend(C,n.m.fn);n.p(C,"peek",C.t);n.p(C,"valueHasMutated",C.G);n.p(C,"valueWillMutate",C.H);return C};n.m.fn={equalityComparer:function(w,B){return w===g||typeof w in J?w===B:h}};var t=n.m.Kb="__ko_proto__";n.m.fn[t]=n.m;n.ma=function(w,B){return w===g||w===c||w[t]===c?h:w[t]===B?f:n.ma(w[t],B)};n.$=function(w){return n.ma(w,n.m)};n.Ra=function(w){return"function"==typeof w&&w[t]===n.m||"function"==typeof w&&w[t]===n.j&&w.zb?f:h};n.b("observable",n.m);n.b("isObservable",n.$);n.b("isWriteableObservable",n.Ra);n.R=function(w){0==arguments.length&&(w=[]);w!==g&&(w!==c&&!("length" in w))&&d(Error("The argument passed when initializing an observable array must be an array, or null, or undefined."));var B=n.m(w);n.a.extend(B,n.R.fn);return B};n.R.fn={remove:function(w){for(var B=this.t(),C=[],E="function"==typeof w?w:function(M){return M===w},H=0;H<B.length;H++){var K=B[H];E(K)&&(0===C.length&&this.H(),C.push(K),B.splice(H,1),H--)}C.length&&this.G();return C},removeAll:function(w){if(w===c){var C=this.t(),B=C.slice(0);this.H();C.splice(0,C.length);this.G();return B}return !w?[]:this.remove(function(E){return 0<=n.a.i(w,E)})},destroy:function(w){var B=this.t(),C="function"==typeof w?w:function(H){return H===w};this.H();for(var E=B.length-1;0<=E;E--){C(B[E])&&(B[E]._destroy=f)}this.G()},destroyAll:function(w){return w===c?this.destroy(i(f)):!w?[]:this.destroy(function(B){return 0<=n.a.i(w,B)})},indexOf:function(w){var B=this();return n.a.i(B,w)},replace:function(w,B){var C=this.indexOf(w);0<=C&&(this.H(),this.t()[C]=B,this.G())}};n.a.o("pop push reverse shift sort splice unshift".split(" "),function(w){n.R.fn[w]=function(){var B=this.t();this.H();B=B[w].apply(B,arguments);this.G();return B}});n.a.o(["slice"],function(w){n.R.fn[w]=function(){var B=this();return B[w].apply(B,arguments)}});n.b("observableArray",n.R);n.j=function(B,H,E){function M(){n.a.o(Z,function(w){w.B()});Z=[]}function N(){var w=Q.throttleEvaluation;w&&0<=w?(clearTimeout(W),W=setTimeout(O,w)):O()}function O(){if(!U){if(T&&Y()){C()}else{U=f;try{var w=n.a.V(Z,function(av){return av.target});n.r.mb(function(av){var aw;0<=(aw=n.a.i(w,av))?w[aw]=c:Z.push(av.ya(N))});for(var at=V.call(H),au=w.length-1;0<=au;au--){w[au]&&Z.splice(au,1)[0].B()}T=f;Q.notifySubscribers(S,"beforeChange");S=at}finally{n.r.end()}Q.notifySubscribers(S);U=h;Z.length||C()}}}function Q(){if(0<arguments.length){return"function"===typeof X?X.apply(H,arguments):d(Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.")),this}T||O();n.r.Wa(Q);return S}function R(){return !T||0<Z.length}var S,T=h,U=h,V=B;V&&"object"==typeof V?(E=V,V=E.read):(E=E||{},V||(V=E.read));"function"!=typeof V&&d(Error("Pass a function that returns the value of the ko.computed"));var X=E.write,P=E.disposeWhenNodeIsRemoved||E.W||g,Y=E.disposeWhen||E.Ka||i(h),C=M,Z=[],W=g;H||(H=E.owner);Q.t=function(){T||O();return S};Q.xb=function(){return Z.length};Q.zb="function"===typeof E.write;Q.B=function(){C()};Q.pa=R;n.S.call(Q);n.a.extend(Q,n.j.fn);n.p(Q,"peek",Q.t);n.p(Q,"dispose",Q.B);n.p(Q,"isActive",Q.pa);n.p(Q,"getDependenciesCount",Q.xb);E.deferEvaluation!==f&&O();if(P&&R()){C=function(){n.a.F.Xa(P,arguments.callee);M()};n.a.F.Ca(P,C);var K=Y,Y=function(){return !n.a.X(P)||K()}}return Q};n.Bb=function(w){return n.ma(w,n.j)};an=n.m.Kb;n.j[an]=n.m;n.j.fn={};n.j.fn[an]=n.j;n.b("dependentObservable",n.j);n.b("computed",n.j);n.b("isComputed",n.Bb);n.gb=function(w){0==arguments.length&&d(Error("When calling ko.toJS, pass the object you want to convert."));return p(w,function(B){for(var C=0;n.$(B)&&10>C;C++){B=B()}return B})};n.toJSON=function(w,C,B){w=n.gb(w);return n.a.xa(w,C,B)};n.b("toJS",n.gb);n.b("toJSON",n.toJSON);n.k={q:function(w){switch(n.a.u(w)){case"option":return w.__ko__hasDomDataOptionValue__===f?n.a.f.get(w,n.c.options.sa):7>=n.a.Z?w.getAttributeNode("value").specified?w.value:w.text:w.value;case"select":return 0<=w.selectedIndex?n.k.q(w.options[w.selectedIndex]):c;default:return w.value}},T:function(w,C){switch(n.a.u(w)){case"option":switch(typeof C){case"string":n.a.f.set(w,n.c.options.sa,c);"__ko__hasDomDataOptionValue__" in w&&delete w.__ko__hasDomDataOptionValue__;w.value=C;break;default:n.a.f.set(w,n.c.options.sa,C),w.__ko__hasDomDataOptionValue__=f,w.value="number"===typeof C?C:""}break;case"select":for(var B=w.options.length-1;0<=B;B--){if(n.k.q(w.options[B])==C){w.selectedIndex=B;break}}break;default:if(C===g||C===c){C=""}w.value=C}}};n.b("selectExtensions",n.k);n.b("selectExtensions.readValue",n.k.q);n.b("selectExtensions.writeValue",n.k.T);var F=/\@ko_token_(\d+)\@/g,aa=["true","false"],ac=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;n.g={Q:[],aa:function(w){var C=n.a.D(w);if(3>C.length){return[]}"{"===C.charAt(0)&&(C=C.substring(1,C.length-1));w=[];for(var B=g,E,H=0;H<C.length;H++){var K=C.charAt(H);if(B===g){switch(K){case'"':case"'":case"/":B=H,E=K}}else{if(K==E&&"\\"!==C.charAt(H-1)){K=C.substring(B,H+1);w.push(K);var M="@ko_token_"+(w.length-1)+"@",C=C.substring(0,B)+M+C.substring(H+1),H=H-(K.length-M.length),B=g}}}E=B=g;for(var N=0,O=g,H=0;H<C.length;H++){K=C.charAt(H);if(B===g){switch(K){case"{":B=H;O=K;E="}";break;case"(":B=H;O=K;E=")";break;case"[":B=H,O=K,E="]"}}K===O?N++:K===E&&(N--,0===N&&(K=C.substring(B,H+1),w.push(K),M="@ko_token_"+(w.length-1)+"@",C=C.substring(0,B)+M+C.substring(H+1),H-=K.length-M.length,B=g))}E=[];C=C.split(",");B=0;for(H=C.length;B<H;B++){N=C[B],O=N.indexOf(":"),0<O&&O<N.length-1?(K=N.substring(O+1),E.push({key:ad(N.substring(0,O),w),value:ad(K,w)})):E.push({unknown:ad(N,w)})}return E},ba:function(w){var C="string"===typeof w?n.g.aa(w):w,B=[];w=[];for(var E,H=0;E=C[H];H++){if(0<B.length&&B.push(","),E.key){var K;w:{K=E.key;var M=n.a.D(K);switch(M.length&&M.charAt(0)){case"'":case'"':break w;default:K="'"+M+"'"}}E=E.value;B.push(K);B.push(":");B.push(E);E=n.a.D(E);0<=n.a.i(aa,n.a.D(E).toLowerCase())?E=h:(M=E.match(ac),E=M===g?h:M[1]?"Object("+M[1]+")"+M[2]:E);E&&(0<w.length&&w.push(", "),w.push(K+" : function(__ko_value) { "+E+" = __ko_value; }"))}else{E.unknown&&B.push(E.unknown)}}C=B.join("");0<w.length&&(C=C+", '_ko_property_writers' : { "+w.join("")+" } ");return C},Eb:function(w,C){for(var B=0;B<w.length;B++){if(n.a.D(w[B].key)==C){return f}}return h},ea:function(w,C,B,E,H){if(!w||!n.Ra(w)){if((w=C()._ko_property_writers)&&w[B]){w[B](E)}}else{(!H||w.t()!==E)&&w(E)}}};n.b("expressionRewriting",n.g);n.b("expressionRewriting.bindingRewriteValidators",n.g.Q);n.b("expressionRewriting.parseObjectLiteral",n.g.aa);n.b("expressionRewriting.preProcessBindings",n.g.ba);n.b("jsonExpressionRewriting",n.g);n.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",n.g.ba);var D="\x3c!--test--\x3e"===l.createComment("test").text,A=D?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,z=D?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,ae={ul:f,ol:f};n.e={I:{},childNodes:function(w){return o(w)?m(w):w.childNodes},Y:function(w){if(o(w)){w=n.e.childNodes(w);for(var C=0,B=w.length;C<B;C++){n.removeNode(w[C])}}else{n.a.ka(w)}},N:function(w,C){if(o(w)){n.e.Y(w);for(var B=w.nextSibling,E=0,H=C.length;E<H;E++){B.parentNode.insertBefore(C[E],B)}}else{n.a.N(w,C)}},Va:function(w,B){o(w)?w.parentNode.insertBefore(B,w.nextSibling):w.firstChild?w.insertBefore(B,w.firstChild):w.appendChild(B)},Pa:function(w,C,B){B?o(w)?w.parentNode.insertBefore(C,B.nextSibling):B.nextSibling?w.insertBefore(C,B.nextSibling):w.appendChild(C):n.e.Va(w,C)},firstChild:function(w){return !o(w)?w.firstChild:!w.nextSibling||x(w.nextSibling)?g:w.nextSibling},nextSibling:function(w){o(w)&&(w=j(w));return w.nextSibling&&x(w.nextSibling)?g:w.nextSibling},jb:function(w){return(w=o(w))?w[1]:g},Ta:function(w){if(ae[n.a.u(w)]){var C=w.firstChild;if(C){do{if(1===C.nodeType){var B;B=C.firstChild;var E=g;if(B){do{if(E){E.push(B)}else{if(o(B)){var H=j(B,f);H?B=H:E=[B]}else{x(B)&&(E=[B])}}}while(B=B.nextSibling)}if(B=E){E=C.nextSibling;for(H=0;H<B.length;H++){E?w.insertBefore(B[H],E):w.appendChild(B[H])}}}}while(C=C.nextSibling)}}}};n.b("virtualElements",n.e);n.b("virtualElements.allowedBindings",n.e.I);n.b("virtualElements.emptyNode",n.e.Y);n.b("virtualElements.insertAfter",n.e.Pa);n.b("virtualElements.prepend",n.e.Va);n.b("virtualElements.setDomNodeChildren",n.e.N);n.J=function(){this.Ha={}};n.a.extend(n.J.prototype,{nodeHasBindings:function(w){switch(w.nodeType){case 1:return w.getAttribute("data-bind")!=g;case 8:return n.e.jb(w)!=g;default:return h}},getBindings:function(w,B){var C=this.getBindingsString(w,B);return C?this.parseBindingsString(C,B,w):g},getBindingsString:function(w){switch(w.nodeType){case 1:return w.getAttribute("data-bind");case 8:return n.e.jb(w);default:return g}},parseBindingsString:function(w,C,B){try{var E;if(!(E=this.Ha[w])){var H=this.Ha,K,M="with($context){with($data||{}){return{"+n.g.ba(w)+"}}}";K=new Function("$context","$element",M);E=H[w]=K}return E(C,B)}catch(N){d(Error("Unable to parse bindings.\nMessage: "+N+";\nBindings value: "+w))}}});n.J.instance=new n.J;n.b("bindingProvider",n.J);n.c={};n.z=function(w,C,B){C?(n.a.extend(this,C),this.$parentContext=C,this.$parent=C.$data,this.$parents=(C.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=w,this.ko=n);this.$data=w;B&&(this[B]=w)};n.z.prototype.createChildContext=function(w,B){return new n.z(w,this,B)};n.z.prototype.extend=function(w){var B=n.a.extend(new n.z,this);return n.a.extend(B,w)};n.eb=function(w,B){if(2==arguments.length){n.a.f.set(w,"__ko_bindingContext__",B)}else{return n.a.f.get(w,"__ko_bindingContext__")}};n.Fa=function(w,C,B){1===w.nodeType&&n.e.Ta(w);return ap(w,C,B,f)};n.Ea=function(w,B){(1===B.nodeType||8===B.nodeType)&&ar(w,B,f)};n.Da=function(w,B){B&&(1!==B.nodeType&&8!==B.nodeType)&&d(Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node"));B=B||k.document.body;aq(w,B,f)};n.ja=function(w){switch(w.nodeType){case 1:case 8:var B=n.eb(w);if(B){return B}if(w.parentNode){return n.ja(w.parentNode)}}return c};n.pb=function(w){return(w=n.ja(w))?w.$data:c};n.b("bindingHandlers",n.c);n.b("applyBindings",n.Da);n.b("applyBindingsToDescendants",n.Ea);n.b("applyBindingsToNode",n.Fa);n.b("contextFor",n.ja);n.b("dataFor",n.pb);var v={"class":"className","for":"htmlFor"};n.c.attr={update:function(w,C){var B=n.a.d(C())||{},E;for(E in B){if("string"==typeof E){var H=n.a.d(B[E]),K=H===h||H===g||H===c;K&&w.removeAttribute(E);8>=n.a.Z&&E in v?(E=v[E],K?w.removeAttribute(E):w[E]=H):K||w.setAttribute(E,H.toString());"name"===E&&n.a.ab(w,K?"":H.toString())}}}};n.c.checked={init:function(w,C,B){n.a.n(w,"click",function(){var E;if("checkbox"==w.type){E=w.checked}else{if("radio"==w.type&&w.checked){E=w.value}else{return}}var H=C(),K=n.a.d(H);"checkbox"==w.type&&K instanceof Array?(E=n.a.i(K,w.value),w.checked&&0>E?H.push(w.value):!w.checked&&0<=E&&H.splice(E,1)):n.g.ea(H,B,"checked",E,f)});"radio"==w.type&&!w.name&&n.c.uniqueName.init(w,i(f))},update:function(w,C){var B=n.a.d(C());"checkbox"==w.type?w.checked=B instanceof Array?0<=n.a.i(B,w.value):B:"radio"==w.type&&(w.checked=w.value==B)}};n.c.css={update:function(w,C){var B=n.a.d(C());if("object"==typeof B){for(var E in B){var H=n.a.d(B[E]);n.a.da(w,E,H)}}else{B=String(B||""),n.a.da(w,w.__ko__cssValue,h),w.__ko__cssValue=B,n.a.da(w,B,f)}}};n.c.enable={update:function(w,C){var B=n.a.d(C());B&&w.disabled?w.removeAttribute("disabled"):!B&&!w.disabled&&(w.disabled=f)}};n.c.disable={update:function(w,B){n.c.enable.update(w,function(){return !n.a.d(B())})}};n.c.event={init:function(w,C,B,E){var H=C()||{},K;for(K in H){(function(){var M=K;"string"==typeof M&&n.a.n(w,M,function(N){var O,P=C()[M];if(P){var Q=B();try{var R=n.a.L(arguments);R.unshift(E);O=P.apply(E,R)}finally{O!==f&&(N.preventDefault?N.preventDefault():N.returnValue=h)}Q[M+"Bubble"]===h&&(N.cancelBubble=f,N.stopPropagation&&N.stopPropagation())}})})()}}};n.c.foreach={Sa:function(w){return function(){var C=w(),B=n.a.ua(C);if(!B||"number"==typeof B.length){return{foreach:C,templateEngine:n.C.oa}}n.a.d(C);return{foreach:B.data,as:B.as,includeDestroyed:B.includeDestroyed,afterAdd:B.afterAdd,beforeRemove:B.beforeRemove,afterRender:B.afterRender,beforeMove:B.beforeMove,afterMove:B.afterMove,templateEngine:n.C.oa}}},init:function(w,B){return n.c.template.init(w,n.c.foreach.Sa(B))},update:function(w,C,B,E,H){return n.c.template.update(w,n.c.foreach.Sa(C),B,E,H)}};n.g.Q.foreach=h;n.e.I.foreach=f;n.c.hasfocus={init:function(w,C,B){function E(M){w.__ko_hasfocusUpdating=f;var N=w.ownerDocument;"activeElement" in N&&(M=N.activeElement===w);N=C();n.g.ea(N,B,"hasfocus",M,f);w.__ko_hasfocusUpdating=h}var H=E.bind(g,f),K=E.bind(g,h);n.a.n(w,"focus",H);n.a.n(w,"focusin",H);n.a.n(w,"blur",K);n.a.n(w,"focusout",K)},update:function(w,C){var B=n.a.d(C());w.__ko_hasfocusUpdating||(B?w.focus():w.blur(),n.r.K(n.a.Ba,g,[w,B?"focusin":"focusout"]))}};n.c.html={init:function(){return{controlsDescendantBindings:f}},update:function(w,B){n.a.ca(w,B())}};var s="__ko_withIfBindingData";af("if");af("ifnot",h,f);af("with",f,h,function(w,B){return w.createChildContext(B)});n.c.options={update:function(w,C,B){"select"!==n.a.u(w)&&d(Error("options binding applies only to SELECT elements"));for(var E=0==w.length,H=n.a.V(n.a.fa(w.childNodes,function(T){return T.tagName&&"option"===n.a.u(T)&&T.selected}),function(T){return n.k.q(T)||T.innerText||T.textContent}),K=w.scrollTop,M=n.a.d(C());0<w.length;){n.A(w.options[0]),w.remove(0)}if(M){B=B();var N=B.optionsIncludeDestroyed;"number"!=typeof M.length&&(M=[M]);if(B.optionsCaption){var O=l.createElement("option");n.a.ca(O,B.optionsCaption);n.k.T(O,c);w.appendChild(O)}C=0;for(var P=M.length;C<P;C++){var Q=M[C];if(!Q||!Q._destroy||N){var O=l.createElement("option"),R=function(T,U,V){var W=typeof U;return"function"==W?U(T):"string"==W?T[U]:V},S=R(Q,B.optionsValue,Q);n.k.T(O,n.a.d(S));Q=R(Q,B.optionsText,S);n.a.cb(O,Q);w.appendChild(O)}}M=w.getElementsByTagName("option");C=N=0;for(P=M.length;C<P;C++){0<=n.a.i(H,n.k.q(M[C]))&&(n.a.bb(M[C],f),N++)}w.scrollTop=K;E&&"value" in B&&u(w,n.a.ua(B.value),f);n.a.ub(w)}}};n.c.options.sa="__ko.optionValueDomData__";n.c.selectedOptions={init:function(w,C,B){n.a.n(w,"change",function(){var E=C(),H=[];n.a.o(w.getElementsByTagName("option"),function(K){K.selected&&H.push(n.k.q(K))});n.g.ea(E,B,"value",H)})},update:function(w,C){"select"!=n.a.u(w)&&d(Error("values binding applies only to SELECT elements"));var B=n.a.d(C());B&&"number"==typeof B.length&&n.a.o(w.getElementsByTagName("option"),function(E){var H=0<=n.a.i(B,n.k.q(E));n.a.bb(E,H)})}};n.c.style={update:function(w,C){var B=n.a.d(C()||{}),E;for(E in B){if("string"==typeof E){var H=n.a.d(B[E]);w.style[E]=H||""}}}};n.c.submit={init:function(w,C,B,E){"function"!=typeof C()&&d(Error("The value for a submit binding must be a function"));n.a.n(w,"submit",function(H){var K,M=C();try{K=M.call(E,w)}finally{K!==f&&(H.preventDefault?H.preventDefault():H.returnValue=h)}})}};n.c.text={update:function(w,B){n.a.cb(w,B())}};n.e.I.text=f;n.c.uniqueName={init:function(w,C){if(C()){var B="ko_unique_"+ ++n.c.uniqueName.ob;n.a.ab(w,B)}}};n.c.uniqueName.ob=0;n.c.value={init:function(w,C,B){function E(){M=h;var N=C(),O=n.k.q(w);n.g.ea(N,B,"value",O)}var H=["change"],K=B().valueUpdate,M=h;K&&("string"==typeof K&&(K=[K]),n.a.P(H,K),H=n.a.Ga(H));if(n.a.Z&&("input"==w.tagName.toLowerCase()&&"text"==w.type&&"off"!=w.autocomplete&&(!w.form||"off"!=w.form.autocomplete))&&-1==n.a.i(H,"propertychange")){n.a.n(w,"propertychange",function(){M=f}),n.a.n(w,"blur",function(){M&&E()})}n.a.o(H,function(N){var O=E;n.a.Ob(N,"after")&&(O=function(){setTimeout(E,0)},N=N.substring(5));n.a.n(w,N,O)})},update:function(w,C){var B="select"===n.a.u(w),E=n.a.d(C()),H=n.k.q(w),K=E!=H;0===E&&(0!==H&&"0"!==H)&&(K=f);K&&(H=function(){n.k.T(w,E)},H(),B&&setTimeout(H,0));B&&0<w.length&&u(w,E,h)}};n.c.visible={update:function(w,C){var B=n.a.d(C()),E="none"!=w.style.display;B&&!E?w.style.display="":!B&&E&&(w.style.display="none")}};n.c.click={init:function(w,C,B,E){return n.c.event.init.call(this,w,function(){var H={};H.click=C();return H},B,E)}};n.v=function(){};n.v.prototype.renderTemplateSource=function(){d(Error("Override renderTemplateSource"))};n.v.prototype.createJavaScriptEvaluatorBlock=function(){d(Error("Override createJavaScriptEvaluatorBlock"))};n.v.prototype.makeTemplateSource=function(w,C){if("string"==typeof w){C=C||l;var B=C.getElementById(w);B||d(Error("Cannot find template with ID "+w));return new n.l.h(B)}if(1==w.nodeType||8==w.nodeType){return new n.l.O(w)}d(Error("Unknown template type: "+w))};n.v.prototype.renderTemplate=function(w,B,C,E){w=this.makeTemplateSource(w,E);return this.renderTemplateSource(w,B,C)};n.v.prototype.isTemplateRewritten=function(w,B){return this.allowTemplateRewriting===h?f:this.makeTemplateSource(w,B).data("isRewritten")};n.v.prototype.rewriteTemplate=function(w,B,C){w=this.makeTemplateSource(w,C);B=B(w.text());w.text(B);w.data("isRewritten",f)};n.b("templateEngine",n.v);var ag=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,ai=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;n.za={vb:function(w,C,B){C.isTemplateRewritten(w,B)||C.rewriteTemplate(w,function(E){return n.za.Gb(E,C)},B)},Gb:function(w,B){return w.replace(ag,function(C,E,H,K,M,N,O){return ao(O,E,B)}).replace(ai,function(C,E){return ao(E,"\x3c!-- ko --\x3e",B)})},kb:function(w){return n.s.ra(function(C,B){C.nextSibling&&n.Fa(C.nextSibling,w,B)})}};n.b("__tr_ambtns",n.za.kb);n.l={};n.l.h=function(w){this.h=w};n.l.h.prototype.text=function(){var w=n.a.u(this.h),w="script"===w?"text":"textarea"===w?"value":"innerHTML";if(0==arguments.length){return this.h[w]}var B=arguments[0];"innerHTML"===w?n.a.ca(this.h,B):this.h[w]=B};n.l.h.prototype.data=function(w){if(1===arguments.length){return n.a.f.get(this.h,"templateSourceData_"+w)}n.a.f.set(this.h,"templateSourceData_"+w,arguments[1])};n.l.O=function(w){this.h=w};n.l.O.prototype=new n.l.h;n.l.O.prototype.text=function(){if(0==arguments.length){var w=n.a.f.get(this.h,"__ko_anon_template__")||{};w.Aa===c&&w.ia&&(w.Aa=w.ia.innerHTML);return w.Aa}n.a.f.set(this.h,"__ko_anon_template__",{Aa:arguments[0]})};n.l.h.prototype.nodes=function(){if(0==arguments.length){return(n.a.f.get(this.h,"__ko_anon_template__")||{}).ia}n.a.f.set(this.h,"__ko_anon_template__",{ia:arguments[0]})};n.b("templateSources",n.l);n.b("templateSources.domElement",n.l.h);n.b("templateSources.anonymousTemplate",n.l.O);var ab;n.wa=function(w){w!=c&&!(w instanceof n.v)&&d(Error("templateEngine must inherit from ko.templateEngine"));ab=w};n.va=function(w,C,B,E,H){B=B||{};(B.templateEngine||ab)==c&&d(Error("Set a template engine before calling renderTemplate"));H=H||"replaceChildren";if(E){var K=L(E);return n.j(function(){var M=C&&C instanceof n.z?C:new n.z(n.a.d(C)),N="function"==typeof w?w(M.$data,M):w,M=ak(E,H,N,M,B);"replaceNode"==H&&(E=M,K=L(E))},g,{Ka:function(){return !K||!n.a.X(K)},W:K&&"replaceNode"==H?K.parentNode:K})}return n.s.ra(function(M){n.va(w,C,B,M,"replaceNode")})};n.Mb=function(w,C,B,E,H){function K(O,P){al(P,N);B.afterRender&&B.afterRender(P,O)}function M(O,P){N=H.createChildContext(n.a.d(O),B.as);N.$index=P;var Q="function"==typeof w?w(O,N):w;return ak(g,"ignoreTargetNode",Q,N,B)}var N;return n.j(function(){var O=n.a.d(C)||[];"undefined"==typeof O.length&&(O=[O]);O=n.a.fa(O,function(P){return B.includeDestroyed||P===c||P===g||!n.a.d(P._destroy)});n.r.K(n.a.$a,g,[E,O,M,B,K])},g,{W:E})};n.c.template={init:function(w,C){var B=n.a.d(C());if("string"!=typeof B&&!B.name&&(1==w.nodeType||8==w.nodeType)){B=1==w.nodeType?w.childNodes:n.e.childNodes(w),B=n.a.Hb(B),(new n.l.O(w)).nodes(B)}return{controlsDescendantBindings:f}},update:function(w,C,B,E,H){C=n.a.d(C());B={};E=f;var K,M=g;"string"!=typeof C&&(B=C,C=B.name,"if" in B&&(E=n.a.d(B["if"])),E&&"ifnot" in B&&(E=!n.a.d(B.ifnot)),K=n.a.d(B.data));"foreach" in B?M=n.Mb(C||w,E&&B.foreach||[],B,w,H):E?(H="data" in B?H.createChildContext(K,B.as):H,M=n.va(C||w,H,B,w)):n.e.Y(w);H=M;(K=n.a.f.get(w,"__ko__templateComputedDomDataKey__"))&&"function"==typeof K.B&&K.B();n.a.f.set(w,"__ko__templateComputedDomDataKey__",H&&H.pa()?H:c)}};n.g.Q.template=function(w){w=n.g.aa(w);return 1==w.length&&w[0].unknown||n.g.Eb(w,"name")?g:"This template engine does not support anonymous templates nested within its templates"};n.e.I.template=f;n.b("setTemplateEngine",n.wa);n.b("renderTemplate",n.va);n.a.Ja=function(w,B,C){w=w||[];B=B||[];return w.length<=B.length?aj(w,B,"added","deleted",C):aj(B,w,"deleted","added",C)};n.b("utils.compareArrays",n.a.Ja);n.a.$a=function(K,Q,O,S,U){function V(w,B){aw=Z[B];ay!==B&&(az[w]=aw);aw.na(ay++);I(aw.M);av.push(aw);M.push(aw)}function W(w,B){if(w){for(var C=0,E=B.length;C<E;C++){B[C]&&n.a.o(B[C].M,function(H){w(H,C,B[C].U)})}}}Q=Q||[];S=S||{};var Y=n.a.f.get(K,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===c,Z=n.a.f.get(K,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],at=n.a.V(Z,function(w){return w.U}),au=n.a.Ja(at,Q),av=[],ax=0,ay=0,N=[],M=[];Q=[];for(var az=[],at=[],aw,R=0,P,T;P=au[R];R++){switch(T=P.moved,P.status){case"deleted":T===c&&(aw=Z[ax],aw.j&&aw.j.B(),N.push.apply(N,I(aw.M)),S.beforeRemove&&(Q[R]=aw,M.push(aw)));ax++;break;case"retained":V(R,ax++);break;case"added":T!==c?V(R,T):(aw={U:P.value,na:n.m(ay++)},av.push(aw),M.push(aw),Y||(at[R]=aw))}}W(S.beforeMove,az);n.a.o(N,S.beforeRemove?n.A:n.removeNode);for(var R=0,Y=n.e.firstChild(K),X;aw=M[R];R++){aw.M||n.a.extend(aw,y(K,O,aw.U,U,aw.na));for(ax=0;au=aw.M[ax];Y=au.nextSibling,X=au,ax++){au!==Y&&n.e.Pa(K,au,X)}!aw.Ab&&U&&(U(aw.U,aw.M,aw.na),aw.Ab=f)}W(S.beforeRemove,Q);W(S.afterMove,az);W(S.afterAdd,at);n.a.f.set(K,"setDomNodeChildrenFromArrayMapping_lastMappingResult",av)};n.b("utils.setDomNodeChildrenFromArrayMapping",n.a.$a);n.C=function(){this.allowTemplateRewriting=h};n.C.prototype=new n.v;n.C.prototype.renderTemplateSource=function(w){var B=!(9>n.a.Z)&&w.nodes?w.nodes():g;if(B){return n.a.L(B.cloneNode(f).childNodes)}w=w.text();return n.a.ta(w)};n.C.oa=new n.C;n.wa(n.C.oa);n.b("nativeTemplateEngine",n.C);n.qa=function(){var w=this.Db=function(){if("undefined"==typeof a||!a.tmpl){return 0}try{if(0<=a.tmpl.tag.tmpl.open.toString().indexOf("__")){return 2}}catch(B){}return 1}();this.renderTemplateSource=function(B,C,E){E=E||{};2>w&&d(Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later."));var H=B.data("precompiled");H||(H=B.text()||"",H=a.template(g,"{{ko_with $item.koBindingContext}}"+H+"{{/ko_with}}"),B.data("precompiled",H));B=[C.$data];C=a.extend({koBindingContext:C},E.templateOptions);C=a.tmpl(H,B,C);C.appendTo(l.createElement("div"));a.fragments={};return C};this.createJavaScriptEvaluatorBlock=function(B){return"{{ko_code ((function() { return "+B+" })()) }}"};this.addTemplate=function(B,C){l.write("<script type='text/html' id='"+B+"'>"+C+"\x3c/script>")};0<w&&(a.tmpl.tag.ko_code={open:"__.push($1 || '');"},a.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};n.qa.prototype=new n.v;an=new n.qa;0<an.Db&&n.wa(an);n.b("jqueryTmplTemplateEngine",n.qa)}"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?e(module.exports||exports):"function"===typeof define&&define.amd?define(["exports"],e):e(k.ko={});f})();window.Modernizr=function(I,K,M){function J(b){Z.cssText=b}function L(c,d){return J(ac.join(c+";")+(d||""))}function N(c,d){return typeof c===d}function P(c,d){return !!~(""+c).indexOf(d)}function R(c,f){for(var g in c){var h=c[g];if(!P(h,"-")&&Z[h]!==M){return f=="pfx"?h:!0}}return !1}function T(c,g,h){for(var i in c){var j=g[c[i]];if(j!==M){return h===!1?c[i]:N(j,"function")?j.bind(h||g):j}}return !1}function V(f,g,h){var i=f.charAt(0).toUpperCase()+f.slice(1),j=(f+" "+ae.join(i+" ")+i).split(" ");return N(g,"string")||N(g,"undefined")?R(j,g):(j=(f+" "+af.join(i+" ")+i).split(" "),T(j,g,h))}var O="2.6.2",Q={},S=!0,U=K.documentElement,W="modernizr",Y=K.createElement(W),Z=Y.style,aa,ab={}.toString,ac=" -webkit- -moz- -o- -ms- ".split(" "),ad="Webkit Moz O ms",ae=ad.split(" "),af=ad.toLowerCase().split(" "),ag={},ah={},ai={},aj=[],ak=aj.slice,al,am=function(b,g,h,o){var p,q,r,s,t=K.createElement("div"),u=K.body,v=u||K.createElement("body");if(parseInt(h,10)){while(h--){r=K.createElement("div"),r.id=o?o[h]:W+(h+1),t.appendChild(r)}}return p=["&#173;",'<style id="s',W,'">',b,"</style>"].join(""),t.id=W,(u?t:v).innerHTML+=p,v.appendChild(t),u||(v.style.background="",v.style.overflow="hidden",s=U.style.overflow,U.style.overflow="hidden",U.appendChild(v)),q=g(t,b),u?t.parentNode.removeChild(t):(v.parentNode.removeChild(v),U.style.overflow=s),!!q},an=function(){function c(a,g){g=g||K.createElement(b[a]||"div"),a="on"+a;var h=a in g;return h||(g.setAttribute||(g=K.createElement("div")),g.setAttribute&&g.removeAttribute&&(g.setAttribute(a,""),h=N(g[a],"function"),N(g[a],"undefined")||(g[a]=M),g.removeAttribute(a))),g=null,h}var b={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return c}(),ao={}.hasOwnProperty,ap;!N(ao,"undefined")&&!N(ao.call,"undefined")?ap=function(c,d){return ao.call(c,d)}:ap=function(c,d){return d in c&&N(c.constructor.prototype[d],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var f=this;if(typeof f!="function"){throw new TypeError}var g=ak.call(arguments,1),h=function(){if(this instanceof h){var b=function(){};b.prototype=f.prototype;var c=new b,d=f.apply(c,g.concat(ak.call(arguments)));return Object(d)===d?d:c}return f.apply(a,g.concat(ak.call(arguments)))};return h}),ag.cssanimations=function(){return V("animationName")},ag.csstransitions=function(){return V("transition")},ag.localstorage=function(){try{return localStorage.setItem(W,W),localStorage.removeItem(W),!0}catch(b){return !1}},ag.sessionstorage=function(){try{return sessionStorage.setItem(W,W),sessionStorage.removeItem(W),!0}catch(b){return !1}};for(var X in ag){ap(ag,X)&&(al=X.toLowerCase(),Q[al]=ag[X](),aj.push((Q[al]?"":"no-")+al))}return Q.addTest=function(c,e){if(typeof c=="object"){for(var f in c){ap(c,f)&&Q.addTest(f,c[f])}}else{c=c.toLowerCase();if(Q[c]!==M){return Q}e=typeof e=="function"?e():e,typeof S!="undefined"&&S&&(U.className+=" "+(e?"":"no-")+c),Q[c]=e}return Q},J(""),Y=aa=null,function(s,t){function C(e,f){var g=e.createElement("p"),h=e.getElementsByTagName("head")[0]||e.documentElement;return g.innerHTML="x<style>"+f+"</style>",h.insertBefore(g.lastChild,h.firstChild)}function D(){var b=ar.elements;return typeof b=="string"?b.split(" "):b}function E(c){var d=A[c[y]];return d||(d={},z++,c[y]=z,A[z]=d),d}function F(b,d,e){d||(d=t);if(B){return d.createElement(b)}e||(e=E(d));var h;return e.cache[b]?h=e.cache[b].cloneNode():w.test(b)?h=(e.cache[b]=e.createElem(b)).cloneNode():h=e.createElem(b),h.canHaveChildren&&!v.test(b)?e.frag.appendChild(h):h}function G(b,h){b||(b=t);if(B){return b.createDocumentFragment()}h=h||E(b);var i=h.frag.cloneNode(),j=0,k=D(),l=k.length;for(;j<l;j++){i.createElement(k[j])}return i}function H(c,d){d.cache||(d.cache={},d.createElem=c.createElement,d.createFrag=c.createDocumentFragment,d.frag=d.createFrag()),c.createElement=function(a){return ar.shivMethods?F(a,c,d):d.createElem(a)},c.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+D().join().replace(/\w+/g,function(b){return d.createElem(b),d.frag.createElement(b),'c("'+b+'")'})+");return n}")(ar,d.frag)}function aq(b){b||(b=t);var d=E(b);return ar.shivCSS&&!x&&!d.hasCSS&&(d.hasCSS=!!C(b,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),B||H(b,d),b}var u=s.html5||{},v=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,w=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,x,y="_html5shiv",z=0,A={},B;(function(){try{var b=t.createElement("a");b.innerHTML="<xyz></xyz>",x="hidden" in b,B=b.childNodes.length==1||function(){t.createElement("a");var c=t.createDocumentFragment();return typeof c.cloneNode=="undefined"||typeof c.createDocumentFragment=="undefined"||typeof c.createElement=="undefined"}()}catch(d){x=!0,B=!0}})();var ar={elements:u.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:u.shivCSS!==!1,supportsUnknownElements:B,shivMethods:u.shivMethods!==!1,type:"default",shivDocument:aq,createElement:F,createDocumentFragment:G};s.html5=ar,aq(t)}(this,K),Q._version=O,Q._prefixes=ac,Q._domPrefixes=af,Q._cssomPrefixes=ae,Q.hasEvent=an,Q.testProp=function(b){return R([b])},Q.testAllProps=V,Q.testStyles=am,Q.prefixed=function(d,e,f){return e?V(d,e,f):V(d,"pfx")},U.className=U.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(S?" js "+aj.join(" "):""),Q}(this,this.document),function(C,E,G){function H(b){return"[object Function]"==S.call(b)}function I(b){return"string"==typeof b}function J(){}function K(b){return !b||"loaded"==b||"complete"==b||"uninitialized"==b}function L(){var b=T.shift();U=1,b?b.t?Q(function(){("c"==b.t?F.injectCss:F.injectJs)(b.s,0,b.a,b.x,b.e,1)},0):(b(),L()):U=0}function M(b,g,h,m,n,p,q){function s(a){if(!v&&K(t.readyState)&&(x.r=v=1,!U&&L(),t.onload=t.onreadystatechange=null,a)){"img"!=b&&Q(function(){X.removeChild(t)},50);for(var c in ac[g]){ac[g].hasOwnProperty(c)&&ac[g][c].onload()}}}var q=q||F.errorTimeout,t=E.createElement(b),v=0,w=0,x={t:h,s:g,e:n,a:p,x:q};1===ac[g]&&(w=1,ac[g]=[]),"object"==b?t.data=g:(t.src=g,t.type=b),t.width=t.height="0",t.onerror=t.onload=t.onreadystatechange=function(){s.call(this,w)},T.splice(m,0,x),"img"!=b&&(w||2===ac[g]?(X.insertBefore(t,W?null:R),Q(s,q)):ac[g].push(t))}function N(e,g,h,i,j){return U=0,g=g||"j",I(e)?M("c"==g?Z:Y,e,g,this.i++,h,i,j):(T.splice(this.i++,0,e),1==T.length&&L()),this}function O(){var b=F;return b.loader={load:N,i:0},b}var P=E.documentElement,Q=C.setTimeout,R=E.getElementsByTagName("script")[0],S={}.toString,T=[],U=0,V="MozAppearance" in P.style,W=V&&!!E.createRange().compareNode,X=W?P:R.parentNode,P=C.opera&&"[object Opera]"==S.call(C.opera),P=!!E.attachEvent&&!P,Y=V?"object":P?"script":"img",Z=P?"script":Y,aa=Array.isArray||function(b){return"[object Array]"==S.call(b)},ab=[],ac={},ad={timeout:function(c,d){return d.length&&(c.timeout=d[0]),c}},D,F;F=function(c){function d(h){var h=h.split("!"),i=ab.length,j=h.pop(),l=h.length,j={url:j,origUrl:j,prefixes:h},o,p,q;for(p=0;p<l;p++){q=h[p].split("="),(o=ad[q.shift()])&&(j=o(j,q))}for(p=0;p<i;p++){j=ab[p](j)}return j}function e(b,l,o,p,q){var r=d(b),s=r.autoCallback;r.url.split(".").pop().split("?").shift(),r.bypass||(l&&(l=H(l)?l:l[b]||l[p]||l[b.split("/").pop().split("?")[0]]),r.instead?r.instead(b,l,o,p,q):(ac[r.url]?r.noexec=!0:ac[r.url]=1,o.load(r.url,r.forceCSS||!r.forceJS&&"css"==r.url.split(".").pop().split("?").shift()?"c":G,r.noexec,r.attrs,r.timeout),(H(l)||H(s))&&o.load(function(){O(),l&&l(r.origUrl,q,p),s&&s(r.origUrl,q,p),ac[r.url]=2})))}function f(g,o){function p(b,h){if(b){if(I(b)){h||(s=function(){var i=[].slice.call(arguments);t.apply(this,i),u()}),e(b,s,o,0,q)}else{if(Object(b)===b){for(w in v=function(){var a=0,i;for(i in b){b.hasOwnProperty(i)&&a++}return a}(),b){b.hasOwnProperty(w)&&(!h&&!--v&&(H(s)?s=function(){var i=[].slice.call(arguments);t.apply(this,i),u()}:s[w]=function(i){return function(){var a=[].slice.call(arguments);i&&i.apply(this,a),u()}}(t[w])),e(b[w],s,o,w,q))}}}}else{!h&&u()}}var q=!!g.test,r=g.load||g.both,s=g.callback||J,t=s,u=g.complete||J,v,w;p(q?g.yep:g.nope,!!r),r&&p(r)}var k,m,n=this.yepnope.loader;if(I(c)){e(c,0,n,0)}else{if(aa(c)){for(k=0;k<c.length;k++){m=c[k],I(m)?e(m,0,n,0):aa(m)?F(m):Object(m)===m&&f(m,n)}}else{Object(c)===c&&f(c,n)}}},F.addPrefix=function(c,d){ad[c]=d},F.addFilter=function(b){ab.push(b)},F.errorTimeout=10000,null==E.readyState&&E.addEventListener&&(E.readyState="loading",E.addEventListener("DOMContentLoaded",D=function(){E.removeEventListener("DOMContentLoaded",D,0),E.readyState="complete"},0)),C.yepnope=O(),C.yepnope.executeStack=L,C.yepnope.injectJs=function(b,f,g,h,m,n){var p=E.createElement("script"),q,r,h=h||F.errorTimeout;p.src=b;for(r in g){p.setAttribute(r,g[r])}f=n?L:f||J,p.onreadystatechange=p.onload=function(){!q&&K(p.readyState)&&(q=1,f(),p.onload=p.onreadystatechange=null)},Q(function(){q||(q=1,f(1))},h),m?p.onload():R.parentNode.insertBefore(p,R)},C.yepnope.injectCss=function(b,f,h,k,l,m){var k=E.createElement("link"),n,f=m?L:f||J;k.href=b,k.rel="stylesheet",k.type="text/css";for(n in h){k.setAttribute(n,h[n])}l||(R.parentNode.insertBefore(k,R),Q(f,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var g=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,h=document.getElementsByTagName("script"),i,j="",k=0,l=h.length;k<l;k++){if(i=h[k].getAttribute("src")){if(i=i.match(g)){j=i[1];break}}}return function(){return j}}(),ImgPath:""};OpenLayers.Class=function(){var e=arguments.length,f=arguments[0],g=arguments[e-1],h="function"==typeof g.initialize?g.initialize:function(){f.prototype.initialize.apply(this,arguments)};1<e?(e=[h,f].concat(Array.prototype.slice.call(arguments).slice(1,e-1),g),OpenLayers.inherit.apply(null,e)):h.prototype=g;return h};OpenLayers.inherit=function(f,g){var h=function(){};h.prototype=g.prototype;f.prototype=new h;var i,j,h=2;for(i=arguments.length;h<i;h++){j=arguments[h],"function"===typeof j&&(j=j.prototype),OpenLayers.Util.extend(f.prototype,j)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(e,f){e=e||{};if(f){for(var g in f){var h=f[g];void 0!==h&&(e[g]=h)}"function"==typeof window.Event&&f instanceof window.Event||(!f.hasOwnProperty||!f.hasOwnProperty("toString"))||(e.toString=f.toString)}return e};OpenLayers.String={startsWith:function(c,d){return 0==c.indexOf(d)},contains:function(c,d){return -1!=c.indexOf(d)},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(f){f=f.split("-");for(var g=f[0],h=1,i=f.length;h<i;h++){var j=f[h],g=g+(j.charAt(0).toUpperCase()+j.substring(1))}return g},format:function(d,e,f){e||(e=window);return d.replace(OpenLayers.String.tokenRegEx,function(b,c){for(var i,j=c.split(/\.+/),k=0;k<j.length;k++){0==k&&(i=e);if(void 0===i){break}i=i[j[k]]}"function"==typeof i&&(i=f?i.apply(null,f):i());return"undefined"==typeof i?"undefined":i})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(b){return OpenLayers.String.numberRegEx.test(b)},numericIf:function(d,e){var f=d;!0===e&&(null!=d&&d.replace)&&(d=d.replace(/^\s*|\s*$/g,""));return OpenLayers.String.isNumeric(d)?parseFloat(d):f}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(d,e){var f=0;0<e&&(f=parseFloat(d.toPrecision(e)));return f},format:function(g,h,i,j){h="undefined"!=typeof h?h:0;i="undefined"!=typeof i?i:OpenLayers.Number.thousandsSeparator;j="undefined"!=typeof j?j:OpenLayers.Number.decimalSeparator;null!=h&&(g=parseFloat(g.toFixed(h)));var k=g.toString().split(".");1==k.length&&null==h&&(h=0);g=k[0];if(i){for(var l=/(-?[0-9]+)([0-9]{3})/;l.test(g);){g=g.replace(l,"$1"+i+"$2")}}0==h?h=g:(i=1<k.length?k[1]:"0",null!=h&&(i+=Array(h-i.length+1).join("0")),h=g+j+i);return h},zeroPad:function(d,e,f){for(d=d.toString(f||10);d.length<e;){d="0"+d}return d}};OpenLayers.Function={bind:function(d,e){var f=Array.prototype.slice.apply(arguments,[2]);return function(){var a=f.concat(Array.prototype.slice.apply(arguments,[0]));return d.apply(e,a)}},bindAsEventListener:function(c,d){return function(a){return c.call(d,a||window.event)}},False:function(){return !1},True:function(){return !0},Void:function(){}};OpenLayers.Array={filter:function(h,i,j){var k=[];if(Array.prototype.filter){k=h.filter(i,j)}else{var l=h.length;if("function"!=typeof i){throw new TypeError}for(var m=0;m<l;m++){if(m in h){var n=h[m];i.call(j,n,m,h)&&k.push(n)}}}return k}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,f,g,h){OpenLayers.Util.isArray(e)&&(h=e[3],g=e[2],f=e[1],e=e[0]);null!=e&&(this.left=OpenLayers.Util.toFloat(e));null!=f&&(this.bottom=OpenLayers.Util.toFloat(f));null!=g&&(this.right=OpenLayers.Util.toFloat(g));null!=h&&(this.top=OpenLayers.Util.toFloat(h))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(c){var d=!1;null!=c&&(d=this.left==c.left&&this.right==c.right&&this.top==c.top&&this.bottom==c.bottom);return d},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(b){return !0===b?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(g,h){null==g&&(g=6);var i=Math.pow(10,g),j=Math.round(this.left*i)/i,k=Math.round(this.bottom*i)/i,l=Math.round(this.right*i)/i,i=Math.round(this.top*i)/i;return !0===h?k+","+j+","+i+","+l:j+","+k+","+l+","+i},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(e,f){null==f&&(f=this.getCenterLonLat());var g,h;"OpenLayers.LonLat"==f.CLASS_NAME?(g=f.lon,h=f.lat):(g=f.x,h=f.y);return new OpenLayers.Bounds((this.left-g)*e+g,(this.bottom-h)*e+h,(this.right-g)*e+g,(this.top-h)*e+h)},add:function(c,d){if(null==c||null==d){throw new TypeError("Bounds.add cannot receive null values")}return new OpenLayers.Bounds(this.left+c,this.bottom+d,this.right+c,this.top+d)},extend:function(b){if(b){switch(b.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(b.lon,b.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(b.x,b.y);break;case"OpenLayers.Bounds":this.centerLonLat=null;if(null==this.left||b.left<this.left){this.left=b.left}if(null==this.bottom||b.bottom<this.bottom){this.bottom=b.bottom}if(null==this.right||b.right>this.right){this.right=b.right}if(null==this.top||b.top>this.top){this.top=b.top}}}},extendXY:function(c,d){this.centerLonLat=null;if(null==this.left||c<this.left){this.left=c}if(null==this.bottom||d<this.bottom){this.bottom=d}if(null==this.right||c>this.right){this.right=c}if(null==this.top||d>this.top){this.top=d}},containsLonLat:function(e,f){"boolean"===typeof f&&(f={inclusive:f});f=f||{};var g=this.contains(e.lon,e.lat,f.inclusive),h=f.worldBounds;h&&!g&&(g=h.getWidth(),h=Math.round((e.lon-(h.left+h.right)/2)/g),g=this.containsLonLat({lon:e.lon-h*g,lat:e.lat},{inclusive:f.inclusive}));return g},containsPixel:function(c,d){return this.contains(c.x,c.y,d)},contains:function(e,f,g){null==g&&(g=!0);if(null==e||null==f){return !1}e=OpenLayers.Util.toFloat(e);f=OpenLayers.Util.toFloat(f);var h=!1;return h=g?e>=this.left&&e<=this.right&&f>=this.bottom&&f<=this.top:e>this.left&&e<this.right&&f>this.bottom&&f<this.top},intersectsBounds:function(h,i){"boolean"===typeof i&&(i={inclusive:i});i=i||{};if(i.worldBounds){var j=this.wrapDateLine(i.worldBounds);h=h.wrapDateLine(i.worldBounds)}else{j=this}null==i.inclusive&&(i.inclusive=!0);var k=!1,l=j.left==h.right||j.right==h.left||j.top==h.bottom||j.bottom==h.top;if(i.inclusive||!l){var k=h.top>=j.bottom&&h.top<=j.top||j.top>h.bottom&&j.top<h.top,l=h.left>=j.left&&h.left<=j.right||j.left>=h.left&&j.left<=h.right,m=h.right>=j.left&&h.right<=j.right||j.right>=h.left&&j.right<=h.right,k=(h.bottom>=j.bottom&&h.bottom<=j.top||j.bottom>=h.bottom&&j.bottom<=h.top||k)&&(l||m)}if(i.worldBounds&&!k){var n=i.worldBounds,l=n.getWidth(),m=!n.containsBounds(j),n=!n.containsBounds(h);m&&!n?(h=h.add(-l,0),k=j.intersectsBounds(h,{inclusive:i.inclusive})):n&&!m&&(j=j.add(-l,0),k=h.intersectsBounds(j,{inclusive:i.inclusive}))}return k},containsBounds:function(g,h,i){null==h&&(h=!1);null==i&&(i=!0);var j=this.contains(g.left,g.bottom,i),k=this.contains(g.right,g.bottom,i),l=this.contains(g.left,g.top,i);g=this.contains(g.right,g.top,i);return h?j||k||l||g:j&&k&&l&&g},determineQuadrant:function(d){var e="",f=this.getCenterLonLat(),e=e+(d.lat<f.lat?"b":"t");return e+=d.lon<f.lon?"l":"r"},transform:function(g,h){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},g,h),j=OpenLayers.Projection.transform({x:this.right,y:this.bottom},g,h),k=OpenLayers.Projection.transform({x:this.left,y:this.top},g,h),l=OpenLayers.Projection.transform({x:this.right,y:this.top},g,h);this.left=Math.min(i.x,k.x);this.bottom=Math.min(i.y,j.y);this.right=Math.max(j.x,l.x);this.top=Math.max(k.y,l.y);return this},wrapDateLine:function(g,h){h=h||{};var i=h.leftTolerance||0,j=h.rightTolerance||0,k=this.clone();if(g){for(var l=g.getWidth();k.left<g.left&&k.right-j<=g.left;){k=k.add(l,0)}for(;k.left+i>=g.right&&k.right>g.right;){k=k.add(-l,0)}i=k.left+i;i<g.right&&(i>g.left&&k.right-j>g.right)&&(k=k.add(-l,0))}return k},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(d,e){var f=d.split(",");return OpenLayers.Bounds.fromArray(f,e)};OpenLayers.Bounds.fromArray=function(c,d){return !0===d?new OpenLayers.Bounds(c[1],c[0],c[3],c[2]):new OpenLayers.Bounds(c[0],c[1],c[2],c[3])};OpenLayers.Bounds.fromSize=function(b){return new OpenLayers.Bounds(0,b.h,b.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(c){var d;d=""+("t"==c.charAt(0)?"b":"t");return d+="l"==c.charAt(1)?"r":"l"};OpenLayers.Element={visible:function(b){return"none"!=OpenLayers.Util.getElement(b).style.display},toggle:function(){for(var e=0,f=arguments.length;e<f;e++){var g=OpenLayers.Util.getElement(arguments[e]),h=OpenLayers.Element.visible(g)?"none":"";g.style.display=h}},remove:function(b){b=OpenLayers.Util.getElement(b);b.parentNode.removeChild(b)},getHeight:function(b){b=OpenLayers.Util.getElement(b);return b.offsetHeight},hasClass:function(d,e){var f=d.className;return !!f&&RegExp("(^|\\s)"+e+"(\\s|$)").test(f)},addClass:function(c,d){OpenLayers.Element.hasClass(c,d)||(c.className+=(c.className?" ":"")+d);return c},removeClass:function(d,e){var f=d.className;f&&(d.className=OpenLayers.String.trim(f.replace(RegExp("(^|\\s+)"+e+"(\\s+|$)")," ")));return d},toggleClass:function(c,d){OpenLayers.Element.hasClass(c,d)?OpenLayers.Element.removeClass(c,d):OpenLayers.Element.addClass(c,d);return c},getStyle:function(e,f){e=OpenLayers.Util.getElement(e);var g=null;if(e&&e.style){g=e.style[OpenLayers.String.camelize(f)];g||(document.defaultView&&document.defaultView.getComputedStyle?g=(g=document.defaultView.getComputedStyle(e,null))?g.getPropertyValue(f):null:e.currentStyle&&(g=e.currentStyle[OpenLayers.String.camelize(f)]));var h=["left","top","right","bottom"];window.opera&&(-1!=OpenLayers.Util.indexOf(h,f)&&"static"==OpenLayers.Element.getStyle(e,"position"))&&(g="auto")}return"auto"==g?null:g}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(c,d){OpenLayers.Util.isArray(c)&&(d=c[1],c=c[0]);this.lon=OpenLayers.Util.toFloat(c);this.lat=OpenLayers.Util.toFloat(d)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(c,d){if(null==c||null==d){throw new TypeError("LonLat.add cannot receive null values")}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(c),this.lat+OpenLayers.Util.toFloat(d))},equals:function(c){var d=!1;null!=c&&(d=this.lon==c.lon&&this.lat==c.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(c.lon)&&isNaN(c.lat));return d},transform:function(d,e){var f=OpenLayers.Projection.transform({x:this.lon,y:this.lat},d,e);this.lon=f.x;this.lat=f.y;return this},wrapDateLine:function(c){var d=this.clone();if(c){for(;d.lon<c.left;){d.lon+=c.getWidth()}for(;d.lon>c.right;){d.lon-=c.getWidth()}}return d},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){b=b.split(",");return new OpenLayers.LonLat(b[0],b[1])};OpenLayers.LonLat.fromArray=function(c){var d=OpenLayers.Util.isArray(c);return new OpenLayers.LonLat(d&&c[0],d&&c[1])};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(c,d){this.x=parseFloat(c);this.y=parseFloat(d)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(c){var d=!1;null!=c&&(d=this.x==c.x&&this.y==c.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(c.x)&&isNaN(c.y));return d},distanceTo:function(b){return Math.sqrt(Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2))},add:function(c,d){if(null==c||null==d){throw new TypeError("Pixel.add cannot receive null values")}return new OpenLayers.Pixel(this.x+c,this.y+d)},offset:function(c){var d=this.clone();c&&(d=this.add(c.x,c.y));return d},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(c,d){this.w=parseFloat(c);this.h=parseFloat(d)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(c){var d=!1;null!=c&&(d=this.w==c.w&&this.h==c.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(c.w)&&isNaN(c.h));return d},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(b){alert(b)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){for(var d=document.getElementsByTagName("script"),e=0,f=d.length;e<f;++e){if(-1!=d[e].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}})();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(d){var e;d||(d="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);d=d.split("-");d[0]=d[0].toLowerCase();"object"==typeof OpenLayers.Lang[d[0]]&&(e=d[0]);if(d[1]){var f=d[0]+"-"+d[1].toUpperCase();"object"==typeof OpenLayers.Lang[f]&&(e=f)}e||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+d.join("-")+" dictionary, falling back to default language"),e=OpenLayers.Lang.defaultCode);OpenLayers.Lang.code=e},translate:function(d,e){var f=OpenLayers.Lang[OpenLayers.Lang.getCode()];(f=f&&f[d])||(f=d);e&&(f=OpenLayers.String.format(f,e));return f}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var e=[],f=0,g=arguments.length;f<g;f++){var h=arguments[f];"string"==typeof h&&(h=document.getElementById(h));if(1==arguments.length){return h}e.push(h)}return e};OpenLayers.Util.isElement=function(b){return !(!b||1!==b.nodeType)};OpenLayers.Util.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)};OpenLayers.Util.removeItem=function(d,e){for(var f=d.length-1;0<=f;f--){d[f]==e&&d.splice(f,1)}return d};OpenLayers.Util.indexOf=function(e,f){if("function"==typeof e.indexOf){return e.indexOf(f)}for(var g=0,h=e.length;g<h;g++){if(e[g]==f){return g}}return -1};OpenLayers.Util.dotless=/\./g;OpenLayers.Util.modifyDOMElement=function(i,j,k,l,m,n,o,p){j&&(i.id=j.replace(OpenLayers.Util.dotless,"_"));k&&(i.style.left=k.x+"px",i.style.top=k.y+"px");l&&(i.style.width=l.w+"px",i.style.height=l.h+"px");m&&(i.style.position=m);n&&(i.style.border=n);o&&(i.style.overflow=o);0<=parseFloat(p)&&1>parseFloat(p)?(i.style.filter="alpha(opacity="+100*p+")",i.style.opacity=p):1==parseFloat(p)&&(i.style.filter="",i.style.opacity="")};OpenLayers.Util.createDiv=function(i,j,l,m,n,o,p,q){var r=document.createElement("div");m&&(r.style.backgroundImage="url("+m+")");i||(i=OpenLayers.Util.createUniqueID("OpenLayersDiv"));n||(n="absolute");OpenLayers.Util.modifyDOMElement(r,i,j,l,n,o,p,q);return r};OpenLayers.Util.createImage=function(i,j,l,m,n,o,p,q){var r=document.createElement("img");i||(i=OpenLayers.Util.createUniqueID("OpenLayersDiv"));n||(n="relative");OpenLayers.Util.modifyDOMElement(r,i,j,l,n,o,null,p);q&&(r.style.display="none",j=function(){r.style.display="";OpenLayers.Event.stopObservingElement(r)},OpenLayers.Event.observe(r,"load",j),OpenLayers.Event.observe(r,"error",j));r.style.alt=i;r.galleryImg="no";m&&(r.src=m);return r};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var d=navigator.appVersion.split("MSIE"),d=parseFloat(d[1]),e=!1;try{e=!!document.body.filters}catch(f){}OpenLayers.Util.alphaHackNeeded=e&&5.5<=d&&7>d}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(i,j,l,m,n,o,p,q,r){OpenLayers.Util.modifyDOMElement(i,j,l,m,o,null,null,r);j=i.childNodes[0];n&&(j.src=n);OpenLayers.Util.modifyDOMElement(j,i.id+"_innerImage",null,m,"relative",p);OpenLayers.Util.alphaHack()&&("none"!=i.style.display&&(i.style.display="inline-block"),null==q&&(q="scale"),i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+j.src+"', sizingMethod='"+q+"')",0<=parseFloat(i.style.opacity)&&1>parseFloat(i.style.opacity)&&(i.style.filter+=" alpha(opacity="+100*i.style.opacity+")"),j.style.filter="alpha(opacity=0)")};OpenLayers.Util.createAlphaImageDiv=function(i,j,m,n,o,p,q,r,s){var t=OpenLayers.Util.createDiv();s=OpenLayers.Util.createImage(null,null,null,null,null,null,null,s);s.className="olAlphaImg";t.appendChild(s);OpenLayers.Util.modifyAlphaImageDiv(t,i,j,m,n,o,p,q,r);return t};OpenLayers.Util.upperCaseObject=function(d){var e={},f;for(f in d){e[f.toUpperCase()]=d[f]}return e};OpenLayers.Util.applyDefaults=function(e,f){e=e||{};var g="function"==typeof window.Event&&f instanceof window.Event,h;for(h in f){if(void 0===e[h]||!g&&f.hasOwnProperty&&f.hasOwnProperty(h)&&!e.hasOwnProperty(h)){e[h]=f[h]}}!g&&(f&&f.hasOwnProperty&&f.hasOwnProperty("toString")&&!e.hasOwnProperty("toString"))&&(e.toString=f.toString);return e};OpenLayers.Util.getParameterString=function(i){var j=[],k;for(k in i){var l=i[k];if(null!=l&&"function"!=typeof l){if("object"==typeof l&&l.constructor==Array){for(var m=[],n,o=0,p=l.length;o<p;o++){n=l[o],m.push(encodeURIComponent(null===n||void 0===n?"":n))}l=m.join(",")}else{l=encodeURIComponent(l)}j.push(encodeURIComponent(k)+"="+l)}}return j.join("&")};OpenLayers.Util.urlAppend=function(e,f){var g=e;if(f){var h=(e+" ").split(/[?&]/),g=g+(" "===h.pop()?f:h.length?"&"+f:"?"+f)}return g};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(b){return OpenLayers.Util.getImagesLocation()+b};OpenLayers.Util.Try=function(){for(var f=null,g=0,h=arguments.length;g<h;g++){var i=arguments[g];try{f=i();break}catch(j){}}return f};OpenLayers.Util.getXmlNodeValue=function(c){var d=null;OpenLayers.Util.Try(function(){d=c.text;d||(d=c.textContent);d||(d=c.firstChild.nodeValue)},function(){d=c.textContent});return d};OpenLayers.Util.mouseLeft=function(d,e){for(var f=d.relatedTarget?d.relatedTarget:d.toElement;f!=e&&null!=f;){f=f.parentNode}return f!=e};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(c,d){null==d&&(d=OpenLayers.Util.DEFAULT_PRECISION);"number"!==typeof c&&(c=parseFloat(c));return 0===d?c:parseFloat(c.toPrecision(d))};OpenLayers.Util.rad=function(b){return b*Math.PI/180};OpenLayers.Util.deg=function(b){return 180*b/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(i,j){for(var o=OpenLayers.Util.VincentyConstants,x=o.a,y=o.b,o=o.f,z=OpenLayers.Util.rad(j.lon-i.lon),A=Math.atan((1-o)*Math.tan(OpenLayers.Util.rad(i.lat))),B=Math.atan((1-o)*Math.tan(OpenLayers.Util.rad(j.lat))),C=Math.sin(A),A=Math.cos(A),D=Math.sin(B),B=Math.cos(B),E=z,F=2*Math.PI,G=20;1e-12<Math.abs(E-F)&&0<--G;){var H=Math.sin(E),I=Math.cos(E),J=Math.sqrt(B*H*B*H+(A*D-C*B*I)*(A*D-C*B*I));if(0==J){return 0}var I=C*D+A*B*I,K=Math.atan2(J,I),L=Math.asin(A*B*H/J),M=Math.cos(L)*Math.cos(L),H=I-2*C*D/M,N=o/16*M*(4+o*(4-3*M)),F=E,E=z+(1-N)*o*Math.sin(L)*(K+N*J*(H+N*I*(-1+2*H*H)))}if(0==G){return NaN}x=M*(x*x-y*y)/(y*y);o=x/1024*(256+x*(-128+x*(74-47*x)));return(y*(1+x/16384*(4096+x*(-768+x*(320-175*x))))*(K-o*J*(H+o/4*(I*(-1+2*H*H)-o/6*H*(-3+4*J*J)*(-3+4*H*H))))).toFixed(3)/1000};OpenLayers.Util.destinationVincenty=function(i,j,o){var x=OpenLayers.Util,y=x.VincentyConstants,z=y.a,A=y.b,B=y.f,y=i.lon;i=i.lat;var C=x.rad(j);j=Math.sin(C);C=Math.cos(C);i=(1-B)*Math.tan(x.rad(i));var D=1/Math.sqrt(1+i*i),E=i*D,F=Math.atan2(i,C);i=D*j;for(var G=1-i*i,z=G*(z*z-A*A)/(A*A),H=1+z/16384*(4096+z*(-768+z*(320-175*z))),I=z/1024*(256+z*(-128+z*(74-47*z))),z=o/(A*H),J=2*Math.PI;1e-12<Math.abs(z-J);){var K=Math.cos(2*F+z),L=Math.sin(z),M=Math.cos(z),N=I*L*(K+I/4*(M*(-1+2*K*K)-I/6*K*(-3+4*L*L)*(-3+4*K*K))),J=z,z=o/(A*H)+N}o=E*L-D*M*C;A=Math.atan2(E*M+D*L*C,(1-B)*Math.sqrt(i*i+o*o));j=Math.atan2(L*j,D*M-E*L*C);C=B/16*G*(4+B*(4-3*G));K=j-(1-C)*B*i*(z+C*L*(K+C*M*(-1+2*K*K)));Math.atan2(i,-o);return new OpenLayers.LonLat(y+x.deg(K),x.deg(A))};OpenLayers.Util.getParameters=function(i,j){j=j||{};i=null===i||void 0===i?window.location.href:i;var m="";if(OpenLayers.String.contains(i,"?")){var n=i.indexOf("?")+1,m=OpenLayers.String.contains(i,"#")?i.indexOf("#"):i.length,m=i.substring(n,m)}for(var n={},m=m.split(/[&;]/),o=0,p=m.length;o<p;++o){var q=m[o].split("=");if(q[0]){var r=q[0];try{r=decodeURIComponent(r)}catch(s){r=unescape(r)}q=(q[1]||"").replace(/\+/g," ");try{q=decodeURIComponent(q)}catch(t){q=unescape(q)}!1!==j.splitArgs&&(q=q.split(","));1==q.length&&(q=q[0]);n[r]=q}}return n};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(b){b=null==b?"id_":b.replace(OpenLayers.Util.dotless,"_");OpenLayers.Util.lastSeqID+=1;return b+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.3047994715386763/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:2.54e-05/OpenLayers.METERS_PER_INCH,Mil:2.54e-08/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.347218694437/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.3164889327/OpenLayers.METERS_PER_INCH,"Lat-83":110946.2573687224/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.11678249437587/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.2011678249437587/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1000*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){return 1<b?1/b:b};OpenLayers.Util.getResolutionFromScale=function(d,e){var f;d&&(null==e&&(e="degrees"),f=1/(OpenLayers.Util.normalizeScale(d)*OpenLayers.INCHES_PER_UNIT[e]*OpenLayers.DOTS_PER_INCH));return f};OpenLayers.Util.getScaleFromResolution=function(c,d){null==d&&(d="degrees");return c*OpenLayers.INCHES_PER_UNIT[d]*OpenLayers.DOTS_PER_INCH};OpenLayers.Util.pagePosition=function(f){var g=[0,0],h=OpenLayers.Util.getViewportElement();if(!f||f==window||f==h){return g}var i=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(f,"position")&&(""==f.style.top||""==f.style.left),j=null;if(f.getBoundingClientRect){f=f.getBoundingClientRect(),j=window.pageYOffset||h.scrollTop,g[0]=f.left+(window.pageXOffset||h.scrollLeft),g[1]=f.top+j}else{if(document.getBoxObjectFor&&!i){f=document.getBoxObjectFor(f),h=document.getBoxObjectFor(h),g[0]=f.screenX-h.screenX,g[1]=f.screenY-h.screenY}else{g[0]=f.offsetLeft;g[1]=f.offsetTop;j=f.offsetParent;if(j!=f){for(;j;){g[0]+=j.offsetLeft,g[1]+=j.offsetTop,j=j.offsetParent}}h=OpenLayers.BROWSER_NAME;if("opera"==h||"safari"==h&&"absolute"==OpenLayers.Element.getStyle(f,"position")){g[1]-=document.body.offsetTop}for(j=f.offsetParent;j&&j!=document.body;){g[0]-=j.scrollLeft;if("opera"!=h||"TR"!=j.tagName){g[1]-=j.scrollTop}j=j.offsetParent}}}return g};OpenLayers.Util.getViewportElement=function(){var b=arguments.callee.viewportElement;void 0==b&&(b="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=b);return b};OpenLayers.Util.isEquivalentUrl=function(e,f,g){g=g||{};OpenLayers.Util.applyDefaults(g,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});e=OpenLayers.Util.createUrlObject(e,g);f=OpenLayers.Util.createUrlObject(f,g);for(var h in e){if("args"!==h&&e[h]!=f[h]){return !1}}for(h in e.args){if(e.args[h]!=f.args[h]){return !1}delete f.args[h]}for(h in f.args){return !1}return !0};OpenLayers.Util.createUrlObject=function(f,g){g=g||{};if(!/^\w+:\/\//.test(f)){var h=window.location,i=h.port?":"+h.port:"",i=h.protocol+"//"+h.host.split(":").shift()+i;0===f.indexOf("/")?f=i+f:(h=h.pathname.split("/"),h.pop(),f=i+h.join("/")+"/"+f)}g.ignoreCase&&(f=f.toLowerCase());h=document.createElement("a");h.href=f;i={};i.host=h.host.split(":").shift();i.protocol=h.protocol;i.port=g.ignorePort80?"80"==h.port||"0"==h.port?"":h.port:""==h.port||"0"==h.port?"80":h.port;i.hash=g.ignoreHash||"#"===h.hash?"":h.hash;var j=h.search;j||(j=f.indexOf("?"),j=-1!=j?f.substr(j):"");i.args=OpenLayers.Util.getParameters(j,{splitArgs:g.splitArgs});i.pathname="/"==h.pathname.charAt(0)?h.pathname:"/"+h.pathname;return i};OpenLayers.Util.removeTail=function(d){var e=null,e=d.indexOf("?"),f=d.indexOf("#");return e=-1==e?-1!=f?d.substr(0,f):d:-1!=f?d.substr(0,Math.min(e,f)):d.substr(0,e)};OpenLayers.IS_GECKO=function(){var b=navigator.userAgent.toLowerCase();return -1==b.indexOf("webkit")&&-1!=b.indexOf("gecko")}();OpenLayers.CANVAS_SUPPORTED=function(){var b=document.createElement("canvas");return !(!b.getContext||!b.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var c="",d=navigator.userAgent.toLowerCase();-1!=d.indexOf("opera")?c="opera":-1!=d.indexOf("msie")?c="msie":-1!=d.indexOf("safari")?c="safari":-1!=d.indexOf("mozilla")&&(c=-1!=d.indexOf("firefox")?"firefox":"mozilla");return c}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(i,j,n){var o,p,q=document.createElement("div");q.style.visibility="hidden";for(var r=n&&n.containerElement?n.containerElement:document.body,s=!1,t=null,u=r;u&&"body"!=u.tagName.toLowerCase();){var v=OpenLayers.Element.getStyle(u,"position");if("absolute"==v){s=!0;break}else{if(v&&"static"!=v){break}}u=u.parentNode}!s||0!==r.clientHeight&&0!==r.clientWidth||(t=document.createElement("div"),t.style.visibility="hidden",t.style.position="absolute",t.style.overflow="visible",t.style.width=document.body.clientWidth+"px",t.style.height=document.body.clientHeight+"px",t.appendChild(q));q.style.position="absolute";j&&(j.w?(o=j.w,q.style.width=o+"px"):j.h&&(p=j.h,q.style.height=p+"px"));n&&n.displayClass&&(q.className=n.displayClass);j=document.createElement("div");j.innerHTML=i;j.style.overflow="visible";if(j.childNodes){for(i=0,n=j.childNodes.length;i<n;i++){j.childNodes[i].style&&(j.childNodes[i].style.overflow="visible")}}q.appendChild(j);t?r.appendChild(t):r.appendChild(q);o||(o=parseInt(j.scrollWidth),q.style.width=o+"px");p||(p=parseInt(j.scrollHeight));q.removeChild(j);t?(t.removeChild(q),r.removeChild(t)):r.removeChild(q);return new OpenLayers.Size(o,p)};OpenLayers.Util.getScrollbarWidth=function(){var d=OpenLayers.Util._scrollbarWidth;if(null==d){var e=null,f=null,e=d=0,e=document.createElement("div");e.style.position="absolute";e.style.top="-1000px";e.style.left="-1000px";e.style.width="100px";e.style.height="50px";e.style.overflow="hidden";f=document.createElement("div");f.style.width="100%";f.style.height="200px";e.appendChild(f);document.body.appendChild(e);d=f.offsetWidth;e.style.overflow="scroll";e=f.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=d-e;d=OpenLayers.Util._scrollbarWidth}return d};OpenLayers.Util.getFormattedLonLat=function(g,h,i){i||(i="dms");g=(g+540)%360-180;var j=Math.abs(g),k=Math.floor(j),l=j=(j-k)/(1/60),j=Math.floor(j),l=Math.round(10*((l-j)/(1/60))),l=l/10;60<=l&&(l-=60,j+=1,60<=j&&(j-=60,k+=1));10>k&&(k="0"+k);k+="\u00b0";0<=i.indexOf("dm")&&(10>j&&(j="0"+j),k+=j+"'",0<=i.indexOf("dms")&&(10>l&&(l="0"+l),k+=l+'"'));return k="lon"==h?k+(0>g?OpenLayers.i18n("W"):OpenLayers.i18n("E")):k+(0>g?OpenLayers.i18n("S"):OpenLayers.i18n("N"))};OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b},destroy:function(){},read:function(b){throw Error("Read not implemented.")},write:function(b){throw Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.CSWGetRecords=function(c){c=OpenLayers.Util.applyDefaults(c,OpenLayers.Format.CSWGetRecords.DEFAULTS);var d=OpenLayers.Format.CSWGetRecords["v"+c.version.replace(/\./g,"_")];if(!d){throw"Unsupported CSWGetRecords version: "+c.version}return new d(c)};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(b){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,b);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null);this.eventListeners=null;this.handler&&(this.handler.destroy(),this.handler=null);if(this.handlers){for(var b in this.handlers){this.handlers.hasOwnProperty(b)&&"function"==typeof this.handlers[b].destroy&&this.handlers[b].destroy()}this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null);this.div=null},setMap:function(b){this.map=b;this.handler&&this.handler.setMap(b)},draw:function(b){null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title));null!=b&&(this.position=b.clone());this.moveTo(this.position);return this.div},moveTo:function(b){null!=b&&null!=this.div&&(this.div.style.left=b.x+"px",this.div.style.top=b.y+"px")},activate:function(){if(this.active){return !1}this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return !0},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(b){return b.target||b.srcElement},isSingleTouch:function(b){return b.touches&&1==b.touches.length},isMultiTouch:function(b){return b.touches&&1<b.touches.length},isLeftClick:function(b){return b.which&&1==b.which||b.button&&1==b.button},isRightClick:function(b){return b.which&&3==b.which||b.button&&2==b.button},stop:function(c,d){d||OpenLayers.Event.preventDefault(c);c.stopPropagation?c.stopPropagation():c.cancelBubble=!0},preventDefault:function(b){b.preventDefault?b.preventDefault():b.returnValue=!1},findElement:function(d,e){for(var f=OpenLayers.Event.element(d);f.parentNode&&(!f.tagName||f.tagName.toUpperCase()!=e.toUpperCase());){f=f.parentNode}return f},observe:function(f,g,h,i){f=OpenLayers.Util.getElement(f);i=i||!1;"keypress"==g&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||f.attachEvent)&&(g="keydown");this.observers||(this.observers={});if(!f._eventCacheID){var j="eventCacheID_";f.id&&(j=f.id+"_"+j);f._eventCacheID=OpenLayers.Util.createUniqueID(j)}j=f._eventCacheID;this.observers[j]||(this.observers[j]=[]);this.observers[j].push({element:f,name:g,observer:h,useCapture:i});f.addEventListener?f.addEventListener(g,h,i):f.attachEvent&&f.attachEvent("on"+g,h)},stopObservingElement:function(b){b=OpenLayers.Util.getElement(b)._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[b])},_removeElementObservers:function(d){if(d){for(var e=d.length-1;0<=e;e--){var f=d[e];OpenLayers.Event.stopObserving.apply(this,[f.element,f.name,f.observer,f.useCapture])}}},stopObserving:function(i,j,l,m){m=m||!1;i=OpenLayers.Util.getElement(i);var n=i._eventCacheID;"keypress"==j&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.detachEvent)&&(j="keydown");var o=!1,p=OpenLayers.Event.observers[n];if(p){for(var q=0;!o&&q<p.length;){var r=p[q];if(r.name==j&&r.observer==l&&r.useCapture==m){p.splice(q,1);0==p.length&&delete OpenLayers.Event.observers[n];o=!0;break}q++}}o&&(i.removeEventListener?i.removeEventListener(j,l,m):i&&i.detachEvent&&i.detachEvent("on"+j,l));return o},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var b in OpenLayers.Event.observers){OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[b]])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(f,g,h,i,j){OpenLayers.Util.extend(this,j);this.object=f;this.fallThrough=i;this.listeners={};this.extensions={};this.extensionCount={};this._msTouches=[];null!=g&&this.attachToElement(g)},destroy:function(){for(var b in this.extensions){"boolean"!==typeof this.extensions[b]&&this.extensions[b].destroy()}this.extensions=null;this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener));this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(b){},attachToElement:function(f){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this));this.element=f;for(var g=!!window.navigator.msMaxTouchPoints,h,i=0,j=this.BROWSER_EVENTS.length;i<j;i++){h=this.BROWSER_EVENTS[i],OpenLayers.Event.observe(f,h,this.eventHandler),g&&0===h.indexOf("touch")&&this.addMsTouchListener(f,h,this.eventHandler)}OpenLayers.Event.observe(f,"dragstart",OpenLayers.Event.stop)},on:function(c){for(var d in c){"scope"!=d&&c.hasOwnProperty(d)&&this.register(d,c.scope,c[d])}},register:function(f,g,h,i){f in OpenLayers.Events&&!this.extensions[f]&&(this.extensions[f]=new OpenLayers.Events[f](this));if(null!=h){null==g&&(g=this.object);var j=this.listeners[f];j||(j=[],this.listeners[f]=j,this.extensionCount[f]=0);g={obj:g,func:h};i?(j.splice(this.extensionCount[f],0,g),"object"===typeof i&&i.extension&&this.extensionCount[f]++):j.push(g)}},registerPriority:function(d,e,f){this.register(d,e,f,!0)},un:function(c){for(var d in c){"scope"!=d&&c.hasOwnProperty(d)&&this.unregister(d,c.scope,c[d])}},unregister:function(f,g,h){null==g&&(g=this.object);f=this.listeners[f];if(null!=f){for(var i=0,j=f.length;i<j;i++){if(f[i].obj==g&&f[i].func==h){f.splice(i,1);break}}}},remove:function(b){null!=this.listeners[b]&&(this.listeners[b]=[])},triggerEvent:function(g,h){var i=this.listeners[g];if(i&&0!=i.length){null==h&&(h={});h.object=this.object;h.element=this.element;h.type||(h.type=g);for(var i=i.slice(),j,k=0,l=i.length;k<l&&(j=i[k],j=j.func.apply(j.obj,[h]),void 0==j||!1!=j);k++){}this.fallThrough||OpenLayers.Event.stop(h,!0);return j}},handleBrowserEvent:function(i){var j=i.type,k=this.listeners[j];if(k&&0!=k.length){if((k=i.touches)&&k[0]){for(var l=0,m=0,n=k.length,o,p=0;p<n;++p){o=this.getTouchClientXY(k[p]),l+=o.clientX,m+=o.clientY}i.clientX=l/n;i.clientY=m/n}this.includeXY&&(i.xy=this.getMousePosition(i));this.triggerEvent(j,i)}},getTouchClientXY:function(f){var g=window.olMockWin||window,h=g.pageXOffset,g=g.pageYOffset,i=f.clientX,j=f.clientY;if(0===f.pageY&&Math.floor(j)>Math.floor(f.pageY)||0===f.pageX&&Math.floor(i)>Math.floor(f.pageX)){i-=h,j-=g}else{if(j<f.pageY-g||i<f.pageX-h){i=f.pageX-h,j=f.pageY-g}}f.olClientX=i;f.olClientY=j;return{clientX:i,clientY:j}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(c){this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls){var d=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||d.scrollLeft,window.pageYOffset||d.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(c.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],c.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(f,g,h){function i(b){h(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var c=j.length-1;0<=c;--c){j[c].stopPropagation()}},preventDefault:function(){for(var c=j.length-1;0<=c;--c){j[c].preventDefault()}},type:g},b))}var j=this._msTouches;switch(g){case"touchstart":return this.addMsTouchListenerStart(f,g,i);case"touchend":return this.addMsTouchListenerEnd(f,g,i);case"touchmove":return this.addMsTouchListenerMove(f,g,i);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(e,f,g){var h=this._msTouches;OpenLayers.Event.observe(e,"MSPointerDown",function(c){for(var d=!1,i=0,j=h.length;i<j;++i){if(h[i].pointerId==c.pointerId){d=!0;break}}d||h.push(c);c.touches=h.slice();g(c)});OpenLayers.Event.observe(e,"MSPointerUp",function(d){for(var i=0,j=h.length;i<j;++i){if(h[i].pointerId==d.pointerId){h.splice(i,1);break}}})},addMsTouchListenerMove:function(e,f,g){var h=this._msTouches;OpenLayers.Event.observe(e,"MSPointerMove",function(c){if(c.pointerType!=c.MSPOINTER_TYPE_MOUSE||0!=c.buttons){if(1!=h.length||h[0].pageX!=c.pageX||h[0].pageY!=c.pageY){for(var d=0,i=h.length;d<i;++d){if(h[d].pointerId==c.pointerId){h[d]=c;break}}c.touches=h.slice();g(c)}}})},addMsTouchListenerEnd:function(e,f,g){var h=this._msTouches;OpenLayers.Event.observe(e,"MSPointerUp",function(c){for(var d=0,i=h.length;d<i;++d){if(h[d].pointerId==c.pointerId){h.splice(d,1);break}}c.touches=h.slice();g(c)})},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(b){this.target=b;for(b=this.events.length-1;0<=b;--b){this.target.register(this.events[b],this,this.buttonClick,{extension:!0})}},destroy:function(){for(var b=this.events.length-1;0<=b;--b){this.target.unregister(this.events[b],this,this.buttonClick)}delete this.target},getPressedButton:function(d){var e=3,f;do{if(OpenLayers.Element.hasClass(d,"olButton")){f=d;break}d=d.parentNode}while(0<--e&&d);return f},ignore:function(d){var e=3,f=!1;do{if("a"===d.nodeName.toLowerCase()){f=!0;break}d=d.parentNode}while(0<--e&&d);return f},buttonClick:function(f){var g=!0,h=OpenLayers.Event.element(f);if(h&&(OpenLayers.Event.isLeftClick(f)||!~f.type.indexOf("mouse"))){if(h=this.getPressedButton(h)){if("keydown"===f.type){switch(f.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:h}),OpenLayers.Event.stop(f),g=!1}}else{if(this.startEvt){if(this.completeRegEx.test(f.type)){var g=OpenLayers.Util.pagePosition(h),i=OpenLayers.Util.getViewportElement(),j=window.pageYOffset||i.scrollTop;g[0]-=window.pageXOffset||i.scrollLeft;g[1]-=j;this.target.triggerEvent("buttonclick",{buttonElement:h,buttonXY:{x:this.startEvt.clientX-g[0],y:this.startEvt.clientY-g[1]}})}this.cancelRegEx.test(f.type)&&delete this.startEvt;OpenLayers.Event.stop(f);g=!1}}this.startRegEx.test(f.type)&&(this.startEvt=f,OpenLayers.Event.stop(f),g=!1)}else{g=!this.ignore(OpenLayers.Event.element(f)),delete this.startEvt}}return g}});OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.vendorPrefix=function(){function h(b){return b?b.replace(/([A-Z])/g,function(c){return"-"+c.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function i(d,g){if(void 0===n[g]){var o,q=0,r=k.length,s="undefined"!==typeof d.cssText;for(n[g]=null;q<r;q++){if((o=k[q])?(s||(o=o.toLowerCase()),o=o+g.charAt(0).toUpperCase()+g.slice(1)):o=g,void 0!==d[o]){n[g]=o;break}}}return n[g]}function j(b){return i(l,b)}var k=["","O","ms","Moz","Webkit"],l=document.createElement("div").style,m={},n={};return{css:function(a){if(void 0===m[a]){var c=a.replace(/(-[\s\S])/g,function(b){return b.charAt(1).toUpperCase()}),c=j(c);m[a]=h(c)}return m[a]},js:i,style:j,cssCache:m,jsCache:n}}();OpenLayers.Animation=function(g){var h=OpenLayers.Util.vendorPrefix.js(g,"requestAnimationFrame"),i=!!h,j=function(){var a=g[h]||function(d,e){g.setTimeout(d,16)};return function(c,e){a.apply(g,[c,e])}}(),k=0,l={};return{isNative:i,requestFrame:j,start:function(d,e,f){e=0<e?e:Number.POSITIVE_INFINITY;var n=++k,o=+new Date;l[n]=function(){l[n]&&+new Date-o<=e?(d(),l[n]&&j(l[n],f)):delete l[n]};j(l[n],f);return n},stop:function(b){delete l[b]}}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(b){this.easing=b?b:OpenLayers.Easing.Expo.easeOut},start:function(e,f,g,h){this.playing=!0;this.begin=e;this.finish=f;this.duration=g;this.callbacks=h.callbacks;this.minFrameRate=h.minFrameRate||30;this.time=0;this.startTime=(new Date).getTime();OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var e={},f;for(f in this.begin){var g=this.begin[f],h=this.finish[f];if(null==g||null==h||isNaN(g)||isNaN(h)){throw new TypeError("invalid value for Tween")}e[f]=this.easing.apply(this,[this.time,g,h-g,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1000/this.minFrameRate&&this.callbacks.eachStep.call(this,e);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,f,g,h){return g*e/h+f},easeOut:function(e,f,g,h){return g*e/h+f},easeInOut:function(e,f,g,h){return g*e/h+f},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,f,g,h){return 0==e?f:g*Math.pow(2,10*(e/h-1))+f},easeOut:function(e,f,g,h){return e==h?f+g:g*(-Math.pow(2,-10*e/h)+1)+f},easeInOut:function(e,f,g,h){return 0==e?f:e==h?f+g:1>(e/=h/2)?g/2*Math.pow(2,10*(e-1))+f:g/2*(-Math.pow(2,-10*--e)+2)+f},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,f,g,h){return g*(e/=h)*e+f},easeOut:function(e,f,g,h){return -g*(e/=h)*(e-2)+f},easeInOut:function(e,f,g,h){return 1>(e/=h/2)?g/2*e*e+f:-g/2*(--e*(e-2)-1)+f},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(c,d){OpenLayers.Util.extend(this,d);this.projCode=c;"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(c))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(c){var d=!1;c&&(c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),"object"==typeof Proj4js&&this.proj.defData&&c.proj.defData?d=this.proj.defData.replace(this.titleRegEx,"")==c.proj.defData.replace(this.titleRegEx,""):c.getCode&&(d=this.getCode(),c=c.getCode(),d=d==c||!!OpenLayers.Projection.transforms[d]&&OpenLayers.Projection.transforms[d][c]===OpenLayers.Projection.nullTransform));return d},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(e,f,g){if(g===OpenLayers.Projection.nullTransform){var h=OpenLayers.Projection.defaults[e];h&&!OpenLayers.Projection.defaults[f]&&(OpenLayers.Projection.defaults[f]=h)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={});OpenLayers.Projection.transforms[e][f]=g};OpenLayers.Projection.transform=function(e,f,g){if(f&&g){if(f instanceof OpenLayers.Projection||(f=new OpenLayers.Projection(f)),g instanceof OpenLayers.Projection||(g=new OpenLayers.Projection(g)),f.proj&&g.proj){e=Proj4js.transform(f.proj,g.proj,e)}else{f=f.getCode();g=g.getCode();var h=OpenLayers.Projection.transforms;if(h[f]&&h[f][g]){h[f][g](e)}}}return e};OpenLayers.Projection.nullTransform=function(b){return b};(function(){function h(b){b.x=180*b.x/k;b.y=180/Math.PI*(2*Math.atan(Math.exp(b.y/k*Math.PI))-Math.PI/2);return b}function i(c){c.x=c.x*k/180;var d=Math.log(Math.tan((90+c.y)*Math.PI/360))/Math.PI*k;c.y=Math.max(-20037508.34,Math.min(d,20037508.34));return c}function j(a,b){var o=OpenLayers.Projection.addTransform,t=OpenLayers.Projection.nullTransform,u,v,w,x,y;u=0;for(v=b.length;u<v;++u){for(w=b[u],o(a,w,i),o(w,a,h),y=u+1;y<v;++y){x=b[y],o(w,x,t),o(x,w,t)}}}var k=20037508.34,l=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],m=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],n;for(n=l.length-1;0<=n;--n){j(l[n],m)}for(n=m.length-1;0<=n;--n){j(m[n],l)}})();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(g,h){1===arguments.length&&"object"===typeof g&&(g=(h=g)&&h.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},h);OpenLayers.Util.extend(this,h);OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]);!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent));!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(g);this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px");OpenLayers.Element.addClass(this.div,"olMap");var i=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(i,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this));i=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(i);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}!0===this.autoUpdateSize&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy));if(this.theme){for(var i=!0,j=document.getElementsByTagName("link"),k=0,l=j.length;k<l;++k){if(OpenLayers.Util.isEquivalentUrl(j.item(k).href,this.theme)){i=!1;break}}i&&(i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(i))}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));k=0;for(l=this.controls.length;k<l;k++){this.addControlToMap(this.controls[k])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);h&&h.layers&&(delete this.center,delete this.zoom,this.addLayers(h.layers),h.center&&!this.getCenter()&&this.setCenter(h.center,h.zoom));this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod));this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(b){this.div=OpenLayers.Util.getElement(b);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return !1}this.panTween&&(this.panTween.stop(),this.panTween=null);this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null);OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);this.paddingForPopups=null;if(null!=this.controls){for(var b=this.controls.length-1;0<=b;--b){this.controls[b].destroy()}this.controls=null}if(null!=this.layers){for(b=this.layers.length-1;0<=b;--b){this.layers[b].destroy(!1)}this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.viewPortDiv=null;this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null);this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null);this.events.destroy();this.options=this.events=null},setOptions:function(c){var d=this.minPx&&c.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,c);d&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,f,g){var h="function"==typeof g.test;return OpenLayers.Array.filter(this[e],function(b){return b[f]==g||h&&g.test(b[f])})},getLayersBy:function(c,d){return this.getBy("layers",c,d)},getLayersByName:function(b){return this.getLayersBy("name",b)},getLayersByClass:function(b){return this.getLayersBy("CLASS_NAME",b)},getControlsBy:function(c,d){return this.getBy("controls",c,d)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},getLayer:function(f){for(var g=null,h=0,i=this.layers.length;h<i;h++){var j=this.layers[h];if(j.id==f){g=j;break}}return g},setLayerZIndex:function(c,d){c.setZIndex(this.Z_INDEX_BASE[c.isBaseLayer?"BaseLayer":"Overlay"]+5*d)},resetLayersZIndex:function(){for(var c=0,d=this.layers.length;c<d;c++){this.setLayerZIndex(this.layers[c],c)}},addLayer:function(d){for(var e=0,f=this.layers.length;e<f;e++){if(this.layers[e]==d){return !1}}if(!1===this.events.triggerEvent("preaddlayer",{layer:d})){return !1}this.allOverlays&&(d.isBaseLayer=!1);d.div.className="olLayerDiv";d.div.style.overflow="";this.setLayerZIndex(d,this.layers.length);d.isFixed?this.viewPortDiv.appendChild(d.div):this.layerContainerDiv.appendChild(d.div);this.layers.push(d);d.setMap(this);d.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(d):d.setVisibility(!1):d.redraw();this.events.triggerEvent("addlayer",{layer:d});d.events.triggerEvent("added",{map:this,layer:d});d.afterAdd();return !0},addLayers:function(d){for(var e=0,f=d.length;e<f;e++){this.addLayer(d[e])}},removeLayer:function(f,g){if(!1!==this.events.triggerEvent("preremovelayer",{layer:f})){null==g&&(g=!0);f.isFixed?this.viewPortDiv.removeChild(f.div):this.layerContainerDiv.removeChild(f.div);OpenLayers.Util.removeItem(this.layers,f);f.removeMap(this);f.map=null;if(this.baseLayer==f&&(this.baseLayer=null,g)){for(var h=0,i=this.layers.length;h<i;h++){var j=this.layers[h];if(j.isBaseLayer||this.allOverlays){this.setBaseLayer(j);break}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:f});f.events.triggerEvent("removed",{map:this,layer:f})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(b){return OpenLayers.Util.indexOf(this.layers,b)},setLayerIndex:function(e,f){var g=this.getLayerIndex(e);0>f?f=0:f>this.layers.length&&(f=this.layers.length);if(g!=f){this.layers.splice(g,1);this.layers.splice(f,0,e);for(var g=0,h=this.layers.length;g<h;g++){this.setLayerZIndex(this.layers[g],g)}this.events.triggerEvent("changelayer",{layer:e,property:"order"});this.allOverlays&&(0===f?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(d,e){var f=this.getLayerIndex(d)+e;this.setLayerIndex(d,f)},setBaseLayer:function(d){if(d!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,d)){var e=this.getCachedCenter(),f=OpenLayers.Util.getResolutionFromScale(this.getScale(),d.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1);this.baseLayer=d;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()}null!=e&&(d=this.getZoomForResolution(f||this.resolution,!0),this.setCenter(e,d,!1,!0));this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(c,d){this.controls.push(c);this.addControlToMap(c,d)},addControls:function(f,g){for(var h=1===arguments.length?[]:g,i=0,j=f.length;i<j;i++){this.addControl(f[i],h[i]?h[i]:null)}},addControlToMap:function(d,e){d.outsideViewport=null!=d.div;this.displayProjection&&!d.displayProjection&&(d.displayProjection=this.displayProjection);d.setMap(this);var f=d.draw(e);f&&!d.outsideViewport&&(f.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(f));d.autoActivate&&d.activate()},getControl:function(f){for(var g=null,h=0,i=this.controls.length;h<i;h++){var j=this.controls[h];if(j.id==f){g=j;break}}return g},removeControl:function(b){b&&b==this.getControl(b.id)&&(b.div&&b.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(b.div),OpenLayers.Util.removeItem(this.controls,b))},addPopup:function(d,e){if(e){for(var f=this.popups.length-1;0<=f;--f){this.removePopup(this.popups[f])}}d.map=this;this.popups.push(d);if(f=d.draw()){f.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(f)}},removePopup:function(c){OpenLayers.Util.removeItem(this.popups,c);if(c.div){try{this.layerContainerDiv.removeChild(c.div)}catch(d){}}c.map=null},getSize:function(){var b=null;null!=this.size&&(b=this.size.clone());return b},updateSize:function(){var c=this.getCurrentSize();if(c&&!isNaN(c.h)&&!isNaN(c.w)){this.events.clearMouseCache();var d=this.getSize();null==d&&(this.size=d=c);if(!c.equals(d)){this.size=c;c=0;for(d=this.layers.length;c<d;c++){this.layers[c].onMapResize()}c=this.getCachedCenter();null!=this.baseLayer&&null!=c&&(d=this.getZoom(),this.zoom=null,this.setCenter(c,d))}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var b=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==b.w&&0==b.h||isNaN(b.w)&&isNaN(b.h)){b.w=this.div.offsetWidth,b.h=this.div.offsetHeight}if(0==b.w&&0==b.h||isNaN(b.w)&&isNaN(b.h)){b.w=parseInt(this.div.style.width),b.h=parseInt(this.div.style.height)}return b},calculateBounds:function(e,f){var g=null;null==e&&(e=this.getCachedCenter());null==f&&(f=this.getResolution());if(null!=e&&null!=f){var g=this.size.w*f/2,h=this.size.h*f/2,g=new OpenLayers.Bounds(e.lon-g,e.lat-h,e.lon+g,e.lat+h)}return g},getCenter:function(){var c=null,d=this.getCachedCenter();d&&(c=d.clone());return c},getCachedCenter:function(){!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(e,f,g){g=OpenLayers.Util.applyDefaults(g,{animate:!0,dragging:!1});if(g.dragging){0==e&&0==f||this.moveByPx(e,f)}else{var h=this.getViewPortPxFromLonLat(this.getCachedCenter());e=h.add(e,f);if(this.dragging||!e.equals(h)){h=this.getLonLatFromViewPortPx(e),g.animate?this.panTo(h):(this.moveTo(h),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(f){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(f)){var g=this.getCachedCenter();if(!f.equals(g)){var g=this.getPixelFromLonLat(g),h=this.getPixelFromLonLat(f),i=0,j=0;this.panTween.start({x:0,y:0},{x:h.x-g.x,y:h.y-g.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(b){this.moveByPx(b.x-i,b.y-j);i=Math.round(b.x);j=Math.round(b.y)},this),done:OpenLayers.Function.bind(function(a){this.moveTo(f);this.dragging=!1;this.events.triggerEvent("moveend")},this)}})}}else{this.setCenter(f)}},setCenter:function(e,f,g,h){this.panTween&&this.panTween.stop();this.zoomTween&&this.zoomTween.stop();this.moveTo(e,f,{dragging:g,forceZoomChange:h})},moveByPx:function(i,j){var l=this.size.w/2,m=this.size.h/2,n=l+i,o=m+j,p=this.baseLayer.wrapDateLine,q=0,r=0;this.restrictedExtent&&(q=l,r=m,p=!1);i=p||n<=this.maxPx.x-q&&n>=this.minPx.x+q?Math.round(i):0;j=o<=this.maxPx.y-r&&o>=this.minPx.y+r?Math.round(j):0;if(i||j){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart"));this.center=null;i&&(this.layerContainerOriginPx.x-=i,this.minPx.x-=i,this.maxPx.x-=i);j&&(this.layerContainerOriginPx.y-=j,this.minPx.y-=j,this.maxPx.y-=j);this.applyTransform();m=0;for(n=this.layers.length;m<n;++m){l=this.layers[m],l.visibility&&(l===this.baseLayer||l.inRange)&&(l.moveByPx(i,j),l.events.triggerEvent("move"))}this.events.triggerEvent("move")}},adjustZoom:function(f){if(this.baseLayer&&this.baseLayer.wrapDateLine){var g=this.baseLayer.resolutions,h=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(f)>h){if(this.fractionalZoom){f=this.getZoomForResolution(h)}else{for(var i=f|0,j=g.length;i<j;++i){if(g[i]<=h){f=i;break}}}}}return f},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(i,j,m){null==i||i instanceof OpenLayers.LonLat||(i=new OpenLayers.LonLat(i));m||(m={});null!=j&&(j=parseFloat(j),this.fractionalZoom||(j=Math.round(j)));var n=j;j=this.adjustZoom(j);j!==n&&(i=this.getCenter());var n=m.dragging||this.dragging,o=m.forceZoomChange;this.getCachedCenter()||this.isValidLonLat(i)||(i=this.maxExtent.getCenterLonLat(),this.center=i.clone());if(null!=this.restrictedExtent){null==i&&(i=this.center);null==j&&(j=this.getZoom());var p=this.getResolutionForZoom(j),p=this.calculateBounds(i,p);if(!this.restrictedExtent.containsBounds(p)){var q=this.restrictedExtent.getCenterLonLat();p.getWidth()>this.restrictedExtent.getWidth()?i=new OpenLayers.LonLat(q.lon,i.lat):p.left<this.restrictedExtent.left?i=i.add(this.restrictedExtent.left-p.left,0):p.right>this.restrictedExtent.right&&(i=i.add(this.restrictedExtent.right-p.right,0));p.getHeight()>this.restrictedExtent.getHeight()?i=new OpenLayers.LonLat(i.lon,q.lat):p.bottom<this.restrictedExtent.bottom?i=i.add(0,this.restrictedExtent.bottom-p.bottom):p.top>this.restrictedExtent.top&&(i=i.add(0,this.restrictedExtent.top-p.top))}}o=o||this.isValidZoomLevel(j)&&j!=this.getZoom();p=this.isValidLonLat(i)&&!i.equals(this.center);if(o||p||n){n||this.events.triggerEvent("movestart",{zoomChanged:o});p&&(!o&&this.center&&this.centerLayerContainer(i),this.center=i.clone());i=o?this.getResolutionForZoom(j):this.getResolution();if(o||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var p=this.getMaxExtent({restricted:!0}),r=p.getCenterLonLat(),q=this.center.lon-r.lon,r=r.lat-this.center.lat,s=Math.round(p.getWidth()/i),t=Math.round(p.getHeight()/i);this.minPx={x:(this.size.w-s)/2-q/i,y:(this.size.h-t)/2-r/i};this.maxPx={x:this.minPx.x+Math.round(p.getWidth()/i),y:this.minPx.y+Math.round(p.getHeight()/i)}}o&&(this.zoom=j,this.resolution=i);i=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(i,o,m.dragging),m.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:o}));i=this.baseLayer.getExtent();for(j=this.layers.length-1;0<=j;--j){p=this.layers[j],p===this.baseLayer||p.isBaseLayer||(q=p.calculateInRange(),p.inRange!=q&&((p.inRange=q)||p.display(!1),this.events.triggerEvent("changelayer",{layer:p,property:"visibility"})),q&&p.visibility&&(p.moveTo(i,o,m.dragging),m.dragging||p.events.triggerEvent("moveend",{zoomChanged:o})))}this.events.triggerEvent("move");n||this.events.triggerEvent("moveend");if(o){j=0;for(m=this.popups.length;j<m;j++){this.popups[j].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(f){var g=this.getViewPortPxFromLonLat(this.layerContainerOrigin),h=this.getViewPortPxFromLonLat(f);if(null!=g&&null!=h){var i=this.layerContainerOriginPx.x;f=this.layerContainerOriginPx.y;var j=Math.round(g.x-h.x),g=Math.round(g.y-h.y);this.applyTransform(this.layerContainerOriginPx.x=j,this.layerContainerOriginPx.y=g);i-=j;f-=g;this.minPx.x-=i;this.maxPx.x-=i;this.minPx.y-=f;this.maxPx.y-=f}},isValidZoomLevel:function(b){return null!=b&&0<=b&&b<this.getNumZoomLevels()},isValidLonLat:function(c){var d=!1;null!=c&&(d=this.getMaxExtent(),d=d.containsLonLat(c,{worldBounds:this.baseLayer.wrapDateLine&&d}));return d},getProjection:function(){var b=this.getProjectionObject();return b?b.getCode():null},getProjectionObject:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.projection);return b},getMaxResolution:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.maxResolution);return b},getMaxExtent:function(c){var d=null;c&&c.restricted&&this.restrictedExtent?d=this.restrictedExtent:null!=this.baseLayer&&(d=this.baseLayer.maxExtent);return d},getNumZoomLevels:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.numZoomLevels);return b},getExtent:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.getExtent());return b},getResolution:function(){var b=null;null!=this.baseLayer?b=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(b=this.layers[0].getResolution());return b},getUnits:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.units);return b},getScale:function(){var b=null;null!=this.baseLayer&&(b=this.getResolution(),b=OpenLayers.Util.getScaleFromResolution(b,this.baseLayer.units));return b},getZoomForExtent:function(d,e){var f=null;null!=this.baseLayer&&(f=this.baseLayer.getZoomForExtent(d,e));return f},getResolutionForZoom:function(c){var d=null;this.baseLayer&&(d=this.baseLayer.getResolutionForZoom(c));return d},getZoomForResolution:function(d,e){var f=null;null!=this.baseLayer&&(f=this.baseLayer.getZoomForResolution(d,e));return f},zoomTo:function(g,h){var i=this;if(i.isValidZoomLevel(g)){if(i.baseLayer.wrapDateLine&&(g=i.adjustZoom(g)),i.zoomTween){var j=i.getResolution(),k=i.getResolutionForZoom(g),l={scale:1},j={scale:j/k};i.zoomTween.playing&&i.zoomTween.duration<3*i.zoomDuration?i.zoomTween.finish={scale:i.zoomTween.finish.scale*j.scale}:(h||(k=i.getSize(),h={x:k.w/2,y:k.h/2}),i.zoomTween.start(l,j,i.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(b){var c=i.layerContainerOriginPx;b=b.scale;i.applyTransform(c.x+((b-1)*(c.x-h.x)|0),c.y+((b-1)*(c.y-h.y)|0),b)},done:function(b){i.applyTransform();b=i.getResolution()/b.scale;var c=i.getZoomForResolution(b,!0);i.moveTo(i.getZoomTargetCenter(h,b),c,!0)}}}))}else{l=h?i.getZoomTargetCenter(h,i.getResolutionForZoom(g)):null,i.setCenter(l,g)}}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(d,e){d instanceof OpenLayers.Bounds||(d=new OpenLayers.Bounds(d));var f=d.getCenterLonLat();if(this.baseLayer.wrapDateLine){f=this.getMaxExtent();for(d=d.clone();d.right<d.left;){d.right+=f.getWidth()}f=d.getCenterLonLat().wrapDateLine(f)}this.setCenter(f,this.getZoomForExtent(d,e))},zoomToMaxExtent:function(b){b=this.getMaxExtent({restricted:b?b.restricted:!0});this.zoomToExtent(b)},zoomToScale:function(f,g){var h=OpenLayers.Util.getResolutionFromScale(f,this.baseLayer.units),i=this.size.w*h/2,h=this.size.h*h/2,j=this.getCachedCenter(),i=new OpenLayers.Bounds(j.lon-i,j.lat-h,j.lon+i,j.lat+h);this.zoomToExtent(i,g)},getLonLatFromViewPortPx:function(c){var d=null;null!=this.baseLayer&&(d=this.baseLayer.getLonLatFromViewPortPx(c));return d},getViewPortPxFromLonLat:function(c){var d=null;null!=this.baseLayer&&(d=this.baseLayer.getViewPortPxFromLonLat(c));return d},getZoomTargetCenter:function(g,h){var i=null,j=this.getSize(),k=j.w/2-g.x,j=g.y-j.h/2,l=this.getLonLatFromPixel(g);l&&(i=new OpenLayers.LonLat(l.lon+k*h,l.lat+j*h));return i},getLonLatFromPixel:function(b){return this.getLonLatFromViewPortPx(b)},getPixelFromLonLat:function(b){b=this.getViewPortPxFromLonLat(b);b.x=Math.round(b.x);b.y=Math.round(b.y);return b},getGeodesicPixelSize:function(g){var h=g?this.getLonLatFromPixel(g):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution();g=h.add(-i/2,0);var j=h.add(i/2,0),k=h.add(0,-i/2),h=h.add(0,i/2),i=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||i;l.equals(i)||(g.transform(l,i),j.transform(l,i),k.transform(l,i),h.transform(l,i));return new OpenLayers.Size(OpenLayers.Util.distVincenty(g,j),OpenLayers.Util.distVincenty(k,h))},getViewPortPxFromLayerPx:function(c){var d=null;null!=c&&(d=c.add(this.layerContainerOriginPx.x,this.layerContainerOriginPx.y));return d},getLayerPxFromViewPortPx:function(c){var d=null;null!=c&&(d=c.add(-this.layerContainerOriginPx.x,-this.layerContainerOriginPx.y),isNaN(d.x)||isNaN(d.y))&&(d=null);return d},getLonLatFromLayerPx:function(b){b=this.getViewPortPxFromLayerPx(b);return this.getLonLatFromViewPortPx(b)},getLayerPxFromLonLat:function(b){b=this.getPixelFromLonLat(b);return this.getLayerPxFromViewPortPx(b)},applyTransform:function(i,j,l){l=l||1;var m=this.layerContainerOriginPx,n=1!==l;i=i||m.x;j=j||m.y;var o=this.layerContainerDiv.style,p=this.applyTransform.transform,q=this.applyTransform.template;if(void 0===p&&(p=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=p)){var r=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));r&&"none"===r||(q=["translate3d(",",0) ","scale3d(",",1)"],o[p]=[q[0],"0,0",q[1]].join(""));q&&~o[p].indexOf(q[0])||(q=["translate(",") ","scale(",")"]);this.applyTransform.template=q}null===p||"translate3d("!==q[0]&&!0!==n?(o.left=i+"px",o.top=j+"px",null!==p&&(o[p]="")):(!0===n&&"translate("===q[0]&&(i-=m.x,j-=m.y,o.left=m.x+"px",o.top=m.y+"px"),o[p]=[q[0],i,"px,",j,"px",q[1],q[2],l,",",l,q[3]].join(""))},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(d,e,f){OpenLayers.Util.extend(this,f);this.control=d;this.callbacks=e;(d=this.map||d.map)&&this.setMap(d);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(b){this.map=b},checkModifiers:function(b){return null==this.keyMask?!0:((b.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(b.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(b.altKey?OpenLayers.Handler.MOD_ALT:0)|(b.metaKey?OpenLayers.Handler.MOD_META:0))==this.keyMask},activate:function(){if(this.active){return !1}for(var d=OpenLayers.Events.prototype.BROWSER_EVENTS,e=0,f=d.length;e<f;e++){this[d[e]]&&this.register(d[e],this[d[e]])}return this.active=!0},deactivate:function(){if(!this.active){return !1}for(var d=OpenLayers.Events.prototype.BROWSER_EVENTS,e=0,f=d.length;e<f;e++){this[d[e]]&&this.unregister(d[e],this[d[e]])}this.active=this.touch=!1;return !0},startTouch:function(){if(!this.touch){this.touch=!0;for(var d="mousedown mouseup mousemove click dblclick mouseout".split(" "),e=0,f=d.length;e<f;e++){this[d[e]]&&this.unregister(d[e],this[d[e]])}}},callback:function(c,d){c&&this.callbacks[c]&&this.callbacks[c].apply(this.control,d)},register:function(c,d){this.map.events.registerPriority(c,this,d);this.map.events.registerPriority(c,this,this.setEvent)},unregister:function(c,d){this.map.events.unregister(c,this,d);this.map.events.unregister(c,this,this.setEvent)},setEvent:function(b){this.evt=b;return !0},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(b){this.startTouch();this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return !0},touchmove:function(b){this.last=this.getEventInfo(b);return !0},touchend:function(b){this.down&&(b.xy=this.last.xy,b.lastTouches=this.last.touches,this.handleSingle(b),this.down=null);return !0},mousedown:function(b){this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return !0},mouseup:function(c){var d=!0;this.checkModifiers(c)&&(this.control.handleRightClicks&&OpenLayers.Event.isRightClick(c))&&(d=this.rightclick(c));return d},rightclick:function(b){if(this.passesTolerance(b)){if(null!=this.rightclickTimerId){return this.clearTimer(),this.callback("dblrightclick",[b]),!this.stopDouble}b=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);b=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(b,this.delay)}return !this.stopSingle},delayedRightCall:function(b){this.rightclickTimerId=null;b&&this.callback("rightclick",[b])},click:function(b){this.last||(this.last=this.getEventInfo(b));this.handleSingle(b);return !this.stopSingle},dblclick:function(b){this.handleDouble(b);return !this.stopDouble},handleDouble:function(b){this.passesDblclickTolerance(b)&&(this["double"]&&this.callback("dblclick",[b]),this.clearTimer())},handleSingle:function(b){this.passesTolerance(b)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(b),this.handleDouble(b)),this.last.touches&&2===this.last.touches.length||this.clearTimer()):(this.first=this.getEventInfo(b),b=this.single?OpenLayers.Util.extend({},b):null,this.queuePotentialClick(b)))},queuePotentialClick:function(b){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay)},passesTolerance:function(d){var e=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(e=this.pixelTolerance>=this.down.xy.distanceTo(d.xy))&&this.touch&&this.down.touches.length===this.last.touches.length){d=0;for(var f=this.down.touches.length;d<f;++d){if(this.getTouchDistance(this.down.touches[d],this.last.touches[d])>this.pixelTolerance){e=!1;break}}}return e},getTouchDistance:function(c,d){return Math.sqrt(Math.pow(c.clientX-d.clientX,2)+Math.pow(c.clientY-d.clientY,2))},passesDblclickTolerance:function(b){b=!0;this.down&&this.first&&(b=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(b){this.timerId=null;b&&this.callback("click",[b])},getEventInfo:function(f){var g;if(f.touches){var h=f.touches.length;g=Array(h);for(var i,j=0;j<h;j++){i=f.touches[j],g[j]={clientX:i.olClientX,clientY:i.olClientY}}}return{xy:f.xy,touches:g}},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,b=!0);return b},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(e,f,g){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(!0===this.documentDrag){var h=this;this._docMove=function(b){h.mousemove({xy:{x:b.clientX,y:b.clientY},element:document})};this._docUp=function(b){h.mouseup({xy:{x:b.clientX,y:b.clientY}})}}},dragstart:function(c){var d=!0;this.dragging=!1;this.checkModifiers(c)&&(OpenLayers.Event.isLeftClick(c)||OpenLayers.Event.isSingleTouch(c))?(this.started=!0,this.last=this.start=c.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(c),this.callback("down",[c.xy]),OpenLayers.Event.preventDefault(c),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,d=!this.stopDown):(this.started=!1,this.last=this.start=null);return d},dragmove:function(b){this.lastMoveEvt=b;!this.started||(this.timeoutId||b.xy.x==this.last.x&&b.xy.y==this.last.y)||(!0===this.documentDrag&&this.documentEvents&&(b.element===document?(this.adjustXY(b),this.setEvent(b)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(b),this.callback("move",[b.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=b.xy);return !0},dragend:function(c){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(c),this.removeDocumentEvents());var d=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(c);this.callback("up",[c.xy]);d&&this.callback("done",[c.xy]);document.onselectstart=this.oldOnselectstart}return !0},down:function(b){},move:function(b){},up:function(b){},out:function(b){},mousedown:function(b){return this.dragstart(b)},touchstart:function(b){this.startTouch();return this.dragstart(b)},mousemove:function(b){return this.dragmove(b)},touchmove:function(b){return this.dragmove(b)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(b){return this.dragend(b)},touchend:function(b){b.xy=this.last;return this.dragend(b)},mouseout:function(c){if(this.started&&OpenLayers.Util.mouseLeft(c,this.map.viewPortDiv)){if(!0===this.documentDrag){this.addDocumentEvents()}else{var d=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(c);this.callback("out",[]);d&&this.callback("done",[c.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}}return !0},click:function(b){return this.start==this.last},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=!1,this.last=this.start=null,b=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"));return b},adjustXY:function(c){var d=OpenLayers.Util.pagePosition(this.map.viewPortDiv);c.xy.x-=d[0];c.xy.y-=d[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(b){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[b])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length){if(this.map.baseLayer){this.layers=[this.map.baseLayer.clone()]}else{return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport){this.element.style.display=""}else{this.div.className+=" "+this.displayClass+"Container";var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,b,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle);this.div.appendChild(this.maximizeDiv);b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,b,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle);this.div.appendChild(this.minimizeDiv);this.minimizeControl()}this.map.getExtent()&&this.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});this.maximized&&this.maximizeControl();return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(g){var h=this.handlers.drag.last.x-g.x,i=this.handlers.drag.last.y-g.y;if(0!=h||0!=i){var j=this.rectPxBounds.top,k=this.rectPxBounds.left;g=Math.abs(this.rectPxBounds.getHeight());var l=this.rectPxBounds.getWidth(),i=Math.max(0,j-i),i=Math.min(i,this.ovmap.size.h-this.hComp-g),h=Math.max(0,k-h),h=Math.min(h,this.ovmap.size.w-this.wComp-l);this.setRectPxBounds(new OpenLayers.Bounds(h,i+g,h+l,i))}},mapDivClick:function(g){var h=this.rectPxBounds.getCenterPixel(),i=g.xy.x-h.x,j=g.xy.y-h.y,k=this.rectPxBounds.top,l=this.rectPxBounds.left;g=Math.abs(this.rectPxBounds.getHeight());h=this.rectPxBounds.getWidth();j=Math.max(0,k+j);j=Math.min(j,this.ovmap.size.h-g);i=Math.max(0,l+i);i=Math.min(i,this.ovmap.size.w-h);this.setRectPxBounds(new OpenLayers.Bounds(i,j+g,i+h,j));this.updateMapToRect()},onButtonClick:function(b){b.buttonElement===this.minimizeDiv?this.minimizeControl():b.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(b){this.element.style.display="";this.showToggle(!1);null!=b&&OpenLayers.Event.stop(b)},minimizeControl:function(b){this.element.style.display="none";this.showToggle(!0);null!=b&&OpenLayers.Event.stop(b)},showToggle:function(b){this.maximizeDiv&&(this.maximizeDiv.style.display=b?"":"none");this.minimizeDiv&&(this.minimizeDiv.style.display=b?"none":"")},update:function(){null==this.ovmap&&this.createMap();!this.autoPan&&this.isSuitableOverview()||this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var c=this.map.getExtent(),d=this.map.getMaxExtent(),c=new OpenLayers.Bounds(Math.max(c.left,d.left),Math.max(c.bottom,d.bottom),Math.min(c.right,d.right),Math.min(c.top,d.top));this.ovmap.getProjection()!=this.map.getProjection()&&(c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));d=this.ovmap.getResolution()/this.map.getResolution();return d>this.minRatio&&d<=this.maxRatio&&this.ovmap.getExtent().containsBounds(c)},updateOverview:function(){var d=this.map.getResolution(),e=this.ovmap.getResolution(),f=e/d;f>this.maxRatio?e=this.minRatio*d:f<=this.minRatio&&(e=this.maxRatio*d);this.ovmap.getProjection()!=this.map.getProjection()?(d=this.map.center.clone(),d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):d=this.map.center;this.ovmap.setCenter(d,this.ovmap.getZoomForResolution(e*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var c=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,c);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=(this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")))?this.wComp:2;this.hComp=(this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")))?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(b){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(b){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var c=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,d=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=c&&d?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[d]:1}},updateRectToMap:function(){var b;b=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();(b=this.getRectBoundsFromMapBounds(b))&&this.setRectPxBounds(b)},updateMapToRect:function(){var b=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(b=b.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(b.getCenterLonLat())},setRectPxBounds:function(g){var h=Math.max(g.top,0),i=Math.max(g.left,0),j=Math.min(g.top+Math.abs(g.getHeight()),this.ovmap.size.h-this.hComp);g=Math.min(g.left+g.getWidth(),this.ovmap.size.w-this.wComp);var k=Math.max(g-i,0),l=Math.max(j-h,0);k<this.minRectSize||l<this.minRectSize?(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,k=i+k/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(h+l/2-this.minRectSize/2)+"px",this.extentRectangle.style.left=Math.round(k)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"):(this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(h)+"px",this.extentRectangle.style.left=Math.round(i)+"px",this.extentRectangle.style.height=Math.round(l)+"px",this.extentRectangle.style.width=Math.round(k)+"px");this.rectPxBounds=new OpenLayers.Bounds(Math.round(i),Math.round(j),Math.round(g),Math.round(h))},getRectBoundsFromMapBounds:function(d){var e=this.getOverviewPxFromLonLat({lon:d.left,lat:d.bottom});d=this.getOverviewPxFromLonLat({lon:d.right,lat:d.top});var f=null;e&&d&&(f=new OpenLayers.Bounds(e.x,e.y,d.x,d.y));return f},getMapBoundsFromRectBounds:function(c){var d=this.getLonLatFromOverviewPx({x:c.left,y:c.bottom});c=this.getLonLatFromOverviewPx({x:c.right,y:c.top});return new OpenLayers.Bounds(d.lon,d.lat,c.lon,c.lat)},getLonLatFromOverviewPx:function(e){var f=this.ovmap.size,g=this.ovmap.getResolution(),h=this.ovmap.getExtent().getCenterLonLat();return{lon:h.lon+(e.x-f.w/2)*g,lat:h.lat-(e.y-f.h/2)*g}},getOverviewPxFromLonLat:function(d){var e=this.ovmap.getResolution(),f=this.ovmap.getExtent();if(f){return{x:Math.round(1/e*(d.lon-f.left)),y:Math.round(1/e*(f.top-d.lat))}}},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(c,d){this.metadata={};d=OpenLayers.Util.extend({},d);null!=this.alwaysInRange&&(d.alwaysInRange=this.alwaysInRange);this.addOptions(d);this.name=c;if(null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object)){this.events.on(this.eventListeners)}},destroy:function(b){null==b&&(b=!0);null!=this.map&&this.map.removeLayer(this,b);this.options=this.div=this.name=this.map=this.projection=null;this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy());this.events=this.eventListeners=null},clone:function(b){null==b&&(b=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(b,this);b.map=null;return b},getOptions:function(){var c={},d;for(d in this.options){c[d]=this[d]}return c},setName:function(b){b!=this.name&&(this.name=b,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(f,g){null==this.options&&(this.options={});f&&("string"==typeof f.projection&&(f.projection=new OpenLayers.Projection(f.projection)),f.projection&&OpenLayers.Util.applyDefaults(f,OpenLayers.Projection.defaults[f.projection.getCode()]),!f.maxExtent||f.maxExtent instanceof OpenLayers.Bounds||(f.maxExtent=new OpenLayers.Bounds(f.maxExtent)),!f.minExtent||f.minExtent instanceof OpenLayers.Bounds||(f.minExtent=new OpenLayers.Bounds(f.minExtent)));OpenLayers.Util.extend(this.options,f);OpenLayers.Util.extend(this,f);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var h=this.map.getResolution(),i=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]),j;for(j in f){if(f.hasOwnProperty(j)&&0<=OpenLayers.Util.indexOf(i,j)){this.initResolutions();g&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(h),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}}},onMapResize:function(){},redraw:function(){var c=!1;if(this.map){this.inRange=this.calculateInRange();var d=this.getExtent();d&&(this.inRange&&this.visibility)&&(this.moveTo(d,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),c=!0)}return c},moveTo:function(d,e,f){d=this.visibility;this.isBaseLayer||(d=d&&this.inRange);this.display(d)},moveByPx:function(c,d){},setMap:function(b){null==this.map&&(this.map=b,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(b){},getImageSize:function(b){return this.imageSize||this.tileSize},setTileSize:function(b){this.tileSize=b=b?b:this.tileSize?this.tileSize:this.map.getTileSize();this.gutter&&(this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(b){b!=this.visibility&&(this.visibility=b,this.display(b),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(b){b!=("none"!=this.div.style.display)&&(this.div.style.display=b&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var b=!1;this.alwaysInRange?b=!0:this.map&&(b=this.map.getResolution(),b=b>=this.minResolution&&b<=this.maxResolution);return b},setIsBaseLayer:function(b){b!=this.isBaseLayer&&(this.isBaseLayer=b,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var h,i,j,k={},l=!0;h=0;for(i=this.RESOLUTION_PROPERTIES.length;h<i;h++){j=this.RESOLUTION_PROPERTIES[h],k[j]=this.options[j],l&&this.options[j]&&(l=!1)}null==this.options.alwaysInRange&&(this.alwaysInRange=l);null==k.resolutions&&(k.resolutions=this.resolutionsFromScales(k.scales));null==k.resolutions&&(k.resolutions=this.calculateResolutions(k));if(null==k.resolutions){h=0;for(i=this.RESOLUTION_PROPERTIES.length;h<i;h++){j=this.RESOLUTION_PROPERTIES[h],k[j]=null!=this.options[j]?this.options[j]:this.map[j]}null==k.resolutions&&(k.resolutions=this.resolutionsFromScales(k.scales));null==k.resolutions&&(k.resolutions=this.calculateResolutions(k))}var m;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(m=this.options.maxResolution);this.options.minScale&&(m=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var n;this.options.minResolution&&"auto"!==this.options.minResolution&&(n=this.options.minResolution);this.options.maxScale&&(n=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));k.resolutions&&(k.resolutions.sort(function(c,d){return d-c}),m||(m=k.resolutions[0]),n||(n=k.resolutions[k.resolutions.length-1]));if(this.resolutions=k.resolutions){i=this.resolutions.length;this.scales=Array(i);for(h=0;h<i;h++){this.scales[h]=OpenLayers.Util.getScaleFromResolution(this.resolutions[h],this.units)}this.numZoomLevels=i}if(this.minResolution=n){this.maxScale=OpenLayers.Util.getScaleFromResolution(n,this.units)}if(this.maxResolution=m){this.minScale=OpenLayers.Util.getScaleFromResolution(m,this.units)}},resolutionsFromScales:function(e){if(null!=e){var f,g,h;h=e.length;f=Array(h);for(g=0;g<h;g++){f[g]=OpenLayers.Util.getResolutionFromScale(e[g],this.units)}return f}},calculateResolutions:function(g){var h,i,j=g.maxResolution;null!=g.minScale?j=OpenLayers.Util.getResolutionFromScale(g.minScale,this.units):"auto"==j&&null!=this.maxExtent&&(h=this.map.getSize(),i=this.maxExtent.getWidth()/h.w,h=this.maxExtent.getHeight()/h.h,j=Math.max(i,h));i=g.minResolution;null!=g.maxScale?i=OpenLayers.Util.getResolutionFromScale(g.maxScale,this.units):"auto"==g.minResolution&&null!=this.minExtent&&(h=this.map.getSize(),i=this.minExtent.getWidth()/h.w,h=this.minExtent.getHeight()/h.h,i=Math.max(i,h));"number"!==typeof j&&("number"!==typeof i&&null!=this.maxExtent)&&(j=this.map.getTileSize(),j=Math.max(this.maxExtent.getWidth()/j.w,this.maxExtent.getHeight()/j.h));h=g.maxZoomLevel;g=g.numZoomLevels;"number"===typeof i&&"number"===typeof j&&void 0===g?g=Math.floor(Math.log(j/i)/Math.log(2))+1:void 0===g&&null!=h&&(g=h+1);if(!("number"!==typeof g||0>=g||"number"!==typeof j&&"number"!==typeof i)){h=Array(g);var k=2;"number"==typeof i&&"number"==typeof j&&(k=Math.pow(j/i,1/(g-1)));var l;if("number"===typeof j){for(l=0;l<g;l++){h[l]=j/Math.pow(k,l)}}else{for(l=0;l<g;l++){h[g-1-l]=i*Math.pow(k,l)}}return h}},getResolution:function(){var b=this.map.getZoom();return this.getResolutionForZoom(b)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(d,e){var f=this.map.getSize(),f=Math.max(d.getWidth()/f.w,d.getHeight()/f.h);return this.getZoomForResolution(f,e)},getDataExtent:function(){},getResolutionForZoom:function(d){d=Math.max(0,Math.min(d,this.resolutions.length-1));if(this.map.fractionalZoom){var e=Math.floor(d),f=Math.ceil(d);d=this.resolutions[e]-(d-e)*(this.resolutions[e]-this.resolutions[f])}else{d=this.resolutions[Math.round(d)]}return d},getZoomForResolution:function(i,j){var k,l;if(this.map.fractionalZoom){var m=0,n=this.resolutions[m],o=this.resolutions[this.resolutions.length-1],p;k=0;for(l=this.resolutions.length;k<l;++k){if(p=this.resolutions[k],p>=i&&(n=p,m=k),p<=i){o=p;break}}k=n-o;k=0<k?m+(n-i)/k:m}else{n=Number.POSITIVE_INFINITY;k=0;for(l=this.resolutions.length;k<l;k++){if(j){m=Math.abs(this.resolutions[k]-i);if(m>n){break}n=m}else{if(this.resolutions[k]<i){break}}}k=Math.max(0,k-1)}return k},getLonLatFromViewPortPx:function(e){var f=null,g=this.map;if(null!=e&&g.minPx){var f=g.getResolution(),h=g.getMaxExtent({restricted:!0}),f=new OpenLayers.LonLat((e.x-g.minPx.x)*f+h.left,(g.minPx.y-e.y)*f+h.top);this.wrapDateLine&&(f=f.wrapDateLine(this.maxExtent))}return f},getViewPortPxFromLonLat:function(d,e){var f=null;null!=d&&(e=e||this.map.getResolution(),f=this.map.calculateBounds(null,e),f=new OpenLayers.Pixel(1/e*(d.lon-f.left),1/e*(f.top-d.lat)));return f},setOpacity:function(g){if(g!=this.opacity){this.opacity=g;for(var h=this.div.childNodes,i=0,j=h.length;i<j;++i){var k=h[i].firstChild||h[i],l=h[i].lastChild;l&&"iframe"===l.nodeName.toLowerCase()&&(k=l.parentNode);OpenLayers.Util.modifyDOMElement(k,null,null,null,null,null,null,g)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(b){this.div.style.zIndex=b},adjustBounds:function(c){if(this.gutter){var d=this.gutter*this.map.getResolution();c=new OpenLayers.Bounds(c.left-d,c.bottom-d,c.right+d,c.top+d)}this.wrapDateLine&&(d={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},c=c.wrapDateLine(this.maxExtent,d));return c},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var b=null;return b=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(b){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(b){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var b=0;b<=this.MAX_ZOOM_LEVEL;++b){this.RESOLUTIONS[b]=156543.03390625/Math.pow(2,b)}this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var c=new OpenLayers.Projection("EPSG:4326"),d=new OpenLayers.Projection("EPSG:900913");return function(a,b){var f=OpenLayers.Projection.transform({x:a,y:b},c,d);return new OpenLayers.LonLat(f.x,f.y)}}(),inverseMercator:function(){var c=new OpenLayers.Projection("EPSG:4326"),d=new OpenLayers.Projection("EPSG:900913");return function(a,b){var f=OpenLayers.Projection.transform({x:a,y:b},d,c);return new OpenLayers.LonLat(f.x,f.y)}}()};OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(c,d){OpenLayers.Layer.prototype.initialize.apply(this,arguments);null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.pane=this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";"msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")");this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane);this.loadMapObject();null==this.mapObject&&this.loadWarningMessage()},removeMap:function(b){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane);OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var d=this.map.getSize(),e=Math.min(d.w,300),f=Math.min(d.h,200),e=new OpenLayers.Size(e,f),d=(new OpenLayers.Pixel(d.w/2,d.h/2)).add(-e.w/2,-e.h/2),d=OpenLayers.Util.createDiv(this.name+"_warning",d,e,null,null,null,"auto");d.style.padding="7px";d.style.backgroundColor="yellow";d.innerHTML=this.getWarningHTML();this.div.appendChild(d)},getWarningHTML:function(){return""},display:function(b){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(b){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(c,d){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);this.dragPanMapObject?this.dragPanMapObject(c,-d):this.moveTo(this.map.getCachedCenter())},moveTo:function(h,i,j){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(null!=this.mapObject){var k=this.map.getCenter(),l=this.map.getZoom();if(null!=k){var m=this.getMapObjectCenter(),m=this.getOLLonLatFromMapObjectLonLat(m),n=this.getMapObjectZoom(),n=this.getOLZoomFromMapObjectZoom(n);k.equals(m)&&l==n||(!i&&m&&this.dragPanMapObject&&this.smoothDragPan?(l=this.map.getViewPortPxFromLonLat(m),k=this.map.getViewPortPxFromLonLat(k),this.dragPanMapObject(k.x-l.x,l.y-k.y)):(k=this.getMapObjectLonLatFromOLLonLat(k),l=this.getMapObjectZoomFromOLZoom(l),this.setMapObjectCenter(k,l,j)))}}},getLonLatFromViewPortPx:function(c){var d=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(c=this.getMapObjectPixelFromOLPixel(c),c=this.getMapObjectLonLatFromMapObjectPixel(c),d=this.getOLLonLatFromMapObjectLonLat(c));return d},getViewPortPxFromLonLat:function(c){var d=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(c=this.getMapObjectLonLatFromOLLonLat(c),c=this.getMapObjectPixelFromMapObjectLonLat(c),d=this.getOLPixelFromMapObjectPixel(c));return d},getOLLonLatFromMapObjectLonLat:function(c){var d=null;null!=c&&(d=this.getLongitudeFromMapObjectLonLat(c),c=this.getLatitudeFromMapObjectLonLat(c),d=new OpenLayers.LonLat(d,c));return d},getMapObjectLonLatFromOLLonLat:function(c){var d=null;null!=c&&(d=this.getMapObjectLonLatFromLonLat(c.lon,c.lat));return d},getOLPixelFromMapObjectPixel:function(c){var d=null;null!=c&&(d=this.getXFromMapObjectPixel(c),c=this.getYFromMapObjectPixel(c),d=new OpenLayers.Pixel(d,c));return d},getMapObjectPixelFromOLPixel:function(c){var d=null;null!=c&&(d=this.getMapObjectPixelFromXY(c.x,c.y));return d},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var e=["minZoomLevel","maxZoomLevel","numZoomLevels"],f=0,g=e.length;f<g;f++){var h=e[f];this[h]=null!=this.options[h]?this.options[h]:this.map[h]}if(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL){this.minZoomLevel=this.MIN_ZOOM_LEVEL}e=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;f=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels;this.numZoomLevels=null!=f?Math.min(f,e):e;this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(null!=this.RESOLUTIONS){e=0;this.resolutions=[];for(f=this.minZoomLevel;f<=this.maxZoomLevel;f++){this.resolutions[e++]=this.RESOLUTIONS[f]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}var d=null,e=this.map.getSize(),f=this.getExtent();null!=e&&null!=f&&(d=Math.max(f.getWidth()/e.w,f.getHeight()/e.h));return d},getExtent:function(){var c=this.map.getSize(),d=this.getLonLatFromViewPortPx({x:0,y:0}),c=this.getLonLatFromViewPortPx({x:c.w,y:c.h});return null!=d&&null!=c?new OpenLayers.Bounds(d.lon,c.lat,c.lon,d.lat):null},getZoomForResolution:function(c){if(null!=this.resolutions){return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments)}var d=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(d)},getOLZoomFromMapObjectZoom:function(c){var d=null;null!=c&&(d=c-this.minZoomLevel,this.map.baseLayer!==this&&(d=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(d))));return d},getMapObjectZoomFromOLZoom:function(c){var d=null;null!=c&&(d=c+this.minZoomLevel,this.map.baseLayer!==this&&(d=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(d))));return d},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,8.58306884765625e-05,4.291534423828125e-05,2.145767211914062e-05,1.072883605957031e-05,5.36441802978515e-06,2.68220901489257e-06,1.341104507446289e-06,6.705522537231445e-07],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(d,e){e=e||{};e.version||(e.version="function"===typeof GMap2?"2":"3");var f=OpenLayers.Layer.Google["v"+e.version.replace(/\./g,"_")];if(f){OpenLayers.Util.applyDefaults(e,f)}else{throw"Unsupported Google Maps API version: "+e.version}OpenLayers.Util.applyDefaults(e,f.DEFAULTS);e.maxExtent&&(e.maxExtent=e.maxExtent.clone());OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[d,e]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[d,e]);this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(c){var d=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(d)},display:function(b){this._dragging||this.setGMapVisibility(b);OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(d,e,f){this._dragging=f;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(c){c!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=c);if(this.getVisibility()){var d=this.getMapContainer();OpenLayers.Util.modifyDOMElement(d,null,null,null,null,null,null,c)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[this.map.id];b&&1>=b.count&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var c=OpenLayers.Layer.Google.cache[this.map.id];if(c){var d=this.mapObject&&this.getMapContainer();d&&d.parentNode&&d.parentNode.removeChild(d);(d=c.termsOfUse)&&d.parentNode&&d.parentNode.removeChild(d);(c=c.poweredBy)&&c.parentNode&&c.parentNode.removeChild(c);this.mapObject&&(window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners)&&google.maps.event.clearListeners(this.mapObject,"tilesloaded")}},removeMap:function(c){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var d=OpenLayers.Layer.Google.cache[c.id];d&&(1>=d.count?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[c.id]):--d.count);delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(c){var d=null;null!=c&&(d=c.getSouthWest(),c=c.getNorthEast(),this.sphericalMercator?(d=this.forwardMercator(d.lng(),d.lat()),c=this.forwardMercator(c.lng(),c.lat())):(d=new OpenLayers.LonLat(d.lng(),d.lat()),c=new OpenLayers.LonLat(c.lng(),c.lat())),d=new OpenLayers.Bounds(d.lon,d.lat,c.lon,c.lat));return d},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(b){return this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lon:b.lng()},getLatitudeFromMapObjectLonLat:function(b){return this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lat:b.lat()},getXFromMapObjectPixel:function(b){return b.x},getYFromMapObjectPixel:function(b){return b.y},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Google.cache={};OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var g,h,i,j=OpenLayers.Layer.Google.cache[this.map.id];if(j){g=j.mapObject,h=j.termsOfUse,i=j.poweredBy,++j.count}else{var j=this.map.viewPortDiv,k=document.createElement("div");k.id=this.map.id+"_GMap2Container";k.style.position="absolute";k.style.width="100%";k.style.height="100%";j.appendChild(k);try{g=new GMap2(k),h=k.lastChild,j.appendChild(h),h.style.zIndex="1100",h.style.right="",h.style.bottom="",h.className="olLayerGoogleCopyright",i=k.lastChild,j.appendChild(i),i.style.zIndex="1100",i.style.right="",i.style.bottom="",i.className="olLayerGooglePoweredBy gmnoprint"}catch(l){throw l}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:g,termsOfUse:h,poweredBy:i,count:1}}this.mapObject=g;this.termsOfUse=h;this.poweredBy=i;-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type);"function"==typeof g.getDragObject?this.dragObject=g.getDragObject():this.dragPanMapObject=null;!1===this.isBaseLayer&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var c=this,d=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(d);delete c._resized;c.mapObject.checkResize();c.moveTo(c.map.getCenter(),c.map.getZoom())})}this._resized=!0}},setGMapVisibility:function(d){var e=OpenLayers.Layer.Google.cache[this.map.id];if(e){var f=this.mapObject.getContainer();!0===d?(this.mapObject.setMapType(this.type),f.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",e.displayed=this.id):(e.displayed===this.id&&delete e.displayed,e.displayed||(f.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(c){var d=null;null!=c&&(d=this.sphericalMercator?this.inverseMercator(c.bottom,c.left):new OpenLayers.LonLat(c.bottom,c.left),c=this.sphericalMercator?this.inverseMercator(c.top,c.right):new OpenLayers.LonLat(c.top,c.right),d=new GLatLngBounds(new GLatLng(d.lat,d.lon),new GLatLng(c.lat,c.lon)));return d},setMapObjectCenter:function(c,d){this.mapObject.setCenter(c,d)},dragPanMapObject:function(c,d){this.dragObject.moveBy(new GSize(-c,d))},getMapObjectLonLatFromMapObjectPixel:function(b){return this.mapObject.fromContainerPixelToLatLng(b)},getMapObjectPixelFromMapObjectLonLat:function(b){return this.mapObject.fromLatLngToContainerPixel(b)},getMapObjectZoomFromMapObjectBounds:function(b){return this.mapObject.getBoundsZoomLevel(b)},getMapObjectLonLatFromLonLat:function(d,e){var f;this.sphericalMercator?(f=this.inverseMercator(d,e),f=new GLatLng(f.lat,f.lon)):f=new GLatLng(e,d);return f},getMapObjectPixelFromXY:function(c,d){return new GPoint(c,d)}};OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(c){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[c]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var d in this.namespaces){this.namespaceAlias[this.namespaces[d]]=d}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(c,d){this.namespaces[c]=d;this.namespaceAlias[d]=c},read:function(c){var d=c.indexOf("<");0<d&&(c=c.substring(d));d=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var a;a=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom;a.loadXML(c);return a},this),function(){return(new DOMParser).parseFromString(c,"text/xml")},function(){var a=new XMLHttpRequest;a.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(c),!1);a.overrideMimeType&&a.overrideMimeType("text/xml");a.send(null);return a.responseXML});this.keepData&&(this.data=d);return d},write:function(d){if(this.xmldom){d=d.xml}else{var e=new XMLSerializer;if(1==d.nodeType){var f=document.implementation.createDocument("","",null);f.importNode&&(d=f.importNode(d,!0));f.appendChild(d);d=e.serializeToString(f)}else{d=e.serializeToString(d)}}return d},createElementNS:function(c,d){return this.xmldom?"string"==typeof c?this.xmldom.createNode(1,d,c):this.xmldom.createNode(1,d,""):document.createElementNS(c,d)},createDocumentFragment:function(){return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(b){"string"!==typeof b&&(b=String(b));return this.xmldom?this.xmldom.createTextNode(b):document.createTextNode(b)},getElementsByTagNameNS:function(i,j,k){var l=[];if(i.getElementsByTagNameNS){l=i.getElementsByTagNameNS(j,k)}else{i=i.getElementsByTagName("*");for(var m,n,o=0,p=i.length;o<p;++o){if(m=i[o],n=m.prefix?m.prefix+":"+k:k,"*"==k||n==m.nodeName){"*"!=j&&j!=m.namespaceURI||l.push(m)}}}return l},getAttributeNodeNS:function(i,j,k){var l=null;if(i.getAttributeNodeNS){l=i.getAttributeNodeNS(j,k)}else{i=i.attributes;for(var m,n,o=0,p=i.length;o<p;++o){if(m=i[o],m.namespaceURI==j&&(n=m.prefix?m.prefix+":"+k:k,n==m.nodeName)){l=m;break}}}return l},getAttributeNS:function(e,f,g){var h="";if(e.getAttributeNS){h=e.getAttributeNS(f,g)||""}else{if(e=this.getAttributeNodeNS(e,f,g)){h=e.nodeValue}}return h},getChildValue:function(e,f){var g=f||"";if(e){for(var h=e.firstChild;h;h=h.nextSibling){switch(h.nodeType){case 3:case 4:g+=h.nodeValue}}}return g},isSimpleContent:function(c){var d=!0;for(c=c.firstChild;c;c=c.nextSibling){if(1===c.nodeType){d=!1;break}}return d},contentType:function(e){var f=!1,g=!1,h=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(e=e.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:g=!0;break;case 8:break;default:f=!0}if(g&&f){break}}if(g&&f){h=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else{if(g){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}if(f){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}}return h},hasAttributeNS:function(e,f,g){var h=!1;return h=e.hasAttributeNS?e.hasAttributeNS(f,g):!!this.getAttributeNodeNS(e,f,g)},setAttributeNS:function(e,f,g,h){if(e.setAttributeNS){e.setAttributeNS(f,g,h)}else{if(this.xmldom){f?(f=e.ownerDocument.createNode(2,g,f),f.nodeValue=h,e.setAttributeNode(f)):e.setAttribute(g,h)}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(e,f){f=f||{};var g=f.uri||this.namespaces[f.prefix];g||(g=e.indexOf(":"),g=this.namespaces[e.substring(0,g)]);g||(g=this.namespaces[this.defaultPrefix]);g=this.createElementNS(g,e);f.attributes&&this.setAttributes(g,f.attributes);var h=f.value;null!=h&&g.appendChild(this.createTextNode(h));return g},setAttributes:function(f,g){var h,i,j;for(j in g){null!=g[j]&&g[j].toString&&(h=g[j].toString(),i=this.namespaces[j.substring(0,j.indexOf(":"))]||null,this.setAttributeNS(f,i,j,h))}},readNode:function(e,f){f||(f={});var g=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(g){var h=e.localName||e.nodeName.split(":").pop();(g=g[h]||g["*"])&&g.apply(this,[e,f])}return f},readChildNodes:function(g,h){h||(h={});for(var i=g.childNodes,j,k=0,l=i.length;k<l;++k){j=i[k],1==j.nodeType&&this.readNode(j,h)}return h},writeNode:function(f,g,h){var i,j=f.indexOf(":");0<j?(i=f.substring(0,j),f=f.substring(j+1)):i=h?this.namespaceAlias[h.namespaceURI]:this.defaultPrefix;g=this.writers[i][f].apply(this,[g]);h&&h.appendChild(g);return g},getChildEl:function(d,e,f){return d&&this.getThisOrNextEl(d.firstChild,e,f)},getNextEl:function(d,e,f){return d&&this.getThisOrNextEl(d.nextSibling,e,f)},getThisOrNextEl:function(d,e,f){d:for(;d;d=d.nextSibling){switch(d.nodeType){case 1:if(!(e&&e!==(d.localName||d.nodeName.split(":").pop())||f&&f!==d.namespaceURI)){break d}d=null;break d;case 3:if(/^\s*$/.test(d.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:d=null;break d}}return d||null},lookupNamespaceURI:function(f,g){var h=null;if(f){if(f.lookupNamespaceURI){h=f.lookupNamespaceURI(g)}else{f:switch(f.nodeType){case 1:if(null!==f.namespaceURI&&f.prefix===g){h=f.namespaceURI;break f}if(h=f.attributes.length){for(var i,j=0;j<h;++j){if(i=f.attributes[j],"xmlns"===i.prefix&&i.name==="xmlns:"+g){h=i.value||null;break f}else{if("xmlns"===i.name&&null===g){h=i.value||null;break f}}}}h=this.lookupNamespaceURI(f.parentNode,g);break f;case 2:h=this.lookupNamespaceURI(f.ownerElement,g);break f;case 9:h=this.lookupNamespaceURI(f.documentElement,g);break f;case 6:case 12:case 10:case 11:break f;default:h=this.lookupNamespaceURI(f.parentNode,g)}}}return h},getXMLDoc:function(){OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(c){c=OpenLayers.Util.applyDefaults(c,OpenLayers.Format.WFST.DEFAULTS);var d=OpenLayers.Format.WFST["v"+c.version.replace(/\./g,"_")];if(!d){throw"Unsupported WFST version: "+c.version}return new d(c)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(d,e,f){this.layer=d;this.lonlat=e;this.data=null!=f?f:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.data=this.lonlat=this.id=this.layer=null;null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null);null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var b=!1;null!=this.layer&&null!=this.layer.map&&(b=this.layer.map.getExtent().containsLonLat(this.lonlat));return b},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(b){null!=this.lonlat&&(this.popup||(this.popup=new (this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,b)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this);return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(d,e,f){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,e]);this.lonlat=null;this.geometry=d?d:null;this.state=null;this.attributes={};e&&(this.attributes=OpenLayers.Util.extend(this.attributes,e));this.style=f?f:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null);this.modified=this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(c){var d=!1;this.layer&&this.layer.map&&(d=this.layer.map.getExtent(),c?(c=this.geometry.getBounds(),d=d.intersectsBounds(c)):d=d.toGeometry().intersects(this.geometry));return d},getVisibility:function(){return !(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,f,g){var h=!1;this.geometry&&(h=this.geometry.atPoint(e,f,g));return h},destroyPopup:function(){},move:function(d){if(this.layer&&this.geometry.move){d="OpenLayers.LonLat"==d.CLASS_NAME?this.layer.getViewPortPxFromLonLat(d):d;var e=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),f=this.layer.map.getResolution();this.geometry.move(f*(d.x-e.x),f*(e.y-d.y));this.layer.drawFeature(this);return e}},toState:function(b){if(b==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=b}}else{if(b==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=b}}else{if(b==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=b}}else{b==OpenLayers.State.UNKNOWN&&(this.state=b)}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(c,d){OpenLayers.Util.extend(this,d);this.rules=[];d&&d.rules&&this.addRules(d.rules);this.setDefaultStyle(c||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var c=0,d=this.rules.length;c<d;c++){this.rules[c].destroy(),this.rules[c]=null}this.defaultStyle=this.rules=null},createSymbolizer:function(i){for(var j=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),i),k=this.rules,l,m=[],n=!1,o=0,p=k.length;o<p;o++){l=k[o],l.evaluate(i)&&(l instanceof OpenLayers.Rule&&l.elseFilter?m.push(l):(n=!0,this.applySymbolizer(l,j,i)))}if(!1==n&&0<m.length){for(n=!0,o=0,p=m.length;o<p;o++){this.applySymbolizer(m[o],j,i)}}0<k.length&&!1==n&&(j.display="none");null!=j.label&&"string"!==typeof j.label&&(j.label=String(j.label));return j},applySymbolizer:function(e,f,g){var h=g.geometry?this.getSymbolizerPrefix(g.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];e=e.symbolizer[h]||e.symbolizer;!0===this.defaultsPerSymbolizer&&(h=this.defaultStyle,OpenLayers.Util.applyDefaults(e,{pointRadius:h.pointRadius}),!0!==e.stroke&&!0!==e.graphic||OpenLayers.Util.applyDefaults(e,{strokeWidth:h.strokeWidth,strokeColor:h.strokeColor,strokeOpacity:h.strokeOpacity,strokeDashstyle:h.strokeDashstyle,strokeLinecap:h.strokeLinecap}),!0!==e.fill&&!0!==e.graphic||OpenLayers.Util.applyDefaults(e,{fillColor:h.fillColor,fillOpacity:h.fillOpacity}),!0===e.graphic&&OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset}));return this.createLiterals(OpenLayers.Util.extend(f,e),g)},createLiterals:function(e,f){var g=OpenLayers.Util.extend({},f.attributes||f.data);OpenLayers.Util.extend(g,this.context);for(var h in this.propertyStyles){e[h]=OpenLayers.Style.createLiteral(e[h],g,f,h)}return e},findPropertyStyles:function(){var h={};this.addPropertyStyles(h,this.defaultStyle);for(var i=this.rules,j,k,l=0,m=i.length;l<m;l++){j=i[l].symbolizer;for(var n in j){if(k=j[n],"object"==typeof k){this.addPropertyStyles(h,k)}else{this.addPropertyStyles(h,j);break}}}return h},addPropertyStyles:function(e,f){var g,h;for(h in f){g=f[h],"string"==typeof g&&g.match(/\$\{\w+\}/)&&(e[h]=!0)}return e},addRules:function(b){Array.prototype.push.apply(this.rules,b);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(b){this.defaultStyle=b;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var f=OpenLayers.Style.SYMBOLIZER_PREFIXES,g=0,h=f.length;g<h;g++){if(-1!=e.CLASS_NAME.indexOf(f[g])){return f[g]}}},clone:function(){var d=OpenLayers.Util.extend({},this);if(this.rules){d.rules=[];for(var e=0,f=this.rules.length;e<f;++e){d.rules.push(this.rules[e].clone())}}d.context=this.context&&OpenLayers.Util.extend({},this.context);e=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(e,d)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(e,f,g,h){"string"==typeof e&&-1!=e.indexOf("${")&&(e=OpenLayers.String.format(e,f,[g,h]),e=isNaN(e)||!e?e:parseFloat(e));return e};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(b){OpenLayers.Util.extend(this,b)},destroy:function(){},evaluate:function(b){return !0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(d){var e=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(d.geometry){var f=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(f=this.value.toGeometry());d.geometry.intersects(f)&&(e=!0)}break;default:throw Error("evaluate is not implemented for this filter type.")}return e},clone:function(){var b=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(b)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(b){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[b])},evaluate:function(d){for(var e=0,f=this.fids.length;e<f;e++){if((d.fid||d.id)==this.fids[e]){return !0}}return !1},clone:function(){var b=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(b,this);b.fids=this.fids.slice();return b},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(b){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},getSrsName:function(d,e){var f=e&&e.srsName;f||(f=d&&d.layer?d.layer.projection.getCode():this.srsName);return f},read:function(d,e){e=e||{};OpenLayers.Util.applyDefaults(e,{output:"features"});"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var f={};d&&this.readNode(d,f,!0);f.features&&"features"===e.output&&(f=f.features);return f},readers:{wfs:{FeatureCollection:function(c,d){d.features=[];this.readChildNodes(c,d)}}},write:function(e,f){var g=this.writeNode("wfs:Transaction",{features:e,options:f}),h=this.schemaLocationAttr();h&&this.setAttributeNS(g,this.namespaces.xsi,"xsi:schemaLocation",h);return OpenLayers.Format.XML.prototype.write.apply(this,[g])},writers:{wfs:{GetFeature:function(e){var f=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType){this.writeNode("Query",e,f)}else{for(var g=0,h=this.featureType.length;g<h;g++){e.featureType=this.featureType[g],this.writeNode("Query",e,f)}}return f},Transaction:function(h){h=h||{};var i=h.options||{},j=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:i.handle}}),k,l=h.features;if(l){!0===i.multi&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var m,n;h=0;for(k=l.length;h<k;++h){n=l[h],(m=this.stateName[n.state])&&this.writeNode(m,{feature:n,options:i},j)}!0===i.multi&&this.setGeometryTypes()}if(i.nativeElements){for(h=0,k=i.nativeElements.length;h<k;++h){this.writeNode("wfs:Native",i.nativeElements[h],j)}}return j},Native:function(b){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:b.vendorId,safeToIgnore:b.safeToIgnore},value:b.value})},Insert:function(c){var d=c.feature;c=c.options;c=this.createElementNSPlus("wfs:Insert",{attributes:{handle:c&&c.handle}});this.srsName=this.getSrsName(d);this.writeNode("feature:_typeName",d,c);return c},Update:function(e){var f=e.feature;e=e.options;e=this.createElementNSPlus("wfs:Update",{attributes:{handle:e&&e.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&e.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var g=f.modified;null===this.geometryName||g&&void 0===g.geometry||(this.srsName=this.getSrsName(f),this.writeNode("Property",{name:this.geometryName,value:f.geometry},e));for(var h in f.attributes){void 0===f.attributes[h]||g&&g.attributes&&(!g.attributes||void 0===g.attributes[h])||this.writeNode("Property",{name:h,value:f.attributes[h]},e)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[f.fid]}),e);return e},Property:function(c){var d=this.createElementNSPlus("wfs:Property");this.writeNode("Name",c.name,d);null!==c.value&&this.writeNode("Value",c.value,d);return d},Name:function(b){return this.createElementNSPlus("wfs:Name",{value:b})},Value:function(c){var d;c instanceof OpenLayers.Geometry?(d=this.createElementNSPlus("wfs:Value"),c=this.writeNode("feature:_geometry",c).firstChild,d.appendChild(c)):d=this.createElementNSPlus("wfs:Value",{value:c});return d},Delete:function(c){var d=c.feature;c=c.options;c=this.createElementNSPlus("wfs:Delete",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&c.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[d.fid]}),c);return c}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var f=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(f[e.featurePrefix]=e.schema);e=[];var g,h;for(h in f){(g=this.namespaces[h])&&e.push(g+" "+f[h])}return e.join(" ")||void 0},setFilterProperty:function(d){if(d.filters){for(var e=0,f=d.filters.length;e<f;++e){OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,d.filters[e])}}else{d instanceof OpenLayers.Filter.Spatial&&!d.property&&(d.property=this.geometryName)}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));var d={exceptionReport:null};c.documentElement&&(this.readChildNodes(c,d),null===d.exceptionReport&&(d=(new OpenLayers.Format.OWSCommon).read(c)));return d},readers:{ogc:{ServiceExceptionReport:function(c,d){d.exceptionReport={exceptions:[]};this.readChildNodes(c,d.exceptionReport)},ServiceException:function(d,e){var f={code:d.getAttribute("code"),locator:d.getAttribute("locator"),text:this.getChildValue(d)};e.exceptions.push(f)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(d,e){var f;d?(f=this.version,f||(f=d.getAttribute("version"),f||(f=this.defaultVersion))):f=e&&e.version||this.version||this.defaultVersion;return f},getParser:function(d){d=d||this.defaultVersion;var e=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=d){var f=OpenLayers.Format[this.name]["v"+d.replace(/\./g,"_")+e];if(!f&&(""!==e&&this.allowFallback&&(e="",f=OpenLayers.Format[this.name]["v"+d.replace(/\./g,"_")]),!f)){throw"Can't find a "+this.name+" parser for version "+d+e}this.parser=new f(this.options)}return this.parser},write:function(d,e){var f=this.getVersion(null,e);this.parser=this.getParser(f);f=this.parser.write(d,e);return !1===this.stringifyOutput?f:OpenLayers.Format.XML.prototype.write.apply(this,[f])},read:function(f,g){"string"==typeof f&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));var h=this.getVersion(f.documentElement);this.parser=this.getParser(h);var i=this.parser.read(f,g),j=this.parser.errorProperty||null;null!==j&&void 0===i[j]&&(j=new OpenLayers.Format.OGCExceptionReport,i.error=j.read(f));i.version=h;return i},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(b){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[b])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(d){var e,f;switch(this.type){case OpenLayers.Filter.Logical.AND:e=0;for(f=this.filters.length;e<f;e++){if(!1==this.filters[e].evaluate(d)){return !1}}return !0;case OpenLayers.Filter.Logical.OR:e=0;for(f=this.filters.length;e<f;e++){if(!0==this.filters[e].evaluate(d)){return !0}}return !1;case OpenLayers.Filter.Logical.NOT:return !this.filters[0].evaluate(d)}},clone:function(){for(var d=[],e=0,f=this.filters.length;e<f;++e){d.push(this.filters[e].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:d})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(b){OpenLayers.Filter.prototype.initialize.apply(this,[b]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===b.matchCase&&(this.matchCase=null)},evaluate:function(c){c instanceof OpenLayers.Feature.Vector&&(c=c.attributes);var d=!1;c=c[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:d=this.value;d=this.matchCase||"string"!=typeof c||"string"!=typeof d?c==d:c.toUpperCase()==d.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:d=this.value;d=this.matchCase||"string"!=typeof c||"string"!=typeof d?c!=d:c.toUpperCase()!=d.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:d=c<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:d=c>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:d=c<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:d=c>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:d=c>=this.lowerBoundary&&c<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:d=RegExp(this.value,"gi").test(c);break;case OpenLayers.Filter.Comparison.IS_NULL:d=null===c}return d},value2regex:function(d,e,f){if("."==d){throw Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison")}d=d?d:"*";e=e?e:".";this.value=this.value.replace(RegExp("\\"+(f?f:"!")+"(.|$)","g"),"\\$1");this.value=this.value.replace(RegExp("\\"+e,"g"),".");this.value=this.value.replace(RegExp("\\"+d,"g"),".*");this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+d);return this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+e)},regex2value:function(){var b=this.value,b=b.replace(/!/g,"!!"),b=b.replace(/(\\)?\\\./g,function(d,e){return e?d:"!."}),b=b.replace(/(\\)?\\\*/g,function(d,e){return e?d:"!*"}),b=b.replace(/\\\\/g,"\\");return b=b.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Comparison.IS_NULL="NULL";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString" in Date.prototype?function(b){return b.toISOString()}:function(b){return isNaN(b.getTime())?"Invalid Date":b.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(b.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(b.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(b.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(b.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(b.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(b.getUTCMilliseconds(),3)+"Z"}}(),parse:function(h){var i;if((h=h.match(this.dateRegEx))&&(h[1]||h[7])){i=parseInt(h[1],10)||0;var j=parseInt(h[2],10)-1||0,k=parseInt(h[3],10)||1;i=new Date(Date.UTC(i,j,k));if(j=h[7]){var k=parseInt(h[4],10),l=parseInt(h[5],10),m=parseFloat(h[6]),n=m|0,m=Math.round(1000*(m-n));i.setUTCHours(k,l,n,m);"Z"!==j&&(j=parseInt(j,10),h=parseInt(h[8],10)||0,h=-1000*(60*60*j+60*h),i=new Date(i.getTime()+h))}}else{i=new Date("invalid")}return i}};OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(c){var d={};this.readers.ogc.Filter.apply(this,[c,d]);return d.filter},readers:{ogc:{_expression:function(d){for(var e="",f=d.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:d=this.readNode(f);d.property?e+="${"+d.property+"}":void 0!==d.value&&(e+=d.value);break;case 3:case 4:e+=f.nodeValue}}return e},Filter:function(d,e){var f={fids:[],filters:[]};this.readChildNodes(d,f);0<f.fids.length?e.filter=new OpenLayers.Filter.FeatureId({fids:f.fids}):0<f.filters.length&&(e.filter=f.filters[0])},FeatureId:function(d,e){var f=d.getAttribute("fid");f&&e.fids.push(f)},And:function(d,e){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(d,f);e.filters.push(f)},Or:function(d,e){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(d,f);e.filters.push(f)},Not:function(d,e){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsLessThan:function(d,e){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsGreaterThan:function(d,e){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsLessThanOrEqualTo:function(d,e){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsGreaterThanOrEqualTo:function(d,e){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsBetween:function(d,e){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(d,f);e.filters.push(f)},Literal:function(c,d){d.value=OpenLayers.String.numericIf(this.getChildValue(c),!0)},PropertyName:function(c,d){d.property=this.getChildValue(c)},LowerBoundary:function(c,d){d.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,c),!0)},UpperBoundary:function(c,d){d.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,c),!0)},Intersects:function(c,d){this.readSpatial(c,d,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(c,d){this.readSpatial(c,d,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(c,d){this.readSpatial(c,d,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(c,d){this.readSpatial(c,d,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(c,d){d.distance=parseInt(this.getChildValue(c));d.distanceUnits=c.getAttribute("units")},Function:function(c,d){},PropertyIsNull:function(d,e){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(d,f);e.filters.push(f)}}},readSpatial:function(d,e,f){f=new OpenLayers.Filter.Spatial({type:f});this.readChildNodes(d,f);f.value=f.components[0];delete f.components;e.filters.push(f)},encodeLiteral:function(b){b instanceof Date&&(b=OpenLayers.Date.toISOString(b));return b},writeOgcExpression:function(c,d){c instanceof OpenLayers.Filter.Function?this.writeNode("Function",c,d):this.writeNode("Literal",c,d);return d},write:function(b){return this.writers.ogc.Filter.apply(this,[b])},writers:{ogc:{Filter:function(c){var d=this.createElementNSPlus("ogc:Filter");this.writeNode(this.getFilterType(c),c,d);return d},_featureIds:function(e){for(var f=this.createDocumentFragment(),g=0,h=e.fids.length;g<h;++g){this.writeNode("ogc:FeatureId",e.fids[g],f)}return f},FeatureId:function(b){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:b}})},And:function(f){for(var g=this.createElementNSPlus("ogc:And"),h,i=0,j=f.filters.length;i<j;++i){h=f.filters[i],this.writeNode(this.getFilterType(h),h,g)}return g},Or:function(f){for(var g=this.createElementNSPlus("ogc:Or"),h,i=0,j=f.filters.length;i<j;++i){h=f.filters[i],this.writeNode(this.getFilterType(h),h,g)}return g},Not:function(c){var d=this.createElementNSPlus("ogc:Not");c=c.filters[0];this.writeNode(this.getFilterType(c),c,d);return d},PropertyIsLessThan:function(c){var d=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",c,d);this.writeOgcExpression(c.value,d);return d},PropertyIsGreaterThan:function(c){var d=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",c,d);this.writeOgcExpression(c.value,d);return d},PropertyIsLessThanOrEqualTo:function(c){var d=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",c,d);this.writeOgcExpression(c.value,d);return d},PropertyIsGreaterThanOrEqualTo:function(c){var d=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",c,d);this.writeOgcExpression(c.value,d);return d},PropertyIsBetween:function(c){var d=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",c,d);this.writeNode("LowerBoundary",c,d);this.writeNode("UpperBoundary",c,d);return d},PropertyName:function(b){return this.createElementNSPlus("ogc:PropertyName",{value:b.property})},Literal:function(b){return this.createElementNSPlus("ogc:Literal",{value:(this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral)(b)})},LowerBoundary:function(c){var d=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(c.lowerBoundary,d);return d},UpperBoundary:function(c){var d=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",c.upperBoundary,d);return d},INTERSECTS:function(b){return this.writeSpatial(b,"Intersects")},WITHIN:function(b){return this.writeSpatial(b,"Within")},CONTAINS:function(b){return this.writeSpatial(b,"Contains")},DWITHIN:function(c){var d=this.writeSpatial(c,"DWithin");this.writeNode("Distance",c,d);return d},Distance:function(b){return this.createElementNSPlus("ogc:Distance",{attributes:{units:b.distanceUnits},value:b.distance})},Function:function(e){var f=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}});e=e.params;for(var g=0,h=e.length;g<h;g++){this.writeOgcExpression(e[g],f)}return f},PropertyIsNull:function(c){var d=this.createElementNSPlus("ogc:PropertyIsNull");this.writeNode("PropertyName",c,d);return d}}},getFilterType:function(c){var d=this.filterMap[c.type];if(!d){throw"Filter writing not supported for rule type: "+c.type}return d},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(b){b&&(this.bounds=b.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(b){this.getBounds()?this.bounds.extend(b):this.setBounds(b)},getBounds:function(){null==this.bounds&&this.calculateBounds();return this.bounds},calculateBounds:function(){},distanceTo:function(c,d){},getVertices:function(b){},atPoint:function(e,f,g){var h=!1;null!=this.getBounds()&&null!=e&&(f=null!=f?f:0,g=null!=g?g:0,h=(new OpenLayers.Bounds(this.bounds.left-f,this.bounds.bottom-g,this.bounds.right+f,this.bounds.top+g)).containsLonLat(e));return h},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(e){var f;if(OpenLayers.Format&&OpenLayers.Format.WKT){var g=OpenLayers.Geometry.fromWKT.format;g||(g=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=g);e=g.read(e);if(e instanceof OpenLayers.Feature.Vector){f=e.geometry}else{if(OpenLayers.Util.isArray(e)){f=e.length;for(var g=Array(f),h=0;h<f;++h){g[h]=e[h].geometry}f=new OpenLayers.Geometry.Collection(g)}}}return f};OpenLayers.Geometry.segmentsIntersect=function(i,j,o){var p=o&&o.point;o=o&&o.tolerance;var q=!1,r=i.x1-j.x1,s=i.y1-j.y1,t=i.x2-i.x1,u=i.y2-i.y1,v=j.y2-j.y1,w=j.x2-j.x1,x=v*t-w*u,v=w*s-v*r,s=t*s-u*r;0==x?0==v&&0==s&&(q=!0):(r=v/x,x=s/x,0<=r&&(1>=r&&0<=x&&1>=x)&&(p?(t=i.x1+r*t,x=i.y1+r*u,q=new OpenLayers.Geometry.Point(t,x)):q=!0));if(o){if(q){if(p){i:for(i=[i,j],j=0;2>j;++j){for(r=i[j],u=1;3>u;++u){if(t=r["x"+u],x=r["y"+u],p=Math.sqrt(Math.pow(t-q.x,2)+Math.pow(x-q.y,2)),p<o){q.x=t;q.y=x;break i}}}}}else{i:for(i=[i,j],j=0;2>j;++j){for(t=i[j],x=i[(j+1)%2],u=1;3>u;++u){if(r={x:t["x"+u],y:t["y"+u]},s=OpenLayers.Geometry.distanceToSegment(r,x),s.distance<o){q=p?new OpenLayers.Geometry.Point(r.x,r.y):!0;break i}}}}}return q};OpenLayers.Geometry.distanceToSegment=function(d,e){var f=OpenLayers.Geometry.distanceSquaredToSegment(d,e);f.distance=Math.sqrt(f.distance);return f};OpenLayers.Geometry.distanceSquaredToSegment=function(i,j){var n=i.x,o=i.y,p=j.x1,q=j.y1,r=j.x2,s=j.y2,t=r-p,u=s-q,v=(t*(n-p)+u*(o-q))/(Math.pow(t,2)+Math.pow(u,2));0>=v||(1<=v?(p=r,q=s):(p+=v*t,q+=v*u));return{distance:Math.pow(p-n,2)+Math.pow(q-o,2),x:p,y:q,along:v}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(c,d){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(c);this.y=parseFloat(d)},clone:function(b){null==b&&(b=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(b,this);return b},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(i,j){var k=!(j&&!1===j.edge)&&j&&j.details,l,m,n,o,p;i instanceof OpenLayers.Geometry.Point?(m=this.x,n=this.y,o=i.x,p=i.y,l=Math.sqrt(Math.pow(m-o,2)+Math.pow(n-p,2)),l=k?{x0:m,y0:n,x1:o,y1:p,distance:l}:l):(l=i.distanceTo(this,j),k&&(l={x0:l.x1,y0:l.y1,x1:l.x0,y1:l.y0,distance:l.distance}));return l},equals:function(c){var d=!1;null!=c&&(d=this.x==c.x&&this.y==c.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(c.x)&&isNaN(c.y));return d},toShortString:function(){return this.x+", "+this.y},move:function(c,d){this.x+=c;this.y+=d;this.clearBounds()},rotate:function(e,f){e*=Math.PI/180;var g=this.distanceTo(f),h=e+Math.atan2(this.y-f.y,this.x-f.x);this.x=f.x+g*Math.cos(h);this.y=f.y+g*Math.sin(h);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(d,e,f){this.x=e.x+d*(void 0==f?1:f)*(this.x-e.x);this.y=e.y+d*(this.y-e.y);this.clearBounds();return this},intersects:function(c){var d=!1;return d="OpenLayers.Geometry.Point"==c.CLASS_NAME?this.equals(c):c.intersects(this)},transform:function(c,d){c&&d&&(OpenLayers.Projection.transform(this,c,d),this.bounds=null);return this},getVertices:function(b){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=b&&this.addComponents(b)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;b<c;b++){a.addComponent(this.components[b].clone())}OpenLayers.Util.applyDefaults(a,this);return a},getComponentsString:function(){for(var d=[],e=0,f=this.components.length;e<f;e++){d.push(this.components[e].toShortString())}return d.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,f=this.components;if(f){for(var g=0,h=f.length;g<h;g++){e.extend(f[g].getBounds())}}null!=e.left&&(null!=e.bottom&&null!=e.right&&null!=e.top)&&this.setBounds(e)},addComponents:function(d){OpenLayers.Util.isArray(d)||(d=[d]);for(var e=0,f=d.length;e<f;e++){this.addComponent(d[e])}},addComponent:function(e,f){var g=!1;if(e&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME))){if(null!=f&&f<this.components.length){var g=this.components.slice(0,f),h=this.components.slice(f,this.components.length);g.push(e);this.components=g.concat(h)}else{this.components.push(e)}e.parent=this;this.clearBounds();g=!0}return g},removeComponents:function(d){var e=!1;OpenLayers.Util.isArray(d)||(d=[d]);for(var f=d.length-1;0<=f;--f){e=this.removeComponent(d[f])||e}return e},removeComponent:function(b){OpenLayers.Util.removeItem(this.components,b);this.clearBounds();return !0},getLength:function(){for(var d=0,e=0,f=this.components.length;e<f;e++){d+=this.components[e].getLength()}return d},getArea:function(){for(var d=0,e=0,f=this.components.length;e<f;e++){d+=this.components[e].getArea()}return d},getGeodesicArea:function(e){for(var f=0,g=0,h=this.components.length;g<h;g++){f+=this.components[g].getGeodesicArea(e)}return f},getCentroid:function(i){if(!i){return this.components.length&&this.components[0].getCentroid()}i=this.components.length;if(!i){return !1}for(var j=[],l=[],m=0,n=Number.MAX_VALUE,o,p=0;p<i;++p){o=this.components[p];var q=o.getArea();o=o.getCentroid(!0);isNaN(q)||(isNaN(o.x)||isNaN(o.y))||(j.push(q),m+=q,n=q<n&&0<q?q:n,l.push(o))}i=j.length;if(0===m){for(p=0;p<i;++p){j[p]=1}m=j.length}else{for(p=0;p<i;++p){j[p]/=n}m/=n}for(var r=n=0,p=0;p<i;++p){o=l[p],q=j[p],n+=o.x*q,r+=o.y*q}return new OpenLayers.Geometry.Point(n/m,r/m)},getGeodesicLength:function(e){for(var f=0,g=0,h=this.components.length;g<h;g++){f+=this.components[g].getGeodesicLength(e)}return f},move:function(e,f){for(var g=0,h=this.components.length;g<h;g++){this.components[g].move(e,f)}},rotate:function(e,f){for(var g=0,h=this.components.length;g<h;++g){this.components[g].rotate(e,f)}},resize:function(e,f,g){for(var h=0;h<this.components.length;++h){this.components[h].resize(e,f,g)}return this},distanceTo:function(i,j){for(var l=!(j&&!1===j.edge)&&j&&j.details,m,n,o,p=Number.POSITIVE_INFINITY,q=0,r=this.components.length;q<r&&!(m=this.components[q].distanceTo(i,j),o=l?m.distance:m,o<p&&(p=o,n=m,0==p));++q){}return n},equals:function(e){var f=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME){if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var g=0,h=this.components.length;g<h;++g){if(!this.components[g].equals(e.components[g])){f=!1;break}}}else{f=!1}}else{f=!1}return f},transform:function(e,f){if(e&&f){for(var g=0,h=this.components.length;g<h;g++){this.components[g].transform(e,f)}this.bounds=null}return this},intersects:function(e){for(var f=!1,g=0,h=this.components.length;g<h&&!(f=e.intersects(this.components[g]));++g){}return f},getVertices:function(e){for(var f=[],g=0,h=this.components.length;g<h;++g){Array.prototype.push.apply(f,this.components[g].getVertices(e))}return f},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(c,d){this.addComponent(c,d)},removePoint:function(b){this.removeComponent(b)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var d=0;if(this.components&&1<this.components.length){for(var e=1,f=this.components.length;e<f;e++){d+=this.components[e-1].distanceTo(this.components[e])}}return d},getGeodesicLength:function(g){var h=this;if(g){var i=new OpenLayers.Projection("EPSG:4326");i.equals(g)||(h=this.clone().transform(g,i))}g=0;if(h.components&&1<h.components.length){for(var j,k=1,l=h.components.length;k<l;k++){i=h.components[k-1],j=h.components[k],g+=OpenLayers.Util.distVincenty({lon:i.x,lat:i.y},{lon:j.x,lat:j.y})}}return 1000*g},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(c){var d=this.components&&2<this.components.length;d&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return d},intersects:function(i){var j=!1,o=i.CLASS_NAME;if("OpenLayers.Geometry.LineString"==o||"OpenLayers.Geometry.LinearRing"==o||"OpenLayers.Geometry.Point"==o){var s=this.getSortedSegments();i="OpenLayers.Geometry.Point"==o?[{x1:i.x,y1:i.y,x2:i.x,y2:i.y}]:i.getSortedSegments();var t,u,v,w,x,y,z,A=0,B=s.length;i:for(;A<B;++A){o=s[A];t=o.x1;u=o.x2;v=o.y1;w=o.y2;var C=0,D=i.length;for(;C<D;++C){x=i[C];if(x.x1>u){break}if(!(x.x2<t||(y=x.y1,z=x.y2,Math.min(y,z)>Math.max(v,w)||Math.max(y,z)<Math.min(v,w)||!OpenLayers.Geometry.segmentsIntersect(o,x)))){j=!0;break i}}}}else{j=i.intersects(this)}return j},getSortedSegments:function(){for(var f=this.components.length-1,g=Array(f),h,i,j=0;j<f;++j){h=this.components[j],i=this.components[j+1],g[j]=h.x<i.x?{x1:h.x,y1:h.y,x2:i.x,y2:i.y}:{x1:i.x,y1:i.y,x2:h.x,y2:h.y}}return g.sort(function(c,d){return c.x1-d.x1})},splitWithSegment:function(i,j){for(var o=!(j&&!1===j.edge),v=j&&j.tolerance,w=[],x=this.getVertices(),y=[],z=[],A=!1,B,C,D,E={point:!0,tolerance:v},F=null,G=0,H=x.length-2;G<=H;++G){if(v=x[G],y.push(v.clone()),B=x[G+1],C={x1:v.x,y1:v.y,x2:B.x,y2:B.y},C=OpenLayers.Geometry.segmentsIntersect(i,C,E),C instanceof OpenLayers.Geometry.Point&&((D=C.x===i.x1&&C.y===i.y1||C.x===i.x2&&C.y===i.y2||C.equals(v)||C.equals(B)?!0:!1)||o)){C.equals(z[z.length-1])||z.push(C.clone()),0===G&&C.equals(v)||C.equals(B)||(A=!0,C.equals(v)||y.push(C),w.push(new OpenLayers.Geometry.LineString(y)),y=[C.clone()])}}A&&(y.push(B.clone()),w.push(new OpenLayers.Geometry.LineString(y)));if(0<z.length){var I=i.x1<i.x2?1:-1,J=i.y1<i.y2?1:-1,F={lines:w,points:z.sort(function(c,d){return I*c.x-I*d.x||J*c.y-J*d.y})}}return F},split:function(i,j){var o=null,x=j&&j.mutual,y,z,A,B;if(i instanceof OpenLayers.Geometry.LineString){var C=this.getVertices(),D,E,F,G,H,I=[];A=[];for(var J=0,K=C.length-2;J<=K;++J){D=C[J];E=C[J+1];F={x1:D.x,y1:D.y,x2:E.x,y2:E.y};B=B||[i];x&&I.push(D.clone());for(var L=0;L<B.length;++L){if(G=B[L].splitWithSegment(F,j)){if(H=G.lines,0<H.length&&(H.unshift(L,1),Array.prototype.splice.apply(B,H),L+=H.length-2),x){for(var M=0,N=G.points.length;M<N;++M){H=G.points[M],H.equals(D)||(I.push(H),A.push(new OpenLayers.Geometry.LineString(I)),I=H.equals(E)?[]:[H.clone()])}}}}}x&&(0<A.length&&0<I.length)&&(I.push(E.clone()),A.push(new OpenLayers.Geometry.LineString(I)))}else{o=i.splitWith(this,j)}B&&1<B.length?z=!0:B=[];A&&1<A.length?y=!0:A=[];if(z||y){o=x?[A,B]:B}return o},splitWith:function(c,d){return c.split(this,d)},getVertices:function(b){return !0===b?[this.components[0],this.components[this.components.length-1]]:!1===b?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(i,j){var o=!(j&&!1===j.edge)&&j&&j.details,u,v={},w=Number.POSITIVE_INFINITY;if(i instanceof OpenLayers.Geometry.Point){for(var x=this.getSortedSegments(),y=i.x,z=i.y,A,B=0,C=x.length;B<C;++B){if(A=x[B],u=OpenLayers.Geometry.distanceToSegment(i,A),u.distance<w){if(w=u.distance,v=u,0===w){break}}else{if(A.x2>y&&(z>A.y1&&z<A.y2||z<A.y1&&z>A.y2)){break}}}v=o?{distance:v.distance,x0:v.x,y0:v.y,x1:y,y1:z}:v.distance}else{if(i instanceof OpenLayers.Geometry.LineString){var x=this.getSortedSegments(),y=i.getSortedSegments(),D,E,F=y.length,G={point:!0},B=0,C=x.length;i:for(;B<C;++B){z=x[B];A=z.x1;E=z.y1;for(var H=0;H<F;++H){if(u=y[H],D=OpenLayers.Geometry.segmentsIntersect(z,u,G)){w=0;v={distance:0,x0:D.x,y0:D.y,x1:D.x,y1:D.y};break i}else{u=OpenLayers.Geometry.distanceToSegment({x:A,y:E},u),u.distance<w&&(w=u.distance,v={distance:w,x0:A,y0:E,x1:u.x,y1:u.y})}}}o||(v=v.distance);0!==w&&z&&(u=i.distanceTo(new OpenLayers.Geometry.Point(z.x2,z.y2),j),B=o?u.distance:u,B<w&&(v=o?{distance:w,x0:u.x1,y0:u.y1,x1:u.x0,y1:u.y0}:B))}else{v=i.distanceTo(this,j),o&&(v={distance:v.distance,x0:v.x1,y0:v.y1,x1:v.x0,y1:v.y0})}}return v},simplify:function(f){if(this&&null!==this){var g=this.getVertices();if(3>g.length){return this}var h=function(c,e,o,s){for(var t=0,u=0,v=e,w;v<o;v++){w=c[e];var x=c[o],y=c[v],y=Math.abs(0.5*(w.x*x.y+x.x*y.y+y.x*w.y-x.x*w.y-y.x*x.y-w.x*y.y));w=Math.sqrt(Math.pow(w.x-x.x,2)+Math.pow(w.y-x.y,2));w=2*(y/w);w>t&&(t=w,u=v)}t>s&&u!=e&&(j.push(u),h(c,e,u,s),h(c,u,o,s))},i=g.length-1,j=[];j.push(0);for(j.push(i);g[0].equals(g[i]);){i--,j.push(i)}h(g,0,i,f);f=[];j.sort(function(c,d){return c-d});for(i=0;i<j.length;i++){f.push(g[j[i]])}return new OpenLayers.Geometry.LineString(f)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(i,j){for(var o=null,s=j&&j.mutual,t,u,v,w,x=[],y=[i],z=0,A=this.components.length;z<A;++z){u=this.components[z];v=!1;for(var B=0;B<y.length;++B){if(t=u.split(y[B],j)){if(s){v=t[0];for(var C=0,D=v.length;C<D;++C){0===C&&x.length?x[x.length-1].addComponent(v[C]):x.push(new OpenLayers.Geometry.MultiLineString([v[C]]))}v=!0;t=t[1]}if(t.length){t.unshift(B,1);Array.prototype.splice.apply(y,t);break}}}v||(x.length?x[x.length-1].addComponent(u.clone()):x=[new OpenLayers.Geometry.MultiLineString(u.clone())])}x&&1<x.length?v=!0:x=[];y&&1<y.length?w=!0:y=[];if(v||w){o=s?[x,y]:y}return o},splitWith:function(i,j){var o=null,r=j&&j.mutual,s,t,u,v,w,x;if(i instanceof OpenLayers.Geometry.LineString){x=[];w=[i];for(var y=0,z=this.components.length;y<z;++y){u=!1;t=this.components[y];for(var A=0;A<w.length;++A){if(s=w[A].split(t,j)){r&&(u=s[0],u.length&&(u.unshift(A,1),Array.prototype.splice.apply(w,u),A+=u.length-2),s=s[1],0===s.length&&(s=[t.clone()]));u=0;for(var B=s.length;u<B;++u){0===u&&x.length?x[x.length-1].addComponent(s[u]):x.push(new OpenLayers.Geometry.MultiLineString([s[u]]))}u=!0}}u||(x.length?x[x.length-1].addComponent(t.clone()):x=[new OpenLayers.Geometry.MultiLineString([t.clone()])])}}else{o=i.split(this)}w&&1<w.length?v=!0:w=[];x&&1<x.length?u=!0:x=[];if(v||u){o=r?[w,x]:x}return o},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,f){var g=!1,h=this.components.pop();null==f&&e.equals(h)||(g=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]);return g},removeComponent:function(c){var d=this.components&&3<this.components.length;d&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]));return d},move:function(e,f){for(var g=0,h=this.components.length;g<h-1;g++){this.components[g].move(e,f)}},rotate:function(e,f){for(var g=0,h=this.components.length;g<h-1;++g){this.components[g].rotate(e,f)}},resize:function(f,g,h){for(var i=0,j=this.components.length;i<j-1;++i){this.components[i].resize(f,g,h)}return this},transform:function(e,f){if(e&&f){for(var g=0,h=this.components.length;g<h-1;g++){this.components[g].transform(e,f)}this.bounds=null}return this},getCentroid:function(){if(this.components){var i=this.components.length;if(0<i&&2>=i){return this.components[0].clone()}if(2<i){var j=0,l=0,m=this.components[0].x,n=this.components[0].y,o=-1*this.getArea();if(0!=o){for(var p=0;p<i-1;p++){var q=this.components[p],r=this.components[p+1],j=j+(q.x+r.x-2*m)*((q.x-m)*(r.y-n)-(r.x-m)*(q.y-n)),l=l+(q.y+r.y-2*n)*((q.x-m)*(r.y-n)-(r.x-m)*(q.y-n))}j=m+j/(6*o);i=n+l/(6*o)}else{for(p=0;p<i-1;p++){j+=this.components[p].x,l+=this.components[p].y}j/=i-1;i=l/(i-1)}return new OpenLayers.Geometry.Point(j,i)}return null}},getArea:function(){var f=0;if(this.components&&2<this.components.length){for(var g=f=0,h=this.components.length;g<h-1;g++){var i=this.components[g],j=this.components[g+1],f=f+(i.x+j.x)*(j.y-i.y)}f=-f/2}return f},getGeodesicArea:function(g){var h=this;if(g){var i=new OpenLayers.Projection("EPSG:4326");i.equals(g)||(h=this.clone().transform(g,i))}g=0;i=h.components&&h.components.length;if(2<i){for(var j,k,l=0;l<i-1;l++){j=h.components[l],k=h.components[l+1],g+=OpenLayers.Util.rad(k.x-j.x)*(2+Math.sin(OpenLayers.Util.rad(j.y))+Math.sin(OpenLayers.Util.rad(k.y)))}g=40680631590769*g/2}return g},containsPoint:function(i){var j=OpenLayers.Number.limitSigDigs,n=j(i.x,14);i=j(i.y,14);for(var o=this.components.length-1,p,q,r,s,t,u=0,v=0;v<o;++v){if(p=this.components[v],r=j(p.x,14),p=j(p.y,14),q=this.components[v+1],s=j(q.x,14),q=j(q.y,14),p==q){if(i==p&&(r<=s&&n>=r&&n<=s||r>=s&&n<=r&&n>=s)){u=-1;break}}else{t=j((i-q)*((s-r)/(q-p))+s,14);if(t==n&&(p<q&&i>=p&&i<=q||p>q&&i<=p&&i>=q)){u=-1;break}t<=n||r!=s&&(t<Math.min(r,s)||t>Math.max(r,s))||(p<q&&i>=p&&i<q||p>q&&i<p&&i>=q)&&++u}}return -1==u?1:!!(u&1)},intersects:function(e){var f=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME){f=this.containsPoint(e)}else{if("OpenLayers.Geometry.LineString"==e.CLASS_NAME){f=e.intersects(this)}else{if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){f=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e])}else{for(var g=0,h=e.components.length;g<h&&!(f=e.components[g].intersects(this));++g){}}}}return f},getVertices:function(b){return !0===b?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var d=0;if(this.components&&0<this.components.length){for(var d=d+Math.abs(this.components[0].getArea()),e=1,f=this.components.length;e<f;e++){d-=Math.abs(this.components[e].getArea())}}return d},getGeodesicArea:function(e){var f=0;if(this.components&&0<this.components.length){for(var f=f+Math.abs(this.components[0].getGeodesicArea(e)),g=1,h=this.components.length;g<h;g++){f-=Math.abs(this.components[g].getGeodesicArea(e))}}return f},containsPoint:function(f){var g=this.components.length,h=!1;if(0<g&&(h=this.components[0].containsPoint(f),1!==h&&h&&1<g)){for(var i,j=1;j<g;++j){if(i=this.components[j].containsPoint(f)){h=1===i?1:!1;break}}}return h},intersects:function(f){var g=!1,h,i;if("OpenLayers.Geometry.Point"==f.CLASS_NAME){g=this.containsPoint(f)}else{if("OpenLayers.Geometry.LineString"==f.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==f.CLASS_NAME){h=0;for(i=this.components.length;h<i&&!(g=f.intersects(this.components[h]));++h){}if(!g){for(h=0,i=f.components.length;h<i&&!(g=this.containsPoint(f.components[h]));++h){}}}else{for(h=0,i=f.components.length;h<i&&!(g=this.intersects(f.components[h]));++h){}}}if(!g&&"OpenLayers.Geometry.Polygon"==f.CLASS_NAME){var j=this.components[0];h=0;for(i=j.components.length;h<i&&!(g=f.containsPoint(j.components[h]));++h){}}return g},distanceTo:function(c,d){return d&&!1===d.edge&&this.intersects(c)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[c,d])},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(i,j,k,l){var m=Math.PI*(1/k-0.5);l&&(m+=l/180*Math.PI);for(var n,o=[],p=0;p<k;++p){n=m+2*p*Math.PI/k,l=i.x+j*Math.cos(n),n=i.y+j*Math.sin(n),o.push(new OpenLayers.Geometry.Point(l,n))}i=new OpenLayers.Geometry.LinearRing(o);return new OpenLayers.Geometry.Polygon([i])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(b){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName);for(var f=[],g=0;g<e.length;g++){var h=this.parseFeature(e[g]);h&&f.push(h)}return f},parseFeature:function(i){for(var j="MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope".split(" "),l,m,n,o=0;o<j.length;++o){if(l=j[o],m=this.getElementsByTagNameNS(i,this.gmlns,l),0<m.length){if(n=this.parseGeometry[l.toLowerCase()]){n=n.apply(this,[m[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection)}else{throw new TypeError("Unsupported geometry type: "+l)}break}}var p;l=this.getElementsByTagNameNS(i,this.gmlns,"Box");for(o=0;o<l.length;++o){j=l[o],m=this.parseGeometry.box.apply(this,[j]),j=j.parentNode,"boundedBy"===(j.localName||j.nodeName.split(":").pop())?p=m:n=m.toGeometry()}var q;this.extractAttributes&&(q=this.parseAttributes(i));q=new OpenLayers.Feature.Vector(n,q);q.bounds=p;q.gml={featureType:i.firstChild.nodeName.split(":")[1],featureNS:i.firstChild.namespaceURI,featureNSPrefix:i.firstChild.prefix};i=i.firstChild;for(var r;i&&(1!=i.nodeType||!(r=i.getAttribute("fid")||i.getAttribute("id")));){i=i.nextSibling}q.fid=r;return q},parseGeometry:{point:function(d){var e,f;f=[];e=this.getElementsByTagNameNS(d,this.gmlns,"pos");0<e.length&&(f=e[0].firstChild.nodeValue,f=f.replace(this.regExes.trimSpace,""),f=f.split(this.regExes.splitSpace));0==f.length&&(e=this.getElementsByTagNameNS(d,this.gmlns,"coordinates"),0<e.length&&(f=e[0].firstChild.nodeValue,f=f.replace(this.regExes.removeSpace,""),f=f.split(",")));0==f.length&&(e=this.getElementsByTagNameNS(d,this.gmlns,"coord"),0<e.length&&(d=this.getElementsByTagNameNS(e[0],this.gmlns,"X"),e=this.getElementsByTagNameNS(e[0],this.gmlns,"Y"),0<d.length&&0<e.length&&(f=[d[0].firstChild.nodeValue,e[0].firstChild.nodeValue])));2==f.length&&(f[2]=null);return this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2])},multipoint:function(e){e=this.getElementsByTagNameNS(e,this.gmlns,"Point");var f=[];if(0<e.length){for(var g,h=0;h<e.length;++h){(g=this.parseGeometry.point.apply(this,[e[h]]))&&f.push(g)}}return new OpenLayers.Geometry.MultiPoint(f)},linestring:function(i,j){var l,m;m=[];var n=[];l=this.getElementsByTagNameNS(i,this.gmlns,"posList");if(0<l.length){m=this.getChildValue(l[0]);m=m.replace(this.regExes.trimSpace,"");m=m.split(this.regExes.splitSpace);var o=parseInt(l[0].getAttribute("dimension")),p,q,r;for(l=0;l<m.length/o;++l){p=l*o,q=m[p],r=m[p+1],p=2==o?null:m[p+2],this.xy?n.push(new OpenLayers.Geometry.Point(q,r,p)):n.push(new OpenLayers.Geometry.Point(r,q,p))}}if(0==m.length&&(l=this.getElementsByTagNameNS(i,this.gmlns,"coordinates"),0<l.length)){for(m=this.getChildValue(l[0]),m=m.replace(this.regExes.trimSpace,""),m=m.replace(this.regExes.trimComma,","),o=m.split(this.regExes.splitSpace),l=0;l<o.length;++l){m=o[l].split(","),2==m.length&&(m[2]=null),this.xy?n.push(new OpenLayers.Geometry.Point(m[0],m[1],m[2])):n.push(new OpenLayers.Geometry.Point(m[1],m[0],m[2]))}}m=null;0!=n.length&&(m=j?new OpenLayers.Geometry.LinearRing(n):new OpenLayers.Geometry.LineString(n));return m},multilinestring:function(e){e=this.getElementsByTagNameNS(e,this.gmlns,"LineString");var f=[];if(0<e.length){for(var g,h=0;h<e.length;++h){(g=this.parseGeometry.linestring.apply(this,[e[h]]))&&f.push(g)}}return new OpenLayers.Geometry.MultiLineString(f)},polygon:function(e){e=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing");var f=[];if(0<e.length){for(var g,h=0;h<e.length;++h){(g=this.parseGeometry.linestring.apply(this,[e[h],!0]))&&f.push(g)}}return new OpenLayers.Geometry.Polygon(f)},multipolygon:function(e){e=this.getElementsByTagNameNS(e,this.gmlns,"Polygon");var f=[];if(0<e.length){for(var g,h=0;h<e.length;++h){(g=this.parseGeometry.polygon.apply(this,[e[h]]))&&f.push(g)}}return new OpenLayers.Geometry.MultiPolygon(f)},envelope:function(h){var i=[],j,k,l=this.getElementsByTagNameNS(h,this.gmlns,"lowerCorner");if(0<l.length){j=[];0<l.length&&(j=l[0].firstChild.nodeValue,j=j.replace(this.regExes.trimSpace,""),j=j.split(this.regExes.splitSpace));2==j.length&&(j[2]=null);var m=this.xy?new OpenLayers.Geometry.Point(j[0],j[1],j[2]):new OpenLayers.Geometry.Point(j[1],j[0],j[2])}h=this.getElementsByTagNameNS(h,this.gmlns,"upperCorner");if(0<h.length){j=[];0<h.length&&(j=h[0].firstChild.nodeValue,j=j.replace(this.regExes.trimSpace,""),j=j.split(this.regExes.splitSpace));2==j.length&&(j[2]=null);var n=this.xy?new OpenLayers.Geometry.Point(j[0],j[1],j[2]):new OpenLayers.Geometry.Point(j[1],j[0],j[2])}m&&n&&(i.push(new OpenLayers.Geometry.Point(m.x,m.y)),i.push(new OpenLayers.Geometry.Point(n.x,m.y)),i.push(new OpenLayers.Geometry.Point(n.x,n.y)),i.push(new OpenLayers.Geometry.Point(m.x,n.y)),i.push(new OpenLayers.Geometry.Point(m.x,m.y)),i=new OpenLayers.Geometry.LinearRing(i),k=new OpenLayers.Geometry.Polygon([i]));return k},box:function(d){var e=this.getElementsByTagNameNS(d,this.gmlns,"coordinates"),f=d=null;0<e.length&&(e=e[0].firstChild.nodeValue,e=e.split(" "),2==e.length&&(d=e[0].split(","),f=e[1].split(",")));if(null!==d&&null!==f){return new OpenLayers.Bounds(parseFloat(d[0]),parseFloat(d[1]),parseFloat(f[0]),parseFloat(f[1]))}}},parseAttributes:function(f){var g={};f=f.firstChild;for(var h,i,j;f;){if(1==f.nodeType){f=f.childNodes;for(h=0;h<f.length;++h){if(i=f[h],1==i.nodeType){if(j=i.childNodes,1==j.length){if(j=j[0],3==j.nodeType||4==j.nodeType){i=i.prefix?i.nodeName.split(":")[1]:i.nodeName,j=j.nodeValue.replace(this.regExes.trimSpace,""),g[i]=j}}else{g[i.nodeName.split(":").pop()]=null}}}break}f=f.nextSibling}return g},write:function(d){OpenLayers.Util.isArray(d)||(d=[d]);for(var e=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),f=0;f<d.length;f++){e.appendChild(this.createFeatureXML(d[f]))}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},createFeatureXML:function(g){var h=this.buildGeometryNode(g.geometry),i=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);i.appendChild(h);var h=this.createElementNS(this.gmlns,"gml:"+this.featureName),j=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);j.setAttribute("fid",g.fid||g.id);j.appendChild(i);for(var k in g.attributes){var i=this.createTextNode(g.attributes[k]),l=k.substring(k.lastIndexOf(":")+1),l=this.createElementNS(this.featureNS,this.featurePrefix+":"+l);l.appendChild(i);j.appendChild(l)}h.appendChild(j);return h},buildGeometryNode:function(c){this.externalProjection&&this.internalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d=c.CLASS_NAME,d=d.substring(d.lastIndexOf(".")+1);return this.buildGeometry[d.toLowerCase()].apply(this,[c])},buildGeometry:{point:function(c){var d=this.createElementNS(this.gmlns,"gml:Point");d.appendChild(this.buildCoordinatesNode(c));return d},multipoint:function(f){var g=this.createElementNS(this.gmlns,"gml:MultiPoint");f=f.components;for(var h,i,j=0;j<f.length;j++){h=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[f[j]]),h.appendChild(i),g.appendChild(h)}return g},linestring:function(c){var d=this.createElementNS(this.gmlns,"gml:LineString");d.appendChild(this.buildCoordinatesNode(c));return d},multilinestring:function(f){var g=this.createElementNS(this.gmlns,"gml:MultiLineString");f=f.components;for(var h,i,j=0;j<f.length;++j){h=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[f[j]]),h.appendChild(i),g.appendChild(h)}return g},linearring:function(c){var d=this.createElementNS(this.gmlns,"gml:LinearRing");d.appendChild(this.buildCoordinatesNode(c));return d},polygon:function(f){var g=this.createElementNS(this.gmlns,"gml:Polygon");f=f.components;for(var h,i,j=0;j<f.length;++j){h=0==j?"outerBoundaryIs":"innerBoundaryIs",h=this.createElementNS(this.gmlns,"gml:"+h),i=this.buildGeometry.linearring.apply(this,[f[j]]),h.appendChild(i),g.appendChild(h)}return g},multipolygon:function(f){var g=this.createElementNS(this.gmlns,"gml:MultiPolygon");f=f.components;for(var h,i,j=0;j<f.length;++j){h=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[f[j]]),h.appendChild(i),g.appendChild(h)}return g},bounds:function(c){var d=this.createElementNS(this.gmlns,"gml:Box");d.appendChild(this.buildCoordinatesNode(c));return d}},buildCoordinatesNode:function(e){var f=this.createElementNS(this.gmlns,"gml:coordinates");f.setAttribute("decimal",".");f.setAttribute("cs",",");f.setAttribute("ts"," ");var g=[];if(e instanceof OpenLayers.Bounds){g.push(e.left+","+e.bottom),g.push(e.right+","+e.top)}else{e=e.components?e.components:[e];for(var h=0;h<e.length;h++){g.push(e[h].x+","+e[h].y)}}g=this.createTextNode(g.join(" "));f.appendChild(g);return f},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.setGeometryTypes();b&&b.featureNS&&this.setNamespace("feature",b.featureNS);this.singleFeatureType=!b||"string"===typeof b.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var f=[];this.readNode(e,{features:f},!0);if(0==f.length){var g=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(g.length){e=0;for(var h=g.length;e<h;++e){this.readNode(g[e],{features:f},!0)}}else{g=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers"),g.length&&this.readNode(g[0],{features:f},!0)}}return f},readNode:function(d,e,f){!0===f&&!0===this.autoConfig&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null);this.featureNS||(d.prefix in this.namespaces||d.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(d.parentNode.nodeName))||(this.featureType=d.nodeName.split(":").pop(),this.setNamespace("feature",d.namespaceURI),this.featureNS=d.namespaceURI,this.autoConfig=!0);return OpenLayers.Format.XML.prototype.readNode.apply(this,[d,e])},readers:{gml:{_inherit:function(d,e,f){},featureMember:function(c,d){this.readChildNodes(c,d)},featureMembers:function(c,d){this.readChildNodes(c,d)},name:function(c,d){d.name=this.getChildValue(c)},boundedBy:function(d,e){var f={};this.readChildNodes(d,f);f.components&&0<f.components.length&&(e.bounds=f.components[0])},Point:function(d,e){var f={points:[]};this.readChildNodes(d,f);e.components||(e.components=[]);e.components.push(f.points[0])},coordinates:function(h,i){for(var j=this.getChildValue(h).replace(this.regExes.trimSpace,""),j=j.replace(this.regExes.trimComma,","),j=j.split(this.regExes.splitSpace),k,l=j.length,m=Array(l),n=0;n<l;++n){k=j[n].split(","),m[n]=this.xy?new OpenLayers.Geometry.Point(k[0],k[1],k[2]):new OpenLayers.Geometry.Point(k[1],k[0],k[2])}i.points=m},coord:function(d,e){var f={};this.readChildNodes(d,f);e.points||(e.points=[]);e.points.push(new OpenLayers.Geometry.Point(f.x,f.y,f.z))},X:function(c,d){d.x=this.getChildValue(c)},Y:function(c,d){d.y=this.getChildValue(c)},Z:function(c,d){d.z=this.getChildValue(c)},MultiPoint:function(d,e){var f={components:[]};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);e.components=[new OpenLayers.Geometry.MultiPoint(f.components)]},pointMember:function(c,d){this.readChildNodes(c,d)},LineString:function(d,e){var f={};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);e.components||(e.components=[]);e.components.push(new OpenLayers.Geometry.LineString(f.points))},MultiLineString:function(d,e){var f={components:[]};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);e.components=[new OpenLayers.Geometry.MultiLineString(f.components)]},lineStringMember:function(c,d){this.readChildNodes(c,d)},Polygon:function(d,e){var f={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);f.inner.unshift(f.outer);e.components||(e.components=[]);e.components.push(new OpenLayers.Geometry.Polygon(f.inner))},LinearRing:function(d,e){var f={};this.readers.gml._inherit.apply(this,[d,f]);this.readChildNodes(d,f);e.components=[new OpenLayers.Geometry.LinearRing(f.points)]},MultiPolygon:function(d,e){var f={components:[]};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);e.components=[new OpenLayers.Geometry.MultiPolygon(f.components)]},polygonMember:function(c,d){this.readChildNodes(c,d)},GeometryCollection:function(d,e){var f={components:[]};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);e.components=[new OpenLayers.Geometry.Collection(f.components)]},geometryMember:function(c,d){this.readChildNodes(c,d)}},feature:{"*":function(e,f){var g,h=e.localName||e.nodeName.split(":").pop();f.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,h)?h===this.featureType&&(g="_typeName"):g="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(g="_attribute"):g="_geometry";g&&this.readers.feature[g].apply(this,[e,f])},_typeName:function(f,g){var h={components:[],attributes:{}};this.readChildNodes(f,h);h.name&&(h.attributes.name=h.name);var i=new OpenLayers.Feature.Vector(h.components[0],h.attributes);this.singleFeatureType||(i.type=f.nodeName.split(":").pop(),i.namespace=f.namespaceURI);var j=f.getAttribute("fid")||this.getAttributeNS(f,this.namespaces.gml,"id");j&&(i.fid=j);this.internalProjection&&(this.externalProjection&&i.geometry)&&i.geometry.transform(this.externalProjection,this.internalProjection);h.bounds&&(i.bounds=h.bounds);g.features.push(i)},_geometry:function(c,d){this.geometryName||(this.geometryName=c.nodeName.split(":").pop());this.readChildNodes(c,d)},_attribute:function(e,f){var g=e.localName||e.nodeName.split(":").pop(),h=this.getChildValue(e);f.attributes[g]=h}},wfs:{FeatureCollection:function(c,d){this.readChildNodes(c,d)}}},write:function(c){var d;d=OpenLayers.Util.isArray(c)?"featureMembers":"featureMember";c=this.writeNode("gml:"+d,c);this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:{featureMember:function(c){var d=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",c,d);return d},MultiPoint:function(e){var f=this.createElementNSPlus("gml:MultiPoint");e=e.components||[e];for(var g=0,h=e.length;g<h;++g){this.writeNode("pointMember",e[g],f)}return f},pointMember:function(c){var d=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",c,d);return d},MultiLineString:function(e){var f=this.createElementNSPlus("gml:MultiLineString");e=e.components||[e];for(var g=0,h=e.length;g<h;++g){this.writeNode("lineStringMember",e[g],f)}return f},lineStringMember:function(c){var d=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",c,d);return d},MultiPolygon:function(e){var f=this.createElementNSPlus("gml:MultiPolygon");e=e.components||[e];for(var g=0,h=e.length;g<h;++g){this.writeNode("polygonMember",e[g],f)}return f},polygonMember:function(c){var d=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",c,d);return d},GeometryCollection:function(e){for(var f=this.createElementNSPlus("gml:GeometryCollection"),g=0,h=e.components.length;g<h;++g){this.writeNode("geometryMember",e.components[g],f)}return f},geometryMember:function(c){var d=this.createElementNSPlus("gml:geometryMember");c=this.writeNode("feature:_geometry",c);d.appendChild(c.firstChild);return d}},feature:{_typeName:function(e){var f=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,f);for(var g in e.attributes){var h=e.attributes[g];null!=h&&this.writeNode("feature:_attribute",{name:g,value:h},f)}return f},_geometry:function(c){this.externalProjection&&this.internalProjection&&(c=c.clone().transform(this.internalProjection,this.externalProjection));var d=this.createElementNSPlus("feature:"+this.geometryName);c=this.writeNode("gml:"+this.geometryTypes[c.CLASS_NAME],c,d);this.srsName&&c.setAttribute("srsName",this.srsName);return d},_attribute:function(b){return this.createElementNSPlus("feature:"+b.name,{value:b.value})}},wfs:{FeatureCollection:function(e){for(var f=this.createElementNSPlus("wfs:FeatureCollection"),g=0,h=e.length;g<h;++g){this.writeNode("gml:featureMember",e[g],f)}return f}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(d,e,f){if(d=parseInt(d.getAttribute("srsDimension"),10)||f&&f.srsDimension){e.srsDimension=d}},featureMembers:function(c,d){this.readChildNodes(c,d)},Curve:function(d,e){var f={points:[]};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);e.components||(e.components=[]);e.components.push(new OpenLayers.Geometry.LineString(f.points))},segments:function(c,d){this.readChildNodes(c,d)},LineStringSegment:function(d,e){var f={};this.readChildNodes(d,f);f.points&&Array.prototype.push.apply(e.points,f.points)},pos:function(d,e){var f=this.getChildValue(d).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),f=this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2]);e.points=[f]},posList:function(i,j){for(var m=this.getChildValue(i).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),n=j.srsDimension||parseInt(i.getAttribute("srsDimension")||i.getAttribute("dimension"),10)||2,o,p,q,r=Array(m.length/n),s=0,t=m.length;s<t;s+=n){o=m[s],p=m[s+1],q=2==n?void 0:m[s+2],r[s/n]=this.xy?new OpenLayers.Geometry.Point(o,p,q):new OpenLayers.Geometry.Point(p,o,q)}j.points=r},Surface:function(c,d){this.readChildNodes(c,d)},patches:function(c,d){this.readChildNodes(c,d)},PolygonPatch:function(c,d){this.readers.gml.Polygon.apply(this,[c,d])},exterior:function(d,e){var f={};this.readChildNodes(d,f);e.outer=f.components[0]},interior:function(d,e){var f={};this.readChildNodes(d,f);e.inner.push(f.components[0])},MultiCurve:function(d,e){var f={components:[]};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);0<f.components.length&&(e.components=[new OpenLayers.Geometry.MultiLineString(f.components)])},curveMember:function(c,d){this.readChildNodes(c,d)},MultiSurface:function(d,e){var f={components:[]};this.readers.gml._inherit.apply(this,[d,f,e]);this.readChildNodes(d,f);0<f.components.length&&(e.components=[new OpenLayers.Geometry.MultiPolygon(f.components)])},surfaceMember:function(c,d){this.readChildNodes(c,d)},surfaceMembers:function(c,d){this.readChildNodes(c,d)},pointMembers:function(c,d){this.readChildNodes(c,d)},lineStringMembers:function(c,d){this.readChildNodes(c,d)},polygonMembers:function(c,d){this.readChildNodes(c,d)},geometryMembers:function(c,d){this.readChildNodes(c,d)},Envelope:function(e,f){var g={points:Array(2)};this.readChildNodes(e,g);f.components||(f.components=[]);var h=g.points[0],g=g.points[1];f.components.push(new OpenLayers.Bounds(h.x,h.y,g.x,g.y))},lowerCorner:function(d,e){var f={};this.readers.gml.pos.apply(this,[d,f]);e.points[0]=f.points[0]},upperCorner:function(d,e){var f={};this.readers.gml.pos.apply(this,[d,f]);e.points[1]=f.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(c){var d;d=OpenLayers.Util.isArray(c)?"featureMembers":"featureMember";c=this.writeNode("gml:"+d,c);this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var f=this.createElementNSPlus("gml:featureMembers"),g=0,h=e.length;g<h;++g){this.writeNode("feature:_typeName",e[g],f)}return f},Point:function(c){var d=this.createElementNSPlus("gml:Point");this.writeNode("pos",c,d);return d},pos:function(b){return this.createElementNSPlus("gml:pos",{value:this.xy?b.x+" "+b.y:b.y+" "+b.x})},LineString:function(c){var d=this.createElementNSPlus("gml:LineString");this.writeNode("posList",c.components,d);return d},Curve:function(c){var d=this.createElementNSPlus("gml:Curve");this.writeNode("segments",c,d);return d},segments:function(c){var d=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",c,d);return d},LineStringSegment:function(c){var d=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",c.components,d);return d},posList:function(f){for(var g=f.length,h=Array(g),i,j=0;j<g;++j){i=f[j],h[j]=this.xy?i.x+" "+i.y:i.y+" "+i.x}return this.createElementNSPlus("gml:posList",{value:h.join(" ")})},Surface:function(c){var d=this.createElementNSPlus("gml:Surface");this.writeNode("patches",c,d);return d},patches:function(c){var d=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",c,d);return d},PolygonPatch:function(e){var f=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],f);for(var g=1,h=e.components.length;g<h;++g){this.writeNode("interior",e.components[g],f)}return f},Polygon:function(e){var f=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],f);for(var g=1,h=e.components.length;g<h;++g){this.writeNode("interior",e.components[g],f)}return f},exterior:function(c){var d=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",c,d);return d},interior:function(c){var d=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",c,d);return d},LinearRing:function(c){var d=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",c.components,d);return d},MultiCurve:function(e){var f=this.createElementNSPlus("gml:MultiCurve");e=e.components||[e];for(var g=0,h=e.length;g<h;++g){this.writeNode("curveMember",e[g],f)}return f},curveMember:function(c){var d=this.createElementNSPlus("gml:curveMember");this.curve?this.writeNode("Curve",c,d):this.writeNode("LineString",c,d);return d},MultiSurface:function(e){var f=this.createElementNSPlus("gml:MultiSurface");e=e.components||[e];for(var g=0,h=e.length;g<h;++g){this.writeNode("surfaceMember",e[g],f)}return f},surfaceMember:function(c){var d=this.createElementNSPlus("gml:surfaceMember");this.surface?this.writeNode("Surface",c,d):this.writeNode("Polygon",c,d);return d},Envelope:function(c){var d=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",c,d);this.writeNode("upperCorner",c,d);this.srsName&&d.setAttribute("srsName",this.srsName);return d},lowerCorner:function(b){return this.createElementNSPlus("gml:lowerCorner",{value:this.xy?b.left+" "+b.bottom:b.bottom+" "+b.left})},upperCorner:function(b){return this.createElementNSPlus("gml:upperCorner",{value:this.xy?b.right+" "+b.top:b.top+" "+b.right})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.curve?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[b])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(d,e){var f=d.getAttribute("matchCase"),f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===f||"0"===f)});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsNotEqualTo:function(d,e){var f=d.getAttribute("matchCase"),f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===f||"0"===f)});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsLike:function(g,h){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(g,i);var j=g.getAttribute("wildCard"),k=g.getAttribute("singleChar"),l=g.getAttribute("escapeChar");i.value2regex(j,k,l);h.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(c){var d=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:c.matchCase}});this.writeNode("PropertyName",c,d);this.writeOgcExpression(c.value,d);return d},PropertyIsNotEqualTo:function(c){var d=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:c.matchCase}});this.writeNode("PropertyName",c,d);this.writeOgcExpression(c.value,d);return d},PropertyIsLike:function(c){var d=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:c.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",c,d);this.writeNode("Literal",c.regex2value(),d);return d},BBOX:function(d){var e=this.createElementNSPlus("ogc:BBOX");d.property&&this.writeNode("PropertyName",d,e);var f=this.writeNode("gml:Envelope",d.value);d.projection&&f.setAttribute("srsName",d.projection);e.appendChild(f);return e},SortBy:function(e){for(var f=this.createElementNSPlus("ogc:SortBy"),g=0,h=e.length;g<h;g++){this.writeNode("ogc:SortProperty",e[g],f)}return f},SortProperty:function(c){var d=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",c,d);this.writeNode("ogc:SortOrder","DESC"==c.order?"DESC":"ASC",d);return d},SortOrder:function(b){return this.createElementNSPlus("ogc:SortOrder",{value:b})}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,f){var g=this.createElementNSPlus("ogc:"+f);this.writeNode("PropertyName",e,g);if(e.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",e.value,g)}else{var h;h=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value);e.projection&&h.setAttribute("srsName",e.projection);g.appendChild(h)}return g},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e,f){var g=this.version;if(!g){var h=e.getAttribute("xmlns:ows");h&&"1.1"===h.substring(h.lastIndexOf("/")+1)&&(g="1.1.0");g||(g=this.defaultVersion)}return g},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(d,e){OpenLayers.Util.applyDefaults(e,this.options);var f={};this.readChildNodes(d,f);return f},readers:{ows:{Exception:function(d,e){var f={code:d.getAttribute("exceptionCode"),locator:d.getAttribute("locator"),texts:[]};e.exceptions.push(f);this.readChildNodes(d,f)},ExceptionText:function(d,e){var f=this.getChildValue(d);e.texts.push(f)},ServiceIdentification:function(c,d){d.serviceIdentification={};this.readChildNodes(c,d.serviceIdentification)},Title:function(c,d){d.title=this.getChildValue(c)},Abstract:function(c,d){d["abstract"]=this.getChildValue(c)},Keywords:function(c,d){d.keywords={};this.readChildNodes(c,d.keywords)},Keyword:function(c,d){d[this.getChildValue(c)]=!0},ServiceType:function(c,d){d.serviceType={codeSpace:c.getAttribute("codeSpace"),value:this.getChildValue(c)}},ServiceTypeVersion:function(c,d){d.serviceTypeVersion=this.getChildValue(c)},Fees:function(c,d){d.fees=this.getChildValue(c)},AccessConstraints:function(c,d){d.accessConstraints=this.getChildValue(c)},ServiceProvider:function(c,d){d.serviceProvider={};this.readChildNodes(c,d.serviceProvider)},ProviderName:function(c,d){d.providerName=this.getChildValue(c)},ProviderSite:function(c,d){d.providerSite=this.getAttributeNS(c,this.namespaces.xlink,"href")},ServiceContact:function(c,d){d.serviceContact={};this.readChildNodes(c,d.serviceContact)},IndividualName:function(c,d){d.individualName=this.getChildValue(c)},PositionName:function(c,d){d.positionName=this.getChildValue(c)},ContactInfo:function(c,d){d.contactInfo={};this.readChildNodes(c,d.contactInfo)},Phone:function(c,d){d.phone={};this.readChildNodes(c,d.phone)},Voice:function(c,d){d.voice=this.getChildValue(c)},Address:function(c,d){d.address={};this.readChildNodes(c,d.address)},DeliveryPoint:function(c,d){d.deliveryPoint=this.getChildValue(c)},City:function(c,d){d.city=this.getChildValue(c)},AdministrativeArea:function(c,d){d.administrativeArea=this.getChildValue(c)},PostalCode:function(c,d){d.postalCode=this.getChildValue(c)},Country:function(c,d){d.country=this.getChildValue(c)},ElectronicMailAddress:function(c,d){d.electronicMailAddress=this.getChildValue(c)},Role:function(c,d){d.role=this.getChildValue(c)},OperationsMetadata:function(c,d){d.operationsMetadata={};this.readChildNodes(c,d.operationsMetadata)},Operation:function(d,e){var f=d.getAttribute("name");e[f]={};this.readChildNodes(d,e[f])},DCP:function(c,d){d.dcp={};this.readChildNodes(c,d.dcp)},HTTP:function(c,d){d.http={};this.readChildNodes(c,d.http)},Get:function(d,e){e.get||(e.get=[]);var f={url:this.getAttributeNS(d,this.namespaces.xlink,"href")};this.readChildNodes(d,f);e.get.push(f)},Post:function(d,e){e.post||(e.post=[]);var f={url:this.getAttributeNS(d,this.namespaces.xlink,"href")};this.readChildNodes(d,f);e.post.push(f)},Parameter:function(d,e){e.parameters||(e.parameters={});var f=d.getAttribute("name");e.parameters[f]={};this.readChildNodes(d,e.parameters[f])},Constraint:function(d,e){e.constraints||(e.constraints={});var f=d.getAttribute("name");e.constraints[f]={};this.readChildNodes(d,e.constraints[f])},Value:function(c,d){d[this.getChildValue(c)]=!0},OutputFormat:function(c,d){d.formats.push({value:this.getChildValue(c)});this.readChildNodes(c,d)},WGS84BoundingBox:function(d,e){var f={};f.crs=d.getAttribute("crs");e.BoundingBox?e.BoundingBox.push(f):(e.projection=f.crs,f=e);this.readChildNodes(d,f)},BoundingBox:function(c,d){this.readers.ows.WGS84BoundingBox.apply(this,[c,d])},LowerCorner:function(d,e){var f=this.getChildValue(d).replace(this.regExes.trimSpace,""),f=f.replace(this.regExes.trimComma,","),f=f.split(this.regExes.splitSpace);e.left=f[0];e.bottom=f[1]},UpperCorner:function(d,e){var f=this.getChildValue(d).replace(this.regExes.trimSpace,""),f=f.replace(this.regExes.trimComma,","),f=f.split(this.regExes.splitSpace);e.right=f[0];e.top=f[1];e.bounds=new OpenLayers.Bounds(e.left,e.bottom,e.right,e.top);delete e.left;delete e.bottom;delete e.right;delete e.top},Language:function(c,d){d.language=this.getChildValue(c)}}},writers:{ows:{BoundingBox:function(d,e){var f=this.createElementNSPlus(e||"ows:BoundingBox",{attributes:{crs:d.projection}});this.writeNode("ows:LowerCorner",d,f);this.writeNode("ows:UpperCorner",d,f);return f},LowerCorner:function(b){return this.createElementNSPlus("ows:LowerCorner",{value:b.bounds.left+" "+b.bounds.bottom})},UpperCorner:function(b){return this.createElementNSPlus("ows:UpperCorner",{value:b.bounds.right+" "+b.bounds.top})},Identifier:function(b){return this.createElementNSPlus("ows:Identifier",{value:b})},Title:function(b){return this.createElementNSPlus("ows:Title",{value:b})},Abstract:function(b){return this.createElementNSPlus("ows:Abstract",{value:b})},OutputFormat:function(b){return this.createElementNSPlus("ows:OutputFormat",{value:b})}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(c,d){d.success=!1;d.exceptionReport={version:c.getAttribute("version"),language:c.getAttribute("language"),exceptions:[]};this.readChildNodes(c,d.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(b){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[b]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[b])},readNode:function(d,e,f){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(c,d){d.numberOfFeatures=parseInt(c.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(c,d){d.insertIds=[];d.success=!1;this.readChildNodes(c,d)},TransactionSummary:function(c,d){d.success=!0},InsertResults:function(c,d){this.readChildNodes(c,d)},Feature:function(d,e){var f={fids:[]};this.readChildNodes(d,f);e.insertIds.push(f.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(c){var d=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);c&&this.setAttributes(d,{resultType:c.resultType,startIndex:c.startIndex,count:c.count});return d},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var f=e.featurePrefix,g=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(f?f+":":"")+e.featureType,srsName:e.srsName}});e.featureNS&&g.setAttribute("xmlns:"+f,e.featureNS);if(e.propertyNames){for(var f=0,h=e.propertyNames.length;f<h;f++){this.writeNode("wfs:PropertyName",{property:e.propertyNames[f]},g)}}e.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter),this.writeNode("ogc:Filter",e.filter,g));return g},PropertyName:function(b){return this.createElementNSPlus("wfs:PropertyName",{value:b.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(b){b=b||{};OpenLayers.Util.extend(this,b);this.options=b},mergeWithDefaultFilter:function(b){return b&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,b]}):b||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(b){b=b||{};b.filter=this.mergeWithDefaultFilter(b.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(b){},createCallback:function(d,e,f){return OpenLayers.Function.bind(function(){d.apply(this,[e,f])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(b){OpenLayers.Util.extend(this,b)},success:function(){return 0<this.code},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return !(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(a,b){var c;if(this.nativeJSON){c=JSON.parse(a,b)}else{try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"===typeof b)){var d=function(a,c){if(c&&"object"===typeof c){for(var e in c){c.hasOwnProperty(e)&&(c[e]=d(e,c[e]))}}return b(a,c)};c=d("",c)}}catch(e){}}this.keepData&&(this.data=c);return c},write:function(f,g){this.pretty=!!g;var h=null,i=typeof f;if(this.serialize[i]){try{h=!this.pretty&&this.nativeJSON?JSON.stringify(f):this.serialize[i].apply(this,[f])}catch(j){OpenLayers.Console.error("Trouble serializing: "+j)}}return h},writeIndent:function(){var c=[];if(this.pretty){for(var d=0;d<this.level;++d){c.push(this.indent)}}return c.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(g){if(null==g){return"null"}if(g.constructor==Date){return this.serialize.date.apply(this,[g])}if(g.constructor==Array){return this.serialize.array.apply(this,[g])}var h=["{"];this.level+=1;var i,j,k,l=!1;for(i in g){g.hasOwnProperty(i)&&(j=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]),k=OpenLayers.Format.JSON.prototype.write.apply(this,[g[i],this.pretty]),null!=j&&null!=k&&(l&&h.push(","),h.push(this.writeNewline(),this.writeIndent(),j,":",this.writeSpace(),k),l=!0))}this.level-=1;h.push(this.writeNewline(),this.writeIndent(),"}");return h.join("")},array:function(f){var g,h=["["];this.level+=1;for(var i=0,j=f.length;i<j;++i){g=OpenLayers.Format.JSON.prototype.write.apply(this,[f[i],this.pretty]),null!=g&&(0<i&&h.push(","),h.push(this.writeNewline(),this.writeIndent(),g))}this.level-=1;h.push(this.writeNewline(),this.writeIndent(),"]");return h.join("")},string:function(c){var d={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(c)?'"'+c.replace(/([\x00-\x1f\\"])/g,function(b,f){var g=d[f];if(g){return g}g=f.charCodeAt();return"\\u00"+Math.floor(g/16).toString(16)+(g%16).toString(16)})+'"':'"'+c+'"'},number:function(b){return isFinite(b)?String(b):"null"},"boolean":function(b){return String(b)},date:function(c){function d(b){return 10>b?"0"+b:b}return'"'+c.getFullYear()+"-"+d(c.getMonth()+1)+"-"+d(c.getDate())+"T"+d(c.getHours())+":"+d(c.getMinutes())+":"+d(c.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(i,j,n){j=j?j:"FeatureCollection";var o=null,p=null,p="string"==typeof i?OpenLayers.Format.JSON.prototype.read.apply(this,[i,n]):i;if(!p){OpenLayers.Console.error("Bad JSON: "+i)}else{if("string"!=typeof p.type){OpenLayers.Console.error("Bad GeoJSON - no type: "+i)}else{if(this.isValidType(p,j)){switch(j){case"Geometry":try{o=this.parseGeometry(p)}catch(q){OpenLayers.Console.error(q)}break;case"Feature":try{o=this.parseFeature(p),o.type="Feature"}catch(r){OpenLayers.Console.error(r)}break;case"FeatureCollection":switch(o=[],p.type){case"Feature":try{o.push(this.parseFeature(p))}catch(s){o=null,OpenLayers.Console.error(s)}break;case"FeatureCollection":i=0;for(j=p.features.length;i<j;++i){try{o.push(this.parseFeature(p.features[i]))}catch(t){o=null,OpenLayers.Console.error(t)}}break;default:try{var u=this.parseGeometry(p);o.push(new OpenLayers.Feature.Vector(u))}catch(v){o=null,OpenLayers.Console.error(v)}}}}}}return o},isValidType:function(d,e){var f=!1;switch(e){case"Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),d.type)?OpenLayers.Console.error("Unsupported geometry type: "+d.type):f=!0;break;case"FeatureCollection":f=!0;break;default:d.type==e?f=!0:OpenLayers.Console.error("Cannot convert types from "+d.type+" to "+e)}return f},parseFeature:function(f){var g,h,i;h=f.properties?f.properties:{};i=f.geometry&&f.geometry.bbox||f.bbox;try{g=this.parseGeometry(f.geometry)}catch(j){throw j}g=new OpenLayers.Feature.Vector(g,h);i&&(g.bounds=OpenLayers.Bounds.fromArray(i));f.id&&(g.fid=f.id);return g},parseGeometry:function(f){if(null==f){return null}var g,h=!1;if("GeometryCollection"==f.type){if(!OpenLayers.Util.isArray(f.geometries)){throw"GeometryCollection must have geometries array: "+f}g=f.geometries.length;for(var h=Array(g),i=0;i<g;++i){h[i]=this.parseGeometry.apply(this,[f.geometries[i]])}g=new OpenLayers.Geometry.Collection(h);h=!0}else{if(!OpenLayers.Util.isArray(f.coordinates)){throw"Geometry must have coordinates array: "+f}if(!this.parseCoords[f.type.toLowerCase()]){throw"Unsupported geometry type: "+f.type}try{g=this.parseCoords[f.type.toLowerCase()].apply(this,[f.coordinates])}catch(j){throw j}}this.internalProjection&&(this.externalProjection&&!h)&&g.transform(this.externalProjection,this.internalProjection);return g},parseCoords:{point:function(b){if(!1==this.ignoreExtraDims&&2!=b.length){throw"Only 2D points are supported: "+b}return new OpenLayers.Geometry.Point(b[0],b[1])},multipoint:function(g){for(var h=[],i=null,j=0,k=g.length;j<k;++j){try{i=this.parseCoords.point.apply(this,[g[j]])}catch(l){throw l}h.push(i)}return new OpenLayers.Geometry.MultiPoint(h)},linestring:function(g){for(var h=[],i=null,j=0,k=g.length;j<k;++j){try{i=this.parseCoords.point.apply(this,[g[j]])}catch(l){throw l}h.push(i)}return new OpenLayers.Geometry.LineString(h)},multilinestring:function(g){for(var h=[],i=null,j=0,k=g.length;j<k;++j){try{i=this.parseCoords.linestring.apply(this,[g[j]])}catch(l){throw l}h.push(i)}return new OpenLayers.Geometry.MultiLineString(h)},polygon:function(h){for(var i=[],j,k,l=0,m=h.length;l<m;++l){try{k=this.parseCoords.linestring.apply(this,[h[l]])}catch(n){throw n}j=new OpenLayers.Geometry.LinearRing(k.components);i.push(j)}return new OpenLayers.Geometry.Polygon(i)},multipolygon:function(g){for(var h=[],i=null,j=0,k=g.length;j<k;++j){try{i=this.parseCoords.polygon.apply(this,[g[j]])}catch(l){throw l}h.push(i)}return new OpenLayers.Geometry.MultiPolygon(h)},box:function(b){if(2!=b.length){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(b[0][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[0][1])])])}},write:function(g,h){var i={type:null};if(OpenLayers.Util.isArray(g)){i.type="FeatureCollection";var j=g.length;i.features=Array(j);for(var k=0;k<j;++k){var l=g[k];if(!l instanceof OpenLayers.Feature.Vector){throw"FeatureCollection only supports collections of features: "+l}i.features[k]=this.extract.feature.apply(this,[l])}}else{0==g.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[g]):g instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[g]),g.layer&&g.layer.projection&&(i.crs=this.createCRSObject(g)))}return OpenLayers.Format.JSON.prototype.write.apply(this,[i,h])},createCRSObject:function(c){c=c.layer.projection.toString();var d={};c.match(/epsg:/i)&&(c=parseInt(c.substring(c.indexOf(":")+1)),d=4326==c?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+c}});return d},extract:{feature:function(c){var d=this.extract.geometry.apply(this,[c.geometry]),d={type:"Feature",properties:c.attributes,geometry:d};null!=c.fid&&(d.id=c.fid);return d},geometry:function(c){if(null==c){return null}this.internalProjection&&this.externalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d=c.CLASS_NAME.split(".")[2];c=this.extract[d.toLowerCase()].apply(this,[c]);return"Collection"==d?{type:"GeometryCollection",geometries:c}:{type:d,coordinates:c}},point:function(b){return[b.x,b.y]},multipoint:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push(this.extract.point.apply(this,[e.components[g]]))}return f},linestring:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push(this.extract.point.apply(this,[e.components[g]]))}return f},multilinestring:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push(this.extract.linestring.apply(this,[e.components[g]]))}return f},polygon:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push(this.extract.linestring.apply(this,[e.components[g]]))}return f},multipolygon:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push(this.extract.polygon.apply(this,[e.components[g]]))}return f},collection:function(e){for(var f=e.components.length,g=Array(f),h=0;h<f;++h){g[h]=this.extract.geometry.apply(this,[e.components[h]])}return g}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(c){c=c||{};this.params={};this.pendingRequests={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);this.format||(this.format=new OpenLayers.Format.GeoJSON);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var d=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(b,e){return d.write(b,e)}}},read:function(d){OpenLayers.Protocol.prototype.read.apply(this,arguments);d=OpenLayers.Util.applyDefaults(d,this.options);d.params=OpenLayers.Util.applyDefaults(d.params,this.options.params);d.filter&&this.filterToParams&&(d.params=this.filterToParams(d.filter,d.params));var e=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.createRequest(d.url,d.params,OpenLayers.Function.bind(function(a){e.data=a;this.handleRead(e,d)},this));e.priv=f;return e},createRequest:function(e,f,g){g=OpenLayers.Protocol.Script.register(g);var h=OpenLayers.String.format(this.callbackTemplate,{id:g});f=OpenLayers.Util.extend({},f);f[this.callbackKey]=this.callbackPrefix+h;e=OpenLayers.Util.urlAppend(e,OpenLayers.Util.getParameterString(f));f=document.createElement("script");f.type="text/javascript";f.src=e;f.id="OpenLayers_Protocol_Script_"+g;this.pendingRequests[f.id]=f;document.getElementsByTagName("head")[0].appendChild(f);return f},destroyRequest:function(b){OpenLayers.Protocol.Script.unregister(b.id.split("_").pop());delete this.pendingRequests[b.id];b.parentNode&&b.parentNode.removeChild(b)},handleRead:function(c,d){this.handleResponse(c,d)},handleResponse:function(c,d){d.callback&&(c.data?(c.features=this.parseFeatures(c.data),c.code=OpenLayers.Protocol.Response.SUCCESS):c.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(c.priv),d.callback.call(d.scope,c))},parseFeatures:function(b){return this.format.read(b)},abort:function(c){if(c){this.destroyRequest(c.priv)}else{for(var d in this.pendingRequests){this.destroyRequest(this.pendingRequests[d])}}},destroy:function(){this.abort();delete this.params;delete this.format;OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"});(function(){var c=OpenLayers.Protocol.Script,d=0;c.registry={};c.register=function(a){var b="c"+ ++d;c.registry[b]=function(){a.apply(this,arguments)};return b};c.unregister=function(a){delete c.registry[a]}})();OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,{geometryType:"linestring",initialize:function(b){OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(h){var i;if("linestring"==this.geometryType){i=OpenLayers.Geometry.LineString}else{if("linearring"==this.geometryType){i=OpenLayers.Geometry.LinearRing}else{if("multipoint"==this.geometryType){i=OpenLayers.Geometry.MultiPoint}else{if("point"!=this.geometryType&&"polygon"!=this.geometryType){return null}}}}h=this.decodeDeltas(h,2);for(var j=h.length,k=[],l=0;l+1<j;){var m=h[l++],n=h[l++];k.push(new OpenLayers.Geometry.Point(n,m))}return"point"==this.geometryType?new OpenLayers.Feature.Vector(k[0]):"polygon"==this.geometryType?new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(k)])):new OpenLayers.Feature.Vector(new i(k))},decode:function(h,i,j){h=this.decodeDeltas(h,i,j||100000);j=h.length;for(var k=[],l=0;l+(i-1)<j;){for(var m=[],n=0;n<i;++n){m.push(h[l++])}k.push(m)}return k},write:function(f){f=(f.constructor==Array?f[0]:f).geometry;var g=f.CLASS_NAME.split(".")[2].toLowerCase();if("point"==g){f=Array(f)}else{if("linestring"==g||"linearring"==g||"multipoint"==g){f=f.components}else{if("polygon"==g){f=f.components[0].components}else{return null}}}for(var g=[],h=f.length,i=0;i<h;++i){var j=f[i];g.push(j.y);g.push(j.x)}return this.encodeDeltas(g,2)},encode:function(i,j,k){k=k||100000;for(var l=[],m=i.length,n=0;n<m;++n){for(var o=i[n],p=0;p<j;++p){l.push(o[p])}}return this.encodeDeltas(l,j,k)},encodeDeltas:function(i,j,l){var m,n=Array(j);for(m=0;m<j;++m){n[m]=0}for(var o=i.length,p=0;p<o;){for(m=0;m<j;++m,++p){var q=i[p],r=q-n[m];n[m]=q;i[p]=r}}return this.encodeFloats(i,l||100000)},decodeDeltas:function(g,h,i){var j,k=Array(h);for(j=0;j<h;++j){k[j]=0}g=this.decodeFloats(g,i||100000);i=g.length;for(var l=0;l<i;){for(j=0;j<h;++j,++l){k[j]+=g[l],g[l]=k[j]}}return g},encodeFloats:function(f,g){for(var h=g||100000,i=f.length,j=0;j<i;++j){f[j]=Math.round(f[j]*h)}return this.encodeSignedIntegers(f)},decodeFloats:function(g,h){for(var i=h||100000,j=this.decodeSignedIntegers(g),k=j.length,l=0;l<k;++l){j[l]/=i}return j},encodeSignedIntegers:function(f){for(var g=f.length,h=0;h<g;++h){var i=f[h],j=i<<1;0>i&&(j=~j);f[h]=j}return this.encodeUnsignedIntegers(f)},decodeSignedIntegers:function(e){e=this.decodeUnsignedIntegers(e);for(var f=e.length,g=0;g<f;++g){var h=e[g];e[g]=h&1?~(h>>1):h>>1}return e},encodeUnsignedIntegers:function(e){for(var f="",g=e.length,h=0;h<g;++h){f+=this.encodeUnsignedInteger(e[h])}return f},decodeUnsignedIntegers:function(h){for(var i=[],j=0,k=0,l=h.length,m=0;m<l;++m){var n=h.charCodeAt(m)-63,j=j|(n&31)<<k;32>n?(i.push(j),k=j=0):k+=5}return i},encodeFloat:function(c,d){c=Math.round(c*(d||100000));return this.encodeSignedInteger(c)},decodeFloat:function(c,d){return this.decodeSignedInteger(c)/(d||100000)},encodeSignedInteger:function(c){var d=c<<1;0>c&&(d=~d);return this.encodeUnsignedInteger(d)},decodeSignedInteger:function(b){b=this.decodeUnsignedInteger(b);return b&1?~(b>>1):b>>1},encodeUnsignedInteger:function(d){for(var e,f="";32<=d;){e=(32|d&31)+63,f+=String.fromCharCode(e),d>>=5}return f+=String.fromCharCode(d+63)},decodeUnsignedInteger:function(g){for(var h=0,i=0,j=g.length,k=0;k<j;++k){var l=g.charCodeAt(k)-63,h=h|(l&31)<<i;if(32>l){break}i+=5}return h},CLASS_NAME:"OpenLayers.Format.EncodedPolyline"});OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.controls=[];this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var c,d=this.controls.length-1;0<=d;d--){c=this.controls[d],c.events&&c.events.un({activate:this.iconOn,deactivate:this.iconOff}),c.panel_div=null}this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var d,e=0,f=this.controls.length;e<f;e++){d=this.controls[e],(d===this.defaultControl||this.saveState&&this.activeState[d.id])&&d.activate()}!0===this.saveState&&(this.defaultControl=null);this.redraw();return !0}return !1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var d,e=0,f=this.controls.length;e<f;e++){d=this.controls[e],this.activeState[d.id]=d.deactivate()}this.redraw();return !0}return !1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick);this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var c=this.div.childNodes.length-1;0<=c;c--){this.div.removeChild(this.div.childNodes[c])}this.div.innerHTML="";if(this.active){for(var c=0,d=this.controls.length;c<d;c++){this.div.appendChild(this.controls[c].panel_div)}}},activateControl:function(e){if(!this.active){return !1}if(e.type==OpenLayers.Control.TYPE_BUTTON){e.trigger()}else{if(e.type==OpenLayers.Control.TYPE_TOGGLE){e.active?e.deactivate():e.activate()}else{if(this.allowDepress&&e.active){e.deactivate()}else{for(var f,g=0,h=this.controls.length;g<h;g++){f=this.controls[g],f==e||f.type!==OpenLayers.Control.TYPE_TOOL&&null!=f.type||f.deactivate()}e.activate()}}}},addControls:function(f){OpenLayers.Util.isArray(f)||(f=[f]);this.controls=this.controls.concat(f);for(var g=0,h=f.length;g<h;g++){var i=f[g],j=this.createControlMarkup(i);OpenLayers.Element.addClass(j,i.displayClass+"ItemInactive");OpenLayers.Element.addClass(j,"olButton");""==i.title||j.title||(j.title=i.title);i.panel_div=j}this.map&&(this.addControlsToMap(f),this.redraw())},createControlMarkup:function(b){return document.createElement("div")},addControlsToMap:function(e){for(var f,g=0,h=e.length;g<h;g++){f=e[g],!0===f.autoActivate?(f.autoActivate=!1,this.map.addControl(f),f.autoActivate=!0):(this.map.addControl(f),f.deactivate()),f.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var b=this.panel_div;b.className=b.className.replace(RegExp("\\b("+this.displayClass+"Item)Inactive\\b"),"$1Active")},iconOff:function(){var b=this.panel_div;b.className=b.className.replace(RegExp("\\b("+this.displayClass+"Item)Active\\b"),"$1Inactive")},onButtonClick:function(d){var e=this.controls;d=d.buttonElement;for(var f=e.length-1;0<=f;--f){if(e[f].panel_div===d){this.activateControl(e[f]);break}}},getControlsBy:function(d,e){var f="function"==typeof e.test;return OpenLayers.Array.filter(this.controls,function(a){return a[d]==e||f&&e.test(a[d])})},getControlsByName:function(b){return this.getControlsBy("name",b)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,f,g,h){OpenLayers.Layer.prototype.initialize.apply(this,[e,h]);this.url=f;this.params||(this.params=OpenLayers.Util.extend({},g))},destroy:function(){this.params=this.url=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.prototype.clone.apply(this,[b])},setUrl:function(b){this.url=b},mergeNewParams:function(b){this.params=OpenLayers.Util.extend(this.params,b);b=this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});return b},redraw:function(b){return b?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(f,g){for(var h=1,i=0,j=f.length;i<j;i++){h*=f.charCodeAt(i)*this.URL_HASH_FACTOR,h-=Math.floor(h)}return g[Math.floor(h*g.length)]},getFullRequestString:function(g,h){var i=h||this.url,j=OpenLayers.Util.extend({},this.params),j=OpenLayers.Util.extend(j,g),k=OpenLayers.Util.getParameterString(j);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(k,i));var k=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i)),l;for(l in j){l.toUpperCase() in k&&delete j[l]}k=OpenLayers.Util.getParameterString(j);return OpenLayers.Util.urlAppend(i,k)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(g,h,i,j,k,l){this.layer=g;this.position=h.clone();this.setBounds(i);this.url=j;k&&(this.size=k.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,l);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=this.eventListeners=null},draw:function(c){c||this.clear();var d=this.shouldDraw();d&&(!c&&!1===this.events.triggerEvent("beforedraw"))&&(d=null);return d},shouldDraw:function(){var d=!1,e=this.layer.maxExtent;if(e){var f=this.layer.map,f=f.baseLayer.wrapDateLine&&f.getMaxExtent();this.bounds.intersectsBounds(e,{inclusive:!1,worldBounds:f})&&(d=!0)}return d||this.layer.displayOutsideMaxExtent},setBounds:function(d){d=d.clone();if(this.layer.map.baseLayer.wrapDateLine){var e=this.layer.map.getMaxExtent(),f=this.layer.map.getResolution();d=d.wrapDateLine(e,{leftTolerance:f,rightTolerance:f})}this.bounds=d},moveTo:function(d,e,f){null==f&&(f=!0);this.setBounds(d);this.position=e.clone();f&&this.draw()},clear:function(b){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(g,h,i,j,k,l){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=j;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"}null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null);this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var b=OpenLayers.Tile.prototype.draw.apply(this,arguments);b?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):!1===b&&this.unload();return b},renderTile:function(){if(this.layer.async){var b=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(a){b==this.asyncRequestId&&(this.url=a,this.initImage())},this)}else{this.url=this.layer.getURL(this.bounds),this.initImage()}},positionTile:function(){var d=this.getTile().style,e=this.frame?this.size:this.layer.getImageSize(this.bounds),f=1;this.layer instanceof OpenLayers.Layer.Grid&&(f=this.layer.getServerResolution()/this.layer.map.getResolution());d.left=this.position.x+"px";d.top=this.position.y+"px";d.width=Math.round(f*e.w)+"px";d.height=Math.round(f*e.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var c=this.imgDiv;if(c){var d=this.getTile();d.parentNode===this.layer.div&&this.layer.div.removeChild(d);this.setImgSrc();!0===this.layerAlphaHack&&(c.style.filter="");OpenLayers.Element.removeClass(c,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var d=this.imgDiv.style;if(this.frame){var e=0,f=0;this.layer.gutter&&(e=100*(this.layer.gutter/this.layer.tileSize.w),f=100*(this.layer.gutter/this.layer.tileSize.h));d.left=-e+"%";d.top=-f+"%";d.width=2*e+100+"%";d.height=2*f+100+"%"}d.visibility="hidden";d.opacity=0;1>this.layer.opacity&&(d.filter="alpha(opacity="+100*this.layer.opacity+")");d.position="absolute";this.layerAlphaHack&&(d.paddingTop=d.height,d.height="0",d.width="100%");this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(b){this.imgDiv=b},initImage:function(){if(this.url||this.imgDiv){this.events.triggerEvent("beforeload");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var c=this.getImage(),d=c.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(d,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&c.removeAttribute("crossorigin"),OpenLayers.Event.observe(c,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(c,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))}else{this.isLoading=!1}},setImgSrc:function(c){var d=this.imgDiv;c?(d.style.visibility="hidden",d.style.opacity=0,this.crossOriginKeyword&&("data:"!==c.substr(0,5)?d.setAttribute("crossorigin",this.crossOriginKeyword):d.removeAttribute("crossorigin")),d.src=c):(this.stopLoading(),this.imgDiv=null,d.parentNode&&d.parentNode.removeChild(d))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var b;this.frame?(b=this.frame.cloneNode(!1),b.appendChild(this.imgDiv)):b=this.imgDiv;this.imgDiv=null;return b}},onImageLoad:function(){var b=this.imgDiv;this.stopLoading();b.style.visibility="inherit";b.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");!0===this.layerAlphaHack&&(b.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b.src+"', sizingMethod='scale')")},onImageError:function(){var b=this.imgDiv;null!=b.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(b,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);window.clearTimeout(this._loadTimeout);delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var b=document.createElement("canvas");b.width=this.size.w;b.height=this.size.h;this.canvasContext=b.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.IMAGE=function(){var b=new Image;b.className="olTileImage";b.galleryImg="no";return b}();OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(e,f,g,h){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(b){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,b);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(b){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer();this.clearGrid();this.tileSize=this.grid=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var f=0,g=this.grid.length;f<g;f++){for(var h=this.grid[f],i=0,j=h.length;i<j;i++){this.destroyTile(h[i])}}this.grid=[];this.gridLayout=this.gridResolution=null}},addOptions:function(d,e){var f=void 0!==d.singleTile&&d.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);this.map&&f&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(b){null==b&&(b=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));b=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[b]);null!=this.tileSize&&(b.tileSize=this.tileSize.clone());b.grid=[];b.gridResolution=null;b.backBuffer=null;b.backBufferTimerId=null;b.loading=!1;b.numLoadingTiles=0;return b},moveTo:function(g,h,i){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);g=g||this.map.getExtent();if(null!=g){var j=!this.grid.length||h,k=this.getTilesBounds(),l=this.map.getResolution();this.getServerResolution(l);if(this.singleTile){if(j||!i&&!k.containsBounds(g)){h&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),h&&"resize"!==this.transitionEffect||this.applyBackBuffer(l),this.initSingleTile(g)}}else{(j=j||!k.intersectsBounds(g,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}))?(!h||"resize"!==this.transitionEffect&&this.gridResolution!==l||this.applyBackBuffer(l),this.initGriddedTiles(g)):this.moveGriddedTiles()}}},getTileData:function(i){var j=null,n=i.lon,o=i.lat,p=this.grid.length;if(this.map&&p){var q=this.map.getResolution();i=this.tileSize.w;var r=this.tileSize.h,s=this.grid[0][0].bounds,t=s.left,s=s.top;if(n<t&&this.map.baseLayer.wrapDateLine){var u=this.map.getMaxExtent().getWidth(),v=Math.ceil((t-n)/u),n=n+u*v}n=(n-t)/(q*i);o=(s-o)/(q*r);q=Math.floor(n);t=Math.floor(o);0<=t&&t<p&&(p=this.grid[t][q])&&(j={tile:p,i:Math.floor((n-q)*i),j:Math.floor((o-t)*r)})}return j},destroyTile:function(b){this.removeTileMonitoringHooks(b);b.destroy()},getServerResolution:function(g){var h=Number.POSITIVE_INFINITY;g=g||this.map.getResolution();if(this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,g)){var i,j,k,l;for(i=this.serverResolutions.length-1;0<=i;i--){k=this.serverResolutions[i];j=Math.abs(k-g);if(j>h){break}h=j;l=k}g=l}return g},getServerZoom:function(){var b=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoomForResolution(b)+(this.zoomOffset||0)},applyBackBuffer:function(g){null!==this.backBufferTimerId&&this.removeBackBuffer();var h=this.backBuffer;if(!h){h=this.createBackBuffer();if(!h){return}g===this.gridResolution?this.div.insertBefore(h,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(h,this.map.baseLayer.div);this.backBuffer=h;var i=this.grid[0][0].bounds;this.backBufferLonLat={lon:i.left,lat:i.top};this.backBufferResolution=this.gridResolution}for(var i=this.backBufferResolution/g,j=h.childNodes,k,l=j.length-1;0<=l;--l){k=j[l],k.style.top=(i*k._i*k._h|0)+"px",k.style.left=(i*k._j*k._w|0)+"px",k.style.width=Math.round(i*k._w)+"px",k.style.height=Math.round(i*k._h)+"px"}g=this.getViewPortPxFromLonLat(this.backBufferLonLat,g);i=this.map.layerContainerOriginPx.y;h.style.left=Math.round(g.x-this.map.layerContainerOriginPx.x)+"px";h.style.top=Math.round(g.y-i)+"px"},createBackBuffer:function(){var h;if(0<this.grid.length){h=document.createElement("div");h.id=this.div.id+"_bb";h.className="olBackBuffer";h.style.position="absolute";var i=this.map;h.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:i.Z_INDEX_BASE.BaseLayer-(i.getNumLayers()-i.getLayerIndex(this));for(var i=0,j=this.grid.length;i<j;i++){for(var k=0,l=this.grid[i].length;k<l;k++){var m=this.grid[i][k],n=this.grid[i][k].createBackBuffer();n&&(n._i=i,n._j=k,n._w=m.size.w,n._h=m.size.h,n.id=m.id+"_bb",h.appendChild(n))}}}return h},removeBackBuffer:function(){if(this._transitionElement){for(var b=this.transitionendEvents.length-1;0<=b;--b){OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[b],this._removeBackBuffer)}delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(c,d){this.singleTile||this.moveGriddedTiles()},setTileSize:function(b){this.singleTile&&(b=this.map.getSize(),b.h=parseInt(b.h*this.ratio,10),b.w=parseInt(b.w*this.ratio,10));OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[b])},getTilesBounds:function(){var d=null,e=this.grid.length;if(e){var d=this.grid[e-1][0].bounds,e=this.grid[0].length*d.getWidth(),f=this.grid.length*d.getHeight(),d=new OpenLayers.Bounds(d.left,d.bottom,d.left+e,d.bottom+f)}return d},initSingleTile:function(d){this.events.triggerEvent("retile");var e=d.getCenterLonLat(),f=d.getWidth()*this.ratio;d=d.getHeight()*this.ratio;e=new OpenLayers.Bounds(e.lon-f/2,e.lat-d/2,e.lon+f/2,e.lat+d/2);f=this.map.getLayerPxFromLonLat({lon:e.left,lat:e.top});this.grid.length||(this.grid[0]=[]);(d=this.grid[0][0])?d.moveTo(e,f):(d=this.addTile(e,f),this.addTileMonitoringHooks(d),d.draw(),this.grid[0][0]=d);this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(g,h,i){var j=i*this.tileSize.w;i*=this.tileSize.h;var k=Math.floor((g.left-h.lon)/j)-this.buffer,l=this.rowSign;g=Math[~l?"floor":"ceil"](l*(h.lat-g.top+i)/i)-this.buffer*l;return{tilelon:j,tilelat:i,startcol:k,startrow:g}},getTileOrigin:function(){var c=this.tileOrigin;if(!c){var c=this.getMaxExtent(),d={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],c=new OpenLayers.LonLat(c[d[0]],c[d[1]])}return c},getTileBoundsForGridIndex:function(i,j){var k=this.getTileOrigin(),l=this.gridLayout,m=l.tilelon,n=l.tilelat,o=l.startcol,l=l.startrow,p=this.rowSign;return new OpenLayers.Bounds(k.lon+(o+j)*m,k.lat-(l+i*p)*n*p,k.lon+(o+j+1)*m,k.lat-(l+(i-1)*p)*n*p)},initGriddedTiles:function(i){this.events.triggerEvent("retile");var j=this.map.getSize(),o=this.getTileOrigin(),t=this.map.getResolution(),u=this.getServerResolution(),v=t/u,t=this.tileSize.w/v,v=this.tileSize.h/v,w=Math.ceil(j.h/v)+2*this.buffer+1,j=Math.ceil(j.w/t)+2*this.buffer+1;this.gridLayout=u=this.calculateGridLayout(i,o,u);var o=u.tilelon,x=u.tilelat,u=this.map.layerContainerOriginPx.x,y=this.map.layerContainerOriginPx.y,z=this.getTileBoundsForGridIndex(0,0),A=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(z.left,z.top));A.x=Math.round(A.x)-u;A.y=Math.round(A.y)-y;var u=[],y=this.map.getCenter(),B=0;do{var C=this.grid[B];C||(C=[],this.grid.push(C));var D=0;do{var z=this.getTileBoundsForGridIndex(B,D),E=A.clone();E.x+=D*Math.round(t);E.y+=B*Math.round(v);var F=C[D];F?F.moveTo(z,E,!1):(F=this.addTile(z,E),this.addTileMonitoringHooks(F),C.push(F));E=z.getCenterLonLat();u.push({tile:F,distance:Math.pow(E.lon-y.lon,2)+Math.pow(E.lat-y.lat,2)});D+=1}while(z.right<=i.right+o*this.buffer||D<j);B+=1}while(z.bottom>=i.bottom-x*this.buffer||B<w);this.removeExcessTiles(B,D);this.gridResolution=t=this.getServerResolution();u.sort(function(c,d){return c.distance-d.distance});i=0;for(t=u.length;i<t;++i){u[i].tile.draw()}},getMaxExtent:function(){return this.maxExtent},addTile:function(d,e){var f=new this.tileClass(this,e,d,null,this.tileSize,this.tileOptions);this.events.triggerEvent("addtile",{tile:f});return f},addTileMonitoringHooks:function(b){b.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart"));this.events.triggerEvent("tileloadstart",{tile:b});this.numLoadingTiles++;!this.singleTile&&(this.backBuffer&&this.gridResolution===this.backBufferResolution)&&OpenLayers.Element.addClass(b.getTile(),"olTileReplacing")};b.onLoadEnd=function(a){this.numLoadingTiles--;a="unload"===a.type;this.events.triggerEvent("tileloaded",{tile:b,aborted:a});if(!this.singleTile&&!a&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var e=b.getTile();if("none"===OpenLayers.Element.getStyle(e,"display")){var f=document.getElementById(b.id+"_bb");f&&f.parentNode.removeChild(f)}OpenLayers.Element.removeClass(e,"olTileReplacing")}if(0===this.numLoadingTiles){if(this.backBuffer){if(0===this.backBuffer.childNodes.length){this.removeBackBuffer()}else{this._transitionElement=a?this.div.lastChild:b.imgDiv;a=this.transitionendEvents;for(e=a.length-1;0<=e;--e){OpenLayers.Event.observe(this._transitionElement,a[e],this._removeBackBuffer)}this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}}this.loading=!1;this.events.triggerEvent("loadend")}};b.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:b})};b.events.on({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,loaderror:b.onLoadError,scope:this})},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,loaderror:b.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var f=this.grid[0][0],g=f.position.x+this.map.layerContainerOriginPx.x,f=f.position.y+this.map.layerContainerOriginPx.y,h=this.getServerResolution()/this.map.getResolution(),h={w:Math.round(this.tileSize.w*h),h:Math.round(this.tileSize.h*h)};if(g>-h.w*(e-1)){this.shiftColumn(!0,h)}else{if(g<-h.w*e){this.shiftColumn(!1,h)}else{if(f>-h.h*(e-1)){this.shiftRow(!0,h)}else{if(f<-h.h*e){this.shiftRow(!1,h)}else{break}}}}}},shiftRow:function(i,j){var n=this.grid,o=i?0:n.length-1,p=i?-1:1;this.gridLayout.startrow+=p*this.rowSign;for(var q=n[o],r=n[i?"pop":"shift"](),s=0,t=r.length;s<t;s++){var u=r[s],v=q[s].position.clone();v.y+=j.h*p;u.moveTo(this.getTileBoundsForGridIndex(o,s),v)}n[i?"unshift":"push"](r)},shiftColumn:function(i,j){var m=this.grid,n=i?0:m[0].length-1,o=i?-1:1;this.gridLayout.startcol+=o;for(var p=0,q=m.length;p<q;p++){var r=m[p],s=r[n].position.clone(),t=r[i?"pop":"shift"]();s.x+=j.w*o;t.moveTo(this.getTileBoundsForGridIndex(p,n),s);r[i?"unshift":"push"](t)}},removeExcessTiles:function(g,h){for(var i,j;this.grid.length>g;){var k=this.grid.pop();i=0;for(j=k.length;i<j;i++){var l=k[i];this.destroyTile(l)}}i=0;for(j=this.grid.length;i<j;i++){for(;this.grid[i].length>h;){k=this.grid[i],l=k.pop(),this.destroyTile(l)}}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(f){var g=this.maxExtent,h=this.getResolution(),i=h*this.tileSize.w,h=h*this.tileSize.h,j=this.getLonLatFromViewPortPx(f);f=g.left+i*Math.floor((j.lon-g.left)/i);g=g.bottom+h*Math.floor((j.lat-g.bottom)/h);return new OpenLayers.Bounds(f,g,f+i,g+h)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:"antialiasing blockout font fontcolor fontsize fontstyle glowing interval outline printmode shadow transparency".split(" "),request:null,response:null,initialize:function(c){this.request=new OpenLayers.Format.ArcXML.Request;this.response=new OpenLayers.Format.ArcXML.Response;if(c){if("feature"==c.requesttype){this.request.get_image=null;var d=this.request.get_feature.query;this.addCoordSys(d.featurecoordsys,c.featureCoordSys);this.addCoordSys(d.filtercoordsys,c.filterCoordSys);c.polygon?(d.isspatial=!0,d.spatialfilter.polygon=c.polygon):c.envelope&&(d.isspatial=!0,d.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(d.spatialfilter.envelope,c.envelope))}else{"image"==c.requesttype?(this.request.get_feature=null,d=this.request.get_image.properties,this.parseEnvelope(d.envelope,c.envelope),this.addLayers(d.layerlist,c.layers),this.addImageSize(d.imagesize,c.tileSize),this.addCoordSys(d.featurecoordsys,c.featureCoordSys),this.addCoordSys(d.filtercoordsys,c.filterCoordSys)):this.request=null}}OpenLayers.Format.XML.prototype.initialize.apply(this,[c])},parseEnvelope:function(c,d){d&&4==d.length&&(c.minx=d[0],c.miny=d[1],c.maxx=d[2],c.maxy=d[3])},addLayers:function(e,f){for(var g=0,h=f.length;g<h;g++){e.push(f[g])}},addImageSize:function(c,d){null!==d&&(c.width=d.w,c.height=d.h,c.printwidth=d.w,c.printheight=d.h)},addCoordSys:function(c,d){"string"==typeof d?(c.id=parseInt(d),c.string=d):"object"==typeof d&&null!==d.proj&&(c.id=d.proj.srsProjNumber,c.string=d.proj.srsCode)},iserror:function(c){var d=null;c?(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]),c=c.documentElement.getElementsByTagName("ERROR"),d=null!==c&&0<c.length):d=""!==this.response.error;return d},read:function(f){"string"==typeof f&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));var g=null;f&&f.documentElement&&(g="ARCXML"==f.documentElement.nodeName?f.documentElement:f.documentElement.getElementsByTagName("ARCXML")[0]);if(!g||"parsererror"===g.firstChild.nodeName){var h,i;try{h=f.firstChild.nodeValue,i=f.firstChild.childNodes[1].firstChild.nodeValue}catch(j){}throw {message:"Error parsing the ArcXML request",error:h,source:i}}return this.parseResponse(g)},write:function(i){i||(i=this.request);var j=this.createElementNS("","ARCXML");j.setAttribute("version","1.1");var k=this.createElementNS("","REQUEST");if(null!=i.get_image){var l=this.createElementNS("","GET_IMAGE");k.appendChild(l);var m=this.createElementNS("","PROPERTIES");l.appendChild(m);i=i.get_image.properties;null!=i.featurecoordsys&&(l=this.createElementNS("","FEATURECOORDSYS"),m.appendChild(l),0===i.featurecoordsys.id?l.setAttribute("string",i.featurecoordsys.string):l.setAttribute("id",i.featurecoordsys.id));null!=i.filtercoordsys&&(l=this.createElementNS("","FILTERCOORDSYS"),m.appendChild(l),0===i.filtercoordsys.id?l.setAttribute("string",i.filtercoordsys.string):l.setAttribute("id",i.filtercoordsys.id));null!=i.envelope&&(l=this.createElementNS("","ENVELOPE"),m.appendChild(l),l.setAttribute("minx",i.envelope.minx),l.setAttribute("miny",i.envelope.miny),l.setAttribute("maxx",i.envelope.maxx),l.setAttribute("maxy",i.envelope.maxy));l=this.createElementNS("","IMAGESIZE");m.appendChild(l);l.setAttribute("height",i.imagesize.height);l.setAttribute("width",i.imagesize.width);if(i.imagesize.height!=i.imagesize.printheight||i.imagesize.width!=i.imagesize.printwidth){l.setAttribute("printheight",i.imagesize.printheight),l.setArrtibute("printwidth",i.imagesize.printwidth)}null!=i.background&&(l=this.createElementNS("","BACKGROUND"),m.appendChild(l),l.setAttribute("color",i.background.color.r+","+i.background.color.g+","+i.background.color.b),null!==i.background.transcolor&&l.setAttribute("transcolor",i.background.transcolor.r+","+i.background.transcolor.g+","+i.background.transcolor.b));if(null!=i.layerlist&&0<i.layerlist.length){for(l=this.createElementNS("","LAYERLIST"),m.appendChild(l),m=0;m<i.layerlist.length;m++){var n=this.createElementNS("","LAYERDEF");l.appendChild(n);n.setAttribute("id",i.layerlist[m].id);n.setAttribute("visible",i.layerlist[m].visible);if("object"==typeof i.layerlist[m].query){var o=i.layerlist[m].query;if(0>o.where.length){continue}var p=null,p="boolean"==typeof o.spatialfilter&&o.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY");p.setAttribute("where",o.where);"number"==typeof o.accuracy&&0<o.accuracy&&p.setAttribute("accuracy",o.accuracy);"number"==typeof o.featurelimit&&2000>o.featurelimit&&p.setAttribute("featurelimit",o.featurelimit);"string"==typeof o.subfields&&"#ALL#"!=o.subfields&&p.setAttribute("subfields",o.subfields);"string"==typeof o.joinexpression&&0<o.joinexpression.length&&p.setAttribute("joinexpression",o.joinexpression);"string"==typeof o.jointables&&0<o.jointables.length&&p.setAttribute("jointables",o.jointables);n.appendChild(p)}"object"==typeof i.layerlist[m].renderer&&this.addRenderer(n,i.layerlist[m].renderer)}}}else{null!=i.get_feature&&(l=this.createElementNS("","GET_FEATURES"),l.setAttribute("outputmode","newxml"),l.setAttribute("checkesc","true"),i.get_feature.geometry?l.setAttribute("geometry",i.get_feature.geometry):l.setAttribute("geometry","false"),i.get_feature.compact&&l.setAttribute("compact",i.get_feature.compact),"number"==i.get_feature.featurelimit&&l.setAttribute("featurelimit",i.get_feature.featurelimit),l.setAttribute("globalenvelope","true"),k.appendChild(l),null!=i.get_feature.layer&&0<i.get_feature.layer.length&&(m=this.createElementNS("","LAYER"),m.setAttribute("id",i.get_feature.layer),l.appendChild(m)),i=i.get_feature.query,null!=i&&(m=null,m=i.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),l.appendChild(m),"number"==typeof i.accuracy&&m.setAttribute("accuracy",i.accuracy),null!=i.featurecoordsys&&(l=this.createElementNS("","FEATURECOORDSYS"),0==i.featurecoordsys.id?l.setAttribute("string",i.featurecoordsys.string):l.setAttribute("id",i.featurecoordsys.id),m.appendChild(l)),null!=i.filtercoordsys&&(l=this.createElementNS("","FILTERCOORDSYS"),0===i.filtercoordsys.id?l.setAttribute("string",i.filtercoordsys.string):l.setAttribute("id",i.filtercoordsys.id),m.appendChild(l)),0<i.buffer&&(l=this.createElementNS("","BUFFER"),l.setAttribute("distance",i.buffer),m.appendChild(l)),i.isspatial&&(l=this.createElementNS("","SPATIALFILTER"),l.setAttribute("relation",i.spatialfilter.relation),m.appendChild(l),i.spatialfilter.envelope?(n=this.createElementNS("","ENVELOPE"),n.setAttribute("minx",i.spatialfilter.envelope.minx),n.setAttribute("miny",i.spatialfilter.envelope.miny),n.setAttribute("maxx",i.spatialfilter.envelope.maxx),n.setAttribute("maxy",i.spatialfilter.envelope.maxy),l.appendChild(n)):"object"==typeof i.spatialfilter.polygon&&l.appendChild(this.writePolygonGeometry(i.spatialfilter.polygon))),null!=i.where&&0<i.where.length&&m.setAttribute("where",i.where)))}j.appendChild(k);return OpenLayers.Format.XML.prototype.write.apply(this,[j])},addGroupRenderer:function(e,f){var g=this.createElementNS("","GROUPRENDERER");e.appendChild(g);for(var h=0;h<f.length;h++){this.addRenderer(g,f[h])}},addRenderer:function(d,e){if(OpenLayers.Util.isArray(e)){this.addGroupRenderer(d,e)}else{var f=this.createElementNS("",e.type.toUpperCase()+"RENDERER");d.appendChild(f);"VALUEMAPRENDERER"==f.tagName?this.addValueMapRenderer(f,e):"VALUEMAPLABELRENDERER"==f.tagName?this.addValueMapLabelRenderer(f,e):"SIMPLELABELRENDERER"==f.tagName?this.addSimpleLabelRenderer(f,e):"SCALEDEPENDENTRENDERER"==f.tagName&&this.addScaleDependentRenderer(f,e)}},addScaleDependentRenderer:function(c,d){"string"!=typeof d.lower&&"number"!=typeof d.lower||c.setAttribute("lower",d.lower);"string"!=typeof d.upper&&"number"!=typeof d.upper||c.setAttribute("upper",d.upper);this.addRenderer(c,d.renderer)},addValueMapLabelRenderer:function(i,j){i.setAttribute("lookupfield",j.lookupfield);i.setAttribute("labelfield",j.labelfield);if("object"==typeof j.exacts){for(var n=0,o=j.exacts.length;n<o;n++){var p=j.exacts[n],q=this.createElementNS("","EXACT");"string"==typeof p.value&&q.setAttribute("value",p.value);"string"==typeof p.label&&q.setAttribute("label",p.label);"string"==typeof p.method&&q.setAttribute("method",p.method);i.appendChild(q);if("object"==typeof p.symbol){var r=null;"text"==p.symbol.type&&(r=this.createElementNS("","TEXTSYMBOL"));if(null!=r){for(var s=this.fontStyleKeys,t=0,u=s.length;t<u;t++){var v=s[t];p.symbol[v]&&r.setAttribute(v,p.symbol[v])}q.appendChild(r)}}}}},addValueMapRenderer:function(h,i){h.setAttribute("lookupfield",i.lookupfield);if("object"==typeof i.ranges){for(var j=0,k=i.ranges.length;j<k;j++){var l=i.ranges[j],m=this.createElementNS("","RANGE");m.setAttribute("lower",l.lower);m.setAttribute("upper",l.upper);h.appendChild(m);if("object"==typeof l.symbol){var n=null;"simplepolygon"==l.symbol.type&&(n=this.createElementNS("","SIMPLEPOLYGONSYMBOL"));null!=n&&("string"==typeof l.symbol.boundarycolor&&n.setAttribute("boundarycolor",l.symbol.boundarycolor),"string"==typeof l.symbol.fillcolor&&n.setAttribute("fillcolor",l.symbol.fillcolor),"number"==typeof l.symbol.filltransparency&&n.setAttribute("filltransparency",l.symbol.filltransparency),m.appendChild(n))}}}else{if("object"==typeof i.exacts){for(j=0,k=i.exacts.length;j<k;j++){l=i.exacts[j],m=this.createElementNS("","EXACT"),"string"==typeof l.value&&m.setAttribute("value",l.value),"string"==typeof l.label&&m.setAttribute("label",l.label),"string"==typeof l.method&&m.setAttribute("method",l.method),h.appendChild(m),"object"==typeof l.symbol&&(n=null,"simplemarker"==l.symbol.type&&(n=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=n&&("string"==typeof l.symbol.antialiasing&&n.setAttribute("antialiasing",l.symbol.antialiasing),"string"==typeof l.symbol.color&&n.setAttribute("color",l.symbol.color),"string"==typeof l.symbol.outline&&n.setAttribute("outline",l.symbol.outline),"string"==typeof l.symbol.overlap&&n.setAttribute("overlap",l.symbol.overlap),"string"==typeof l.symbol.shadow&&n.setAttribute("shadow",l.symbol.shadow),"number"==typeof l.symbol.transparency&&n.setAttribute("transparency",l.symbol.transparency),"string"==typeof l.symbol.usecentroid&&n.setAttribute("usecentroid",l.symbol.usecentroid),"number"==typeof l.symbol.width&&n.setAttribute("width",l.symbol.width),m.appendChild(n)))}}}},addSimpleLabelRenderer:function(i,j){i.setAttribute("field",j.field);for(var k="featureweight howmanylabels labelbufferratio labelpriorities labelweight linelabelposition rotationalangles".split(" "),l=0,m=k.length;l<m;l++){var n=k[l];j[n]&&i.setAttribute(n,j[n])}if("text"==j.symbol.type){var o=j.symbol,p=this.createElementNS("","TEXTSYMBOL");i.appendChild(p);k=this.fontStyleKeys;l=0;for(m=k.length;l<m;l++){n=k[l],o[n]&&p.setAttribute(n,j[n])}}},writePolygonGeometry:function(i){if(!(i instanceof OpenLayers.Geometry.Polygon)){throw {message:"Cannot write polygon geometry to ArcXML with an "+i.CLASS_NAME+" object.",geometry:i}}for(var j=this.createElementNS("","POLYGON"),m=0,n=i.components.length;m<n;m++){for(var o=i.components[m],p=this.createElementNS("","RING"),q=0,r=o.components.length;q<r;q++){var s=o.components[q],t=this.createElementNS("","POINT");t.setAttribute("x",s.x);t.setAttribute("y",s.y);p.appendChild(t)}j.appendChild(p)}return j},parseResponse:function(i){"string"==typeof i&&(i=(new OpenLayers.Format.XML).read(i));var j=new OpenLayers.Format.ArcXML.Response,m=i.getElementsByTagName("ERROR");if(null!=m&&0<m.length){j.error=this.getChildValue(m,"Unknown error.")}else{m=i.getElementsByTagName("RESPONSE");if(null==m||0==m.length){return j.error="No RESPONSE tag found in ArcXML response.",j}var n=m[0].firstChild.nodeName;"#text"==n&&(n=m[0].firstChild.nextSibling.nodeName);if("IMAGE"==n){m=i.getElementsByTagName("ENVELOPE"),i=i.getElementsByTagName("OUTPUT"),null==m||0==m.length?j.error="No ENVELOPE tag found in ArcXML response.":null==i||0==i.length?j.error="No OUTPUT tag found in ArcXML response.":(m=this.parseAttributes(m[0]),n=this.parseAttributes(i[0]),j.image="string"==typeof n.type?{envelope:m,output:{type:n.type,data:this.getChildValue(i[0])}}:{envelope:m,output:n})}else{if("FEATURES"==n){if(i=m[0].getElementsByTagName("FEATURES"),m=i[0].getElementsByTagName("FEATURECOUNT"),j.features.featurecount=m[0].getAttribute("count"),0<j.features.featurecount){for(m=i[0].getElementsByTagName("ENVELOPE"),j.features.envelope=this.parseAttributes(m[0],"number"),i=i[0].getElementsByTagName("FEATURE"),m=0;m<i.length;m++){for(var n=new OpenLayers.Feature.Vector,o=i[m].getElementsByTagName("FIELD"),p=0;p<o.length;p++){var q=o[p].getAttribute("name"),r=o[p].getAttribute("value");n.attributes[q]=r}o=i[m].getElementsByTagName("POLYGON");if(0<o.length){o=o[0].getElementsByTagName("RING");p=[];for(q=0;q<o.length;q++){r=[];r.push(this.parsePointGeometry(o[q]));for(var s=o[q].getElementsByTagName("HOLE"),t=0;t<s.length;t++){r.push(this.parsePointGeometry(s[t]))}p.push(new OpenLayers.Geometry.Polygon(r))}n.geometry=1==p.length?p[0]:new OpenLayers.Geometry.MultiPolygon(p)}j.features.feature.push(n)}}}else{j.error="Unidentified response type."}}}return j},parseAttributes:function(e,f){for(var g={},h=0;h<e.attributes.length;h++){g[e.attributes[h].nodeName]="number"==f?parseFloat(e.attributes[h].nodeValue):e.attributes[h].nodeValue}return g},parsePointGeometry:function(e){var f=[],g=e.getElementsByTagName("COORDS");if(0<g.length){for(e=this.getChildValue(g[0]),e=e.split(/;/),g=0;g<e.length;g++){var h=e[g].split(/ /);f.push(new OpenLayers.Geometry.Point(h[0],h[1]))}}else{if(e=e.getElementsByTagName("POINT"),0<e.length){for(g=0;g<e.length;g++){f.push(new OpenLayers.Geometry.Point(parseFloat(e[g].getAttribute("x")),parseFloat(e[g].getAttribute("y"))))}}}return new OpenLayers.Geometry.LinearRing(f)},CLASS_NAME:"OpenLayers.Format.ArcXML"});OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(b){return OpenLayers.Util.extend(this,{get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]})},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(b){return OpenLayers.Util.extend(this,{image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""})},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});(function(){function i(){this._object=o&&!r?new o:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function j(){return new i}function l(b){j.onreadystatechange&&j.onreadystatechange.apply(b);b.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function m(h){try{h.responseText=h._object.responseText}catch(s){}try{var t;var v=h._object,w=v.responseXML,x=v.responseText;q&&(x&&w&&!w.documentElement&&v.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/))&&(w=new window.ActiveXObject("Microsoft.XMLDOM"),w.async=!1,w.validateOnParse=!1,w.loadXML(x));t=w&&(q&&0!=w.parseError||!w.documentElement||w.documentElement&&"parsererror"==w.documentElement.tagName)?null:w;h.responseXML=t}catch(y){}try{h.status=h._object.status}catch(z){}try{h.statusText=h._object.statusText}catch(A){}}function n(b){b._object.onreadystatechange=new window.Function}var o=window.XMLHttpRequest,p=!!window.controllers,q=window.document.all&&!window.opera,r=q&&window.navigator.userAgent.match(/MSIE 7.0/);j.prototype=i.prototype;p&&o.wrapped&&(j.wrapped=o.wrapped);j.UNSENT=0;j.OPENED=1;j.HEADERS_RECEIVED=2;j.LOADING=3;j.DONE=4;j.prototype.readyState=j.UNSENT;j.prototype.responseText="";j.prototype.responseXML=null;j.prototype.status=0;j.prototype.statusText="";j.prototype.priority="NORMAL";j.prototype.onreadystatechange=null;j.onreadystatechange=null;j.onopen=null;j.onsend=null;j.onabort=null;j.prototype.open=function(b,c,d,e,g){delete this._headers;3>arguments.length&&(d=!0);this._async=d;var h=this,u=this.readyState,v;q&&d&&(v=function(){u!=j.DONE&&(n(h),h.abort())},window.attachEvent("onunload",v));j.onopen&&j.onopen.apply(this,arguments);4<arguments.length?this._object.open(b,c,d,e,g):3<arguments.length?this._object.open(b,c,d,e):this._object.open(b,c,d);this.readyState=j.OPENED;l(this);this._object.onreadystatechange=function(){if(!p||d){h.readyState=h._object.readyState,m(h),h._aborted?h.readyState=j.UNSENT:(h.readyState==j.DONE&&(delete h._data,n(h),q&&d&&window.detachEvent("onunload",v)),u!=h.readyState&&l(h),u=h.readyState)}}};j.prototype.send=function(b){j.onsend&&j.onsend.apply(this,arguments);arguments.length||(b=null);b&&b.nodeType&&(b=window.XMLSerializer?(new window.XMLSerializer).serializeToString(b):b.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml"));this._data=b;b:if(this._object.send(this._data),p&&!this._async){for(this.readyState=j.OPENED,m(this);this.readyState<j.DONE;){if(this.readyState++,l(this),this._aborted){break b}}}};j.prototype.abort=function(){j.onabort&&j.onabort.apply(this,arguments);this.readyState>j.UNSENT&&(this._aborted=!0);this._object.abort();n(this);this.readyState=j.UNSENT;delete this._data};j.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};j.prototype.getResponseHeader=function(b){return this._object.getResponseHeader(b)};j.prototype.setRequestHeader=function(c,d){this._headers||(this._headers={});this._headers[c]=d;return this._object.setRequestHeader(c,d)};j.prototype.addEventListener=function(f,g,h){for(var k=0,s;s=this._listeners[k];k++){if(s[0]==f&&s[1]==g&&s[2]==h){return}}this._listeners.push([f,g,h])};j.prototype.removeEventListener=function(f,g,h){for(var k=0,s;(s=this._listeners[k])&&(s[0]!=f||s[1]!=g||s[2]!=h);k++){}s&&this._listeners.splice(k,1)};j.prototype.dispatchEvent=function(d){d={type:d.type,target:this,currentTarget:this,eventPhase:2,bubbles:d.bubbles,cancelable:d.cancelable,timeStamp:d.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==d.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[d]);for(var e=0,f;f=this._listeners[e];e++){f[0]!=d.type||f[2]||(f[1].handleEvent||f[1]).apply(this,[d])}};j.prototype.toString=function(){return"[object XMLHttpRequest]"};j.toString=function(){return"[XMLHttpRequest]"};window.Function.prototype.apply||(window.Function.prototype.apply=function(c,d){d||(d=[]);c.__func=this;c.__func(d[0],d[1],d[2],d[3],d[4]);delete c.__func});OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Request.XMLHttpRequest=j})();OpenLayers.ProxyHost="";OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(f,g){var h=0!==f.indexOf("http"),i=!h&&f.match(this.URL_SPLIT_REGEX);if(i){var j=window.location,h=i[1]==j.protocol&&i[3]==j.hostname,i=i[4],j=j.port;if(80!=i&&""!=i||"80"!=j&&""!=j){h=h&&i==j}}h||g&&(f="function"==typeof g?g(f):g+encodeURIComponent(f));return f},issue:function(i){var j=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});i=i||{};i.headers=i.headers||{};i=OpenLayers.Util.applyDefaults(i,j);i.headers=OpenLayers.Util.applyDefaults(i.headers,j.headers);var j=!1,k;for(k in i.headers){i.headers.hasOwnProperty(k)&&"x-requested-with"===k.toLowerCase()&&(j=!0)}!1===j&&(i.headers["X-Requested-With"]="XMLHttpRequest");var l=new OpenLayers.Request.XMLHttpRequest,m=OpenLayers.Util.urlAppend(i.url,OpenLayers.Util.getParameterString(i.params||{})),m=OpenLayers.Request.makeSameOrigin(m,i.proxy);l.open(i.method,m,i.async,i.user,i.password);for(var n in i.headers){l.setRequestHeader(n,i.headers[n])}var o=this.events,p=this;l.onreadystatechange=function(){l.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==o.triggerEvent("complete",{request:l,config:i,requestUrl:m})&&p.runCallbacks({request:l,config:i,requestUrl:m})};!1===i.async?l.send(i.data):window.setTimeout(function(){0!==l.readyState&&l.send(i.data)},0);return l},runCallbacks:function(g){var h=g.request,i=g.config,j=i.scope?OpenLayers.Function.bind(i.callback,i.scope):i.callback,k;i.success&&(k=i.scope?OpenLayers.Function.bind(i.success,i.scope):i.success);var l;i.failure&&(l=i.scope?OpenLayers.Function.bind(i.failure,i.scope):i.failure);"file:"==OpenLayers.Util.createUrlObject(i.url).protocol&&h.responseText&&(h.status=200);j(h);if(!h.status||200<=h.status&&300>h.status){this.events.triggerEvent("success",g),k&&k(h)}h.status&&(200>h.status||300<=h.status)&&(this.events.triggerEvent("failure",g),l&&l(h))},GET:function(b){b=OpenLayers.Util.extend(b,{method:"GET"});return OpenLayers.Request.issue(b)},POST:function(b){b=OpenLayers.Util.extend(b,{method:"POST"});b.headers=b.headers?b.headers:{};"CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers)||(b.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(b)},PUT:function(b){b=OpenLayers.Util.extend(b,{method:"PUT"});b.headers=b.headers?b.headers:{};"CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers)||(b.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(b)},DELETE:function(b){b=OpenLayers.Util.extend(b,{method:"DELETE"});return OpenLayers.Request.issue(b)},HEAD:function(b){b=OpenLayers.Util.extend(b,{method:"HEAD"});return OpenLayers.Request.issue(b)},OPTIONS:function(b){b=OpenLayers.Util.extend(b,{method:"OPTIONS"});return OpenLayers.Request.issue(b)}});OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(d,e,f){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:f.serviceName},this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(f,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[d,e,this.params,f]);this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"));null===this.options.layers&&(this.options.layers=[])},getURL:function(c){var d="";c=this.adjustBounds(c);c=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:c.toArray(),tileSize:this.tileSize}));c=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:c.write(),async:!1});null!=c&&(d=c.responseXML,d&&d.documentElement||(d=c.responseText),d=(new OpenLayers.Format.ArcXML).read(d),d=this.getUrlOrImage(d.image.output));return d},getURLasync:function(d,e,f){d=this.adjustBounds(d);d=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:d.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:d.write(),callback:function(b){var c=b.responseXML;c&&c.documentElement||(c=b.responseText);b=(new OpenLayers.Format.ArcXML).read(c);e.call(f,this.getUrlOrImage(b.image.output))},scope:this})},getUrlOrImage:function(c){var d="";c.url?d=c.url:c.data&&(d="data:image/"+c.type+";base64,"+c.data);return d},setLayerQuery:function(d,e){for(var f=0;f<this.options.layers.length;f++){if(d==this.options.layers[f].id){this.options.layers[f].query=e;return}}this.options.layers.push({id:d,visible:!0,query:e})},getFeatureInfo:function(i,j,k){var l=k.buffer||1,m=k.callback||function(){},n=k.scope||window,o={};OpenLayers.Util.extend(o,this.options);o.requesttype="feature";i instanceof OpenLayers.LonLat?(o.polygon=null,o.envelope=[i.lon-l,i.lat-l,i.lon+l,i.lat+l]):i instanceof OpenLayers.Geometry.Polygon&&(o.envelope=null,o.polygon=i);var p=new OpenLayers.Format.ArcXML(o);OpenLayers.Util.extend(p.request.get_feature,k);p.request.get_feature.layer=j.id;"number"==typeof j.query.accuracy?p.request.get_feature.query.accuracy=j.query.accuracy:(i=this.map.getCenter(),k=this.map.getViewPortPxFromLonLat(i),k.x++,k=this.map.getLonLatFromPixel(k),p.request.get_feature.query.accuracy=k.lon-i.lon);p.request.get_feature.query.where=j.query.where;p.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:p.write(),callback:function(b){b=p.parseResponse(b.responseText);p.iserror()?m.call(n,null):m.call(n,b.features)}})},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(b){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.position=this.buttons=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(d){OpenLayers.Control.prototype.draw.apply(this,arguments);d=this.position;this.buttons=[];var e={w:18,h:18},f=new OpenLayers.Pixel(d.x+e.w/2,d.y);this._addButton("panup","north-mini.png",f,e);d.y=f.y+e.h;this._addButton("panleft","west-mini.png",d,e);this._addButton("panright","east-mini.png",d.add(e.w,0),e);this._addButton("pandown","south-mini.png",f.add(0,2*e.h),e);this._addButton("zoomin","zoom-plus-mini.png",f.add(0,3*e.h+5),e);this._addButton("zoomworld","zoom-world-mini.png",f.add(0,4*e.h+5),e);this._addButton("zoomout","zoom-minus-mini.png",f.add(0,5*e.h+5),e);return this.div},_addButton:function(e,f,g,h){f=OpenLayers.Util.getImageLocation(f);g=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+e,g,h,f,"absolute");g.style.cursor="pointer";this.div.appendChild(g);g.action=e;g.className="olButton";this.buttons.push(g);return g},_removeButton:function(b){this.div.removeChild(b);OpenLayers.Util.removeItem(this.buttons,b)},removeButtons:function(){for(var b=this.buttons.length-1;0<=b;--b){this._removeButton(this.buttons[b])}},onButtonClick:function(b){switch(b.buttonElement.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(b){return this.slideRatio?this.map.getSize()[b]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(b){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar());this.draw()},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position.clone();this.buttons=[];var f={w:18,h:18};if(this.panIcons){var g=new OpenLayers.Pixel(e.x+f.w/2,e.y),h=f.w;this.zoomWorldIcon&&(g=new OpenLayers.Pixel(e.x+f.w,e.y));this._addButton("panup","north-mini.png",g,f);e.y=g.y+f.h;this._addButton("panleft","west-mini.png",e,f);this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",e.add(f.w,0),f),h*=2);this._addButton("panright","east-mini.png",e.add(h,0),f);this._addButton("pandown","south-mini.png",g.add(0,2*f.h),f);this._addButton("zoomin","zoom-plus-mini.png",g.add(0,3*f.h+5),f);g=this._addZoomBar(g.add(0,4*f.h+5));this._addButton("zoomout","zoom-minus-mini.png",g,f)}else{this._addButton("zoomin","zoom-plus-mini.png",e,f),g=this._addZoomBar(e.add(0,f.h)),this._addButton("zoomout","zoom-minus-mini.png",g,f),this.zoomWorldIcon&&(g=g.add(0,f.h+3),this._addButton("zoomworld","zoom-world-mini.png",g,f))}return this.div},_addZoomBar:function(g){var h=OpenLayers.Util.getImageLocation("slider.png"),i=this.id+"_"+this.map.id,j=this.map.getMinZoom(),k=this.map.getNumZoomLevels()-1-this.map.getZoom(),k=OpenLayers.Util.createAlphaImageDiv(i,g.add(-1,k*this.zoomStopHeight),{w:20,h:9},h,"absolute");k.style.cursor="move";this.slider=k;this.sliderEvents=new OpenLayers.Events(this,k,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var l={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-j)},h=OpenLayers.Util.getImageLocation("zoombar.png"),i=null;OpenLayers.Util.alphaHack()?(i=this.id+"_"+this.map.id,i=OpenLayers.Util.createAlphaImageDiv(i,g,{w:l.w,h:this.zoomStopHeight},h,"absolute",null,"crop"),i.style.height=l.h+"px"):i=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,g,l,h);i.style.cursor="pointer";i.className="olButton";this.zoombarDiv=i;this.div.appendChild(i);this.startTop=parseInt(i.style.top);this.div.appendChild(k);this.map.events.register("zoomend",this,this.moveZoomBar);return g=g.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-j))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(c){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(c.buttonElement===this.zoombarDiv){var d=c.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){d=Math.floor(d)}d=this.map.getNumZoomLevels()-1-d;d=Math.min(Math.max(d,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(d)}},passEventToSlider:function(b){this.sliderEvents.handleBrowserEvent(b)},zoomBarDown:function(b){if(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=b.xy.clone(),this.zoomStart=b.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(b)}},zoomBarDrag:function(d){if(null!=this.mouseDragStart){var e=this.mouseDragStart.y-d.xy.y,f=OpenLayers.Util.pagePosition(this.zoombarDiv);0<d.clientY-f[1]&&d.clientY-f[1]<parseInt(this.zoombarDiv.style.height)-2&&(e=parseInt(this.slider.style.top)-e,this.slider.style.top=e+"px",this.mouseDragStart=d.xy.clone());this.deltaY=this.zoomStart.y-d.xy.y;OpenLayers.Event.stop(d)}},zoomBarUp:function(c){if((OpenLayers.Event.isLeftClick(c)||"touchend"===c.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var d=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(d+=this.deltaY/this.zoomStopHeight,d=Math.min(Math.max(d,0),this.map.getNumZoomLevels()-1)):(d+=this.deltaY/this.zoomStopHeight,d=Math.max(Math.round(d),0));this.map.zoomTo(d);this.zoomStart=this.mouseDragStart=null;this.deltaY=0;OpenLayers.Event.stop(c)}},moveZoomBar:function(){var b=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=b+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);return d},readers:{wfs:{WFS_Capabilities:function(c,d){this.readChildNodes(c,d)},FeatureTypeList:function(c,d){d.featureTypeList={featureTypes:[]};this.readChildNodes(c,d.featureTypeList)},FeatureType:function(d,e){var f={};this.readChildNodes(d,f);e.featureTypes.push(f)},Name:function(d,e){var f=this.getChildValue(d);f&&(f=f.split(":"),e.name=f.pop(),0<f.length&&(e.featureNS=this.lookupNamespaceURI(d,f[0])))},Title:function(d,e){var f=this.getChildValue(d);f&&(e.title=f)},Abstract:function(d,e){var f=this.getChildValue(d);f&&(e["abstract"]=f)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(d,e){var f=this.getChildValue(d);f&&(e.srs=f)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(f,g,h,i,j){this.url=g;this.maxExtent=this.extent=h;this.size=i;OpenLayers.Layer.prototype.initialize.apply(this,[f,j]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null);OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions()));return b=OpenLayers.Layer.prototype.clone.apply(this,[b])},setMap:function(b){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w);OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(f,g,h){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var i=null==this.tile;if(g||i){this.setTileSize();var j=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});i?(this.tile=new OpenLayers.Tile.Image(this,j,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=j.clone());this.tile.draw()}},setTileSize:function(){var c=this.extent.getWidth()/this.map.getResolution(),d=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(c,d)},addTileMonitoringHooks:function(b){b.onLoadStart=function(){this.events.triggerEvent("loadstart")};b.events.register("loadstart",this,b.onLoadStart);b.onLoadEnd=function(){this.events.triggerEvent("loadend")};b.events.register("loadend",this,b.onLoadEnd);b.events.register("unload",this,b.onLoadEnd)},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,scope:this})},setUrl:function(b){this.url=b;this.tile.draw()},getURL:function(b){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b;this.active=!1},destroy:function(){this.deactivate();this.options=this.layer=null},setLayer:function(b){this.layer=b},activate:function(){return this.active?!1:this.active=!0},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(b){OpenLayers.Strategy.prototype.initialize.apply(this,[b]);this.events=new OpenLayers.Events(this)},activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b&&this.auto){if("number"===typeof this.auto){this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1000*this.auto)}else{this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.auto&&("number"===typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this}));return b},triggerSave:function(c){var d=c.feature;d.state!==OpenLayers.State.INSERT&&d.state!==OpenLayers.State.UPDATE&&d.state!==OpenLayers.State.DELETE||this.save([c.feature])},save:function(i){i||(i=this.layer.features);this.events.triggerEvent("start",{features:i});var j=this.layer.projection,k=this.layer.map.getProjectionObject();if(!k.equals(j)){for(var l=i.length,m=Array(l),n,o,p=0;p<l;++p){n=i[p],o=n.clone(),o.fid=n.fid,o.state=n.state,n.url&&(o.url=n.url),o._original=n,o.geometry.transform(k,j),m[p]=o}i=m}this.layer.protocol.commit(i,{callback:this.onCommit,scope:this})},onCommit:function(i){var j={response:i};if(i.success()){for(var l=i.reqFeatures,m,n=[],o=i.insertIds||[],p=0,q=0,r=l.length;q<r;++q){if(m=l[q],m=m._original||m,i=m.state){i==OpenLayers.State.DELETE?n.push(m):i==OpenLayers.State.INSERT&&(m.fid=o[p],++p),m.state=null}}0<n.length&&this.layer.destroyFeatures(n);this.events.triggerEvent("success",j)}else{this.events.triggerEvent("fail",j)}},CLASS_NAME:"OpenLayers.Strategy.Save"});OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(c){this.target=c;if(c.object instanceof OpenLayers.Map){this.setMap(c.object)}else{if(c.object instanceof OpenLayers.Layer.Vector){c.object.map?this.setMap(c.object.map):c.object.events.register("added",this,function(a){this.setMap(c.object.map)})}else{throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances"}}for(var d=this.provides.length-1;0<=d;--d){c.extensions[this.provides[d]]=!0}},setMap:function(b){this.map=b;this.cache={};b.events.register("mousedown",this,this.start,{extension:!0});b.events.register("mouseup",this,this.onClick,{extension:!0});b.events.register("touchstart",this,this.start,{extension:!0});b.events.register("touchmove",this,this.cancel,{extension:!0});b.events.register("touchend",this,this.onClick,{extension:!0});b.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(b){this.startEvt=b},cancel:function(b){delete this.startEvt},onClick:function(g){if(this.startEvt&&("touchend"===g.type||OpenLayers.Event.isLeftClick(g))){g=this.getFeatures(this.startEvt);delete this.startEvt;for(var h,i,j={},k=0,l=g.length;k<l&&(h=g[k],i=h.layer,j[i.id]=!0,h=this.triggerEvent("featureclick",{feature:h}),!1!==h);++k){}k=0;for(l=this.map.layers.length;k<l;++k){i=this.map.layers[k],i instanceof OpenLayers.Layer.Vector&&!j[i.id]&&this.triggerEvent("nofeatureclick",{layer:i})}}},onMousemove:function(h){delete this.startEvt;var i=this.getFeatures(h),j={};h=[];for(var k,l=0,m=i.length;l<m;++l){k=i[l],j[k.id]=k,this.cache[k.id]||h.push(k)}var i=[],n;for(n in this.cache){k=this.cache[n],k.layer&&k.layer.map?j[k.id]||i.push(k):delete this.cache[n]}l=0;for(m=h.length;l<m&&(k=h[l],this.cache[k.id]=k,n=this.triggerEvent("featureover",{feature:k}),!1!==n);++l){}l=0;for(m=i.length;l<m&&(k=i[l],delete this.cache[k.id],n=this.triggerEvent("featureout",{feature:k}),!1!==n);++l){}},triggerEvent:function(e,f){var g=f.feature?f.feature.layer:f.layer,h=this.target.object;if(h instanceof OpenLayers.Map||h===g){return this.target.triggerEvent(e,f)}},getFeatures:function(i){var j=i.clientX,m=i.clientY,n=[],o=[],p=[],q,r,s,t;for(t=this.map.layers.length-1;0<=t;--t){if(q=this.map.layers[t],"none"!==q.div.style.display){if(q.renderer instanceof OpenLayers.Renderer.Elements){if(q instanceof OpenLayers.Layer.Vector){for(r=document.elementFromPoint(j,m);r&&r._featureId;){(s=q.getFeatureById(r._featureId))?(n.push(s),r.style.display="none",o.push(r),r=document.elementFromPoint(j,m)):r=!1}}p.push(q);q.div.style.display="none"}else{q.renderer instanceof OpenLayers.Renderer.Canvas&&(s=q.renderer.getFeatureIdFromEvent(i))&&(n.push(s),p.push(q))}}}t=0;for(i=o.length;t<i;++t){o[t].style.display=""}for(t=p.length-1;0<=t;--t){p[t].div.style.display="block"}return n},destroy:function(){for(var b=this.provides.length-1;0<=b;--b){delete this.target.extensions[this.provides[b]]}this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this});delete this.cache;delete this.map;delete this.target}});OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick;OpenLayers.Events.featureover=OpenLayers.Events.featureclick;OpenLayers.Events.featureout=OpenLayers.Events.featureclick;OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(b){this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(i){"string"==typeof i&&(i=OpenLayers.Format.XML.prototype.read.apply(this,[i]));var j=[];if(this.extractTracks){for(var m=i.getElementsByTagName("trk"),n=0,o=m.length;n<o;n++){var p={};this.extractAttributes&&(p=this.parseAttributes(m[n]));for(var q=this.getElementsByTagNameNS(m[n],m[n].namespaceURI,"trkseg"),r=0,s=q.length;r<s;r++){var t=this.extractSegment(q[r],"trkpt");j.push(new OpenLayers.Feature.Vector(t,p))}}}if(this.extractRoutes){for(o=i.getElementsByTagName("rte"),m=0,n=o.length;m<n;m++){p={},this.extractAttributes&&(p=this.parseAttributes(o[m])),q=this.extractSegment(o[m],"rtept"),j.push(new OpenLayers.Feature.Vector(q,p))}}if(this.extractWaypoints){for(i=i.getElementsByTagName("wpt"),m=0,o=i.length;m<o;m++){p={},this.extractAttributes&&(p=this.parseAttributes(i[m])),n=new OpenLayers.Geometry.Point(i[m].getAttribute("lon"),i[m].getAttribute("lat")),j.push(new OpenLayers.Feature.Vector(n,p))}}if(this.internalProjection&&this.externalProjection){for(p=0,i=j.length;p<i;p++){j[p].geometry.transform(this.externalProjection,this.internalProjection)}}return j},extractSegment:function(g,h){for(var i=this.getElementsByTagNameNS(g,g.namespaceURI,h),j=[],k=0,l=i.length;k<l;k++){j.push(new OpenLayers.Geometry.Point(i[k].getAttribute("lon"),i[k].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(j)},parseAttributes:function(e){var f={};e=e.firstChild;for(var g,h;e;){1==e.nodeType&&e.firstChild&&(g=e.firstChild,3==g.nodeType||4==g.nodeType)&&(h=e.prefix?e.nodeName.split(":")[1]:e.nodeName,"trkseg"!=h&&"rtept"!=h&&(f[h]=g.nodeValue)),e=e.nextSibling}return f},write:function(f,g){f=OpenLayers.Util.isArray(f)?f:[f];var h=this.createElementNS(this.namespaces.gpx,"gpx");h.setAttribute("version","1.1");h.setAttribute("creator",this.creator);this.setAttributes(h,{"xsi:schemaLocation":this.schemaLocation});g&&"object"==typeof g&&h.appendChild(this.buildMetadataNode(g));for(var i=0,j=f.length;i<j;i++){h.appendChild(this.buildFeatureNode(f[i]))}return OpenLayers.Format.XML.prototype.write.apply(this,[h])},buildMetadataNode:function(g){for(var h=["name","desc","author"],i=this.createElementNS(this.namespaces.gpx,"metadata"),j=0;j<h.length;j++){var k=h[j];if(g[k]){var l=this.createElementNS(this.namespaces.gpx,k);l.appendChild(this.createTextNode(g[k]));i.appendChild(l)}}return i},buildFeatureNode:function(e){var f=e.geometry,f=f.clone();this.internalProjection&&this.externalProjection&&f.transform(this.internalProjection,this.externalProjection);if("OpenLayers.Geometry.Point"==f.CLASS_NAME){var g=this.buildWptNode(f);this.appendAttributesNode(g,e);return g}g=this.createElementNS(this.namespaces.gpx,"trk");this.appendAttributesNode(g,e);e=this.buildTrkSegNode(f);e=OpenLayers.Util.isArray(e)?e:[e];for(var f=0,h=e.length;f<h;f++){g.appendChild(e[f])}return g},buildTrkSegNode:function(f){var g,h,i,j;if("OpenLayers.Geometry.LineString"==f.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==f.CLASS_NAME){g=this.createElementNS(this.namespaces.gpx,"trkseg");h=0;for(i=f.components.length;h<i;h++){j=f.components[h],g.appendChild(this.buildTrkPtNode(j))}return g}g=[];h=0;for(i=f.components.length;h<i;h++){g.push(this.buildTrkSegNode(f.components[h]))}return g},buildTrkPtNode:function(c){var d=this.createElementNS(this.namespaces.gpx,"trkpt");d.setAttribute("lon",c.x);d.setAttribute("lat",c.y);return d},buildWptNode:function(c){var d=this.createElementNS(this.namespaces.gpx,"wpt");d.setAttribute("lon",c.x);d.setAttribute("lat",c.y);return d},appendAttributesNode:function(d,e){var f=this.createElementNS(this.namespaces.gpx,"name");f.appendChild(this.createTextNode(e.attributes.name||e.id));d.appendChild(f);f=this.createElementNS(this.namespaces.gpx,"desc");f.appendChild(this.createTextNode(e.attributes.description||this.defaultDesc));d.appendChild(f)},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(b){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[b])},read:function(i){"string"==typeof i&&(i=OpenLayers.Format.XML.prototype.read.apply(this,[i]));for(var j=i.documentElement.childNodes,l={layerDescriptions:[]},m,n,o=0;o<j.length;++o){if(m=j[o],n=m.nodeName,"LayerDescription"==n){n=m.getAttribute("name");var p="",q="",r="";m.getAttribute("owsType")?(p=m.getAttribute("owsType"),q=m.getAttribute("owsURL")):""!=m.getAttribute("wfs")?(p="WFS",q=m.getAttribute("wfs")):""!=m.getAttribute("wcs")&&(p="WCS",q=m.getAttribute("wcs"));m=m.getElementsByTagName("Query");0<m.length&&((r=m[0].getAttribute("typeName"))||(r=m[0].getAttribute("typename")));m={layerName:n,owsType:p,owsURL:q,typeName:r};l.layerDescriptions.push(m);l.length=l.layerDescriptions.length;l[l.length-1]=m}else{if("ServiceException"==n){return{error:(new OpenLayers.Format.OGCExceptionReport).read(i)}}}}return l},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"});OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1;OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(d,e,f){if(f&&f.sphericalMercator||this.sphericalMercator){f=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},f)}OpenLayers.Layer.Grid.prototype.initialize.apply(this,[d||this.name,e||this.url,{},f])},clone:function(b){null==b&&(b=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(c){c=this.getXYZ(c);var d=this.url;OpenLayers.Util.isArray(d)&&(d=this.selectUrl(""+c.x+c.y+c.z,d));return OpenLayers.String.format(d,c)},getXYZ:function(e){var f=this.getServerResolution(),g=Math.round((e.left-this.maxExtent.left)/(f*this.tileSize.w));e=Math.round((this.maxExtent.top-e.top)/(f*this.tileSize.h));f=this.getServerZoom();if(this.wrapDateLine){var h=Math.pow(2,f),g=(g%h+h)%h}return{x:g,y:e,z:f}},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(d,e,f){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(b){null==b&&(b=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(c,d){this.container=OpenLayers.Util.getElement(c);OpenLayers.Util.extend(this,d)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return !1},setExtent:function(d,e){this.extent=d.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var f=d.getWidth()/this.map.getExtent().getWidth();d=d.scale(1/f);this.extent=d.wrapDateLine(this.map.getMaxExtent()).scale(f)}e&&(this.resolution=null);return !0},setSize:function(b){this.size=b.clone();this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(h,i){null==i&&(i=h.style);if(h.geometry){var j=h.geometry.getBounds();if(j){var k;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(k=this.map.getMaxExtent());j.intersectsBounds(this.extent,{worldBounds:k})?this.calculateFeatureDx(j,k):i={display:"none"};j=this.drawGeometry(h.geometry,i,h.id);if("none"!=i.display&&i.label&&!1!==j){k=h.geometry.getCentroid();if(i.labelXOffset||i.labelYOffset){var l=isNaN(i.labelXOffset)?0:i.labelXOffset,m=isNaN(i.labelYOffset)?0:i.labelYOffset,n=this.getResolution();k.move(l*n,m*n)}this.drawText(h.id,i,k)}else{this.removeText(h.id)}return j}}},calculateFeatureDx:function(d,e){this.featureDx=0;if(e){var f=e.getWidth();this.featureDx=Math.round(((d.left+d.right)/2-(this.extent.left+this.extent.right)/2)/f)*f}},drawGeometry:function(d,e,f){},drawText:function(d,e,f){},removeText:function(b){},clear:function(){},getFeatureIdFromEvent:function(b){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var f=0,g=e.length;f<g;++f){var h=e[f];this.eraseGeometry(h.geometry,h.id);this.removeText(h.id)}},eraseGeometry:function(c,d){},moveRoot:function(b){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(c){var d=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);!1===c.stroke&&(delete d.strokeWidth,delete d.strokeColor);!1===c.fill&&delete d.fillColor;OpenLayers.Util.extend(d,c);return d},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(c,d){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return !1},eraseGeometry:function(c,d){this.eraseFeatures(this.features[d][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(c){this.size=c.clone();var d=this.root;d.style.width=c.w+"px";d.style.height=c.h+"px";d.width=c.w;d.height=c.h;this.resolution=null;this.hitDetection&&(d=this.hitCanvas,d.style.width=c.w+"px",d.style.height=c.h+"px",d.width=c.w,d.height=c.h)},drawFeature:function(e,f){var g;if(e.geometry){f=this.applyDefaultSymbolizer(f||e.style);g=e.geometry.getBounds();var h;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(h=this.map.getMaxExtent());h=g&&g.intersectsBounds(this.extent,{worldBounds:h});(g="none"!==f.display&&!!g&&h)?this.features[e.id]=[e,f]:delete this.features[e.id];this.pendingRedraw=!0}this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1);return g},drawGeometry:function(e,f,g){var h=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"==h||"OpenLayers.Geometry.MultiPoint"==h||"OpenLayers.Geometry.MultiLineString"==h||"OpenLayers.Geometry.MultiPolygon"==h){for(h=0;h<e.components.length;h++){this.drawGeometry(e.components[h],f,g)}}else{switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,f,g);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,f,g);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,f,g);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,f,g)}}},drawExternalGraphic:function(i,j,m){var n=new Image,o=j.title||j.graphicTitle;o&&(n.title=o);var p=j.graphicWidth||j.graphicHeight,q=j.graphicHeight||j.graphicWidth,p=p?p:2*j.pointRadius,q=q?q:2*j.pointRadius,r=void 0!=j.graphicXOffset?j.graphicXOffset:-(0.5*p),s=void 0!=j.graphicYOffset?j.graphicYOffset:-(0.5*q),t=j.graphicOpacity||j.fillOpacity;n.onload=OpenLayers.Function.bind(function(){if(this.features[m]){var a=this.getLocalXY(i),c=a[0],a=a[1];if(!isNaN(c)&&!isNaN(a)){var c=c+r|0,a=a+s|0,d=this.canvas;d.globalAlpha=t;var f=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);d.drawImage(n,c*f,a*f,p*f,q*f);this.hitDetection&&(this.setHitContextStyle("fill",m),this.hitContext.fillRect(c,a,p,q))}}},this);n.src=j.externalGraphic},drawNamedSymbol:function(i,j,k){var l,m,n,o;n=Math.PI/180;var p=OpenLayers.Renderer.symbol[j.graphicName];if(!p){throw Error(j.graphicName+" is not a valid symbol name")}if(!(!p.length||2>p.length||(i=this.getLocalXY(i),m=i[0],o=i[1],isNaN(m)||isNaN(o)))){this.canvas.lineCap="round";this.canvas.lineJoin="round";this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round");if(j.graphicName in this.cachedSymbolBounds){l=this.cachedSymbolBounds[j.graphicName]}else{l=new OpenLayers.Bounds;for(i=0;i<p.length;i+=2){l.extend(new OpenLayers.LonLat(p[i],p[i+1]))}this.cachedSymbolBounds[j.graphicName]=l}this.canvas.save();this.hitDetection&&this.hitContext.save();this.canvas.translate(m,o);this.hitDetection&&this.hitContext.translate(m,o);i=n*j.rotation;isNaN(i)||(this.canvas.rotate(i),this.hitDetection&&this.hitContext.rotate(i));n=2*j.pointRadius/Math.max(l.getWidth(),l.getHeight());this.canvas.scale(n,n);this.hitDetection&&this.hitContext.scale(n,n);i=l.getCenterLonLat().lon;l=l.getCenterLonLat().lat;this.canvas.translate(-i,-l);this.hitDetection&&this.hitContext.translate(-i,-l);o=j.strokeWidth;j.strokeWidth=o/n;if(!1!==j.fill){this.setCanvasStyle("fill",j);this.canvas.beginPath();for(i=0;i<p.length;i+=2){l=p[i],m=p[i+1],0==i&&this.canvas.moveTo(l,m),this.canvas.lineTo(l,m)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",k,j);this.hitContext.beginPath();for(i=0;i<p.length;i+=2){l=p[i],m=p[i+1],0==i&&this.canvas.moveTo(l,m),this.hitContext.lineTo(l,m)}this.hitContext.closePath();this.hitContext.fill()}}if(!1!==j.stroke){this.setCanvasStyle("stroke",j);this.canvas.beginPath();for(i=0;i<p.length;i+=2){l=p[i],m=p[i+1],0==i&&this.canvas.moveTo(l,m),this.canvas.lineTo(l,m)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",k,j,n);this.hitContext.beginPath();for(i=0;i<p.length;i+=2){l=p[i],m=p[i+1],0==i&&this.hitContext.moveTo(l,m),this.hitContext.lineTo(l,m)}this.hitContext.closePath();this.hitContext.stroke()}}j.strokeWidth=o;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}},setCanvasStyle:function(c,d){"fill"===c?(this.canvas.globalAlpha=d.fillOpacity,this.canvas.fillStyle=d.fillColor):"stroke"===c?(this.canvas.globalAlpha=d.strokeOpacity,this.canvas.strokeStyle=d.strokeColor,this.canvas.lineWidth=d.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(c){c=Number(c.split("_").pop())+1;16777216<=c&&(this.hitOverflow=c-16777215,c=c%16777216+1);c="000000"+c.toString(16);var d=c.length;return c="#"+c.substring(d-6,d)},setHitContextStyle:function(e,f,g,h){f=this.featureIdToHex(f);"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=f):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=f,"undefined"===typeof h?this.hitContext.lineWidth=g.strokeWidth+2:isNaN(h)||(this.hitContext.lineWidth=g.strokeWidth+2/h)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(g,h,i){if(!1!==h.graphic){if(h.externalGraphic){this.drawExternalGraphic(g,h,i)}else{if(h.graphicName&&"circle"!=h.graphicName){this.drawNamedSymbol(g,h,i)}else{var j=this.getLocalXY(g);g=j[0];j=j[1];if(!isNaN(g)&&!isNaN(j)){var k=2*Math.PI,l=h.pointRadius;!1!==h.fill&&(this.setCanvasStyle("fill",h),this.canvas.beginPath(),this.canvas.arc(g,j,l,0,k,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,h),this.hitContext.beginPath(),this.hitContext.arc(g,j,l,0,k,!0),this.hitContext.fill()));!1!==h.stroke&&(this.setCanvasStyle("stroke",h),this.canvas.beginPath(),this.canvas.arc(g,j,l,0,k,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,h),this.hitContext.beginPath(),this.hitContext.arc(g,j,l,0,k,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}}}},drawLineString:function(d,e,f){e=OpenLayers.Util.applyDefaults({fill:!1},e);this.drawLinearRing(d,e,f)},drawLinearRing:function(d,e,f){!1!==e.fill&&(this.setCanvasStyle("fill",e),this.renderPath(this.canvas,d,e,f,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",f,e),this.renderPath(this.hitContext,d,e,f,"fill")));!1!==e.stroke&&(this.setCanvasStyle("stroke",e),this.renderPath(this.canvas,d,e,f,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",f,e),this.renderPath(this.hitContext,d,e,f,"stroke")));this.setCanvasStyle("reset")},renderPath:function(g,h,i,j,k){h=h.components;i=h.length;g.beginPath();j=this.getLocalXY(h[0]);var l=j[1];if(!isNaN(j[0])&&!isNaN(l)){g.moveTo(j[0],j[1]);for(j=1;j<i;++j){l=this.getLocalXY(h[j]),g.lineTo(l[0],l[1])}"fill"===k?g.fill():g.stroke()}},drawPolygon:function(f,g,h){f=f.components;var i=f.length;this.drawLinearRing(f[0],g,h);for(var j=1;j<i;++j){this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(f[j],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},g),h),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(f[j],OpenLayers.Util.applyDefaults({fill:!1},g),h)}},drawText:function(i,j){var m=this.getLocalXY(i);this.setCanvasStyle("reset");this.canvas.fillStyle=j.fontColor;this.canvas.globalAlpha=j.fontOpacity||1;var n=[j.fontStyle?j.fontStyle:"normal","normal",j.fontWeight?j.fontWeight:"normal",j.fontSize?j.fontSize:"1em",j.fontFamily?j.fontFamily:"sans-serif"].join(" "),o=j.label.split("\n"),p=o.length;if(this.canvas.fillText){this.canvas.font=n;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[j.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[j.labelAlign[1]]||"middle";var q=OpenLayers.Renderer.Canvas.LABEL_FACTOR[j.labelAlign[1]];null==q&&(q=-0.5);n=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;m[1]+=n*q*(p-1);for(q=0;q<p;q++){j.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=j.labelOutlineOpacity||j.fontOpacity||1,this.canvas.strokeStyle=j.labelOutlineColor,this.canvas.lineWidth=j.labelOutlineWidth,this.canvas.strokeText(o[q],m[0],m[1]+n*q+1),this.canvas.restore()),this.canvas.fillText(o[q],m[0],m[1]+n*q)}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=n;var r=OpenLayers.Renderer.Canvas.LABEL_FACTOR[j.labelAlign[0]];null==r&&(r=-0.5);q=OpenLayers.Renderer.Canvas.LABEL_FACTOR[j.labelAlign[1]];null==q&&(q=-0.5);n=this.canvas.mozMeasureText("xx");m[1]+=n*(1+q*p);for(q=0;q<p;q++){var s=m[0]+r*this.canvas.mozMeasureText(o[q]),t=m[1]+q*n;this.canvas.translate(s,t);this.canvas.mozDrawText(o[q]);this.canvas.translate(-s,-t)}}}this.setCanvasStyle("reset")},getLocalXY:function(d){var e=this.getResolution(),f=this.extent;return[(d.x-this.featureDx)/e+-f.left/e,f.top/e-d.y/e]},clear:function(){var c=this.root.height,d=this.root.width;this.canvas.clearRect(0,0,d,c);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,d,c)},getFeatureIdFromEvent:function(d){var e;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(d=d.xy,d=this.hitContext.getImageData(d.x|0,d.y|0,1,1).data,255===d[3]&&(d=d[2]+256*(d[1]+256*d[0])))){d="OpenLayers_Feature_Vector_"+(d-1+this.hitOverflow);try{e=this.features[d][0]}catch(f){}}return e},eraseFeatures:function(c){OpenLayers.Util.isArray(c)||(c=[c]);for(var d=0;d<c.length;++d){delete this.features[c[d].id]}this.redraw()},redraw:function(){if(!this.locked){var g=this.root.height,h=this.root.width;this.canvas.clearRect(0,0,h,g);this.hitDetection&&this.hitContext.clearRect(0,0,h,g);var g=[],i,j,k=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),l;for(l in this.features){this.features.hasOwnProperty(l)&&(h=this.features[l][0],i=h.geometry,this.calculateFeatureDx(i.getBounds(),k),j=this.features[l][1],this.drawGeometry(i,j,h.id),j.label&&g.push([h,j]))}h=0;for(i=g.length;h<i;++h){l=g[h],this.drawText(l[0].geometry.getCentroid(),l[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(d){var e={interestingTagsExclude:"source source_ref source:ref history attribution created_by".split(" "),areaTags:"area building leisure tourism ruins historic landuse military natural sport".split(" ")},e=OpenLayers.Util.extend(e,d),f={};for(d=0;d<e.interestingTagsExclude.length;d++){f[e.interestingTagsExclude[d]]=!0}e.interestingTagsExclude=f;f={};for(d=0;d<e.areaTags.length;d++){f[e.areaTags[d]]=!0}e.areaTags=f;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(i){"string"==typeof i&&(i=OpenLayers.Format.XML.prototype.read.apply(this,[i]));var j=this.getNodes(i),m=this.getWays(i);i=Array(m.length);for(var n=0;n<m.length;n++){for(var o=Array(m[n].nodes.length),p=this.isWayArea(m[n])?1:0,q=0;q<m[n].nodes.length;q++){var r=j[m[n].nodes[q]],s=new OpenLayers.Geometry.Point(r.lon,r.lat);s.osm_id=parseInt(m[n].nodes[q]);o[q]=s;r.used=!0}r=null;r=p?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(o)):new OpenLayers.Geometry.LineString(o);this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);o=new OpenLayers.Feature.Vector(r,m[n].tags);o.osm_id=parseInt(m[n].id);o.fid="way."+o.osm_id;i[n]=o}for(var t in j){r=j[t];if(!r.used||this.checkTags){m=null;if(this.checkTags){m=this.getTags(r.node,!0);if(r.used&&!m[1]){continue}m=m[0]}else{m=this.getTags(r.node)}o=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(r.lon,r.lat),m);this.internalProjection&&this.externalProjection&&o.geometry.transform(this.externalProjection,this.internalProjection);o.osm_id=parseInt(t);o.fid="node."+o.osm_id;i.push(o)}r.node=null}return i},getNodes:function(f){f=f.getElementsByTagName("node");for(var g={},h=0;h<f.length;h++){var i=f[h],j=i.getAttribute("id");g[j]={lat:i.getAttribute("lat"),lon:i.getAttribute("lon"),node:i}}return g},getWays:function(g){g=g.getElementsByTagName("way");for(var h=[],i=0;i<g.length;i++){var j=g[i],k={id:j.getAttribute("id")};k.tags=this.getTags(j);j=j.getElementsByTagName("nd");k.nodes=Array(j.length);for(var l=0;l<j.length;l++){k.nodes[l]=j[l].getAttribute("ref")}h.push(k)}return h},getTags:function(h,i){for(var j=h.getElementsByTagName("tag"),k={},l=!1,m=0;m<j.length;m++){var n=j[m].getAttribute("k");k[n]=j[m].getAttribute("v");i&&(this.interestingTagsExclude[n]||(l=!0))}return i?[k,l]:k},isWayArea:function(e){var f=!1,g=!1;e.nodes[0]==e.nodes[e.nodes.length-1]&&(f=!0);if(this.checkTags){for(var h in e.tags){if(this.areaTags[h]){g=!0;break}}}return f&&(this.checkTags?g:!0)},write:function(f){OpenLayers.Util.isArray(f)||(f=[f]);this.osm_id=1;this.created_nodes={};var g=this.createElementNS(null,"osm");g.setAttribute("version","0.5");g.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var h=f.length-1;0<=h;h--){for(var i=this.createFeatureNodes(f[h]),j=0;j<i.length;j++){g.appendChild(i[j])}}return OpenLayers.Format.XML.prototype.write.apply(this,[g])},createFeatureNodes:function(d){var e=[],f=d.geometry.CLASS_NAME,f=f.substring(f.lastIndexOf(".")+1),f=f.toLowerCase();(f=this.createXML[f])&&(e=f.apply(this,[d]));return e},createXML:{point:function(f){var g=null,h=f.geometry?f.geometry:f;this.internalProjection&&this.externalProjection&&(h=h.clone(),h.transform(this.internalProjection,this.externalProjection));var i=!1;f.osm_id?(g=f.osm_id,this.created_nodes[g]&&(i=!0)):(g=-this.osm_id,this.osm_id++);var j=i?this.created_nodes[g]:this.createElementNS(null,"node");this.created_nodes[g]=j;j.setAttribute("id",g);j.setAttribute("lon",h.x);j.setAttribute("lat",h.y);f.attributes&&this.serializeTags(f,j);this.setState(f,j);return i?[]:[j]},linestring:function(h){var i,j=[],k=h.geometry;h.osm_id?i=h.osm_id:(i=-this.osm_id,this.osm_id++);var l=this.createElementNS(null,"way");l.setAttribute("id",i);for(i=0;i<k.components.length;i++){var m=this.createXML.point.apply(this,[k.components[i]]);if(m.length){var m=m[0],n=m.getAttribute("id");j.push(m)}else{n=k.components[i].osm_id,m=this.created_nodes[n]}this.setState(h,m);m=this.createElementNS(null,"nd");m.setAttribute("ref",n);l.appendChild(m)}this.serializeTags(h,l);j.push(l);return j},polygon:function(c){var d=OpenLayers.Util.extend({area:"yes"},c.attributes),d=new OpenLayers.Feature.Vector(c.geometry.components[0],d);d.osm_id=c.osm_id;return this.createXML.linestring.apply(this,[d])}},serializeTags:function(e,f){for(var g in e.attributes){var h=this.createElementNS(null,"tag");h.setAttribute("k",g);h.setAttribute("v",e.attributes[g]);f.appendChild(h)}},setState:function(d,e){if(d.state){var f=null;switch(d.state){case OpenLayers.State.UPDATE:case OpenLayers.State.DELETE:f="delete"}f&&e.setAttribute("action",f)}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(d,e,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var c=0,d=this.KEY_EVENTS.length;c<d;c++){OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[c],this.eventListener)}return !0}return !1},deactivate:function(){var c=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var c=0,d=this.KEY_EVENTS.length;c<d;c++){OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[c],this.eventListener)}c=!0}return c},handleKeyEvent:function(b){this.checkModifiers(b)&&this.callback(b.type,[b])},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(d,e){e=e||{};this.layer=d;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,e.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[e]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var f={documentDrag:this.documentDrag,stopDown:!1};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress}),drag:new OpenLayers.Handler.Drag(this,{down:function(b){this.vertex=null;(b=this.layer.getFeatureFromEvent(this.handlers.drag.evt))?this.dragStart(b):this.clickout&&(this._unselect=this.feature)},move:function(b){delete this._unselect;this.vertex&&this.dragVertex(this.vertex,b)},up:function(){this.handlers.drag.stopDown=!1;this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(b){this.vertex&&this.dragComplete(this.vertex)}},f)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});return this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var b=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate(),(b=this.feature)&&(b.geometry&&b.layer)&&this.unselectFeature(b),b=!0);return b},beforeSelectFeature:function(b){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:b})},selectFeature:function(c){if(!(this.feature===c||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,c.geometry.CLASS_NAME))){!1!==this.beforeSelectFeature(c)&&(this.feature&&this.unselectFeature(this.feature),this.feature=c,this.layer.selectedFeatures.push(c),this.layer.drawFeature(c,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var d=c.modified;!c.geometry||d&&d.geometry||(this._originalGeometry=c.geometry.clone())}},unselectFeature:function(b){this.layer.removeFeatures(this.vertices,{silent:!0});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:!0});this.virtualVertices=[];this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);this.layer.drawFeature(this.feature,"default");this.feature=null;OpenLayers.Util.removeItem(this.layer.selectedFeatures,b);this.onModificationEnd(b);this.layer.events.triggerEvent("afterfeaturemodified",{feature:b,modified:this.modified});this.modified=!1},dragStart:function(c){var d="OpenLayers.Geometry.Point"==c.geometry.CLASS_NAME;this.standalone||(c._sketch||!d)&&c._sketch||(this.toggle&&this.feature===c&&(this._unselect=c),this.selectFeature(c));if(c._sketch||d){this.vertex=c,this.handlers.drag.stopDown=!0}},dragVertex:function(e,f){var g=this.map.getLonLatFromViewPortPx(f),h=e.geometry;h.move(g.lon-h.x,g.lat-h.y);this.modified=!0;"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:f}):(e._index?(e.geometry.parent.addComponent(e.geometry,e._index),delete e._index,OpenLayers.Util.removeItem(this.virtualVertices,e),this.vertices.push(e)):e==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):e!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:f}),0<this.virtualVertices.length&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"));this.layer.drawFeature(e)},dragComplete:function(b){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var b=this.feature;b.modified=OpenLayers.Util.extend(b.modified,{geometry:this._originalGeometry});delete this._originalGeometry}},resetVertices:function(){0<this.vertices.length&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]);0<this.virtualVertices.length&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]);this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null);this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(c){var d=c.keyCode;this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,d)&&(d=this.layer.getFeatureFromEvent(this.handlers.drag.evt))&&(-1!=OpenLayers.Util.indexOf(this.vertices,d)&&!this.handlers.drag.dragging&&d.geometry.parent)&&(d.geometry.parent.removeComponent(d.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:d.geometry,feature:this.feature,pixel:c.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))},collectVertices:function(){function c(a){var b,h,i;if("OpenLayers.Geometry.Point"==a.CLASS_NAME){h=new OpenLayers.Feature.Vector(a),h._sketch=!0,h.renderIntent=d.vertexRenderIntent,d.vertices.push(h)}else{i=a.components.length;"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME&&(i-=1);for(b=0;b<i;++b){h=a.components[b],"OpenLayers.Geometry.Point"==h.CLASS_NAME?(h=new OpenLayers.Feature.Vector(h),h._sketch=!0,h.renderIntent=d.vertexRenderIntent,d.vertices.push(h)):c(h)}if(d.createVertices&&"OpenLayers.Geometry.MultiPoint"!=a.CLASS_NAME){for(b=0,i=a.components.length;b<i-1;++b){h=a.components[b];var j=a.components[b+1];"OpenLayers.Geometry.Point"==h.CLASS_NAME&&"OpenLayers.Geometry.Point"==j.CLASS_NAME&&(h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((h.x+j.x)/2,(h.y+j.y)/2),null,d.virtualStyle),h.geometry.parent=a,h._index=b+1,h._sketch=!0,d.virtualVertices.push(h))}}}}this.vertices=[];this.virtualVertices=[];var d=this;c.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:!0});this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var d=this.feature.geometry,e=d.getBounds().getCenterLonLat(),e=new OpenLayers.Geometry.Point(e.lon,e.lat),f=new OpenLayers.Feature.Vector(e);e.move=function(a,g){OpenLayers.Geometry.Point.prototype.move.call(this,a,g);d.move(a,g)};f._sketch=!0;this.dragHandle=f;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var h=this.feature.geometry,i=h.getBounds(),j=i.getCenterLonLat(),k=new OpenLayers.Geometry.Point(j.lon,j.lat),i=new OpenLayers.Geometry.Point(i.right,i.bottom),j=new OpenLayers.Feature.Vector(i),l=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,m=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,n=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;i.move=function(a,d){OpenLayers.Geometry.Point.prototype.move.call(this,a,d);var e=this.x-k.x,f=this.y-k.y,g=e-a,o=f-d;if(n){var s=Math.atan2(o,g),s=Math.atan2(f,e)-s,s=s*(180/Math.PI);h.rotate(s,k)}if(l){var t;m?(f/=o,t=e/g/f):(g=Math.sqrt(g*g+o*o),f=Math.sqrt(e*e+f*f)/g);h.resize(f,k,t)}};j._sketch=!0;this.radiusHandle=j;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(b){this.handlers.drag.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(b){"removelayer"!=b.type&&"order"!=b.property||this.moveLayerToTop()},moveLayerToTop:function(){var b=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(b)},moveLayerBack:function(){var b=this.layer.getZIndex()-1;b>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(b):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.969809570313,2445.984904785156,1222.992452392578,611.4962261962891,305.7481130981445,152.8740565490723,76.43702827453613,38.21851413726807,19.10925706863403,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.2985821416974068,0.1492910708487034,0.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(b){b=OpenLayers.Util.applyDefaults({sphericalMercator:!0},b);OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[b.name||"Bing "+(b.type||this.type),null,b]);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var c=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),c=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(c),d=document.createElement("script");d.type="text/javascript";d.src=c;d.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(d)},initLayer:function(){var d=this.metadata.resourceSets[0].resources[0],e=d.imageUrl.replace("{quadkey}","${quadkey}"),e=e.replace("{culture}",this.culture),e=e.replace(this.protocolRegex,this.protocol);this.url=[];for(var f=0;f<d.imageUrlSubdomains.length;++f){this.url.push(e.replace("{subdomain}",d.imageUrlSubdomains[f]))}this.addOptions({maxResolution:Math.min(this.serverResolutions[d.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(d.zoomMax+1-d.zoomMin,this.numZoomLevels)},!0);this.isBaseLayer||this.redraw();this.updateAttribution()},getURL:function(h){if(this.url){var i=this.getXYZ(h);h=i.x;for(var j=i.y,i=i.z,k=[],l=i;0<l;--l){var m="0",n=1<<l-1;0!=(h&n)&&m++;0!=(j&n)&&(m++,m++);k.push(m)}k=k.join("");h=this.selectUrl(""+h+j+i,this.url);return OpenLayers.String.format(h,{quadkey:k})}},updateAttribution:function(){var i=this.metadata;if(i.resourceSets&&this.map&&this.map.center){var j=i.resourceSets[0].resources[0],o=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),p=j.imageryProviders||[],q=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),j="",r,s,t,u,v,w,x;s=0;for(t=p.length;s<t;++s){for(r=p[s],u=0,v=r.coverageAreas.length;u<v;++u){x=r.coverageAreas[u],w=OpenLayers.Bounds.fromArray(x.bbox,!0),o.intersectsBounds(w)&&(q<=x.zoomMax&&q>=x.zoomMin)&&(j+=r.attribution+" ")}}i=i.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:i,copyrights:j});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.updateAttribution)},clone:function(b){null==b&&(b=new OpenLayers.Layer.Bing(this.options));return b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"});OpenLayers.Layer.Bing.processMetadata=function(b){this.metadata=b;this.initLayer();b=document.getElementById(this._callbackId);b.parentNode.removeChild(b);window[this._callbackId]=void 0;delete this._callbackId};OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(d,e){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(d instanceof OpenLayers.Style){this.styles["default"]=d,this.styles.select=d,this.styles.temporary=d,this.styles["delete"]=d}else{if("object"==typeof d){for(var f in d){if(d[f] instanceof OpenLayers.Style){this.styles[f]=d[f]}else{if("object"==typeof d[f]){this.styles[f]=new OpenLayers.Style(d[f])}else{this.styles["default"]=new OpenLayers.Style(d);this.styles.select=new OpenLayers.Style(d);this.styles.temporary=new OpenLayers.Style(d);this.styles["delete"]=new OpenLayers.Style(d);break}}}}}OpenLayers.Util.extend(this,e)},destroy:function(){for(var b in this.styles){this.styles[b].destroy()}this.styles=null},createSymbolizer:function(d,e){d||(d=new OpenLayers.Feature.Vector);this.styles[e]||(e="default");d.renderIntent=e;var f={};this.extendDefault&&"default"!=e&&(f=this.styles["default"].createSymbolizer(d));return OpenLayers.Util.extend(f,this.styles[e].createSymbolizer(d))},addUniqueValueRules:function(g,h,i,j){var k=[],l;for(l in i){k.push(new OpenLayers.Rule({symbolizer:i[l],context:j,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:h,value:l})}))}this.styles[g].addRules(k)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(e,f){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.renderer&&this.renderer.supported()||this.assignRenderer();this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError());this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var g=0,h=this.strategies.length;g<h;g++){this.strategies[g].setLayer(this)}}},destroy:function(){if(this.strategies){var d,e,f;e=0;for(f=this.strategies.length;e<f;e++){d=this.strategies[e],d.autoDestroy&&d.destroy()}this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null);this.destroyFeatures();this.unrenderedFeatures=this.selectedFeatures=this.features=null;this.renderer&&this.renderer.destroy();this.drawn=this.geometryType=this.renderer=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(f){null==f&&(f=new OpenLayers.Layer.Vector(this.name,this.getOptions()));f=OpenLayers.Layer.prototype.clone.apply(this,[f]);for(var g=this.features,h=g.length,i=Array(h),j=0;j<h;++j){i[j]=g[j].clone()}f.features=i;return f},refresh:function(b){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",b)},assignRenderer:function(){for(var d=0,e=this.renderers.length;d<e;d++){var f=this.renderers[d];if((f="function"==typeof f?f:OpenLayers.Renderer[f])&&f.prototype.supported()){this.renderer=new f(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(c){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(this.renderer){this.renderer.map=this.map;var d=this.map.getSize();d.w*=this.ratio;d.h*=this.ratio;this.renderer.setSize(d)}else{this.map.removeLayer(this)}},afterAdd:function(){if(this.strategies){var d,e,f;e=0;for(f=this.strategies.length;e<f;e++){d=this.strategies[e],d.autoActivate&&d.activate()}}},removeMap:function(d){this.drawn=!1;if(this.strategies){var e,f;e=0;for(f=this.strategies.length;e<f;e++){d=this.strategies[e],d.autoActivate&&d.deactivate()}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var b=this.map.getSize();b.w*=this.ratio;b.h*=this.ratio;this.renderer.setSize(b)},moveTo:function(g,h,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var j=!0;if(!i){this.renderer.root.style.visibility="hidden";var j=this.map.getSize(),k=j.w,j=j.h,k=k/2*this.ratio-k/2,j=j/2*this.ratio-j/2,k=k+this.map.layerContainerOriginPx.x,k=-Math.round(k),j=j+this.map.layerContainerOriginPx.y,j=-Math.round(j);this.div.style.left=k+"px";this.div.style.top=j+"px";k=this.map.getExtent().scale(this.ratio);j=this.renderer.setExtent(k,h);this.renderer.root.style.visibility="visible";!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft);if(!h&&j){for(var l in this.unrenderedFeatures){k=this.unrenderedFeatures[l],this.drawFeature(k)}}}if(!this.drawn||h||!j){for(this.drawn=!0,l=0,j=this.features.length;l<j;l++){this.renderer.locked=l!==j-1,k=this.features[l],this.drawFeature(k)}}},display:function(c){OpenLayers.Layer.prototype.display.apply(this,arguments);var d=this.div.style.display;d!=this.renderer.root.style.display&&(this.renderer.root.style.display=d)},addFeatures:function(h,i){OpenLayers.Util.isArray(h)||(h=[h]);var j=!i||!i.silent;if(j){var k={features:h};if(!1===this.events.triggerEvent("beforefeaturesadded",k)){return}h=k.features}for(var k=[],l=0,m=h.length;l<m;l++){this.renderer.locked=l!=h.length-1?!0:!1;var n=h[l];if(this.geometryType&&!(n.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)}n.layer=this;!n.style&&this.style&&(n.style=OpenLayers.Util.extend({},this.style));if(j){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:n})){continue}this.preFeatureInsert(n)}k.push(n);this.features.push(n);this.drawFeature(n);j&&(this.events.triggerEvent("featureadded",{feature:n}),this.onFeatureInsert(n))}j&&this.events.triggerEvent("featuresadded",{features:k})},removeFeatures:function(f,g){if(f&&0!==f.length){if(f===this.features){return this.removeAllFeatures(g)}OpenLayers.Util.isArray(f)||(f=[f]);f===this.selectedFeatures&&(f=f.slice());var h=!g||!g.silent;h&&this.events.triggerEvent("beforefeaturesremoved",{features:f});for(var i=f.length-1;0<=i;i--){this.renderer.locked=0!=i&&f[i-1].geometry?!0:!1;var j=f[i];delete this.unrenderedFeatures[j.id];h&&this.events.triggerEvent("beforefeatureremoved",{feature:j});this.features=OpenLayers.Util.removeItem(this.features,j);j.layer=null;j.geometry&&this.renderer.eraseFeatures(j);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,j)&&OpenLayers.Util.removeItem(this.selectedFeatures,j);h&&this.events.triggerEvent("featureremoved",{feature:j})}h&&this.events.triggerEvent("featuresremoved",{features:f})}},removeAllFeatures:function(e){e=!e||!e.silent;var f=this.features;e&&this.events.triggerEvent("beforefeaturesremoved",{features:f});for(var g,h=f.length-1;0<=h;h--){g=f[h],e&&this.events.triggerEvent("beforefeatureremoved",{feature:g}),g.layer=null,e&&this.events.triggerEvent("featureremoved",{feature:g})}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];e&&this.events.triggerEvent("featuresremoved",{features:f})},destroyFeatures:function(d,e){void 0==d&&(d=this.features);if(d){this.removeFeatures(d,e);for(var f=d.length-1;0<=f;f--){d[f].destroy()}}},drawFeature:function(d,e){if(this.drawn){if("object"!=typeof e){e||d.state!==OpenLayers.State.DELETE||(e="delete");var f=e||d.renderIntent;(e=d.style||this.style)||(e=this.styleMap.createSymbolizer(d,f))}f=this.renderer.drawFeature(d,e);!1===f||null===f?this.unrenderedFeatures[d.id]=d:delete this.unrenderedFeatures[d.id]}},eraseFeatures:function(b){this.renderer.eraseFeatures(b)},getFeatureFromEvent:function(c){if(!this.renderer){throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.")}var d=null;(c=this.renderer.getFeatureIdFromEvent(c))&&(d="string"===typeof c?this.getFeatureById(c):c);return d},getFeatureBy:function(f,g){for(var h=null,i=0,j=this.features.length;i<j;++i){if(this.features[i][f]==g){h=this.features[i];break}}return h},getFeatureById:function(b){return this.getFeatureBy("id",b)},getFeatureByFid:function(b){return this.getFeatureBy("fid",b)},getFeaturesByAttribute:function(g,h){var i,j,k=this.features.length,l=[];for(i=0;i<k;i++){(j=this.features[i])&&j.attributes&&j.attributes[g]===h&&l.push(j)}return l},onFeatureInsert:function(b){},preFeatureInsert:function(b){},getDataExtent:function(){var f=null,g=this.features;if(g&&0<g.length){for(var h=null,i=0,j=g.length;i<j;i++){if(h=g[i].geometry){null===f&&(f=new OpenLayers.Bounds),f.extend(h.getBounds())}}}return f},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(b){b=b||{};OpenLayers.Layer.Vector.prototype.initialize.apply(this,[b.name,b])},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);b.events.register("moveend",this,this.onMoveEnd)},removeMap:function(b){b.events.unregister("moveend",this,this.onMoveEnd);OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(b){this.ratio=b;this.updateGrid(!0)},setMaxFeatures:function(b){this.maxFeatures=b;this.updateGrid(!0)},setSpacing:function(c,d){this.dx=c;this.dy=d||c;this.updateGrid(!0)},setOrigin:function(b){this.origin=b;this.updateGrid(!0)},getOrigin:function(){this.origin||(this.origin=this.map.getExtent().getCenterLonLat());return this.origin},setRotation:function(b){this.rotation=b;this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var c=this.map.getExtent();if(this.rotation){var d=this.getOrigin(),d=new OpenLayers.Geometry.Point(d.lon,d.lat),c=c.toGeometry();c.rotate(-this.rotation,d);c=c.getBounds()}return c},updateGrid:function(i){if(i||this.invalidBounds()){var j=this.getViewBounds(),m=this.getOrigin();i=new OpenLayers.Geometry.Point(m.lon,m.lat);var n=j.getWidth(),o=j.getHeight(),p=n/o,q=Math.sqrt(this.dx*this.dy*this.maxFeatures/p),n=Math.min(n*this.ratio,q*p),o=Math.min(o*this.ratio,q),j=j.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(j.lon-n/2,j.lat-o/2,j.lon+n/2,j.lat+o/2);for(var j=Math.floor(o/this.dy),n=Math.floor(n/this.dx),o=m.lon+this.dx*Math.ceil((this.gridBounds.left-m.lon)/this.dx),m=m.lat+this.dy*Math.ceil((this.gridBounds.bottom-m.lat)/this.dy),q=Array(j*n),r,s=0;s<n;++s){for(var p=o+s*this.dx,t=0;t<j;++t){r=m+t*this.dy,r=new OpenLayers.Geometry.Point(p,r),this.rotation&&r.rotate(this.rotation,i),q[s*j+t]=new OpenLayers.Feature.Vector(r)}}this.destroyFeatures(this.features,{silent:!0});this.addFeatures(q,{silent:!0})}},invalidBounds:function(){return !this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(d,e,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(i){if(this.map&&this.checkModifiers(i)){for(var j=!1,m=!1,n=!1,o=OpenLayers.Event.element(i);null!=o&&!n&&!j;){if(!j){try{var p,j=(p=o.currentStyle?o.currentStyle.overflow:document.defaultView.getComputedStyle(o,null).getPropertyValue("overflow"))&&"auto"==p||"scroll"==p}catch(q){}}if(!m&&(m=OpenLayers.Element.hasClass(o,"olScrollable"),!m)){for(var n=0,r=this.map.layers.length;n<r;n++){var s=this.map.layers[n];if(o==s.div||o==s.pane){m=!0;break}}}n=o==this.map.div;o=o.parentNode}if(!j&&n){if(m){if(j=0,i.wheelDelta?(j=i.wheelDelta,0===j%160&&(j*=0.75),j/=120):i.detail&&(j=-(i.detail/Math.abs(i.detail))),this.delta+=j,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var t=OpenLayers.Util.extend({},i);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(t)},this),this.interval)}else{this.wheelZoom(i)}}OpenLayers.Event.stop(i)}}},wheelZoom:function(c){var d=this.delta;this.delta=0;d&&(c.xy=this.map.events.getMousePosition(c),0>d?this.callback("down",[c,this.cumulative?Math.max(-this.maxDelta,d):-1]):this.callback("up",[c,this.cumulative?Math.min(this.maxDelta,d):1]))},activate:function(c){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var d=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",d);OpenLayers.Event.observe(window,"mousewheel",d);OpenLayers.Event.observe(document,"mousewheel",d);return !0}return !1},deactivate:function(c){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var d=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",d);OpenLayers.Event.stopObserving(window,"mousewheel",d);OpenLayers.Event.stopObserving(document,"mousewheel",d);return !0}return !1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(b){OpenLayers.Util.extend(this,b)},clone:function(){return new (eval(this.CLASS_NAME))(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(b){this.symbolizer={};OpenLayers.Util.extend(this,b);this.symbolizers&&delete this.symbolizer;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var b in this.symbolizer){this.symbolizer[b]=null}this.symbolizer=null;delete this.symbolizers},evaluate:function(e){var f=this.getContext(e),g=!0;if(this.minScaleDenominator||this.maxScaleDenominator){var h=e.layer.map.getScale()}this.minScaleDenominator&&(g=h>=OpenLayers.Style.createLiteral(this.minScaleDenominator,f));g&&this.maxScaleDenominator&&(g=h<OpenLayers.Style.createLiteral(this.maxScaleDenominator,f));g&&this.filter&&(g="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(e):this.filter.evaluate(f));return g},getContext:function(c){var d=this.context;d||(d=c.attributes||c.data);"function"==typeof this.context&&(d=this.context(c));return d},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.symbolizers){var f=this.symbolizers.length;e.symbolizers=Array(f);for(var g=0;g<f;++g){e.symbolizers[g]=this.symbolizers[g].clone()}}else{e.symbolizer={};for(var h in this.symbolizer){f=this.symbolizer[h],g=typeof f,"object"===g?e.symbolizer[h]=OpenLayers.Util.extend({},f):"string"===g&&(e.symbolizer[h]=f)}}e.filter=this.filter&&this.filter.clone();e.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(e)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(d,e){var f={};this.readChildNodes(d,f);e.outer=f.components[0]},innerBoundaryIs:function(d,e){var f={};this.readChildNodes(d,f);e.inner.push(f.components[0])},Box:function(e,f){var g={};this.readChildNodes(e,g);f.components||(f.components=[]);var h=g.points[0],g=g.points[1];f.components.push(new OpenLayers.Bounds(h.x,h.y,g.x,g.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(c){var d;d=OpenLayers.Util.isArray(c)?"wfs:FeatureCollection":"gml:featureMember";c=this.writeNode(d,c);this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(c){var d=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[c],d);return d},coordinates:function(f){for(var g=f.length,h=Array(g),i,j=0;j<g;++j){i=f[j],h[j]=this.xy?i.x+","+i.y:i.y+","+i.x,void 0!=i.z&&(h[j]+=","+i.z)}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==g?h[0]:h.join(" ")})},LineString:function(c){var d=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",c.components,d);return d},Polygon:function(d){var e=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",d.components[0],e);for(var f=1;f<d.components.length;++f){this.writeNode("innerBoundaryIs",d.components[f],e)}return e},outerBoundaryIs:function(c){var d=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",c,d);return d},innerBoundaryIs:function(c){var d=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",c,d);return d},LinearRing:function(c){var d=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",c.components,d);return d},Box:function(c){var d=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:c.left,y:c.bottom},{x:c.right,y:c.top}],d);this.srsName&&d.setAttribute("srsName",this.srsName);return d}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[b])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(d,e){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsNotEqualTo:function(d,e){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(d,f);e.filters.push(f)},PropertyIsLike:function(g,h){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(g,i);var j=g.getAttribute("wildCard"),k=g.getAttribute("singleChar"),l=g.getAttribute("escape");i.value2regex(j,k,l);h.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(c){var d=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",c,d);this.writeOgcExpression(c.value,d);return d},PropertyIsNotEqualTo:function(c){var d=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",c,d);this.writeOgcExpression(c.value,d);return d},PropertyIsLike:function(c){var d=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",c,d);this.writeNode("Literal",c.regex2value(),d);return d},BBOX:function(d){var e=this.createElementNSPlus("ogc:BBOX");d.property&&this.writeNode("PropertyName",d,e);var f=this.writeNode("gml:Box",d.value,e);d.projection&&f.setAttribute("srsName",d.projection);return e}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,f){var g=this.createElementNSPlus("ogc:"+f);this.writeNode("PropertyName",e,g);if(e.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",e.value,g)}else{var h;h=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value);e.projection&&h.setAttribute("srsName",e.projection);g.appendChild(h)}return g},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(b){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[b]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[b])},readNode:function(d,e,f){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(c,d){d.insertIds=[];d.success=!1;this.readChildNodes(c,d)},InsertResult:function(d,e){var f={fids:[]};this.readChildNodes(d,f);e.insertIds=e.insertIds.concat(f.fids)},TransactionResult:function(c,d){this.readChildNodes(c,d)},Status:function(c,d){this.readChildNodes(c,d)},SUCCESS:function(c,d){d.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e);var f=e.featurePrefix,g=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(f?f+":":"")+e.featureType}});e.srsNameInQuery&&e.srsName&&g.setAttribute("srsName",e.srsName);e.featureNS&&g.setAttribute("xmlns:"+f,e.featureNS);if(e.propertyNames){for(var f=0,h=e.propertyNames.length;f<h;f++){this.writeNode("ogc:PropertyName",{property:e.propertyNames[f]},g)}}e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,g));return g}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(b){this.compare=b?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(f){this.exists(f)&&this.remove(f);var g=f.id;this.determineZIndex(f);for(var h=-1,i=this.order.length,j;1<i-h;){j=parseInt((h+i)/2),0<this.compare(this,f,OpenLayers.Util.getElement(this.order[j]))?h=j:i=j}this.order.splice(i,0,g);this.indices[g]=this.getZIndex(f);return this.getNextElement(i)},remove:function(c){c=c.id;var d=OpenLayers.Util.indexOf(this.order,c);0<=d&&(this.order.splice(d,1),delete this.indices[c],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(b){return null!=this.indices[b.id]},getZIndex:function(b){return b._style.graphicZIndex},determineZIndex:function(c){var d=c._style.graphicZIndex;null==d?(d=this.maxZIndex,c._style.graphicZIndex=d):d>this.maxZIndex&&(this.maxZIndex=d)},getNextElement:function(c){c+=1;if(c<this.order.length){var d=OpenLayers.Util.getElement(this.order[c]);void 0==d&&(d=this.getNextElement(c));return d}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,f,g){f=e.getZIndex(f);var h=0;g&&(e=e.getZIndex(g),h=f-e);return h},Z_ORDER_DRAWING_ORDER:function(d,e,f){d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(d,e,f);f&&0==d&&(d=1);return d},Z_ORDER_Y_ORDER:function(d,e,f){d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(d,e,f);f&&0===d&&(e=f._boundsBottom-e._boundsBottom,d=0===e?1:e);return d}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(c,d){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);d&&(d.zIndexing||d.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(d.yOrdering))},destroy:function(){this.clear();this.xmlns=this.root=this.rendererRoot=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var c,d=this.vectorRoot;if(d){for(;c=d.firstChild;){d.removeChild(c)}}if(d=this.textRoot){for(;c=d.firstChild;){d.removeChild(c)}}this.indexer&&this.indexer.clear()},setExtent:function(g,h){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),j=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var k,l=g.getWidth()/this.map.getExtent().getWidth();g=g.scale(1/l);l=this.map.getMaxExtent();l.right>g.left&&l.right<g.right?k=!0:l.left>g.left&&l.left<g.right&&(k=!1);if(k!==this.rightOfDateLine||h){i=!1,this.xOffset=!0===k?l.getWidth()/j:0}this.rightOfDateLine=k}return i},getNodeType:function(c,d){},drawGeometry:function(g,h,i){var j=g.CLASS_NAME,k=!0;if("OpenLayers.Geometry.Collection"==j||"OpenLayers.Geometry.MultiPoint"==j||"OpenLayers.Geometry.MultiLineString"==j||"OpenLayers.Geometry.MultiPolygon"==j){for(var j=0,l=g.components.length;j<l;j++){k=this.drawGeometry(g.components[j],h,i)&&k}return k}j=k=!1;"none"!=h.display&&(h.backgroundGraphic?this.redrawBackgroundNode(g.id,g,h,i):j=!0,k=this.redrawNode(g.id,g,h,i));!1==k&&(h=document.getElementById(g.id))&&(h._style.backgroundGraphic&&(j=!0),h.parentNode.removeChild(h));j&&(h=document.getElementById(g.id+this.BACKGROUND_ID_SUFFIX))&&h.parentNode.removeChild(h);return k},redrawNode:function(e,f,g,h){g=this.applyDefaultSymbolizer(g);e=this.nodeFactory(e,this.getNodeType(f,g));e._featureId=h;e._boundsBottom=f.getBounds().bottom;e._geometryClass=f.CLASS_NAME;e._style=g;f=this.drawGeometryNode(e,f,g);if(!1===f){return !1}e=f.node;this.indexer?(g=this.indexer.insert(e))?this.vectorRoot.insertBefore(e,g):this.vectorRoot.appendChild(e):e.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(e);this.postDraw(e);return f.complete},redrawBackgroundNode:function(e,f,g,h){g=OpenLayers.Util.extend({},g);g.externalGraphic=g.backgroundGraphic;g.graphicXOffset=g.backgroundXOffset;g.graphicYOffset=g.backgroundYOffset;g.graphicZIndex=g.backgroundGraphicZIndex;g.graphicWidth=g.backgroundWidth||g.graphicWidth;g.graphicHeight=g.backgroundHeight||g.graphicHeight;g.backgroundGraphic=null;g.backgroundXOffset=null;g.backgroundYOffset=null;g.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,f,g,null)},drawGeometryNode:function(f,g,h){h=h||f._style;var i={isFilled:void 0===h.fill?!0:h.fill,isStroked:void 0===h.stroke?!!h.strokeWidth:h.stroke},j;switch(g.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===h.graphic&&(i.isFilled=!1,i.isStroked=!1);j=this.drawPoint(f,g);break;case"OpenLayers.Geometry.LineString":i.isFilled=!1;j=this.drawLineString(f,g);break;case"OpenLayers.Geometry.LinearRing":j=this.drawLinearRing(f,g);break;case"OpenLayers.Geometry.Polygon":j=this.drawPolygon(f,g);break;case"OpenLayers.Geometry.Rectangle":j=this.drawRectangle(f,g)}f._options=i;return !1!=j?{node:this.setStyle(f,h,i,g),complete:j}:!1},postDraw:function(b){},drawPoint:function(c,d){},drawLineString:function(c,d){},drawLinearRing:function(c,d){},drawPolygon:function(c,d){},drawRectangle:function(c,d){},drawCircle:function(c,d){},removeText:function(c){var d=document.getElementById(c+this.LABEL_ID_SUFFIX);d&&this.textRoot.removeChild(d);(c=document.getElementById(c+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(c)},getFeatureIdFromEvent:function(d){var e=d.target,f=e&&e.correspondingUseElement;return(f?f:e||d.srcElement)._featureId},eraseGeometry:function(e,f){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME){for(var g=0,h=e.components.length;g<h;g++){this.eraseGeometry(e.components[g],f)}}else{(g=OpenLayers.Util.getElement(e.id))&&g.parentNode&&(g.geometry&&(g.geometry.destroy(),g.geometry=null),g.parentNode.removeChild(g),this.indexer&&this.indexer.remove(g),g._style.backgroundGraphic&&(g=OpenLayers.Util.getElement(e.id+this.BACKGROUND_ID_SUFFIX))&&g.parentNode&&g.parentNode.removeChild(g))}},nodeFactory:function(d,e){var f=OpenLayers.Util.getElement(d);f?this.nodeTypeCompare(f,e)||(f.parentNode.removeChild(f),f=this.nodeFactory(d,e)):f=this.createNode(e,d);return f},nodeTypeCompare:function(c,d){},createNode:function(c,d){},moveRoot:function(c){var d=this.root;c.root.parentNode==this.rendererRoot&&(d=c.root);d.parentNode.removeChild(d);c.rendererRoot.appendChild(d)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(b){return"circle"!=b&&!!b},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(d){d=d||window.location.href;var e=OpenLayers.Util.getParameters(d),f=d.indexOf("#");0<f&&(d="?"+d.substring(f+1,d.length),OpenLayers.Util.extend(e,OpenLayers.Util.getParameters(d)));return e},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var f=0,g=this.map.controls.length;f<g;f++){var h=this.map.controls[f];if(h!=this&&"OpenLayers.Control.ArgParser"==h.CLASS_NAME){h.displayProjection!=this.displayProjection&&(this.displayProjection=h.displayProjection);break}}f==this.map.controls.length&&(f=this.getParameters(),f.layers&&(this.layers=f.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),f.lat&&f.lon&&(this.center=new OpenLayers.LonLat(parseFloat(f.lon),parseFloat(f.lat)),f.zoom&&(this.zoom=parseFloat(f.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter()))},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var e=0,f=this.layers.length;e<f;e++){var g=this.map.layers[e],h=this.layers.charAt(e);"B"==h?this.map.setBaseLayer(g):"T"!=h&&"F"!=h||g.setVisibility("T"==h)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(d,e,f){null===d||"object"!=typeof d||OpenLayers.Util.isElement(d)?(OpenLayers.Control.prototype.initialize.apply(this,[f]),this.element=OpenLayers.Util.getElement(d),this.base=e||document.location.href):(this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[d]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null);this.map&&this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var f=0,g=this.map.controls.length;f<g;f++){var h=this.map.controls[f];if(h.CLASS_NAME==this.argParserClass.CLASS_NAME){h.displayProjection!=this.displayProjection&&(this.displayProjection=h.displayProjection);break}}f==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element));this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var d=this.anchor?"#":"?",e=this.base,f=null;-1!=e.indexOf("#")&&!1==this.anchor&&(f=e.substring(e.indexOf("#"),e.length));-1!=e.indexOf(d)&&(e=e.substring(0,e.indexOf(d)));e=e.split("#")[0]+d+OpenLayers.Util.getParameterString(this.createParams());f&&(e+=f);this.anchor&&!this.element?window.location.href=e:this.element.href=e},createParams:function(f,g,h){f=f||this.map.getCenter();var i=OpenLayers.Util.getParameters(this.base);if(f){for(i.zoom=g||this.map.getZoom(),g=f.lat,f=f.lon,this.displayProjection&&(g=OpenLayers.Projection.transform({x:f,y:g},this.map.getProjectionObject(),this.displayProjection),f=g.x,g=g.y),i.lat=Math.round(100000*g)/100000,i.lon=Math.round(100000*f)/100000,h=h||this.map.layers,i.layers="",f=0,g=h.length;f<g;f++){var j=h[f];i.layers=j.isBaseLayer?i.layers+(j==this.map.baseLayer?"B":"0"):i.layers+(j.getVisibility()?"T":"F")}}return i},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,f,g){var h=[];h.push(e,f,{},g);OpenLayers.Layer.Grid.prototype.initialize.apply(this,h)},clone:function(b){null==b&&(b=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(d){d=this.adjustBounds(d);var e=this.getServerResolution(),f=Math.round((d.left-this.tileOrigin.lon)/(e*this.tileSize.w));d=Math.round((d.bottom-this.tileOrigin.lat)/(e*this.tileSize.h));e=this.getServerZoom();f=this.serviceVersion+"/"+this.layername+"/"+e+"/"+f+"/"+d+"."+this.type;d=this.url;OpenLayers.Util.isArray(d)&&(d=this.selectUrl(f,d));return d+f},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WCSCapabilities"});OpenLayers.Format.WCSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,splitSpace:/\s+/},defaultPrefix:"wcs",read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);return d},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1"});OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"service",readers:{wcs:{WCS_Capabilities:function(c,d){this.readChildNodes(c,d)},Service:function(c,d){d.service={};this.readChildNodes(c,d.service)},name:function(c,d){d.name=this.getChildValue(c)},label:function(c,d){d.label=this.getChildValue(c)},keywords:function(c,d){d.keywords=[];this.readChildNodes(c,d.keywords)},keyword:function(c,d){d.push(this.getChildValue(c))},responsibleParty:function(c,d){d.responsibleParty={};this.readChildNodes(c,d.responsibleParty)},individualName:function(c,d){d.individualName=this.getChildValue(c)},organisationName:function(c,d){d.organisationName=this.getChildValue(c)},positionName:function(c,d){d.positionName=this.getChildValue(c)},contactInfo:function(c,d){d.contactInfo={};this.readChildNodes(c,d.contactInfo)},phone:function(c,d){d.phone={};this.readChildNodes(c,d.phone)},voice:function(c,d){d.voice=this.getChildValue(c)},facsimile:function(c,d){d.facsimile=this.getChildValue(c)},address:function(c,d){d.address={};this.readChildNodes(c,d.address)},deliveryPoint:function(c,d){d.deliveryPoint=this.getChildValue(c)},city:function(c,d){d.city=this.getChildValue(c)},postalCode:function(c,d){d.postalCode=this.getChildValue(c)},country:function(c,d){d.country=this.getChildValue(c)},electronicMailAddress:function(c,d){d.electronicMailAddress=this.getChildValue(c)},fees:function(c,d){d.fees=this.getChildValue(c)},accessConstraints:function(c,d){d.accessConstraints=this.getChildValue(c)},ContentMetadata:function(c,d){d.contentMetadata=[];this.readChildNodes(c,d.contentMetadata)},CoverageOfferingBrief:function(d,e){var f={};this.readChildNodes(d,f);e.push(f)},name:function(c,d){d.name=this.getChildValue(c)},label:function(c,d){d.label=this.getChildValue(c)},lonLatEnvelope:function(f,g){var h=this.getElementsByTagNameNS(f,"http://www.opengis.net/gml","pos");if(2==h.length){var i={},j={};OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[h[0],i]);OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[h[1],j]);g.lonLatEnvelope={};g.lonLatEnvelope.srsName=f.getAttribute("srsName");g.lonLatEnvelope.min=i.points[0];g.lonLatEnvelope.max=j.points[0]}}}},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_0_0"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var b=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(b){if(this.layer.events.on({refresh:this.load,scope:this}),!0==this.layer.visibility||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this});return b},load:function(c){var d=this.layer;d.events.triggerEvent("loadstart",{filter:d.filter});d.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:d.filter,scope:this},c));d.events.un({visibilitychanged:this.load,scope:this})},merge:function(i){var j=this.layer;j.destroyFeatures();var k=i.features;if(k&&0<k.length){var l=j.projection,m=j.map.getProjectionObject();if(!m.equals(l)){for(var n,o=0,p=k.length;o<p;++o){(n=k[o].geometry)&&n.transform(l,m)}}j.addFeatures(k)}j.events.triggerEvent("loadend",{response:i})},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"\u2212",zoomOutId:"olZoomOutLink",draw:function(){var e=OpenLayers.Control.prototype.draw.apply(this),f=this.getOrCreateLinks(e),g=f.zoomIn,f=f.zoomOut,h=this.map.events;f.parentNode!==e&&(h=this.events,h.attachToElement(f.parentNode));h.register("buttonclick",this,this.onZoomClick);this.zoomInLink=g;this.zoomOutLink=f;return e},getOrCreateLinks:function(d){var e=document.getElementById(this.zoomInId),f=document.getElementById(this.zoomOutId);e||(e=document.createElement("a"),e.href="#zoomIn",e.appendChild(document.createTextNode(this.zoomInText)),e.className="olControlZoomIn",d.appendChild(e));OpenLayers.Element.addClass(e,"olButton");f||(f=document.createElement("a"),f.href="#zoomOut",f.appendChild(document.createTextNode(this.zoomOutText)),f.className="olControlZoomOut",d.appendChild(f));OpenLayers.Element.addClass(f,"olButton");return{zoomIn:e,zoomOut:f}},onZoomClick:function(b){b=b.buttonElement;b===this.zoomInLink?this.map.zoomIn():b===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick);delete this.zoomInLink;delete this.zoomOutLink;OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(i,j){if(2>i.length){throw Error("At least two point features have to be added to create a line from")}for(var l=Array(i.length-1),m,n,o,p=0,q=i.length;p<q;p++){m=i[p];o=m.geometry;if(!o){o=m.lonlat,o=new OpenLayers.Geometry.Point(o.lon,o.lat)}else{if("OpenLayers.Geometry.Point"!=o.CLASS_NAME){throw new TypeError("Only features with point geometries are supported.")}}if(0<p){m=null!=this.dataFrom?i[p+this.dataFrom].data||i[p+this.dataFrom].attributes:null;var r=null!=this.styleFrom?i[p+this.styleFrom].style:null;n=new OpenLayers.Geometry.LineString([n,o]);l[p-1]=new OpenLayers.Feature.Vector(n,m,r)}n=o}this.addFeatures(l,j)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.SOURCE_NODE=-1;OpenLayers.Layer.PointTrack.TARGET_NODE=0;OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Protocol.WFS=function(c){c=OpenLayers.Util.applyDefaults(c,OpenLayers.Protocol.WFS.DEFAULTS);var d=OpenLayers.Protocol.WFS["v"+c.version.replace(/\./g,"_")];if(!d){throw"Unsupported WFS version: "+c.version}return new d(c)};OpenLayers.Protocol.WFS.fromWMSLayer=function(e,f){var g,h;g=e.params.LAYERS;g=(OpenLayers.Util.isArray(g)?g[0]:g).split(":");1<g.length&&(h=g[0]);g=g.pop();h={url:e.url,featureType:g,featurePrefix:h,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(f,h))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(c,d){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(c){if(c!=this.opacity){this.opacity=c;c=0;for(var d=this.markers.length;c<d;c++){this.markers[c].setOpacity(this.opacity)}}},moveTo:function(f,g,h){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(g||!this.drawn){for(var i=0,j=this.markers.length;i<j;i++){this.drawMarker(this.markers[i])}this.drawn=!0}},addMarker:function(b){this.markers.push(b);1>this.opacity&&b.setOpacity(this.opacity);this.map&&this.map.getExtent()&&(b.map=this.map,this.drawMarker(b))},removeMarker:function(b){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,b),b.erase())},clearMarkers:function(){if(null!=this.markers){for(;0<this.markers.length;){this.removeMarker(this.markers[0])}}},drawMarker:function(c){var d=this.map.getLayerPxFromLonLat(c.lonlat);null==d?c.display(!1):c.isDrawn()?c.icon&&c.icon.moveTo(d):(c=c.draw(d),this.div.appendChild(c))},getDataExtent:function(){var d=null;if(this.markers&&0<this.markers.length){for(var d=new OpenLayers.Bounds,e=0,f=this.markers.length;e<f;e++){d.extend(this.markers[e].lonlat)}}return d},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(c,d){this.direction=c;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[d])},trigger:function(){if(this.map){var b=OpenLayers.Function.bind(function(c){return this.slideRatio?this.map.getSize()[c]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-b("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,b("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-b("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(b("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Format.CSWGetDomain=function(c){c=OpenLayers.Util.applyDefaults(c,OpenLayers.Format.CSWGetDomain.DEFAULTS);var d=OpenLayers.Format.CSWGetDomain["v"+c.version.replace(/\./g,"_")];if(!d){throw"Unsupported CSWGetDomain version: "+c.version}return new d(c)};OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"};OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);return d},readers:{csw:{GetDomainResponse:function(c,d){this.readChildNodes(c,d)},DomainValues:function(g,h){OpenLayers.Util.isArray(h.DomainValues)||(h.DomainValues=[]);for(var i=g.attributes,j={},k=0,l=i.length;k<l;++k){j[i[k].name]=i[k].nodeValue}this.readChildNodes(g,j);h.DomainValues.push(j)},PropertyName:function(c,d){d.PropertyName=this.getChildValue(c)},ParameterName:function(c,d){d.ParameterName=this.getChildValue(c)},ListOfValues:function(c,d){OpenLayers.Util.isArray(d.ListOfValues)||(d.ListOfValues=[]);this.readChildNodes(c,d.ListOfValues)},Value:function(g,h){for(var i=g.attributes,j={},k=0,l=i.length;k<l;++k){j[i[k].name]=i[k].nodeValue}j.value=this.getChildValue(g);h.push({Value:j})},ConceptualScheme:function(c,d){d.ConceptualScheme={};this.readChildNodes(c,d.ConceptualScheme)},Name:function(c,d){d.Name=this.getChildValue(c)},Document:function(c,d){d.Document=this.getChildValue(c)},Authority:function(c,d){d.Authority=this.getChildValue(c)},RangeOfValues:function(c,d){d.RangeOfValues={};this.readChildNodes(c,d.RangeOfValues)},MinValue:function(g,h){for(var i=g.attributes,j={},k=0,l=i.length;k<l;++k){j[i[k].name]=i[k].nodeValue}j.value=this.getChildValue(g);h.MinValue=j},MaxValue:function(g,h){for(var i=g.attributes,j={},k=0,l=i.length;k<l;++k){j[i[k].name]=i[k].nodeValue}j.value=this.getChildValue(g);h.MaxValue=j}}},write:function(b){b=this.writeNode("csw:GetDomain",b);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetDomain:function(c){var d=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});c.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",c.PropertyName||this.PropertyName,d):(c.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",c.ParameterName||this.ParameterName,d);this.readChildNodes(d,c);return d},PropertyName:function(b){return this.createElementNSPlus("csw:PropertyName",{value:b})},ParameterName:function(b){return this.createElementNSPlus("csw:ParameterName",{value:b})}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(b){return(new OpenLayers.Format.ArcXML).read(b).features.feature}});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.options=b||{};this.options.layer&&this.setLayer(this.options.layer);b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS);this.setTargets(this.options.targets);0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer);this.geoToleranceCache={}},setLayer:function(b){this.active?(this.deactivate(),this.layer=b,this.activate()):this.layer=b},setTargets:function(e){this.targets=[];if(e&&e.length){for(var f,g=0,h=e.length;g<h;++g){f=e[g],f instanceof OpenLayers.Layer.Vector?this.addTargetLayer(f):this.addTarget(f)}}},addTargetLayer:function(b){this.addTarget({layer:b})},addTarget:function(b){b=OpenLayers.Util.applyDefaults(b,this.defaults);b.nodeTolerance=b.nodeTolerance||b.tolerance;b.vertexTolerance=b.vertexTolerance||b.tolerance;b.edgeTolerance=b.edgeTolerance||b.tolerance;this.targets.push(b)},removeTargetLayer:function(d){for(var e,f=this.targets.length-1;0<=f;--f){e=this.targets[f],e.layer===d&&this.removeTarget(e)}},removeTarget:function(b){return OpenLayers.Util.removeItem(this.targets,b)},activate:function(){var b=OpenLayers.Control.prototype.activate.call(this);if(b&&this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.call(this);b&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this});this.point=this.feature=null;return b},onSketchModified:function(b){this.feature=b.feature;this.considerSnapping(b.vertex,b.vertex)},onVertexModified:function(c){this.feature=c.feature;var d=this.layer.map.getLonLatFromViewPortPx(c.pixel);this.considerSnapping(c.vertex,new OpenLayers.Geometry.Point(d.lon,d.lat))},considerSnapping:function(i,j){for(var k={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},l=!1,m,n,o=0,p=this.targets.length;o<p;++o){if(n=this.targets[o],m=this.testTarget(n,j)){if(this.greedy){k=m;k.target=n;l=!0;break}else{if(m.rank<k.rank||m.rank===k.rank&&m.dist<k.dist){k=m,k.target=n,l=!0}}}}l&&(!1!==this.events.triggerEvent("beforesnap",{point:i,x:k.x,y:k.y,distance:k.dist,layer:k.target.layer,snapType:this.precedence[k.rank]})?(i.x=k.x,i.y=k.y,this.point=i,this.events.triggerEvent("snap",{point:i,snapType:this.precedence[k.rank],layer:k.target.layer,distance:k.dist})):l=!1);this.point&&!l&&(i.x=j.x,i.y=j.y,this.point=null,this.events.triggerEvent("unsnap",{point:i}))},testTarget:function(i,j){var o=this.layer.map.getResolution();if("minResolution" in i&&o<i.minResolution||"maxResolution" in i&&o>=i.maxResolution){return null}for(var o={node:this.getGeoTolerance(i.nodeTolerance,o),vertex:this.getGeoTolerance(i.vertexTolerance,o),edge:this.getGeoTolerance(i.edgeTolerance,o)},y=Math.max(o.node,o.vertex,o.edge),z={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},A=!1,B=i.layer.features,C,D,E,F,G,H,I=this.precedence.length,J=new OpenLayers.LonLat(j.x,j.y),K=0,L=B.length;K<L;++K){if(C=B[K],C!==this.feature&&(!C._sketch&&C.state!==OpenLayers.State.DELETE&&(!i.filter||i.filter.evaluate(C)))&&C.atPoint(J,y,y)){for(var M=0,N=Math.min(z.rank+1,I);M<N;++M){if(D=this.precedence[M],i[D]){if("edge"===D){if(E=C.geometry.distanceTo(j,{details:!0}),G=E.distance,G<=o[D]&&G<z.dist){z={rank:M,dist:G,x:E.x0,y:E.y0};A=!0;break}}else{E=C.geometry.getVertices("node"===D);H=!1;for(var O=0,P=E.length;O<P;++O){F=E[O],G=F.distanceTo(j),G<=o[D]&&(M<z.rank||M===z.rank&&G<z.dist)&&(z={rank:M,dist:G,x:F.x,y:F.y},H=A=!0)}if(H){break}}}}}}return A?z:null},getGeoTolerance:function(d,e){e!==this.resolution&&(this.resolution=e,this.geoToleranceCache={});var f=this.geoToleranceCache[d];void 0===f&&(f=d*e,this.geoToleranceCache[d]=f);return f},destroy:function(){this.active&&this.deactivate();delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(c,d){d.exceptionReport={version:c.getAttribute("version"),language:c.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(c,d.exceptionReport)},AllowedValues:function(c,d){d.allowedValues={};this.readChildNodes(c,d.allowedValues)},AnyValue:function(c,d){d.anyValue=!0},DataType:function(c,d){d.dataType=this.getChildValue(c)},Range:function(c,d){d.range={};this.readChildNodes(c,d.range)},MinimumValue:function(c,d){d.minValue=this.getChildValue(c)},MaximumValue:function(c,d){d.maxValue=this.getChildValue(c)},Identifier:function(c,d){d.identifier=this.getChildValue(c)},SupportedCRS:function(c,d){d.supportedCRS=this.getChildValue(c)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(c){var d=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":c.closure}});this.writeNode("ows:MinimumValue",c.minValue,d);this.writeNode("ows:MaximumValue",c.maxValue,d);return d},MinimumValue:function(b){return this.createElementNSPlus("ows:MinimumValue",{value:b})},MaximumValue:function(b){return this.createElementNSPlus("ows:MaximumValue",{value:b})},Value:function(b){return this.createElementNSPlus("ows:Value",{value:b})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(b){b=this.writeNode("wcs:GetCoverage",b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wcs:{GetCoverage:function(c){var d=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:c.version||this.VERSION,service:"WCS"}});this.writeNode("ows:Identifier",c.identifier,d);this.writeNode("wcs:DomainSubset",c.domainSubset,d);this.writeNode("wcs:Output",c.output,d);return d},DomainSubset:function(c){var d=this.createElementNSPlus("wcs:DomainSubset",{});this.writeNode("ows:BoundingBox",c.boundingBox,d);c.temporalSubset&&this.writeNode("wcs:TemporalSubset",c.temporalSubset,d);return d},TemporalSubset:function(e){for(var f=this.createElementNSPlus("wcs:TemporalSubset",{}),g=0,h=e.timePeriods.length;g<h;++g){this.writeNode("wcs:TimePeriod",e.timePeriods[g],f)}return f},TimePeriod:function(c){var d=this.createElementNSPlus("wcs:TimePeriod",{});this.writeNode("wcs:BeginPosition",c.begin,d);this.writeNode("wcs:EndPosition",c.end,d);c.resolution&&this.writeNode("wcs:TimeResolution",c.resolution,d);return d},BeginPosition:function(b){return this.createElementNSPlus("wcs:BeginPosition",{value:b})},EndPosition:function(b){return this.createElementNSPlus("wcs:EndPosition",{value:b})},TimeResolution:function(b){return this.createElementNSPlus("wcs:TimeResolution",{value:b})},Output:function(c){var d=this.createElementNSPlus("wcs:Output",{attributes:{format:c.format,store:c.store}});c.gridCRS&&this.writeNode("wcs:GridCRS",c.gridCRS,d);return d},GridCRS:function(c){var d=this.createElementNSPlus("wcs:GridCRS",{});this.writeNode("wcs:GridBaseCRS",c.baseCRS,d);c.type&&this.writeNode("wcs:GridType",c.type,d);c.origin&&this.writeNode("wcs:GridOrigin",c.origin,d);this.writeNode("wcs:GridOffsets",c.offsets,d);c.CS&&this.writeNode("wcs:GridCS",c.CS,d);return d},GridBaseCRS:function(b){return this.createElementNSPlus("wcs:GridBaseCRS",{value:b})},GridOrigin:function(b){return this.createElementNSPlus("wcs:GridOrigin",{value:b})},GridType:function(b){return this.createElementNSPlus("wcs:GridType",{value:b})},GridOffsets:function(b){return this.createElementNSPlus("wcs:GridOffsets",{value:b})},GridCS:function(b){return this.createElementNSPlus("wcs:GridCS",{value:b})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"});OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(b){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(b){this.features=[];this.styles={};this.fetched={};return this.parseData(b,{depth:0,styleBaseUrl:this.styleBaseUrl})},parseData:function(h,i){"string"==typeof h&&(h=OpenLayers.Format.XML.prototype.read.apply(this,[h]));for(var j=["Link","NetworkLink","Style","StyleMap","Placemark"],k=0,l=j.length;k<l;++k){var m=j[k],n=this.getElementsByTagNameNS(h,"*",m);if(0!=n.length){switch(m.toLowerCase()){case"link":case"networklink":this.parseLinks(n,i);break;case"style":this.extractStyles&&this.parseStyles(n,i);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(n,i);break;case"placemark":this.parseFeatures(n,i)}}}return this.features},parseLinks:function(g,h){if(h.depth>=this.maxDepth){return !1}var i=OpenLayers.Util.extend({},h);i.depth++;for(var j=0,k=g.length;j<k;j++){var l=this.parseProperty(g[j],"*","href");l&&!this.fetched[l]&&(this.fetched[l]=!0,(l=this.fetchLink(l))&&this.parseData(l,i))}},fetchLink:function(b){if(b=OpenLayers.Request.GET({url:b,async:!1})){return b.responseText}},parseStyles:function(f,g){for(var h=0,i=f.length;h<i;h++){var j=this.parseStyle(f[h]);j&&(this.styles[(g.styleBaseUrl||"")+"#"+j.id]=j)}},parseKmlColor:function(c){var d=null;c&&(c=c.match(this.regExes.kmlColor))&&(d={color:"#"+c[4]+c[3]+c[2],opacity:parseInt(c[1],16)/255});return d},parseStyle:function(i){for(var j={},o=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],q,r,s=0,t=o.length;s<t;++s){if(q=o[s],r=this.getElementsByTagNameNS(i,"*",q)[0]){switch(q.toLowerCase()){case"linestyle":q=this.parseProperty(r,"*","color");if(q=this.parseKmlColor(q)){j.strokeColor=q.color,j.strokeOpacity=q.opacity}(q=this.parseProperty(r,"*","width"))&&(j.strokeWidth=q);break;case"polystyle":q=this.parseProperty(r,"*","color");if(q=this.parseKmlColor(q)){j.fillOpacity=q.opacity,j.fillColor=q.color}"0"==this.parseProperty(r,"*","fill")&&(j.fillColor="none");"0"==this.parseProperty(r,"*","outline")&&(j.strokeWidth="0");break;case"iconstyle":var u=parseFloat(this.parseProperty(r,"*","scale")||1);q=32*u;var v=32*u,w=this.getElementsByTagNameNS(r,"*","Icon")[0];if(w){var x=this.parseProperty(w,"*","href");if(x){var y=this.parseProperty(w,"*","w"),z=this.parseProperty(w,"*","h");!OpenLayers.String.startsWith(x,"http://maps.google.com/mapfiles/kml")||(y||z)||(z=y=64,u/=2);y=y||z;z=z||y;y&&(q=parseInt(y)*u);z&&(v=parseInt(z)*u);if(z=x.match(this.regExes.kmlIconPalette)){y=z[1],z=z[2],x=this.parseProperty(w,"*","x"),w=this.parseProperty(w,"*","y"),x="http://maps.google.com/mapfiles/kml/pal"+y+"/icon"+(8*(w?7-w/32:7)+(x?x/32:0))+z}j.graphicOpacity=1;j.externalGraphic=x}}if(r=this.getElementsByTagNameNS(r,"*","hotSpot")[0]){x=parseFloat(r.getAttribute("x")),w=parseFloat(r.getAttribute("y")),y=r.getAttribute("xunits"),"pixels"==y?j.graphicXOffset=-x*u:"insetPixels"==y?j.graphicXOffset=-q+x*u:"fraction"==y&&(j.graphicXOffset=-q*x),r=r.getAttribute("yunits"),"pixels"==r?j.graphicYOffset=-v+w*u+1:"insetPixels"==r?j.graphicYOffset=-(w*u)+1:"fraction"==r&&(j.graphicYOffset=-v*(1-w)+1)}j.graphicWidth=q;j.graphicHeight=v;break;case"balloonstyle":(r=OpenLayers.Util.getXmlNodeValue(r))&&(j.balloonStyle=r.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":if(q=this.parseProperty(r,"*","color"),q=this.parseKmlColor(q)){j.fontColor=q.color,j.fontOpacity=q.opacity}}}}!j.strokeColor&&j.fillColor&&(j.strokeColor=j.fillColor);(i=i.getAttribute("id"))&&j&&(j.id=i);return j},parseStyleMaps:function(i,j){for(var m=0,n=i.length;m<n;m++){for(var o=i[m],p=this.getElementsByTagNameNS(o,"*","Pair"),o=o.getAttribute("id"),q=0,r=p.length;q<r;q++){var s=p[q],t=this.parseProperty(s,"*","key");(s=this.parseProperty(s,"*","styleUrl"))&&"normal"==t&&(this.styles[(j.styleBaseUrl||"")+"#"+o]=this.styles[(j.styleBaseUrl||"")+s])}}},parseFeatures:function(i,j){for(var k=[],l=0,m=i.length;l<m;l++){var n=i[l],o=this.parseFeature.apply(this,[n]);if(o){this.extractStyles&&(o.attributes&&o.attributes.styleUrl)&&(o.style=this.getStyle(o.attributes.styleUrl,j));if(this.extractStyles){var p=this.getElementsByTagNameNS(n,"*","Style")[0];p&&(p=this.parseStyle(p))&&(o.style=OpenLayers.Util.extend(o.style,p))}this.extractTracks?(n=this.getElementsByTagNameNS(n,this.namespaces.gx,"Track"))&&0<n.length&&(o={features:[],feature:o},this.readNode(n[0],o),0<o.features.length&&k.push.apply(k,o.features)):k.push(o)}else{throw"Bad Placemark: "+l}}this.features=this.features.concat(k)},readers:{kml:{when:function(c,d){d.whens.push(OpenLayers.Date.parse(this.getChildValue(c)))},_trackPointAttribute:function(d,e){var f=d.nodeName.split(":").pop();e.attributes[f].push(this.getChildValue(d))}},gx:{Track:function(i,j){var m={whens:[],points:[],angles:[]};if(this.trackAttributes){var n;m.attributes={};for(var o=0,p=this.trackAttributes.length;o<p;++o){n=this.trackAttributes[o],m.attributes[n]=[],n in this.readers.kml||(this.readers.kml[n]=this.readers.kml._trackPointAttribute)}}this.readChildNodes(i,m);if(m.whens.length!==m.points.length){throw Error("gx:Track with unequal number of when ("+m.whens.length+") and gx:coord ("+m.points.length+") elements.")}var q=0<m.angles.length;if(q&&m.whens.length!==m.angles.length){throw Error("gx:Track with unequal number of when ("+m.whens.length+") and gx:angles ("+m.angles.length+") elements.")}for(var r,o=0,p=m.whens.length;o<p;++o){r=j.feature.clone();r.fid=j.feature.fid||j.feature.id;n=m.points[o];r.geometry=n;"z" in n&&(r.attributes.altitude=n.z);this.internalProjection&&this.externalProjection&&r.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes){for(var s=0,t=this.trackAttributes.length;s<t;++s){n=this.trackAttributes[s],r.attributes[n]=m.attributes[n][o]}}r.attributes.when=m.whens[o];r.attributes.trackId=j.feature.id;q&&(n=m.angles[o],r.attributes.heading=parseFloat(n[0]),r.attributes.tilt=parseFloat(n[1]),r.attributes.roll=parseFloat(n[2]));j.features.push(r)}},coord:function(e,f){var g=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/),h=new OpenLayers.Geometry.Point(g[0],g[1]);2<g.length&&(h.z=parseFloat(g[2]));f.points.push(h)},angles:function(d,e){var f=this.getChildValue(d).replace(this.regExes.trimSpace,"").split(/\s+/);e.angles.push(f)}}},parseFeature:function(i){for(var j=["MultiGeometry","Polygon","LineString","Point"],k,l,m,n=0,o=j.length;n<o;++n){if(k=j[n],this.internalns=i.namespaceURI?i.namespaceURI:this.kmlns,l=this.getElementsByTagNameNS(i,this.internalns,k),0<l.length){if(j=this.parseGeometry[k.toLowerCase()]){m=j.apply(this,[l[0]]),this.internalProjection&&this.externalProjection&&m.transform(this.externalProjection,this.internalProjection)}else{throw new TypeError("Unsupported geometry type: "+k)}break}}var p;this.extractAttributes&&(p=this.parseAttributes(i));k=new OpenLayers.Feature.Vector(m,p);i=i.getAttribute("id")||i.getAttribute("name");null!=i&&(k.fid=i);return k},getStyle:function(e,f){var g=OpenLayers.Util.removeTail(e),h=OpenLayers.Util.extend({},f);h.depth++;h.styleBaseUrl=g;!this.styles[e]&&!OpenLayers.String.startsWith(e,"#")&&h.depth<=this.maxDepth&&!this.fetched[g]&&(g=this.fetchLink(g))&&this.parseData(g,h);return OpenLayers.Util.extend({},this.styles[e])},parseGeometry:{point:function(d){var e=this.getElementsByTagNameNS(d,this.internalns,"coordinates");d=[];if(0<e.length){var f=e[0].firstChild.nodeValue,f=f.replace(this.regExes.removeSpace,"");d=f.split(",")}e=null;if(1<d.length){2==d.length&&(d[2]=null),e=new OpenLayers.Geometry.Point(d[0],d[1],d[2])}else{throw"Bad coordinate string: "+f}return e},linestring:function(i,j){var l=this.getElementsByTagNameNS(i,this.internalns,"coordinates"),m=null;if(0<l.length){for(var l=this.getChildValue(l[0]),l=l.replace(this.regExes.trimSpace,""),l=l.replace(this.regExes.trimComma,","),m=l.split(this.regExes.splitSpace),n=m.length,o=Array(n),p,q,r=0;r<n;++r){if(p=m[r].split(","),q=p.length,1<q){2==p.length&&(p[2]=null),o[r]=new OpenLayers.Geometry.Point(p[0],p[1],p[2])}else{throw"Bad LineString point coordinates: "+m[r]}}if(n){m=j?new OpenLayers.Geometry.LinearRing(o):new OpenLayers.Geometry.LineString(o)}else{throw"Bad LineString coordinates: "+l}}return m},polygon:function(f){f=this.getElementsByTagNameNS(f,this.internalns,"LinearRing");var g=f.length,h=Array(g);if(0<g){for(var i=0,j=f.length;i<j;++i){if(g=this.parseGeometry.linestring.apply(this,[f[i],!0])){h[i]=g}else{throw"Bad LinearRing geometry: "+i}}}return new OpenLayers.Geometry.Polygon(h)},multigeometry:function(g){for(var h,i=[],j=g.childNodes,k=0,l=j.length;k<l;++k){g=j[k],1==g.nodeType&&(h=g.prefix?g.nodeName.split(":")[1]:g.nodeName,(h=this.parseGeometry[h.toLowerCase()])&&i.push(h.apply(this,[g])))}return new OpenLayers.Geometry.Collection(i)}},parseAttributes:function(h){var i={},j=h.getElementsByTagName("ExtendedData");j.length&&(i=this.parseExtendedData(j[0]));var k,l,m;h=h.childNodes;for(var j=0,n=h.length;j<n;++j){if(k=h[j],1==k.nodeType&&(l=k.childNodes,1<=l.length&&3>=l.length)){switch(l.length){case 1:m=l[0];break;case 2:m=l[0];l=l[1];m=3==m.nodeType||4==m.nodeType?m:l;break;default:m=l[1]}if(3==m.nodeType||4==m.nodeType){if(k=k.prefix?k.nodeName.split(":")[1]:k.nodeName,m=OpenLayers.Util.getXmlNodeValue(m)){m=m.replace(this.regExes.trimSpace,""),i[k]=m}}}}return i},parseExtendedData:function(i){var j={},l,m,n,o,p=i.getElementsByTagName("Data");l=0;for(m=p.length;l<m;l++){n=p[l];o=n.getAttribute("name");var q={},r=n.getElementsByTagName("value");r.length&&(q.value=this.getChildValue(r[0]));this.kvpAttributes?j[o]=q.value:(n=n.getElementsByTagName("displayName"),n.length&&(q.displayName=this.getChildValue(n[0])),j[o]=q)}i=i.getElementsByTagName("SimpleData");l=0;for(m=i.length;l<m;l++){q={},n=i[l],o=n.getAttribute("name"),q.value=this.getChildValue(n),this.kvpAttributes?j[o]=q.value:(q.displayName=o,j[o]=q)}return j},parseProperty:function(f,g,h){var i;f=this.getElementsByTagNameNS(f,g,h);try{i=OpenLayers.Util.getXmlNodeValue(f[0])}catch(j){i=null}return i},write:function(f){OpenLayers.Util.isArray(f)||(f=[f]);for(var g=this.createElementNS(this.kmlns,"kml"),h=this.createFolderXML(),i=0,j=f.length;i<j;++i){h.appendChild(this.createPlacemarkXML(f[i]))}g.appendChild(h);return OpenLayers.Format.XML.prototype.write.apply(this,[g])},createFolderXML:function(){var d=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var e=this.createElementNS(this.kmlns,"name"),f=this.createTextNode(this.foldersName);e.appendChild(f);d.appendChild(e)}this.foldersDesc&&(e=this.createElementNS(this.kmlns,"description"),f=this.createTextNode(this.foldersDesc),e.appendChild(f),d.appendChild(e));return d},createPlacemarkXML:function(e){var f=this.createElementNS(this.kmlns,"name"),g=e.style&&e.style.label?e.style.label:e.id;f.appendChild(this.createTextNode(e.attributes.name||g));var h=this.createElementNS(this.kmlns,"description");h.appendChild(this.createTextNode(e.attributes.description||this.placemarksDesc));g=this.createElementNS(this.kmlns,"Placemark");null!=e.fid&&g.setAttribute("id",e.fid);g.appendChild(f);g.appendChild(h);f=this.buildGeometryNode(e.geometry);g.appendChild(f);e.attributes&&(e=this.buildExtendedData(e.attributes))&&g.appendChild(e);return g},buildGeometryNode:function(d){var e=d.CLASS_NAME,e=e.substring(e.lastIndexOf(".")+1),e=this.buildGeometry[e.toLowerCase()],f=null;e&&(f=e.apply(this,[d]));return f},buildGeometry:{point:function(c){var d=this.createElementNS(this.kmlns,"Point");d.appendChild(this.buildCoordinatesNode(c));return d},multipoint:function(b){return this.buildGeometry.collection.apply(this,[b])},linestring:function(c){var d=this.createElementNS(this.kmlns,"LineString");d.appendChild(this.buildCoordinatesNode(c));return d},multilinestring:function(b){return this.buildGeometry.collection.apply(this,[b])},linearring:function(c){var d=this.createElementNS(this.kmlns,"LinearRing");d.appendChild(this.buildCoordinatesNode(c));return d},polygon:function(g){var h=this.createElementNS(this.kmlns,"Polygon");g=g.components;for(var i,j,k=0,l=g.length;k<l;++k){i=0==k?"outerBoundaryIs":"innerBoundaryIs",i=this.createElementNS(this.kmlns,i),j=this.buildGeometry.linearring.apply(this,[g[k]]),i.appendChild(j),h.appendChild(i)}return h},multipolygon:function(b){return this.buildGeometry.collection.apply(this,[b])},collection:function(f){for(var g=this.createElementNS(this.kmlns,"MultiGeometry"),h,i=0,j=f.components.length;i<j;++i){(h=this.buildGeometryNode.apply(this,[f.components[i]]))&&g.appendChild(h)}return g}},buildCoordinatesNode:function(g){var h=this.createElementNS(this.kmlns,"coordinates"),i;if(i=g.components){for(var j=i.length,k=Array(j),l=0;l<j;++l){g=i[l],k[l]=this.buildCoordinates(g)}i=k.join(" ")}else{i=this.buildCoordinates(g)}i=this.createTextNode(i);h.appendChild(i);return h},buildCoordinates:function(b){this.internalProjection&&this.externalProjection&&(b=b.clone(),b.transform(this.internalProjection,this.externalProjection));return b.x+","+b.y},buildExtendedData:function(g){var h=this.createElementNS(this.kmlns,"ExtendedData"),i;for(i in g){if(g[i]&&"name"!=i&&"description"!=i&&"styleUrl"!=i){var j=this.createElementNS(this.kmlns,"Data");j.setAttribute("name",i);var k=this.createElementNS(this.kmlns,"value");if("object"==typeof g[i]){if(g[i].value&&k.appendChild(this.createTextNode(g[i].value)),g[i].displayName){var l=this.createElementNS(this.kmlns,"displayName");l.appendChild(this.getXMLDoc().createCDATASection(g[i].displayName));j.appendChild(l)}}else{k.appendChild(this.createTextNode(g[i]))}j.appendChild(k);h.appendChild(j)}}return this.isSimpleContent(h)?null:h},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));var e=d;d&&9==d.nodeType&&(d=d.documentElement);var f={};this.readNode(d,f);void 0===f.service&&(d=new OpenLayers.Format.OGCExceptionReport,f.error=d.read(e));return f},readers:{wms:{Service:function(c,d){d.service={};this.readChildNodes(c,d.service)},Name:function(c,d){d.name=this.getChildValue(c)},Title:function(c,d){d.title=this.getChildValue(c)},Abstract:function(c,d){d["abstract"]=this.getChildValue(c)},BoundingBox:function(e,f){var g={};g.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var h={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};isNaN(h.x)&&isNaN(h.y)||(g.res=h);return g},OnlineResource:function(c,d){d.href=this.getAttributeNS(c,this.namespaces.xlink,"href")},ContactInformation:function(c,d){d.contactInformation={};this.readChildNodes(c,d.contactInformation)},ContactPersonPrimary:function(c,d){d.personPrimary={};this.readChildNodes(c,d.personPrimary)},ContactPerson:function(c,d){d.person=this.getChildValue(c)},ContactOrganization:function(c,d){d.organization=this.getChildValue(c)},ContactPosition:function(c,d){d.position=this.getChildValue(c)},ContactAddress:function(c,d){d.contactAddress={};this.readChildNodes(c,d.contactAddress)},AddressType:function(c,d){d.type=this.getChildValue(c)},Address:function(c,d){d.address=this.getChildValue(c)},City:function(c,d){d.city=this.getChildValue(c)},StateOrProvince:function(c,d){d.stateOrProvince=this.getChildValue(c)},PostCode:function(c,d){d.postcode=this.getChildValue(c)},Country:function(c,d){d.country=this.getChildValue(c)},ContactVoiceTelephone:function(c,d){d.phone=this.getChildValue(c)},ContactFacsimileTelephone:function(c,d){d.fax=this.getChildValue(c)},ContactElectronicMailAddress:function(c,d){d.email=this.getChildValue(c)},Fees:function(d,e){var f=this.getChildValue(d);f&&"none"!=f.toLowerCase()&&(e.fees=f)},AccessConstraints:function(d,e){var f=this.getChildValue(d);f&&"none"!=f.toLowerCase()&&(e.accessConstraints=f)},Capability:function(c,d){d.capability={nestedLayers:[],layers:[]};this.readChildNodes(c,d.capability)},Request:function(c,d){d.request={};this.readChildNodes(c,d.request)},GetCapabilities:function(c,d){d.getcapabilities={formats:[]};this.readChildNodes(c,d.getcapabilities)},Format:function(c,d){OpenLayers.Util.isArray(d.formats)?d.formats.push(this.getChildValue(c)):d.format=this.getChildValue(c)},DCPType:function(c,d){this.readChildNodes(c,d)},HTTP:function(c,d){this.readChildNodes(c,d)},Get:function(c,d){d.get={};this.readChildNodes(c,d.get);d.href||(d.href=d.get.href)},Post:function(c,d){d.post={};this.readChildNodes(c,d.post);d.href||(d.href=d.get.href)},GetMap:function(c,d){d.getmap={formats:[]};this.readChildNodes(c,d.getmap)},GetFeatureInfo:function(c,d){d.getfeatureinfo={formats:[]};this.readChildNodes(c,d.getfeatureinfo)},Exception:function(c,d){d.exception={formats:[]};this.readChildNodes(c,d.exception)},Layer:function(i,j){var o,p;j.capability?(p=j.capability,o=j):p=j;var q=i.getAttributeNode("queryable"),r=q&&q.specified?i.getAttribute("queryable"):null,s=(q=i.getAttributeNode("cascaded"))&&q.specified?i.getAttribute("cascaded"):null,q=(q=i.getAttributeNode("opaque"))&&q.specified?i.getAttribute("opaque"):null,t=i.getAttribute("noSubsets"),u=i.getAttribute("fixedWidth"),v=i.getAttribute("fixedHeight"),w=o||{},x=OpenLayers.Util.extend;o={nestedLayers:[],styles:o?[].concat(o.styles):[],srs:o?x({},w.srs):{},metadataURLs:[],bbox:o?x({},w.bbox):{},llbbox:w.llbbox,dimensions:o?x({},w.dimensions):{},authorityURLs:o?x({},w.authorityURLs):{},identifiers:{},keywords:[],queryable:r&&""!==r?"1"===r||"true"===r:w.queryable||!1,cascaded:null!==s?parseInt(s):w.cascaded||0,opaque:q?"1"===q||"true"===q:w.opaque||!1,noSubsets:null!==t?"1"===t||"true"===t:w.noSubsets||!1,fixedWidth:null!=u?parseInt(u):w.fixedWidth||0,fixedHeight:null!=v?parseInt(v):w.fixedHeight||0,minScale:w.minScale,maxScale:w.maxScale,attribution:w.attribution};j.nestedLayers.push(o);o.capability=p;this.readChildNodes(i,o);delete o.capability;o.name&&(r=o.name.split(":"),s=p.request,q=s.getfeatureinfo,0<r.length&&(o.prefix=r[0]),p.layers.push(o),void 0===o.formats&&(o.formats=s.getmap.formats),void 0===o.infoFormats&&q&&(o.infoFormats=q.formats))},Attribution:function(c,d){d.attribution={};this.readChildNodes(c,d.attribution)},LogoURL:function(c,d){d.logo={width:c.getAttribute("width"),height:c.getAttribute("height")};this.readChildNodes(c,d.logo)},Style:function(d,e){var f={};e.styles.push(f);this.readChildNodes(d,f)},LegendURL:function(d,e){var f={width:d.getAttribute("width"),height:d.getAttribute("height")};e.legend=f;this.readChildNodes(d,f)},MetadataURL:function(d,e){var f={type:d.getAttribute("type")};e.metadataURLs.push(f);this.readChildNodes(d,f)},DataURL:function(c,d){d.dataURL={};this.readChildNodes(c,d.dataURL)},FeatureListURL:function(c,d){d.featureListURL={};this.readChildNodes(c,d.featureListURL)},AuthorityURL:function(e,f){var g=e.getAttribute("name"),h={};this.readChildNodes(e,h);f.authorityURLs[g]=h.href},Identifier:function(d,e){var f=d.getAttribute("authority");e.identifiers[f]=this.getChildValue(d)},KeywordList:function(c,d){this.readChildNodes(c,d)},SRS:function(c,d){d.srs[this.getChildValue(c)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(c,d){this.readChildNodes(c,d)},Keyword:function(c,d){d.keywords&&d.keywords.push(this.getChildValue(c))},DescribeLayer:function(c,d){d.describelayer={formats:[]};this.readChildNodes(c,d.describelayer)},GetLegendGraphic:function(c,d){d.getlegendgraphic={formats:[]};this.readChildNodes(c,d.getlegendgraphic)},GetStyles:function(c,d){d.getstyles={formats:[]};this.readChildNodes(c,d.getstyles)},PutStyles:function(c,d){d.putstyles={formats:[]};this.readChildNodes(c,d.putstyles)},UserDefinedSymbolization:function(d,e){var f={supportSLD:1==parseInt(d.getAttribute("SupportSLD")),userLayer:1==parseInt(d.getAttribute("UserLayer")),userStyle:1==parseInt(d.getAttribute("UserStyle")),remoteWFS:1==parseInt(d.getAttribute("RemoteWFS"))};e.userSymbols=f},LatLonBoundingBox:function(c,d){d.llbbox=[parseFloat(c.getAttribute("minx")),parseFloat(c.getAttribute("miny")),parseFloat(c.getAttribute("maxx")),parseFloat(c.getAttribute("maxy"))]},BoundingBox:function(d,e){var f=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[d,e]);f.srs=d.getAttribute("SRS");e.bbox[f.srs]=f},ScaleHint:function(g,h){var i=g.getAttribute("min"),j=g.getAttribute("max"),k=Math.pow(2,0.5),l=OpenLayers.INCHES_PER_UNIT.m;0!=i&&(h.maxScale=parseFloat((i/k*l*OpenLayers.DOTS_PER_INCH).toPrecision(13)));j!=Number.POSITIVE_INFINITY&&(h.minScale=parseFloat((j/k*l*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(d,e){var f={name:d.getAttribute("name").toLowerCase(),units:d.getAttribute("units"),unitsymbol:d.getAttribute("unitSymbol")};e.dimensions[f.name]=f},Extent:function(e,f){var g=e.getAttribute("name").toLowerCase();if(g in f.dimensions){g=f.dimensions[g];g.nearestVal="1"===e.getAttribute("nearestValue");g.multipleVal="1"===e.getAttribute("multipleValues");g.current="1"===e.getAttribute("current");g["default"]=e.getAttribute("default")||"";var h=this.getChildValue(e);g.values=h.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(f,g){for(var h=this.getChildValue(f).split(/ +/),i=0,j=h.length;i<j;i++){g.srs[h[i]]=!0}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions)));!b.geometryName&&1<parseFloat(this.format.version)&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(d){OpenLayers.Protocol.prototype.read.apply(this,arguments);d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options||{});var e=new OpenLayers.Protocol.Response({requestType:"read"}),f=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",d)]);e.priv=OpenLayers.Request.POST({url:d.url,callback:this.createCallback(this.handleRead,e,d),params:d.params,headers:d.headers,data:f});return e},setFeatureType:function(b){this.featureType=b;this.format.featureType=b},setGeometryName:function(b){this.geometryName=b;this.format.geometryName=b},handleRead:function(d,e){e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options);if(e.callback){var f=d.priv;200<=f.status&&300>f.status?(f=this.parseResponse(f,e.readOptions))&&!1!==f.success?(e.readOptions&&"object"==e.readOptions.output?OpenLayers.Util.extend(d,f):d.features=f,d.code=OpenLayers.Protocol.Response.SUCCESS):(d.code=OpenLayers.Protocol.Response.FAILURE,d.error=f):d.code=OpenLayers.Protocol.Response.FAILURE;e.callback.call(e.scope,d)}},parseResponse:function(e,f){var g=e.responseXML;g&&g.documentElement||(g=e.responseText);if(!g||0>=g.length){return null}g=null!==this.readFormat?this.readFormat.read(g):this.format.read(g,f);if(!this.featureNS){var h=this.readFormat||this.format;this.featureNS=h.featureNS;h.autoConfig=!1;this.geometryName||this.setGeometryName(h.geometryName)}return g},commit:function(d,e){e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options);var f=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:d});f.priv=OpenLayers.Request.POST({url:e.url,headers:e.headers,data:this.format.write(d,e),callback:this.createCallback(this.handleCommit,f,e)});return f},handleCommit:function(e,f){if(f.callback){var g=e.priv,h=g.responseXML;h&&h.documentElement||(h=g.responseText);g=this.format.read(h)||{};e.insertIds=g.insertIds||[];g.success?e.code=OpenLayers.Protocol.Response.SUCCESS:(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=g);f.callback.call(f.scope,e)}},filterDelete:function(f,g){g=OpenLayers.Util.extend({},g);OpenLayers.Util.applyDefaults(g,this.options);new OpenLayers.Protocol.Response({requestType:"commit"});var h=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),i=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(g.featureNS?this.featurePrefix+":":"")+g.featureType}});g.featureNS&&i.setAttribute("xmlns:"+this.featurePrefix,g.featureNS);var j=this.format.writeNode("ogc:Filter",f);i.appendChild(j);h.appendChild(i);h=OpenLayers.Format.XML.prototype.write.apply(this.format,[h]);return OpenLayers.Request.POST({url:this.url,callback:g.callback||function(){},data:h})},abort:function(b){b&&b.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,f,g,h){OpenLayers.Handler.prototype.initialize.apply(this,[e,g,h]);this.layer=f},touchstart:function(b){this.startTouch();return OpenLayers.Event.isMultiTouch(b)?!0:this.mousedown(b)},touchmove:function(b){OpenLayers.Event.preventDefault(b)},mousedown:function(b){if(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b)){this.down=b.xy}return this.handle(b)?!this.stopDown:!0},mouseup:function(b){this.up=b.xy;return this.handle(b)?!this.stopUp:!0},click:function(b){return this.handle(b)?!this.stopClick:!0},mousemove:function(b){if(!this.callbacks.over&&!this.callbacks.out){return !0}this.handle(b);return !0},dblclick:function(b){return !this.handle(b)},geometryTypeMatches:function(b){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)},handle:function(f){this.feature&&!this.feature.layer&&(this.feature=null);var g=f.type,h=!1,i=!!this.feature,j="click"==g||"dblclick"==g||"touchstart"==g;(this.feature=this.layer.getFeatureFromEvent(f))&&!this.feature.layer&&(this.feature=null);this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null);this.feature?("touchstart"===g&&OpenLayers.Event.preventDefault(f),f=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(i&&f?(this.lastFeature&&this.triggerCallback(g,"out",[this.lastFeature]),this.triggerCallback(g,"in",[this.feature])):i&&!j||this.triggerCallback(g,"in",[this.feature]),this.lastFeature=this.feature,h=!0):(this.lastFeature&&(i&&f||j)&&this.triggerCallback(g,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(i||j)&&this.triggerCallback(g,"out",[this.lastFeature]);return h},triggerCallback:function(d,e,f){if(e=this.EVENTMAP[d][e]){"click"==d&&this.up&&this.down?(Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(e,f),this.up=this.down=null):this.callback(e,f)}},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),b=!0);return b},handleMapEvents:function(b){"removelayer"!=b.type&&"order"!=b.property||this.moveLayerToTop()},moveLayerToTop:function(){var b=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(b)},moveLayerBack:function(){var b=this.layer.getZIndex()-1;b>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(b):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(e){for(var f=this.layers,g,h=0;h<f.length;h++){if(g=f[h].getFeatureFromEvent(e)){return g}}},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();b.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(b){b.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var c,d=0;d<this.map.layers.length;++d){c=this.map.layers[d],-1!=OpenLayers.Util.indexOf(this.layers,c)&&c.renderer.moveRoot(this.renderer)}},resetRoots:function(){for(var c,d=0;d<this.layers.length;++d){c=this.layers[d],this.renderer&&c.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(c.renderer)}},handleChangeLayer:function(c){var d=c.layer;"order"==c.property&&-1!=OpenLayers.Util.indexOf(this.layers,d)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(d,e){OpenLayers.Control.prototype.initialize.apply(this,[e]);null===this.scope&&(this.scope=this);this.initLayer(d);var f={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(f.over=this.overFeature,f.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(f,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(b){OpenLayers.Util.isArray(b)?(this.layers=b,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:b})):this.layer=b},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer);OpenLayers.Control.prototype.destroy.apply(this,arguments);this.layers&&this.layer.destroy()},activate:function(){this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate());return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer));return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(g){var h=this.layers||[this.layer],i,j,k,l;for(k=0;k<h.length;++k){if(i=h[k],l=0,null!=i.selectedFeatures){for(;i.selectedFeatures.length>l;){j=i.selectedFeatures[l],g&&g.except==j?++l:this.unselect(j)}}}},clickFeature:function(b){this.hover||(-1<OpenLayers.Util.indexOf(b.layer.selectedFeatures,b)?this.toggleSelect()?this.unselect(b):this.multipleSelect()||this.unselectAll({except:b}):(this.multipleSelect()||this.unselectAll({except:b}),this.select(b)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(b){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(c){var d=c.layer;this.hover&&(this.highlightOnly?this.highlight(c):-1==OpenLayers.Util.indexOf(d.selectedFeatures,c)&&this.select(c))},outFeature:function(c){if(this.hover){if(this.highlightOnly){if(c._lastHighlighter==this.id){if(c._prevHighlighter&&c._prevHighlighter!=this.id){delete c._lastHighlighter;var d=this.map.getControl(c._prevHighlighter);d&&d.highlight(c)}else{this.unhighlight(c)}}}else{this.unselect(c)}}},highlight:function(c){var d=c.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:c})&&(c._prevHighlighter=c._lastHighlighter,c._lastHighlighter=this.id,d.drawFeature(c,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:c}))},unhighlight:function(c){var d=c.layer;void 0==c._prevHighlighter?delete c._lastHighlighter:(c._prevHighlighter!=this.id&&(c._lastHighlighter=c._prevHighlighter),delete c._prevHighlighter);d.drawFeature(c,c.style||c.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:c})},select:function(d){var e=this.onBeforeSelect.call(this.scope,d),f=d.layer;!1!==e&&(e=f.events.triggerEvent("beforefeatureselected",{feature:d}),!1!==e&&(f.selectedFeatures.push(d),this.highlight(d),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=f.selectedFeatures[0]),f.events.triggerEvent("featureselected",{feature:d}),this.onSelect.call(this.scope,d)))},unselect:function(c){var d=c.layer;this.unhighlight(c);OpenLayers.Util.removeItem(d.selectedFeatures,c);d.events.triggerEvent("featureunselected",{feature:c});this.onUnselect.call(this.scope,c)},selectBox:function(i){if(i instanceof OpenLayers.Bounds){var j=this.map.getLonLatFromPixel({x:i.left,y:i.bottom});i=this.map.getLonLatFromPixel({x:i.right,y:i.top});j=new OpenLayers.Bounds(j.lon,j.lat,i.lon,i.lat);this.multipleSelect()||this.unselectAll();i=this.multiple;this.multiple=!0;var k=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:k});for(var l,m=0;m<k.length;++m){l=k[m];for(var n=0,o=l.features.length;n<o;++n){var p=l.features[n];p.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,p.geometry.CLASS_NAME))&&j.toGeometry().intersects(p.geometry)&&-1==OpenLayers.Util.indexOf(l.selectedFeatures,p)&&this.select(p)}}this.multiple=i;this.events.triggerEvent("boxselectionend",{layers:k})}},setMap:function(b){this.handlers.feature.setMap(b);this.box&&this.handlers.box.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(c){var d=this.active;this.unselectAll();this.deactivate();this.layers&&(this.layer.destroy(),this.layers=null);this.initLayer(c);this.handlers.feature.layer=this.layer;d&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(d,e,f){f&&f.layerOptions&&f.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return !1}var b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);return !0},createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return !1}this.cancel();null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1));this.layer=null;return !0},destroyFeature:function(b){!this.layer||!b&&this.persist||this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var b=this.layer;b&&1<b.features.length&&this.layer.features[0].destroy()},finalize:function(b){this.mouseDown=!1;this.lastTouchPx=this.lastUp=this.lastDown=null;this.callback(b?"cancel":"done",[this.geometryClone()]);this.destroyFeature(b)},cancel:function(){this.finalize(!0)},click:function(b){OpenLayers.Event.stop(b);return !1},dblclick:function(b){OpenLayers.Event.stop(b);return !1},modifyFeature:function(b){this.point||this.createFeature(b);b=this.layer.getLonLatFromViewPortPx(b);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var b=this.point&&this.point.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiPoint([b]));return b},geometryClone:function(){var b=this.getGeometry();return b&&b.clone()},mousedown:function(b){return this.down(b)},touchstart:function(b){this.startTouch();this.lastTouchPx=b.xy;return this.down(b)},mousemove:function(b){return this.move(b)},touchmove:function(b){this.lastTouchPx=b.xy;return this.move(b)},mouseup:function(b){return this.up(b)},touchend:function(b){b.xy=this.lastTouchPx;return this.up(b)},down:function(b){this.mouseDown=!0;this.lastDown=b.xy;this.touch||this.modifyFeature(b.xy);this.stoppedDown=this.stopDown;return !this.stopDown},move:function(b){this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(b.xy);return !0},up:function(b){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(!this.checkModifiers(b)||this.lastUp&&this.lastUp.equals(b.xy)||!this.lastDown||!this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){return !0}this.touch&&this.modifyFeature(b.xy);this.persist&&this.destroyPersistedFeature();this.lastUp=b.xy;this.finalize();return !this.stopUp},mouseout:function(b){OpenLayers.Util.mouseLeft(b,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,f,g){var h=!0;null!=g&&e&&f&&e.distanceTo(f)>g&&(h=!1);return h},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(b){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,b);this.line=null},destroyPersistedFeature:function(){var b=this.layer;b&&2<b.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(b){this.layer.removeFeatures([this.point]);b=this.layer.getLonLatFromViewPortPx(b);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(c,d){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(c,d),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(d,e){var f=this.getCurrentPointIndex()-1,f=this.line.geometry.components[f];!f||(isNaN(f.x)||isNaN(f.y))||this.insertXY(f.x+d,f.y+e)},insertDirectionLength:function(e,f){e*=Math.PI/180;var g=f*Math.cos(e),h=f*Math.sin(e);this.insertDeltaXY(g,h)},insertDeflectionLength:function(e,f){var g=this.getCurrentPointIndex()-1;if(0<g){var h=this.line.geometry.components[g],g=this.line.geometry.components[g-1],h=Math.atan2(h.y-g.y,h.x-g.x);this.insertDirectionLength(180*h/Math.PI+e,f)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var f=this.line.geometry,g=f.components,h=this.getCurrentPointIndex()-1,i=g[h],j=f.removeComponent(i);j&&(this.touch&&0<h&&(g=f.components,f=g[h-1],h=this.getCurrentPointIndex(),g=g[h],g.x=f.x,g.y=f.y),this.redoStack||(this.redoStack=[]),this.redoStack.push(i),this.drawFeature());return j},redo:function(){var b=this.redoStack&&this.redoStack.pop();b&&(this.line.geometry.addComponent(b,this.getCurrentPointIndex()),this.drawFeature());return !!b},freehandMode:function(b){return this.freehandToggle&&b[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(d,e){this.line||this.createFeature(d);var f=this.layer.getLonLatFromViewPortPx(d);this.point.geometry.x=f.lon;this.point.geometry.y=f.lat;this.callback("modify",[this.point.geometry,this.getSketch(),e]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var b=this.line&&this.line.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiLineString([b]));return b},touchstart:function(b){if(this.timerId&&this.passesTolerance(this.lastTouchPx,b.xy,this.doubleTouchTolerance)){return this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1}this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,b)},down:function(c){var d=this.stopDown;this.freehandMode(c)&&(d=!0,this.touch&&(this.modifyFeature(c.xy,!!this.lastUp),OpenLayers.Event.stop(c)));this.touch||this.lastDown&&this.passesTolerance(this.lastDown,c.xy,this.pixelTolerance)||this.modifyFeature(c.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=c.xy;this.stoppedDown=d;return !d},move:function(b){if(this.stoppedDown&&this.freehandMode(b)){return this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(b.xy),!1}this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(b.xy,!!this.lastUp);return !0},up:function(b){!this.mouseDown||this.lastUp&&this.lastUp.equals(b.xy)||(this.stoppedDown&&this.freehandMode(b)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(b.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(b.xy),this.lastUp=b.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry()));this.stoppedDown=this.stopDown;this.mouseDown=!1;return !this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]);this.removePoint();this.finalize()},dblclick:function(b){this.freehandMode(b)||this.finishGeometry();return !1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Spherical=OpenLayers.Spherical||{};OpenLayers.Spherical.DEFAULT_RADIUS=6378137;OpenLayers.Spherical.computeDistanceBetween=function(f,g,h){h=h||OpenLayers.Spherical.DEFAULT_RADIUS;var i=Math.sin(Math.PI*(g.lon-f.lon)/360),j=Math.sin(Math.PI*(g.lat-f.lat)/360);f=j*j+i*i*Math.cos(Math.PI*f.lat/180)*Math.cos(Math.PI*g.lat/180);return 2*h*Math.atan2(Math.sqrt(f),Math.sqrt(1-f))};OpenLayers.Spherical.computeHeading=function(e,f){var g=Math.sin(Math.PI*(e.lon-f.lon)/180)*Math.cos(Math.PI*f.lat/180),h=Math.cos(Math.PI*e.lat/180)*Math.sin(Math.PI*f.lat/180)-Math.sin(Math.PI*e.lat/180)*Math.cos(Math.PI*f.lat/180)*Math.cos(Math.PI*(e.lon-f.lon)/180);return 180*Math.atan2(g,h)/Math.PI};OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(d){OpenLayers.Control.prototype.setMap.apply(this,arguments);var e,f=this.layers||d.layers;for(e=f.length-1;0<=e;--e){this.addLayer({layer:f[e]})}if(!this.layers){d.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(b){b.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},removeLayer:function(b){b.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},makeSameOrigin:function(c){if(this.active&&(c=c.tile,c instanceof OpenLayers.Tile.Image&&!c.crossOriginKeyword&&"data:"!==c.url.substr(0,5))){var d=OpenLayers.Request.makeSameOrigin(c.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[d]=c.url;c.url=d}},onTileLoaded:function(b){this.active&&(!b.aborted&&b.tile instanceof OpenLayers.Tile.Image&&"data:"!==b.tile.url.substr(0,5))&&(this.cache({tile:b.tile}),delete OpenLayers.Control.CacheWrite.urlMap[b.tile.url])},cache:function(d){if(window.localStorage){d=d.tile;try{var e=d.getCanvasContext();e&&window.localStorage.setItem("olCache_"+(OpenLayers.Control.CacheWrite.urlMap[d.url]||d.url),e.canvas.toDataURL(this.imageFormat))}catch(f){(e=f.name||f.message)&&this.quotaRegEx.test(e)?this.events.triggerEvent("cachefull",{tile:d}):OpenLayers.Console.error(f.toString())}}},destroy:function(){if(this.layers||this.map){var c,d=this.layers||this.map.layers;for(c=d.length-1;0<=c;--c){this.removeLayer({layer:d[c]})}}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"});OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var c,d;for(c=window.localStorage.length-1;0<=c;--c){d=window.localStorage.key(c),"olCache_"===d.substr(0,8)&&window.localStorage.removeItem(d)}}};OpenLayers.Control.CacheWrite.urlMap={};OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(e,f){var g=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(f&&f.map){if(this.context=g,f.map instanceof OpenLayers.Map){g=this.mergeContextToMap(g,f.map)}else{var h=f.map;if(OpenLayers.Util.isElement(h)||"string"==typeof h){h={div:h}}g=this.contextToMap(g,h)}}return g},getLayerFromContext:function(g){var h,i,j={queryable:g.queryable,visibility:g.visibility,maxExtent:g.maxExtent,metadata:OpenLayers.Util.applyDefaults(g.metadata,{styles:g.styles,formats:g.formats,"abstract":g["abstract"],dataURL:g.dataURL}),numZoomLevels:g.numZoomLevels,units:g.units,isBaseLayer:g.isBaseLayer,opacity:g.opacity,displayInLayerSwitcher:g.displayInLayerSwitcher,singleTile:g.singleTile,tileSize:g.tileSize?new OpenLayers.Size(g.tileSize.width,g.tileSize.height):void 0,minScale:g.minScale||g.maxScaleDenominator,maxScale:g.maxScale||g.minScaleDenominator,srs:g.srs,dimensions:g.dimensions,metadataURL:g.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(j,this.layerOptions);var k={layers:g.name,transparent:g.transparent,version:g.version};if(g.formats&&0<g.formats.length){for(k.format=g.formats[0].value,h=0,i=g.formats.length;h<i;h++){var l=g.formats[h];if(!0==l.current){k.format=l.value;break}}}if(g.styles&&0<g.styles.length){for(h=0,i=g.styles.length;h<i;h++){if(l=g.styles[h],!0==l.current){l.href?k.sld=l.href:l.body?k.sld_body=l.body:k.styles=l.name;break}}}this.layerParams&&OpenLayers.Util.applyDefaults(k,this.layerParams);h=null;i=g.service;i==OpenLayers.Format.Context.serviceTypes.WFS?(j.strategies=[new OpenLayers.Strategy.BBOX],j.protocol=new OpenLayers.Protocol.WFS({url:g.url,featurePrefix:g.name.split(":")[0],featureType:g.name.split(":").pop()}),h=new OpenLayers.Layer.Vector(g.title||g.name,j)):i==OpenLayers.Format.Context.serviceTypes.KML?(j.strategies=[new OpenLayers.Strategy.Fixed],j.protocol=new OpenLayers.Protocol.HTTP({url:g.url,format:new OpenLayers.Format.KML}),h=new OpenLayers.Layer.Vector(g.title||g.name,j)):i==OpenLayers.Format.Context.serviceTypes.GML?(j.strategies=[new OpenLayers.Strategy.Fixed],j.protocol=new OpenLayers.Protocol.HTTP({url:g.url,format:new OpenLayers.Format.GML}),h=new OpenLayers.Layer.Vector(g.title||g.name,j)):g.features?(h=new OpenLayers.Layer.Vector(g.title||g.name,j),h.addFeatures(g.features)):!0!==g.categoryLayer&&(h=new OpenLayers.Layer.WMS(g.title||g.name,g.url,k,j));return h},getLayersFromContext:function(f){for(var g=[],h=0,i=f.length;h<i;h++){var j=this.getLayerFromContext(f[h]);null!==j&&g.push(j)}return g},contextToMap:function(d,e){e=OpenLayers.Util.applyDefaults({maxExtent:d.maxExtent,projection:d.projection,units:d.units},e);e.maxExtent&&(e.maxResolution=e.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);e.metadata={contactInformation:d.contactInformation,"abstract":d["abstract"],keywords:d.keywords,logo:d.logo,descriptionURL:d.descriptionURL};var f=new OpenLayers.Map(e);f.addLayers(this.getLayersFromContext(d.layersContext));f.setCenter(d.bounds.getCenterLonLat(),f.getZoomForExtent(d.bounds,!0));return f},mergeContextToMap:function(c,d){d.addLayers(this.getLayersFromContext(c.layersContext));return d},write:function(c,d){c=this.toContext(c);return OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"});OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(g){var h=this.getParser(),i={queryable:g.queryable,visibility:g.visibility,name:g.params.LAYERS,title:g.name,"abstract":g.metadata["abstract"],dataURL:g.metadata.dataURL,metadataURL:g.metadataURL,server:{version:g.params.VERSION,url:g.url},maxExtent:g.maxExtent,transparent:g.params.TRANSPARENT,numZoomLevels:g.numZoomLevels,units:g.units,isBaseLayer:g.isBaseLayer,opacity:1==g.opacity?void 0:g.opacity,displayInLayerSwitcher:g.displayInLayerSwitcher,singleTile:g.singleTile,tileSize:g.singleTile||!g.tileSize?void 0:{width:g.tileSize.w,height:g.tileSize.h},minScale:g.options.resolutions||g.options.scales||g.options.maxResolution||g.options.minScale?g.minScale:void 0,maxScale:g.options.resolutions||g.options.scales||g.options.minResolution||g.options.maxScale?g.maxScale:void 0,formats:[],styles:[],srs:g.srs,dimensions:g.dimensions};g.metadata.servertitle&&(i.server.title=g.metadata.servertitle);if(g.metadata.formats&&0<g.metadata.formats.length){for(var j=0,k=g.metadata.formats.length;j<k;j++){var l=g.metadata.formats[j];i.formats.push({value:l.value,current:l.value==g.params.FORMAT})}}else{i.formats.push({value:g.params.FORMAT,current:!0})}if(g.metadata.styles&&0<g.metadata.styles.length){for(j=0,k=g.metadata.styles.length;j<k;j++){h=g.metadata.styles[j],h.current=h.href==g.params.SLD||h.body==g.params.SLD_BODY||h.name==g.params.STYLES?!0:!1,i.styles.push(h)}}else{i.styles.push({href:g.params.SLD,body:g.params.SLD_BODY,name:g.params.STYLES||h.defaultStyleName,title:h.defaultStyleTitle,current:!0})}return i},toContext:function(f){var g={},h=f.layers;if("OpenLayers.Map"==f.CLASS_NAME){var i=f.metadata||{};g.size=f.getSize();g.bounds=f.getExtent();g.projection=f.projection;g.title=f.title;g.keywords=i.keywords;g["abstract"]=i["abstract"];g.logo=i.logo;g.descriptionURL=i.descriptionURL;g.contactInformation=i.contactInformation;g.maxExtent=f.maxExtent}else{OpenLayers.Util.applyDefaults(g,f),void 0!=g.layers&&delete g.layers}void 0==g.layersContext&&(g.layersContext=[]);if(void 0!=h&&OpenLayers.Util.isArray(h)){for(f=0,i=h.length;f<i;f++){var j=h[f];j instanceof OpenLayers.Layer.WMS&&g.layersContext.push(this.layerToContext(j))}}return g},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(c){var d=null;if(null==c){d=this.namespaces[this.defaultPrefix]}else{for(d in this.namespaces){if(this.namespaces[d]==c){break}}}return d},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c=c.documentElement;this.rootPrefix=c.prefix;var d={version:c.getAttribute("version")};this.runChildNodes(d,c);return d},runChildNodes:function(i,j){for(var k=j.childNodes,l,m,n,o=0,p=k.length;o<p;++o){l=k[o],1==l.nodeType&&(m=this.getNamespacePrefix(l.namespaceURI),n=l.nodeName.split(":").pop(),(m=this["read_"+m+"_"+n])&&m.apply(this,[i,l]))}},read_wmc_General:function(c,d){this.runChildNodes(c,d)},read_wmc_BoundingBox:function(c,d){c.projection=d.getAttribute("SRS");c.bounds=new OpenLayers.Bounds(d.getAttribute("minx"),d.getAttribute("miny"),d.getAttribute("maxx"),d.getAttribute("maxy"))},read_wmc_LayerList:function(c,d){c.layersContext=[];this.runChildNodes(c,d)},read_wmc_Layer:function(d,e){var f={visibility:"1"!=e.getAttribute("hidden"),queryable:"1"==e.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(f,e);d.layersContext.push(f)},read_wmc_Extension:function(c,d){this.runChildNodes(c,d)},read_ol_units:function(c,d){c.units=this.getChildValue(d)},read_ol_maxExtent:function(d,e){var f=new OpenLayers.Bounds(e.getAttribute("minx"),e.getAttribute("miny"),e.getAttribute("maxx"),e.getAttribute("maxy"));d.maxExtent=f},read_ol_transparent:function(c,d){c.transparent=this.getChildValue(d)},read_ol_numZoomLevels:function(c,d){c.numZoomLevels=parseInt(this.getChildValue(d))},read_ol_opacity:function(c,d){c.opacity=parseFloat(this.getChildValue(d))},read_ol_singleTile:function(c,d){c.singleTile="true"==this.getChildValue(d)},read_ol_tileSize:function(d,e){var f={width:e.getAttribute("width"),height:e.getAttribute("height")};d.tileSize=f},read_ol_isBaseLayer:function(c,d){c.isBaseLayer="true"==this.getChildValue(d)},read_ol_displayInLayerSwitcher:function(c,d){c.displayInLayerSwitcher="true"==this.getChildValue(d)},read_wmc_Server:function(c,d){c.version=d.getAttribute("version");c.url=this.getOnlineResource_href(d);c.metadata.servertitle=d.getAttribute("title")},read_wmc_FormatList:function(c,d){this.runChildNodes(c,d)},read_wmc_Format:function(d,e){var f={value:this.getChildValue(e)};"1"==e.getAttribute("current")&&(f.current=!0);d.formats.push(f)},read_wmc_StyleList:function(c,d){this.runChildNodes(c,d)},read_wmc_Style:function(d,e){var f={};this.runChildNodes(f,e);"1"==e.getAttribute("current")&&(f.current=!0);d.styles.push(f)},read_wmc_SLD:function(c,d){this.runChildNodes(c,d)},read_sld_StyledLayerDescriptor:function(d,e){var f=OpenLayers.Format.XML.prototype.write.apply(this,[e]);d.body=f},read_sld_FeatureTypeStyle:function(d,e){var f=OpenLayers.Format.XML.prototype.write.apply(this,[e]);d.body=f},read_wmc_OnlineResource:function(c,d){c.href=this.getAttributeNS(d,this.namespaces.xlink,"href")},read_wmc_Name:function(d,e){var f=this.getChildValue(e);f&&(d.name=f)},read_wmc_Title:function(d,e){var f=this.getChildValue(e);f&&(d.title=f)},read_wmc_MetadataURL:function(c,d){c.metadataURL=this.getOnlineResource_href(d)},read_wmc_KeywordList:function(c,d){c.keywords=[];this.runChildNodes(c.keywords,d)},read_wmc_Keyword:function(c,d){c.push(this.getChildValue(d))},read_wmc_Abstract:function(d,e){var f=this.getChildValue(e);f&&(d["abstract"]=f)},read_wmc_LogoURL:function(c,d){c.logo={width:d.getAttribute("width"),height:d.getAttribute("height"),format:d.getAttribute("format"),href:this.getOnlineResource_href(d)}},read_wmc_DescriptionURL:function(c,d){c.descriptionURL=this.getOnlineResource_href(d)},read_wmc_ContactInformation:function(d,e){var f={};this.runChildNodes(f,e);d.contactInformation=f},read_wmc_ContactPersonPrimary:function(d,e){var f={};this.runChildNodes(f,e);d.personPrimary=f},read_wmc_ContactPerson:function(d,e){var f=this.getChildValue(e);f&&(d.person=f)},read_wmc_ContactOrganization:function(d,e){var f=this.getChildValue(e);f&&(d.organization=f)},read_wmc_ContactPosition:function(d,e){var f=this.getChildValue(e);f&&(d.position=f)},read_wmc_ContactAddress:function(d,e){var f={};this.runChildNodes(f,e);d.contactAddress=f},read_wmc_AddressType:function(d,e){var f=this.getChildValue(e);f&&(d.type=f)},read_wmc_Address:function(d,e){var f=this.getChildValue(e);f&&(d.address=f)},read_wmc_City:function(d,e){var f=this.getChildValue(e);f&&(d.city=f)},read_wmc_StateOrProvince:function(d,e){var f=this.getChildValue(e);f&&(d.stateOrProvince=f)},read_wmc_PostCode:function(d,e){var f=this.getChildValue(e);f&&(d.postcode=f)},read_wmc_Country:function(d,e){var f=this.getChildValue(e);f&&(d.country=f)},read_wmc_ContactVoiceTelephone:function(d,e){var f=this.getChildValue(e);f&&(d.phone=f)},read_wmc_ContactFacsimileTelephone:function(d,e){var f=this.getChildValue(e);f&&(d.fax=f)},read_wmc_ContactElectronicMailAddress:function(d,e){var f=this.getChildValue(e);f&&(d.email=f)},read_wmc_DataURL:function(c,d){c.dataURL=this.getOnlineResource_href(d)},read_wmc_LegendURL:function(d,e){var f={width:e.getAttribute("width"),height:e.getAttribute("height"),format:e.getAttribute("format"),href:this.getOnlineResource_href(e)};d.legend=f},read_wmc_DimensionList:function(c,d){c.dimensions={};this.runChildNodes(c.dimensions,d)},read_wmc_Dimension:function(e,f){var g={name:f.getAttribute("name").toLowerCase(),units:f.getAttribute("units")||"",unitSymbol:f.getAttribute("unitSymbol")||"",userValue:f.getAttribute("userValue")||"",nearestValue:"1"===f.getAttribute("nearestValue"),multipleValues:"1"===f.getAttribute("multipleValues"),current:"1"===f.getAttribute("current"),"default":f.getAttribute("default")||""},h=this.getChildValue(f);g.values=h.split(",");e[g.name]=g},write:function(d,e){var f=this.createElementDefaultNS("ViewContext");this.setAttributes(f,{version:this.VERSION,id:e&&"string"==typeof e.id?e.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);f.appendChild(this.write_wmc_General(d));f.appendChild(this.write_wmc_LayerList(d));return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createElementDefaultNS:function(d,e,f){d=this.createElementNS(this.namespaces[this.defaultPrefix],d);e&&d.appendChild(this.createTextNode(e));f&&this.setAttributes(d,f);return d},setAttributes:function(e,f){var g,h;for(h in f){g=f[h].toString(),g.match(/[A-Z]/)?this.setAttributeNS(e,null,h,g):e.setAttribute(h,g)}},write_wmc_General:function(d){var e=this.createElementDefaultNS("General");d.size&&e.appendChild(this.createElementDefaultNS("Window",null,{width:d.size.w,height:d.size.h}));var f=d.bounds;e.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:f.left.toPrecision(18),miny:f.bottom.toPrecision(18),maxx:f.right.toPrecision(18),maxy:f.top.toPrecision(18),SRS:d.projection}));e.appendChild(this.createElementDefaultNS("Title",d.title));d.keywords&&e.appendChild(this.write_wmc_KeywordList(d.keywords));d["abstract"]&&e.appendChild(this.createElementDefaultNS("Abstract",d["abstract"]));d.logo&&e.appendChild(this.write_wmc_URLType("LogoURL",d.logo.href,d.logo));d.descriptionURL&&e.appendChild(this.write_wmc_URLType("DescriptionURL",d.descriptionURL));d.contactInformation&&e.appendChild(this.write_wmc_ContactInformation(d.contactInformation));e.appendChild(this.write_ol_MapExtension(d));return e},write_wmc_KeywordList:function(e){for(var f=this.createElementDefaultNS("KeywordList"),g=0,h=e.length;g<h;g++){f.appendChild(this.createElementDefaultNS("Keyword",e[g]))}return f},write_wmc_ContactInformation:function(c){var d=this.createElementDefaultNS("ContactInformation");c.personPrimary&&d.appendChild(this.write_wmc_ContactPersonPrimary(c.personPrimary));c.position&&d.appendChild(this.createElementDefaultNS("ContactPosition",c.position));c.contactAddress&&d.appendChild(this.write_wmc_ContactAddress(c.contactAddress));c.phone&&d.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",c.phone));c.fax&&d.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",c.fax));c.email&&d.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",c.email));return d},write_wmc_ContactPersonPrimary:function(c){var d=this.createElementDefaultNS("ContactPersonPrimary");c.person&&d.appendChild(this.createElementDefaultNS("ContactPerson",c.person));c.organization&&d.appendChild(this.createElementDefaultNS("ContactOrganization",c.organization));return d},write_wmc_ContactAddress:function(c){var d=this.createElementDefaultNS("ContactAddress");c.type&&d.appendChild(this.createElementDefaultNS("AddressType",c.type));c.address&&d.appendChild(this.createElementDefaultNS("Address",c.address));c.city&&d.appendChild(this.createElementDefaultNS("City",c.city));c.stateOrProvince&&d.appendChild(this.createElementDefaultNS("StateOrProvince",c.stateOrProvince));c.postcode&&d.appendChild(this.createElementDefaultNS("PostCode",c.postcode));c.country&&d.appendChild(this.createElementDefaultNS("Country",c.country));return d},write_ol_MapExtension:function(d){var e=this.createElementDefaultNS("Extension");if(d=d.maxExtent){var f=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(f,{minx:d.left.toPrecision(18),miny:d.bottom.toPrecision(18),maxx:d.right.toPrecision(18),maxy:d.top.toPrecision(18)});e.appendChild(f)}return e},write_wmc_LayerList:function(e){for(var f=this.createElementDefaultNS("LayerList"),g=0,h=e.layersContext.length;g<h;++g){f.appendChild(this.write_wmc_Layer(e.layersContext[g]))}return f},write_wmc_Layer:function(c){var d=this.createElementDefaultNS("Layer",null,{queryable:c.queryable?"1":"0",hidden:c.visibility?"0":"1"});d.appendChild(this.write_wmc_Server(c));d.appendChild(this.createElementDefaultNS("Name",c.name));d.appendChild(this.createElementDefaultNS("Title",c.title));c["abstract"]&&d.appendChild(this.createElementDefaultNS("Abstract",c["abstract"]));c.dataURL&&d.appendChild(this.write_wmc_URLType("DataURL",c.dataURL));c.metadataURL&&d.appendChild(this.write_wmc_URLType("MetadataURL",c.metadataURL));return d},write_wmc_LayerExtension:function(g){var h=this.createElementDefaultNS("Extension"),i=g.maxExtent,j=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(j,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)});h.appendChild(j);g.tileSize&&!g.singleTile&&(i=this.createElementNS(this.namespaces.ol,"ol:tileSize"),this.setAttributes(i,g.tileSize),h.appendChild(i));for(var i="transparent numZoomLevels units isBaseLayer opacity displayInLayerSwitcher singleTile".split(" "),k=0,l=i.length;k<l;++k){(j=this.createOLPropertyNode(g,i[k]))&&h.appendChild(j)}return h},createOLPropertyNode:function(d,e){var f=null;null!=d[e]&&(f=this.createElementNS(this.namespaces.ol,"ol:"+e),f.appendChild(this.createTextNode(d[e].toString())));return f},write_wmc_Server:function(d){d=d.server;var e=this.createElementDefaultNS("Server"),f={service:"OGC:WMS",version:d.version};d.title&&(f.title=d.title);this.setAttributes(e,f);e.appendChild(this.write_wmc_OnlineResource(d.url));return e},write_wmc_URLType:function(e,f,g){e=this.createElementDefaultNS(e);e.appendChild(this.write_wmc_OnlineResource(f));if(g){f=["width","height","format"];for(var h=0;h<f.length;h++){f[h] in g&&e.setAttribute(f[h],g[f[h]])}}return e},write_wmc_DimensionList:function(g){var h=this.createElementDefaultNS("DimensionList"),i;for(i in g.dimensions){var j={},k=g.dimensions[i],l;for(l in k){j[l]="boolean"==typeof k[l]?Number(k[l]):k[l]}k="";j.values&&(k=j.values.join(","),delete j.values);h.appendChild(this.createElementDefaultNS("Dimension",k,j))}return h},write_wmc_FormatList:function(f){for(var g=this.createElementDefaultNS("FormatList"),h=0,i=f.formats.length;h<i;h++){var j=f.formats[h];g.appendChild(this.createElementDefaultNS("Format",j.value,j.current&&!0==j.current?{current:"1"}:null))}return g},write_wmc_StyleList:function(h){var i=this.createElementDefaultNS("StyleList");if((h=h.styles)&&OpenLayers.Util.isArray(h)){for(var j,k=0,l=h.length;k<l;k++){var m=h[k],n=this.createElementDefaultNS("Style",null,m.current&&!0==m.current?{current:"1"}:null);m.href?(j=this.createElementDefaultNS("SLD"),m.name&&j.appendChild(this.createElementDefaultNS("Name",m.name)),m.title&&j.appendChild(this.createElementDefaultNS("Title",m.title)),m.legend&&j.appendChild(this.write_wmc_URLType("LegendURL",m.legend.href,m.legend)),m=this.write_wmc_OnlineResource(m.href),j.appendChild(m),n.appendChild(j)):m.body?(j=this.createElementDefaultNS("SLD"),m.name&&j.appendChild(this.createElementDefaultNS("Name",m.name)),m.title&&j.appendChild(this.createElementDefaultNS("Title",m.title)),m.legend&&j.appendChild(this.write_wmc_URLType("LegendURL",m.legend.href,m.legend)),m=OpenLayers.Format.XML.prototype.read.apply(this,[m.body]).documentElement,j.ownerDocument&&j.ownerDocument.importNode&&(m=j.ownerDocument.importNode(m,!0)),j.appendChild(m),n.appendChild(j)):(n.appendChild(this.createElementDefaultNS("Name",m.name)),n.appendChild(this.createElementDefaultNS("Title",m.title)),m["abstract"]&&n.appendChild(this.createElementDefaultNS("Abstract",m["abstract"])),m.legend&&n.appendChild(this.write_wmc_URLType("LegendURL",m.legend.href,m.legend)));i.appendChild(n)}}return i},write_wmc_OnlineResource:function(c){var d=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(d,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(d,this.namespaces.xlink,"xlink:href",c);return d},getOnlineResource_href:function(c){var d={};c=c.getElementsByTagName("OnlineResource");0<c.length&&this.read_wmc_OnlineResource(d,c[0]);return d.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);b={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,b)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var e=[];if(this.map&&this.map.layers){for(var f=0,g=this.map.layers.length;f<g;f++){var h=this.map.layers[f];h.attribution&&h.getVisibility()&&-1===OpenLayers.Util.indexOf(e,h.attribution)&&e.push(h.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:e.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(b){OpenLayers.Util.extend(this,b)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(b){this.points.unshift({xy:b,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(g){for(var h,i=(new Date).getTime(),j=0,k=this.points.length,l;j<k;j++){l=this.points[j];if(i-l.tick>this.delay){break}h=l}if(h&&(j=(new Date).getTime()-h.tick,i=Math.sqrt(Math.pow(g.x-h.xy.x,2)+Math.pow(g.y-h.xy.y,2)),j=i/j,!(0==j||j<this.threshold))){return i=Math.asin((g.y-h.xy.y)/i),h.xy.x<=g.x&&(i=Math.PI-i),{speed:j,theta:i}}},move:function(i,j){var k=i.speed,l=Math.cos(i.theta),m=-Math.sin(i.theta),n=(new Date).getTime(),o=0,p=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var b=(new Date).getTime()-n,c=-this.deceleration*Math.pow(b,2)/2+k*b,d=c*l,c=c*m,e,f;e=!1;0>=-this.deceleration*b+k&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,e=!0);b=d-o;f=c-p;o=d;p=c;j(b,f,e)}},this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(b){},write:function(c){var d;window.ActiveXObject?this.xmldom=d=new ActiveXObject("Microsoft.XMLDOM"):d=document.implementation.createDocument("","",null);c=this.writeNode("wps:Execute",c,d);this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);return d},writers:{wps:{Execute:function(c){var d=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});this.writeNode("ows:Identifier",c.identifier,d);this.writeNode("wps:DataInputs",c.dataInputs,d);this.writeNode("wps:ResponseForm",c.responseForm,d);return d},ResponseForm:function(c){var d=this.createElementNSPlus("wps:ResponseForm",{});c.rawDataOutput&&this.writeNode("wps:RawDataOutput",c.rawDataOutput,d);c.responseDocument&&this.writeNode("wps:ResponseDocument",c.responseDocument,d);return d},ResponseDocument:function(e){var f=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:e.storeExecuteResponse,lineage:e.lineage,status:e.status}});if(e.outputs){for(var g=0,h=e.outputs.length;g<h;g++){this.writeNode("wps:Output",e.outputs[g],f)}}return f},Output:function(c){var d=this.createElementNSPlus("wps:Output",{attributes:{asReference:c.asReference,mimeType:c.mimeType,encoding:c.encoding,schema:c.schema}});this.writeNode("ows:Identifier",c.identifier,d);this.writeNode("ows:Title",c.title,d);this.writeNode("ows:Abstract",c["abstract"],d);return d},RawDataOutput:function(c){var d=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:c.mimeType,encoding:c.encoding,schema:c.schema}});this.writeNode("ows:Identifier",c.identifier,d);return d},DataInputs:function(e){for(var f=this.createElementNSPlus("wps:DataInputs",{}),g=0,h=e.length;g<h;++g){this.writeNode("wps:Input",e[g],f)}return f},Input:function(c){var d=this.createElementNSPlus("wps:Input",{});this.writeNode("ows:Identifier",c.identifier,d);c.title&&this.writeNode("ows:Title",c.title,d);c.data&&this.writeNode("wps:Data",c.data,d);c.reference&&this.writeNode("wps:Reference",c.reference,d);c.boundingBoxData&&this.writeNode("wps:BoundingBoxData",c.boundingBoxData,d);return d},Data:function(c){var d=this.createElementNSPlus("wps:Data",{});c.literalData?this.writeNode("wps:LiteralData",c.literalData,d):c.complexData?this.writeNode("wps:ComplexData",c.complexData,d):c.boundingBoxData&&this.writeNode("ows:BoundingBox",c.boundingBoxData,d);return d},LiteralData:function(b){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:b.uom},value:b.value})},ComplexData:function(d){var e=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:d.mimeType,encoding:d.encoding,schema:d.schema}}),f=d.value;"string"===typeof f?e.appendChild(this.getXMLDoc().createCDATASection(d.value)):e.appendChild(f);return e},Reference:function(c){var d=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:c.mimeType,"xlink:href":c.href,method:c.method,encoding:c.encoding,schema:c.schema}});c.body&&this.writeNode("wps:Body",c.body,d);return d},BoundingBoxData:function(c,d){this.writers.ows.BoundingBox.apply(this,[c,d,"wps:BoundingBoxData"])},Body:function(c){var d=this.createElementNSPlus("wps:Body",{});c.wcs?this.writeNode("wcs:GetCoverage",c.wcs,d):c.wfs?(this.featureType=c.wfs.featureType,this.version=c.wfs.version,this.writeNode("wfs:GetFeature",c.wfs,d)):this.writeNode("wps:Execute",c,d);return d}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(c,d){d.executeResponse={lang:c.getAttribute("lang"),statusLocation:c.getAttribute("statusLocation"),serviceInstance:c.getAttribute("serviceInstance"),service:c.getAttribute("service")};this.readChildNodes(c,d.executeResponse)},Process:function(c,d){d.process={};this.readChildNodes(c,d.process)},Status:function(c,d){d.status={creationTime:c.getAttribute("creationTime")};this.readChildNodes(c,d.status)},ProcessSucceeded:function(c,d){d.processSucceeded=!0},ProcessOutputs:function(c,d){d.processOutputs=[];this.readChildNodes(c,d.processOutputs)},Output:function(d,e){var f={};this.readChildNodes(d,f);e.push(f)},Reference:function(c,d){d.reference={href:c.getAttribute("href"),mimeType:c.getAttribute("mimeType"),encoding:c.getAttribute("encoding"),schema:c.getAttribute("schema")}},Data:function(c,d){d.data={};this.readChildNodes(c,d)},LiteralData:function(c,d){d.literalData={dataType:c.getAttribute("dataType"),uom:c.getAttribute("uom"),value:this.getChildValue(c)}},ComplexData:function(d,e){e.complexData={mimeType:d.getAttribute("mimeType"),schema:d.getAttribute("schema"),encoding:d.getAttribute("encoding"),value:""};if(this.isSimpleContent(d)){var f;for(f=d.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 3:case 4:e.complexData.value+=f.nodeValue}}}else{for(f=d.firstChild;f;f=f.nextSibling){1==f.nodeType&&(e.complexData.value=f)}}},BoundingBox:function(c,d){d.boundingBoxData={dimensions:c.getAttribute("dimensions"),crs:c.getAttribute("crs")};this.readChildNodes(c,d.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(d,e,f){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[d,f]);this.location=e;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(d,e,f){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(i){var j=i.responseXML;j&&j.documentElement||(j=OpenLayers.Format.XML.prototype.read(i.responseText));if(this.useFeedTitle){i=null;try{i=j.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(m){i=j.getElementsByTagName("title")[0].firstChild.nodeValue}i&&this.setName(i)}i={};OpenLayers.Util.extend(i,this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(i.externalProjection=this.projection,i.internalProjection=this.map.getProjectionObject());j=(new OpenLayers.Format.GeoRSS(i)).read(j);i=0;for(var n=j.length;i<n;i++){var o={},p=j[i];if(p.geometry){var q=p.attributes.title?p.attributes.title:"Untitled",r=p.attributes.description?p.attributes.description:"No description.",s=p.attributes.link?p.attributes.link:"",p=p.geometry.getBounds().getCenterLonLat();o.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone();o.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(q||r){o.title=q;o.description=r;var t='<div class="olLayerGeoRSSClose">[x]</div>',t=t+'<div class="olLayerGeoRSSTitle">';s&&(t+='<a class="link" href="'+s+'" target="_blank">');t+=q;s&&(t+="</a>");t+="</div>";t+='<div style="" class="olLayerGeoRSSDescription">';t+=r;t+="</div>";o.popupContentHTML=t}p=new OpenLayers.Feature(this,p,o);this.features.push(p);o=p.createMarker();o.events.register("click",p,this.markerClick);this.addMarker(o)}}this.events.triggerEvent("loadend")},markerClick:function(e){var f=this==this.layer.selectedFeature;this.layer.selectedFeature=f?null:this;for(var g=0,h=this.layer.map.popups.length;g<h;g++){this.layer.map.removePopup(this.layer.map.popups[g])}f||(f=this.createPopup(),OpenLayers.Event.observe(f.div,"click",OpenLayers.Function.bind(function(){for(var c=0,d=this.layer.map.popups.length;c<d;c++){this.layer.map.removePopup(this.layer.map.popups[c])}},this)),this.layer.map.addPopup(f));OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features){for(;0<this.features.length;){var b=this.features[0];OpenLayers.Util.removeItem(this.features,b);b.destroy()}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(d,e){e=OpenLayers.Util.applyDefaults(e,this.options);var f={namedLayers:!0===e.namedLayersAsArray?[]:{}};this.readChildNodes(d,f);return f},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(c,d){d.version=c.getAttribute("version");this.readChildNodes(c,d)},Name:function(c,d){d.name=this.getChildValue(c)},Title:function(c,d){d.title=this.getChildValue(c)},Abstract:function(c,d){d.description=this.getChildValue(c)},NamedLayer:function(f,g){var h={userStyles:[],namedStyles:[]};this.readChildNodes(f,h);for(var i=0,j=h.userStyles.length;i<j;++i){h.userStyles[i].layerName=h.name}OpenLayers.Util.isArray(g.namedLayers)?g.namedLayers.push(h):g.namedLayers[h.name]=h},NamedStyle:function(c,d){d.namedStyles.push(this.getChildName(c.firstChild))},UserStyle:function(d,e){var f={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(d,f);this.multipleSymbolizers?(delete f.defaultsPerSymbolizer,f=new OpenLayers.Style2(f)):f=new OpenLayers.Style(this.defaultSymbolizer,f);e.userStyles.push(f)},IsDefault:function(c,d){"1"==this.getChildValue(c)&&(d.isDefault=!0)},FeatureTypeStyle:function(d,e){++this.featureTypeCounter;var f={rules:this.multipleSymbolizers?e.rules:[]};this.readChildNodes(d,f);this.multipleSymbolizers||(e.rules=f.rules)},Rule:function(d,e){var f;this.multipleSymbolizers&&(f={symbolizers:[]});f=new OpenLayers.Rule(f);this.readChildNodes(d,f);e.rules.push(f)},ElseFilter:function(c,d){d.elseFilter=!0},MinScaleDenominator:function(c,d){d.minScaleDenominator=parseFloat(this.getChildValue(c))},MaxScaleDenominator:function(c,d){d.maxScaleDenominator=parseFloat(this.getChildValue(c))},TextSymbolizer:function(d,e){var f={};this.readChildNodes(d,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,e.symbolizers.push(new OpenLayers.Symbolizer.Text(f))):e.symbolizer.Text=OpenLayers.Util.applyDefaults(f,e.symbolizer.Text)},LabelPlacement:function(c,d){this.readChildNodes(c,d)},PointPlacement:function(g,h){var i={};this.readChildNodes(g,i);i.labelRotation=i.rotation;delete i.rotation;var j,k=h.labelAnchorPointX,l=h.labelAnchorPointY;k<=1/3?j="l":k>1/3&&k<2/3?j="c":k>=2/3&&(j="r");l<=1/3?j+="b":l>1/3&&l<2/3?j+="m":l>=2/3&&(j+="t");i.labelAlign=j;OpenLayers.Util.applyDefaults(h,i)},AnchorPoint:function(c,d){this.readChildNodes(c,d)},AnchorPointX:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.labelAnchorPointX=f)},AnchorPointY:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.labelAnchorPointY=f)},Displacement:function(c,d){this.readChildNodes(c,d)},DisplacementX:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.labelXOffset=f)},DisplacementY:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.labelYOffset=f)},LinePlacement:function(c,d){this.readChildNodes(c,d)},PerpendicularOffset:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.labelPerpendicularOffset=f)},Label:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.label=f)},Font:function(c,d){this.readChildNodes(c,d)},Halo:function(d,e){var f={};this.readChildNodes(d,f);e.haloRadius=f.haloRadius;e.haloColor=f.fillColor;e.haloOpacity=f.fillOpacity},Radius:function(d,e){var f=this.readers.ogc._expression.call(this,d);null!=f&&(e.haloRadius=f)},RasterSymbolizer:function(d,e){var f={};this.readChildNodes(d,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,e.symbolizers.push(new OpenLayers.Symbolizer.Raster(f))):e.symbolizer.Raster=OpenLayers.Util.applyDefaults(f,e.symbolizer.Raster)},Geometry:function(c,d){d.geometry={};this.readChildNodes(c,d.geometry)},ColorMap:function(c,d){d.colorMap=[];this.readChildNodes(c,d.colorMap)},ColorMapEntry:function(e,f){var g=e.getAttribute("quantity"),h=e.getAttribute("opacity");f.push({color:e.getAttribute("color"),quantity:null!==g?parseFloat(g):void 0,label:e.getAttribute("label")||void 0,opacity:null!==h?parseFloat(h):void 0})},LineSymbolizer:function(d,e){var f={};this.readChildNodes(d,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,e.symbolizers.push(new OpenLayers.Symbolizer.Line(f))):e.symbolizer.Line=OpenLayers.Util.applyDefaults(f,e.symbolizer.Line)},PolygonSymbolizer:function(d,e){var f={fill:!1,stroke:!1};this.multipleSymbolizers||(f=e.symbolizer.Polygon||f);this.readChildNodes(d,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,e.symbolizers.push(new OpenLayers.Symbolizer.Polygon(f))):e.symbolizer.Polygon=f},PointSymbolizer:function(d,e){var f={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(f=e.symbolizer.Point||f);this.readChildNodes(d,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,e.symbolizers.push(new OpenLayers.Symbolizer.Point(f))):e.symbolizer.Point=f},Stroke:function(c,d){d.stroke=!0;this.readChildNodes(c,d)},Fill:function(c,d){d.fill=!0;this.readChildNodes(c,d)},CssParameter:function(e,f){var g=e.getAttribute("name"),h=this.cssMap[g];f.label&&("fill"===g?h="fontColor":"fill-opacity"===g&&(h="fontOpacity"));h&&(g=this.readers.ogc._expression.call(this,e))&&(f[h]=g)},Graphic:function(i,j){j.graphic=!0;var k={};this.readChildNodes(i,k);for(var l="stroke strokeColor strokeWidth strokeOpacity strokeLinecap fill fillColor fillOpacity graphicName rotation graphicFormat".split(" "),m,n,o=0,p=l.length;o<p;++o){m=l[o],n=k[m],void 0!=n&&(j[m]=n)}void 0!=k.opacity&&(j.graphicOpacity=k.opacity);void 0!=k.size&&(isNaN(k.size/2)?j.graphicWidth=k.size:j.pointRadius=k.size/2);void 0!=k.href&&(j.externalGraphic=k.href);void 0!=k.rotation&&(j.rotation=k.rotation)},ExternalGraphic:function(c,d){this.readChildNodes(c,d)},Mark:function(c,d){this.readChildNodes(c,d)},WellKnownName:function(c,d){d.graphicName=this.getChildValue(c)},Opacity:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.opacity=f)},Size:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.size=f)},Rotation:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.rotation=f)},OnlineResource:function(c,d){d.href=this.getAttributeNS(c,this.namespaces.xlink,"href")},Format:function(c,d){d.graphicFormat=this.getChildValue(c)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(d){var e=null,f;for(f in this.cssMap){if(this.cssMap[f]==d){e=f;break}}return e},getGraphicFormat:function(d){var e,f;for(f in this.graphicFormats){if(this.graphicFormats[f].test(d)){e=f;break}}return e||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(b){return this.writers.sld.StyledLayerDescriptor.apply(this,[b])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(i,j){var k=this.createElementNSPlus(i),l="string"==typeof j?j.split("${"):[j];k.appendChild(this.createTextNode(l[0]));for(var m,n,o=1,p=l.length;o<p;o++){m=l[o],n=m.indexOf("}"),0<n?(this.writeNode("ogc:PropertyName",{property:m.substring(0,n)},k),k.appendChild(this.createTextNode(m.substring(++n)))):k.appendChild(this.createTextNode("${"+m))}return k},StyledLayerDescriptor:function(e){var f=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});f.setAttribute("xmlns:ogc",this.namespaces.ogc);f.setAttribute("xmlns:gml",this.namespaces.gml);e.name&&this.writeNode("Name",e.name,f);e.title&&this.writeNode("Title",e.title,f);e.description&&this.writeNode("Abstract",e.description,f);if(OpenLayers.Util.isArray(e.namedLayers)){for(var g=0,h=e.namedLayers.length;g<h;++g){this.writeNode("NamedLayer",e.namedLayers[g],f)}}else{for(g in e.namedLayers){this.writeNode("NamedLayer",e.namedLayers[g],f)}}return f},Name:function(b){return this.createElementNSPlus("sld:Name",{value:b})},Title:function(b){return this.createElementNSPlus("sld:Title",{value:b})},Abstract:function(b){return this.createElementNSPlus("sld:Abstract",{value:b})},NamedLayer:function(e){var f=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",e.name,f);if(e.namedStyles){for(var g=0,h=e.namedStyles.length;g<h;++g){this.writeNode("NamedStyle",e.namedStyles[g],f)}}if(e.userStyles){for(g=0,h=e.userStyles.length;g<h;++g){this.writeNode("UserStyle",e.userStyles[g],f)}}return f},NamedStyle:function(c){var d=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",c,d);return d},UserStyle:function(i){var j=this.createElementNSPlus("sld:UserStyle");i.name&&this.writeNode("Name",i.name,j);i.title&&this.writeNode("Title",i.title,j);i.description&&this.writeNode("Abstract",i.description,j);i.isDefault&&this.writeNode("IsDefault",i.isDefault,j);if(this.multipleSymbolizers&&i.rules){for(var o={0:[]},q=[0],r,s,t,u,v,w=0,x=i.rules.length;w<x;++w){if(r=i.rules[w],r.symbolizers){s={};for(var y=0,z=r.symbolizers.length;y<z;++y){t=r.symbolizers[y],u=t.zIndex,u in s||(v=r.clone(),v.symbolizers=[],s[u]=v),s[u].symbolizers.push(t.clone())}for(u in s){u in o||(q.push(u),o[u]=[]),o[u].push(s[u])}}else{o[0].push(r.clone())}}q.sort();w=0;for(x=q.length;w<x;++w){r=o[q[w]],0<r.length&&(v=i.clone(),v.rules=o[q[w]],this.writeNode("FeatureTypeStyle",v,j))}}else{this.writeNode("FeatureTypeStyle",i,j)}return j},IsDefault:function(b){return this.createElementNSPlus("sld:IsDefault",{value:b?"1":"0"})},FeatureTypeStyle:function(e){for(var f=this.createElementNSPlus("sld:FeatureTypeStyle"),g=0,h=e.rules.length;g<h;++g){this.writeNode("Rule",e.rules[g],f)}return f},Rule:function(h){var i=this.createElementNSPlus("sld:Rule");h.name&&this.writeNode("Name",h.name,i);h.title&&this.writeNode("Title",h.title,i);h.description&&this.writeNode("Abstract",h.description,i);h.elseFilter?this.writeNode("ElseFilter",null,i):h.filter&&this.writeNode("ogc:Filter",h.filter,i);void 0!=h.minScaleDenominator&&this.writeNode("MinScaleDenominator",h.minScaleDenominator,i);void 0!=h.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",h.maxScaleDenominator,i);var j,k;if(this.multipleSymbolizers&&h.symbolizers){for(var l=0,m=h.symbolizers.length;l<m;++l){k=h.symbolizers[l],j=k.CLASS_NAME.split(".").pop(),this.writeNode(j+"Symbolizer",k,i)}}else{for(var m=OpenLayers.Style.SYMBOLIZER_PREFIXES,l=0,n=m.length;l<n;++l){j=m[l],(k=h.symbolizer[j])&&this.writeNode(j+"Symbolizer",k,i)}}return i},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(b){return this.createElementNSPlus("sld:MinScaleDenominator",{value:b})},MaxScaleDenominator:function(b){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:b})},LineSymbolizer:function(c){var d=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",c,d);return d},Stroke:function(c){var d=this.createElementNSPlus("sld:Stroke");void 0!=c.strokeColor&&this.writeNode("CssParameter",{symbolizer:c,key:"strokeColor"},d);void 0!=c.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:c,key:"strokeOpacity"},d);void 0!=c.strokeWidth&&this.writeNode("CssParameter",{symbolizer:c,key:"strokeWidth"},d);void 0!=c.strokeDashstyle&&"solid"!==c.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:c,key:"strokeDashstyle"},d);void 0!=c.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:c,key:"strokeLinecap"},d);return d},CssParameter:function(b){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(b.key)},value:b.symbolizer[b.key]})},TextSymbolizer:function(c){var d=this.createElementNSPlus("sld:TextSymbolizer");null!=c.label&&this.writeNode("Label",c.label,d);null==c.fontFamily&&null==c.fontSize&&null==c.fontWeight&&null==c.fontStyle||this.writeNode("Font",c,d);null==c.labelAnchorPointX&&null==c.labelAnchorPointY&&null==c.labelAlign&&null==c.labelXOffset&&null==c.labelYOffset&&null==c.labelRotation&&null==c.labelPerpendicularOffset||this.writeNode("LabelPlacement",c,d);null==c.haloRadius&&null==c.haloColor&&null==c.haloOpacity||this.writeNode("Halo",c,d);null==c.fontColor&&null==c.fontOpacity||this.writeNode("Fill",{fillColor:c.fontColor,fillOpacity:c.fontOpacity},d);return d},LabelPlacement:function(c){var d=this.createElementNSPlus("sld:LabelPlacement");null==c.labelAnchorPointX&&null==c.labelAnchorPointY&&null==c.labelAlign&&null==c.labelXOffset&&null==c.labelYOffset&&null==c.labelRotation||null!=c.labelPerpendicularOffset||this.writeNode("PointPlacement",c,d);null!=c.labelPerpendicularOffset&&this.writeNode("LinePlacement",c,d);return d},LinePlacement:function(c){var d=this.createElementNSPlus("sld:LinePlacement");this.writeNode("PerpendicularOffset",c.labelPerpendicularOffset,d);return d},PerpendicularOffset:function(b){return this.createElementNSPlus("sld:PerpendicularOffset",{value:b})},PointPlacement:function(c){var d=this.createElementNSPlus("sld:PointPlacement");null==c.labelAnchorPointX&&null==c.labelAnchorPointY&&null==c.labelAlign||this.writeNode("AnchorPoint",c,d);null==c.labelXOffset&&null==c.labelYOffset||this.writeNode("Displacement",c,d);null!=c.labelRotation&&this.writeNode("Rotation",c.labelRotation,d);return d},AnchorPoint:function(f){var g=this.createElementNSPlus("sld:AnchorPoint"),h=f.labelAnchorPointX,i=f.labelAnchorPointY;null!=h&&this.writeNode("AnchorPointX",h,g);null!=i&&this.writeNode("AnchorPointY",i,g);if(null==h&&null==i){var j=f.labelAlign.substr(0,1);f=f.labelAlign.substr(1,1);"l"===j?h=0:"c"===j?h=0.5:"r"===j&&(h=1);"b"===f?i=0:"m"===f?i=0.5:"t"===f&&(i=1);this.writeNode("AnchorPointX",h,g);this.writeNode("AnchorPointY",i,g)}return g},AnchorPointX:function(b){return this.createElementNSPlus("sld:AnchorPointX",{value:b})},AnchorPointY:function(b){return this.createElementNSPlus("sld:AnchorPointY",{value:b})},Displacement:function(c){var d=this.createElementNSPlus("sld:Displacement");null!=c.labelXOffset&&this.writeNode("DisplacementX",c.labelXOffset,d);null!=c.labelYOffset&&this.writeNode("DisplacementY",c.labelYOffset,d);return d},DisplacementX:function(b){return this.createElementNSPlus("sld:DisplacementX",{value:b})},DisplacementY:function(b){return this.createElementNSPlus("sld:DisplacementY",{value:b})},Font:function(c){var d=this.createElementNSPlus("sld:Font");c.fontFamily&&this.writeNode("CssParameter",{symbolizer:c,key:"fontFamily"},d);c.fontSize&&this.writeNode("CssParameter",{symbolizer:c,key:"fontSize"},d);c.fontWeight&&this.writeNode("CssParameter",{symbolizer:c,key:"fontWeight"},d);c.fontStyle&&this.writeNode("CssParameter",{symbolizer:c,key:"fontStyle"},d);return d},Label:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Label",b)},Halo:function(c){var d=this.createElementNSPlus("sld:Halo");c.haloRadius&&this.writeNode("Radius",c.haloRadius,d);(c.haloColor||c.haloOpacity)&&this.writeNode("Fill",{fillColor:c.haloColor,fillOpacity:c.haloOpacity},d);return d},Radius:function(b){return this.createElementNSPlus("sld:Radius",{value:b})},RasterSymbolizer:function(c){var d=this.createElementNSPlus("sld:RasterSymbolizer");c.geometry&&this.writeNode("Geometry",c.geometry,d);c.opacity&&this.writeNode("Opacity",c.opacity,d);c.colorMap&&this.writeNode("ColorMap",c.colorMap,d);return d},Geometry:function(c){var d=this.createElementNSPlus("sld:Geometry");c.property&&this.writeNode("ogc:PropertyName",c,d);return d},ColorMap:function(e){for(var f=this.createElementNSPlus("sld:ColorMap"),g=0,h=e.length;g<h;++g){this.writeNode("ColorMapEntry",e[g],f)}return f},ColorMapEntry:function(c){var d=this.createElementNSPlus("sld:ColorMapEntry");d.setAttribute("color",c.color);void 0!==c.opacity&&d.setAttribute("opacity",parseFloat(c.opacity));void 0!==c.quantity&&d.setAttribute("quantity",parseFloat(c.quantity));void 0!==c.label&&d.setAttribute("label",c.label);return d},PolygonSymbolizer:function(c){var d=this.createElementNSPlus("sld:PolygonSymbolizer");!1!==c.fill&&this.writeNode("Fill",c,d);!1!==c.stroke&&this.writeNode("Stroke",c,d);return d},Fill:function(c){var d=this.createElementNSPlus("sld:Fill");c.fillColor&&this.writeNode("CssParameter",{symbolizer:c,key:"fillColor"},d);null!=c.fillOpacity&&this.writeNode("CssParameter",{symbolizer:c,key:"fillOpacity"},d);return d},PointSymbolizer:function(c){var d=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",c,d);return d},Graphic:function(c){var d=this.createElementNSPlus("sld:Graphic");void 0!=c.externalGraphic?this.writeNode("ExternalGraphic",c,d):this.writeNode("Mark",c,d);void 0!=c.graphicOpacity&&this.writeNode("Opacity",c.graphicOpacity,d);void 0!=c.pointRadius?this.writeNode("Size",2*c.pointRadius,d):void 0!=c.graphicWidth&&this.writeNode("Size",c.graphicWidth,d);void 0!=c.rotation&&this.writeNode("Rotation",c.rotation,d);return d},ExternalGraphic:function(c){var d=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",c.externalGraphic,d);c=c.graphicFormat||this.getGraphicFormat(c.externalGraphic);this.writeNode("Format",c,d);return d},Mark:function(c){var d=this.createElementNSPlus("sld:Mark");c.graphicName&&this.writeNode("WellKnownName",c.graphicName,d);!1!==c.fill&&this.writeNode("Fill",c,d);!1!==c.stroke&&this.writeNode("Stroke",c,d);return d},WellKnownName:function(b){return this.createElementNSPlus("sld:WellKnownName",{value:b})},Opacity:function(b){return this.createElementNSPlus("sld:Opacity",{value:b})},Size:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Size",b)},Rotation:function(b){return this.createElementNSPlus("sld:Rotation",{value:b})},OnlineResource:function(b){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":b}})},Format:function(b){return this.createElementNSPlus("sld:Format",{value:b})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(f,g,h,i){var j=[];h=OpenLayers.Util.upperCaseObject(h);1.3<=parseFloat(h.VERSION)&&!h.EXCEPTIONS&&(h.EXCEPTIONS="INIMAGE");j.push(f,g,h,i);OpenLayers.Layer.Grid.prototype.initialize.apply(this,j);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));!this.noMagic&&(this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase())&&(null!=i&&i.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(b){null==b&&(b=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},reverseAxisOrder:function(){var b=this.projection.getCode();return 1.3<=parseFloat(this.params.VERSION)&&!!(this.yx[b]||OpenLayers.Projection.defaults[b]&&OpenLayers.Projection.defaults[b].yx)},getURL:function(e){e=this.adjustBounds(e);var f=this.getImageSize(),g={},h=this.reverseAxisOrder();g.BBOX=this.encodeBBOX?e.toBBOX(null,h):e.toArray(h);g.WIDTH=f.w;g.HEIGHT=f.h;return this.getFullRequestString(g)},mergeNewParams:function(b){b=[OpenLayers.Util.upperCaseObject(b)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b)},getFullRequestString:function(d,e){var f=this.map.getProjectionObject(),f=this.projection&&this.projection.equals(f)?this.projection.getCode():f.getCode(),f="none"==f?null:f;1.3<=parseFloat(this.params.VERSION)?this.params.CRS=f:this.params.SRS=f;"boolean"==typeof this.params.TRANSPARENT&&(d.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(e,f,g,h){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(e){e=this.adjustBounds(e);var f=this.map.getResolution(),g=Math.round(10000*this.map.getScale())/10000,h=Math.round(e.left/f);e=-Math.round(e.top/f);return this.getFullRequestString({t:e,l:h,s:g})},calculateGridLayout:function(d,e,f){e=f*this.tileSize.w;f*=this.tileSize.h;return{tilelon:e,tilelat:f,startcol:Math.floor(d.left/e)-this.buffer,startrow:Math.floor(d.top/f)+this.buffer}},getTileBoundsForGridIndex:function(g,h){this.getTileOrigin();var i=this.gridLayout,j=i.tilelon,k=i.tilelat,l=(i.startcol+h)*j,i=(i.startrow-g)*k;return new OpenLayers.Bounds(l,i,l+j,i+k)},clone:function(b){null==b&&(b=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions()));b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b]);null!=this.tileSize&&(b.tileSize=this.tileSize.clone());b.grid=[];return b},getTileBounds:function(e){var f=this.getResolution(),g=f*this.tileSize.w,f=f*this.tileSize.h,h=this.getLonLatFromViewPortPx(e);e=g*Math.floor(h.lon/g);h=f*Math.floor(h.lat/f);return new OpenLayers.Bounds(e,h,e+g,h+f)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(b){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[b])},read_sld_MinScaleDenominator:function(d,e){var f=parseFloat(this.getChildValue(e));0<f&&(d.maxScale=f)},read_sld_MaxScaleDenominator:function(c,d){c.minScale=parseFloat(this.getChildValue(d))},read_wmc_SRS:function(c,d){"srs" in c||(c.srs={});c.srs[this.getChildValue(d)]=!0},write_wmc_Layer:function(e){var f=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.maxScale){var g=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");g.appendChild(this.createTextNode(e.maxScale.toPrecision(16)));f.appendChild(g)}e.minScale&&(g=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator"),g.appendChild(this.createTextNode(e.minScale.toPrecision(16))),f.appendChild(g));if(e.srs){for(var h in e.srs){f.appendChild(this.createElementDefaultNS("SRS",h))}}f.appendChild(this.write_wmc_FormatList(e));f.appendChild(this.write_wmc_StyleList(e));e.dimensions&&f.appendChild(this.write_wmc_DimensionList(e));f.appendChild(this.write_wmc_LayerExtension(e));return f},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"});OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(d,e){OpenLayers.Util.applyDefaults(e,this.options);var f={};this.readChildNodes(d,f);return f},readers:{xls:{XLS:function(c,d){d.version=c.getAttribute("version");this.readChildNodes(c,d)},Response:function(c,d){this.readChildNodes(c,d)},GeocodeResponse:function(c,d){d.responseLists=[];this.readChildNodes(c,d)},GeocodeResponseList:function(d,e){var f={features:[],numberOfGeocodedAddresses:parseInt(d.getAttribute("numberOfGeocodedAddresses"))};e.responseLists.push(f);this.readChildNodes(d,f)},GeocodedAddress:function(d,e){var f=new OpenLayers.Feature.Vector;e.features.push(f);this.readChildNodes(d,f);f.geometry=f.components[0]},GeocodeMatchCode:function(c,d){d.attributes.matchCode={accuracy:parseFloat(c.getAttribute("accuracy")),matchType:c.getAttribute("matchType")}},Address:function(d,e){var f={countryCode:d.getAttribute("countryCode"),addressee:d.getAttribute("addressee"),street:[],place:[]};e.attributes.address=f;this.readChildNodes(d,f)},freeFormAddress:function(c,d){d.freeFormAddress=this.getChildValue(c)},StreetAddress:function(c,d){this.readChildNodes(c,d)},Building:function(c,d){d.building={number:c.getAttribute("number"),subdivision:c.getAttribute("subdivision"),buildingName:c.getAttribute("buildingName")}},Street:function(c,d){d.street.push(this.getChildValue(c))},Place:function(c,d){d.place[c.getAttribute("type")]=this.getChildValue(c)},PostalCode:function(c,d){d.postalCode=this.getChildValue(c)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(b){return this.writers.xls.XLS.apply(this,[b])},writers:{xls:{XLS:function(c){var d=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});this.writeNode("RequestHeader",c.header,d);this.writeNode("Request",c,d);return d},RequestHeader:function(b){return this.createElementNSPlus("xls:RequestHeader")},Request:function(c){var d=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:c.requestID||"",version:this.VERSION}});this.writeNode("GeocodeRequest",c.addresses,d);return d},GeocodeRequest:function(e){for(var f=this.createElementNSPlus("xls:GeocodeRequest"),g=0,h=e.length;g<h;g++){this.writeNode("Address",e[g],f)}return f},Address:function(c){var d=this.createElementNSPlus("xls:Address",{attributes:{countryCode:c.countryCode}});c.freeFormAddress?this.writeNode("freeFormAddress",c.freeFormAddress,d):(c.street&&this.writeNode("StreetAddress",c,d),c.municipality&&this.writeNode("Municipality",c.municipality,d),c.countrySubdivision&&this.writeNode("CountrySubdivision",c.countrySubdivision,d),c.postalCode&&this.writeNode("PostalCode",c.postalCode,d));return d},freeFormAddress:function(b){return this.createElementNSPlus("freeFormAddress",{value:b})},StreetAddress:function(e){var f=this.createElementNSPlus("xls:StreetAddress");e.building&&this.writeNode(f,"Building",e.building);e=e.street;OpenLayers.Util.isArray(e)||(e=[e]);for(var g=0,h=e.length;g<h;g++){this.writeNode("Street",e[g],f)}return f},Building:function(b){return this.createElementNSPlus("xls:Building",{attributes:{number:b.number,subdivision:b.subdivision,buildingName:b.buildingName}})},Street:function(b){return this.createElementNSPlus("xls:Street",{value:b})},Municipality:function(b){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:b})},CountrySubdivision:function(b){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:b})},PostalCode:function(b){return this.createElementNSPlus("xls:PostalCode",{value:b})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"});OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"});OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0;OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(b){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(d,e,f){d+=f?0:this.translationParameters.x;e+=f?0:this.translationParameters.y;return d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL},setExtent:function(f,g){var h=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),i=this.getResolution(),j=-f.left/i,i=f.top/i;if(g){return this.left=j,this.top=i,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0}(j=this.translate(j-this.left+this.xOffset,i-this.top))||this.setExtent(f,!0);return h&&j},translate:function(d,e){if(this.inValidRange(d,e,!0)){var f="";if(d||e){f="translate("+d+","+e+")"}this.root.setAttributeNS(null,"transform",f);this.translationParameters={x:d,y:e};return !0}return !1},setSize:function(b){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(d,e){var f=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":f=e.externalGraphic?"image":this.isComplexSymbol(e.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":f="rect";break;case"OpenLayers.Geometry.LineString":f="polyline";break;case"OpenLayers.Geometry.LinearRing":f="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":f="path"}return f},setStyle:function(i,j,m){j=j||i._style;m=m||i._options;var n=j.title||j.graphicTitle;if(n){i.setAttributeNS(null,"title",n);var o=i.getElementsByTagName("title");0<o.length?o[0].firstChild.textContent=n:(o=this.nodeFactory(null,"title"),o.textContent=n,i.appendChild(o))}var o=parseFloat(i.getAttributeNS(null,"r")),n=1,p;if("OpenLayers.Geometry.Point"==i._geometryClass&&o){i.style.visibility="";if(!1===j.graphic){i.style.visibility="hidden"}else{if(j.externalGraphic){p=this.getPosition(i);j.graphicWidth&&j.graphicHeight&&i.setAttributeNS(null,"preserveAspectRatio","none");var o=j.graphicWidth||j.graphicHeight,q=j.graphicHeight||j.graphicWidth,o=o?o:2*j.pointRadius,q=q?q:2*j.pointRadius,r=void 0!=j.graphicYOffset?j.graphicYOffset:-(0.5*q),s=j.graphicOpacity||j.fillOpacity;i.setAttributeNS(null,"x",(p.x+(void 0!=j.graphicXOffset?j.graphicXOffset:-(0.5*o))).toFixed());i.setAttributeNS(null,"y",(p.y+r).toFixed());i.setAttributeNS(null,"width",o);i.setAttributeNS(null,"height",q);i.setAttributeNS(this.xlinkns,"xlink:href",j.externalGraphic);i.setAttributeNS(null,"style","opacity: "+s);i.onclick=OpenLayers.Event.preventDefault}else{if(this.isComplexSymbol(j.graphicName)){var o=3*j.pointRadius,q=2*o,t=this.importSymbol(j.graphicName);p=this.getPosition(i);n=3*this.symbolMetrics[t.id][0]/q;r=i.parentNode;s=i.nextSibling;r&&r.removeChild(i);i.firstChild&&i.removeChild(i.firstChild);i.appendChild(t.firstChild.cloneNode(!0));i.setAttributeNS(null,"viewBox",t.getAttributeNS(null,"viewBox"));i.setAttributeNS(null,"width",q);i.setAttributeNS(null,"height",q);i.setAttributeNS(null,"x",p.x-o);i.setAttributeNS(null,"y",p.y-o);s?r.insertBefore(i,s):r&&r.appendChild(i)}else{i.setAttributeNS(null,"r",j.pointRadius)}}}o=j.rotation;void 0===o&&void 0===i._rotation||!p||(i._rotation=o,o|=0,"svg"!==i.nodeName?i.setAttributeNS(null,"transform","rotate("+o+" "+p.x+" "+p.y+")"):(p=this.symbolMetrics[t.id],i.firstChild.setAttributeNS(null,"transform","rotate("+o+" "+p[1]+" "+p[2]+")")))}m.isFilled?(i.setAttributeNS(null,"fill",j.fillColor),i.setAttributeNS(null,"fill-opacity",j.fillOpacity)):i.setAttributeNS(null,"fill","none");m.isStroked?(i.setAttributeNS(null,"stroke",j.strokeColor),i.setAttributeNS(null,"stroke-opacity",j.strokeOpacity),i.setAttributeNS(null,"stroke-width",j.strokeWidth*n),i.setAttributeNS(null,"stroke-linecap",j.strokeLinecap||"round"),i.setAttributeNS(null,"stroke-linejoin","round"),j.strokeDashstyle&&i.setAttributeNS(null,"stroke-dasharray",this.dashStyle(j,n))):i.setAttributeNS(null,"stroke","none");j.pointerEvents&&i.setAttributeNS(null,"pointer-events",j.pointerEvents);null!=j.cursor&&i.setAttributeNS(null,"cursor",j.cursor);return i},dashStyle:function(e,f){var g=e.strokeWidth*f,h=e.strokeDashstyle;switch(h){case"solid":return"none";case"dot":return[1,4*g].join();case"dash":return[4*g,4*g].join();case"dashdot":return[4*g,4*g,1,4*g].join();case"longdash":return[8*g,4*g].join();case"longdashdot":return[8*g,4*g,1,4*g].join();default:return OpenLayers.String.trim(h).replace(/\s+/g,",")}},createNode:function(d,e){var f=document.createElementNS(this.xmlns,d);e&&f.setAttributeNS(null,"id",e);return f},nodeTypeCompare:function(c,d){return d==c.nodeName},createRenderRoot:function(){var b=this.nodeFactory(this.container.id+"_svgRoot","svg");b.style.display="block";return b},createRoot:function(b){return this.nodeFactory(this.container.id+b,"g")},createDefs:function(){var b=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(b);return b},drawPoint:function(c,d){return this.drawCircle(c,d,1)},drawCircle:function(f,g,h){var i=this.getResolution(),j=(g.x-this.featureDx)/i+this.left;g=this.top-g.y/i;return this.inValidRange(j,g)?(f.setAttributeNS(null,"cx",j),f.setAttributeNS(null,"cy",g),f.setAttributeNS(null,"r",h),f):!1},drawLineString:function(d,e){var f=this.getComponentsString(e.components);return f.path?(d.setAttributeNS(null,"points",f.path),f.complete?d:null):!1},drawLinearRing:function(d,e){var f=this.getComponentsString(e.components);return f.path?(d.setAttributeNS(null,"points",f.path),f.complete?d:null):!1},drawPolygon:function(i,j){for(var l="",m=!0,n=!0,o,p,q=0,r=j.components.length;q<r;q++){l+=" M",o=this.getComponentsString(j.components[q].components," "),(p=o.path)?(l+=" "+p,n=o.complete&&n):m=!1}return m?(i.setAttributeNS(null,"d",l+" z"),i.setAttributeNS(null,"fill-rule","evenodd"),n?i:null):!1},drawRectangle:function(f,g){var h=this.getResolution(),i=(g.x-this.featureDx)/h+this.left,j=this.top-g.y/h;return this.inValidRange(i,j)?(f.setAttributeNS(null,"x",i),f.setAttributeNS(null,"y",j),f.setAttributeNS(null,"width",g.width/h),f.setAttributeNS(null,"height",g.height/h),f):!1},drawText:function(i,j,o){var p=!!j.labelOutlineWidth;if(p){var q=OpenLayers.Util.extend({},j);q.fontColor=q.labelOutlineColor;q.fontStrokeColor=q.labelOutlineColor;q.fontStrokeWidth=j.labelOutlineWidth;j.labelOutlineOpacity&&(q.fontOpacity=j.labelOutlineOpacity);delete q.labelOutlineWidth;this.drawText(i,q,o)}var r=this.getResolution(),q=(o.x-this.featureDx)/r+this.left,s=o.y/r-this.top,p=p?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,r=this.nodeFactory(i+p,"text");r.setAttributeNS(null,"x",q);r.setAttributeNS(null,"y",-s);j.fontColor&&r.setAttributeNS(null,"fill",j.fontColor);j.fontStrokeColor&&r.setAttributeNS(null,"stroke",j.fontStrokeColor);j.fontStrokeWidth&&r.setAttributeNS(null,"stroke-width",j.fontStrokeWidth);j.fontOpacity&&r.setAttributeNS(null,"opacity",j.fontOpacity);j.fontFamily&&r.setAttributeNS(null,"font-family",j.fontFamily);j.fontSize&&r.setAttributeNS(null,"font-size",j.fontSize);j.fontWeight&&r.setAttributeNS(null,"font-weight",j.fontWeight);j.fontStyle&&r.setAttributeNS(null,"font-style",j.fontStyle);!0===j.labelSelect?(r.setAttributeNS(null,"pointer-events","visible"),r._featureId=i):r.setAttributeNS(null,"pointer-events","none");s=j.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;r.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[s[0]]||"middle");!0===OpenLayers.IS_GECKO&&r.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[s[1]]||"central");for(var t=j.label.split("\n"),u=t.length;r.childNodes.length>u;){r.removeChild(r.lastChild)}for(var v=0;v<u;v++){var w=this.nodeFactory(i+p+"_tspan_"+v,"tspan");!0===j.labelSelect&&(w._featureId=i,w._geometry=o,w._geometryClass=o.CLASS_NAME);!1===OpenLayers.IS_GECKO&&w.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[s[1]]||"-35%");w.setAttribute("x",q);if(0==v){var x=OpenLayers.Renderer.SVG.LABEL_VFACTOR[s[1]];null==x&&(x=-0.5);w.setAttribute("dy",x*(u-1)+"em")}else{w.setAttribute("dy","1em")}w.textContent=""===t[v]?" ":t[v];w.parentNode||r.appendChild(w)}r.parentNode||this.textRoot.appendChild(r)},getComponentsString:function(i,j){for(var k=[],l=!0,m=i.length,n=[],o,p=0;p<m;p++){o=i[p],k.push(o),(o=this.getShortString(o))?n.push(o):(0<p&&this.getShortString(i[p-1])&&n.push(this.clipLine(i[p],i[p-1])),p<m-1&&this.getShortString(i[p+1])&&n.push(this.clipLine(i[p],i[p+1])),l=!1)}return{path:n.join(j||","),complete:l}},clipLine:function(i,j){if(j.equals(i)){return""}var l=this.getResolution(),m=this.MAX_PIXEL-this.translationParameters.x,n=this.MAX_PIXEL-this.translationParameters.y,o=(j.x-this.featureDx)/l+this.left,p=this.top-j.y/l,q=(i.x-this.featureDx)/l+this.left,l=this.top-i.y/l,r;if(q<-m||q>m){r=(l-p)/(q-o),q=0>q?-m:m,l=p+(q-o)*r}if(l<-n||l>n){r=(q-o)/(l-p),l=0>l?-n:n,q=o+(l-p)*r}return q+","+l},getShortString:function(d){var e=this.getResolution(),f=(d.x-this.featureDx)/e+this.left;d=this.top-d.y/e;return this.inValidRange(f,d)?f+","+d:!1},getPosition:function(b){return{x:parseFloat(b.getAttributeNS(null,"cx")),y:parseFloat(b.getAttributeNS(null,"cy"))}},importSymbol:function(i){this.defs||(this.defs=this.createDefs());var j=this.container.id+"-"+i,l=document.getElementById(j);if(null!=l){return l}var m=OpenLayers.Renderer.symbol[i];if(!m){throw Error(i+" is not a valid symbol name")}i=this.nodeFactory(j,"symbol");var n=this.nodeFactory(null,"polygon");i.appendChild(n);for(var l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),o=[],p,q,r=0;r<m.length;r+=2){p=m[r],q=m[r+1],l.left=Math.min(l.left,p),l.bottom=Math.min(l.bottom,q),l.right=Math.max(l.right,p),l.top=Math.max(l.top,q),o.push(p,",",q)}n.setAttributeNS(null,"points",o.join(" "));m=l.getWidth();n=l.getHeight();i.setAttributeNS(null,"viewBox",[l.left-m,l.bottom-n,3*m,3*n].join(" "));this.symbolMetrics[j]=[Math.max(m,n),l.getCenterLonLat().lon,l.getCenterLonLat().lat];this.defs.appendChild(i);return i},getFeatureIdFromEvent:function(c){var d=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);d||(d=c.target,d=d.parentNode&&d!=this.rendererRoot?d.parentNode._featureId:void 0);return d},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(b){OpenLayers.Event.preventDefault(b)};OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(d,e){var f=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);"0.3.0"===f&&(f=this.defaultVersion);return f},toContext:function(c){var d={};"OpenLayers.Map"==c.CLASS_NAME&&(d.bounds=c.getExtent(),d.maxExtent=c.maxExtent,d.projection=c.projection,d.size=c.getSize(),d.layers=c.layers);return d},CLASS_NAME:"OpenLayers.Format.OWSContext"});OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(g){if(g.layersContext){for(var h=0,i=g.layersContext.length;h<i;h++){var j=g.layersContext[h],k=[],l=g.title||"";g.metadata&&g.metadata.nestingPath&&(k=g.metadata.nestingPath.slice());""!=l&&k.push(l);j.metadata.nestingPath=k;j.layersContext&&this.setNestingPath(j)}}},decomposeNestingPath:function(c){var d=[];if(OpenLayers.Util.isArray(c)){for(c=c.slice();0<c.length;){d.push(c.slice()),c.pop()}d.reverse()}return d},read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);this.setNestingPath({layersContext:d.layersContext});c=[];this.processLayer(c,d);delete d.layersContext;d.layersContext=c;return d},processLayer:function(f,g){if(g.layersContext){for(var h=0,i=g.layersContext.length;h<i;h++){var j=g.layersContext[h];f.push(j);j.layersContext&&this.processLayer(f,j)}}},write:function(d,e){this.nestingLayerLookup={};e=e||{};OpenLayers.Util.applyDefaults(e,d);var f=this.writeNode("OWSContext",e);this.nestingLayerLookup=null;this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[f])},readers:{kml:{Document:function(c,d){d.features=(new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0})).read(c)}},owc:{OWSContext:function(c,d){this.readChildNodes(c,d)},General:function(c,d){this.readChildNodes(c,d)},ResourceList:function(c,d){this.readChildNodes(c,d)},Layer:function(d,e){var f={metadata:{},visibility:"1"!=d.getAttribute("hidden"),queryable:"1"==d.getAttribute("queryable"),opacity:null!=d.getAttribute("opacity")?parseFloat(d.getAttribute("opacity")):null,name:d.getAttribute("name"),categoryLayer:null==d.getAttribute("name"),formats:[],styles:[]};e.layersContext||(e.layersContext=[]);e.layersContext.push(f);this.readChildNodes(d,f)},InlineGeometry:function(e,f){f.features=[];var g=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember"),h;1<=g.length&&(h=g[0]);h&&h.firstChild&&(g=h.firstChild.nextSibling?h.firstChild.nextSibling:h.firstChild,this.setNamespace("feature",g.namespaceURI),this.featureType=g.localName||g.nodeName.split(":").pop(),this.readChildNodes(e,f))},Server:function(c,d){if(!d.service&&!d.version||d.service!=OpenLayers.Format.Context.serviceTypes.WMS){d.service=c.getAttribute("service"),d.version=c.getAttribute("version"),this.readChildNodes(c,d)}},Name:function(c,d){d.name=this.getChildValue(c);this.readChildNodes(c,d)},Title:function(c,d){d.title=this.getChildValue(c);this.readChildNodes(c,d)},StyleList:function(c,d){this.readChildNodes(c,d.styles)},Style:function(d,e){var f={};e.push(f);this.readChildNodes(d,f)},LegendURL:function(d,e){var f={};e.legend=f;this.readChildNodes(d,f)},OnlineResource:function(c,d){d.url=this.getAttributeNS(c,this.namespaces.xlink,"href");this.readChildNodes(c,d)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(c){var d=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:c.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});this.writeNode("General",c,d);this.writeNode("ResourceList",c,d);return d},General:function(c){var d=this.createElementNSPlus("General");this.writeNode("ows:BoundingBox",c,d);this.writeNode("ows:Title",c.title||"OpenLayers OWSContext",d);return d},ResourceList:function(g){for(var h=this.createElementNSPlus("ResourceList"),i=0,j=g.layers.length;i<j;i++){var k=g.layers[i],l=this.decomposeNestingPath(k.metadata.nestingPath);this.writeNode("_Layer",{layer:k,subPaths:l},h)}return h},Server:function(c){var d=this.createElementNSPlus("Server",{attributes:{version:c.version,service:c.service}});this.writeNode("OnlineResource",c,d);return d},OnlineResource:function(b){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":b.url}})},InlineGeometry:function(e){var f=this.createElementNSPlus("InlineGeometry"),g=e.getDataExtent();null!==g&&this.writeNode("gml:boundedBy",g,f);for(var g=0,h=e.features.length;g<h;g++){this.writeNode("gml:featureMember",e.features[g],f)}return f},StyleList:function(e){for(var f=this.createElementNSPlus("StyleList"),g=0,h=e.length;g<h;g++){this.writeNode("Style",e[g],f)}return f},Style:function(c){var d=this.createElementNSPlus("Style");this.writeNode("Name",c,d);this.writeNode("Title",c,d);c.legend&&this.writeNode("LegendURL",c,d);return d},Name:function(b){return this.createElementNSPlus("Name",{value:b.name})},Title:function(b){return this.createElementNSPlus("Title",{value:b.title})},LegendURL:function(c){var d=this.createElementNSPlus("LegendURL");this.writeNode("OnlineResource",c.legend,d);return d},_WMS:function(c){var d=this.createElementNSPlus("Layer",{attributes:{name:c.params.LAYERS,queryable:c.queryable?"1":"0",hidden:c.visibility?"0":"1",opacity:c.hasOwnProperty("opacity")?c.opacity:null}});this.writeNode("ows:Title",c.name,d);this.writeNode("ows:OutputFormat",c.params.FORMAT,d);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:c.params.VERSION,url:c.url},d);c.metadata.styles&&0<c.metadata.styles.length&&this.writeNode("StyleList",c.metadata.styles,d);return d},_Layer:function(e){var f,g,h;f=e.layer;g=e.subPaths;h=null;0<g.length?(f=g[0].join("/"),g=f.lastIndexOf("/"),h=this.nestingLayerLookup[f],g=0<g?f.substring(g+1,f.length):f,h||(h=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",g,h),this.nestingLayerLookup[f]=h),e.subPaths.shift(),this.writeNode("_Layer",e,h)):(f instanceof OpenLayers.Layer.WMS?h=this.writeNode("_WMS",f):f instanceof OpenLayers.Layer.Vector&&(f.protocol instanceof OpenLayers.Protocol.WFS.v1?h=this.writeNode("_WFS",f):f.protocol instanceof OpenLayers.Protocol.HTTP?f.protocol.format instanceof OpenLayers.Format.GML?(f.protocol.format.version="2.1.2",h=this.writeNode("_GML",f)):f.protocol.format instanceof OpenLayers.Format.KML&&(f.protocol.format.version="2.2",h=this.writeNode("_KML",f)):(this.setNamespace("feature",this.featureNS),h=this.writeNode("_InlineGeometry",f))),f.options.maxScale&&this.writeNode("sld:MinScaleDenominator",f.options.maxScale,h),f.options.minScale&&this.writeNode("sld:MaxScaleDenominator",f.options.minScale,h),this.nestingLayerLookup[f.name]=h);return h},_WFS:function(c){var d=this.createElementNSPlus("Layer",{attributes:{name:c.protocol.featurePrefix+":"+c.protocol.featureType,hidden:c.visibility?"0":"1"}});this.writeNode("ows:Title",c.name,d);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:c.protocol.version,url:c.protocol.url},d);return d},_InlineGeometry:function(c){var d=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:c.visibility?"0":"1"}});this.writeNode("ows:Title",c.name,d);this.writeNode("InlineGeometry",c,d);return d},_GML:function(c){var d=this.createElementNSPlus("Layer");this.writeNode("ows:Title",c.name,d);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:c.protocol.url,version:c.protocol.format.version},d);return d},_KML:function(c){var d=this.createElementNSPlus("Layer");this.writeNode("ows:Title",c.name,d);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:c.protocol.format.version,url:c.protocol.url},d);return d}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(c){var d=this.createElementNSPlus("gml:boundedBy");this.writeNode("gml:Box",c,d);return d}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(g,h,i,j,k,l){null==g&&(g=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=g;this.lonlat=h;this.contentSize=null!=i?i:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=j&&(this.contentHTML=j);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden");g=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(g,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);k&&this.addCloseBox(l);this.registerEvents()},destroy:function(){this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv));this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&&this.map.removePopup(this);this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(b){null==b&&null!=this.lonlat&&null!=this.map&&(b=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&&this.map.events.register("movestart",this,this.hide);this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var c=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=c&&(this.contentDiv._oldOverflow=c,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var c=this.contentDiv._oldOverflow;c&&(this.contentDiv.style.overflow=c,this.contentDiv._oldOverflow=null)}));this.moveTo(b);this.autoSize||this.size||this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&&this.panIntoView();return this.div},updatePosition:function(){if(this.lonlat&&this.map){var b=this.map.getLayerPxFromLonLat(this.lonlat);b&&this.moveTo(b)}},moveTo:function(b){null!=b&&null!=this.div&&(this.div.style.left=b.x+"px",this.div.style.top=b.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(f){this.size=f.clone();var g=this.getContentDivPadding(),h=g.left+g.right,i=g.top+g.bottom;this.fixPadding();h+=this.padding.left+this.padding.right;i+=this.padding.top+this.padding.bottom;if(this.closeDiv){var j=parseInt(this.closeDiv.style.width),h=h+(j+g.right)}this.size.w+=h;this.size.h+=i;"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=g.left+g.right,this.contentSize.h+=g.bottom+g.top);null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px");null!=this.contentDiv&&(this.contentDiv.style.width=f.w+"px",this.contentDiv.style.height=f.h+"px")},updateSize:function(){var f="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",g=this.map?this.map.div:document.body,h=OpenLayers.Util.getRenderedDimensions(f,null,{displayClass:this.displayClass,containerElement:g}),i=this.getSafeContentSize(h),j=null;i.equals(h)?j=h:(h={w:i.w<h.w?i.w:null,h:i.h<h.h?i.h:null},h.w&&h.h?j=i:(f=OpenLayers.Util.getRenderedDimensions(f,h,{displayClass:this.contentDisplayClass,containerElement:g}),"hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&f.equals(i)&&(i=OpenLayers.Util.getScrollbarWidth(),h.w?f.h+=i:f.w+=i),j=this.getSafeContentSize(f)));this.setSize(j)},setBackgroundColor:function(b){void 0!=b&&(this.backgroundColor=b);null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(b){void 0!=b&&(this.opacity=b);null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(b){void 0!=b&&(this.border=b);null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(b){null!=b&&(this.contentHTML=b);null!=this.contentDiv&&(null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML)&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var f=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},g=this.contentDiv.getElementsByTagName("img"),h=0,i=g.length;h<i;h++){var j=g[h];if(0==j.width||0==j.height){j._onImgLoad=OpenLayers.Function.bind(f,{popup:this,img:j}),OpenLayers.Event.observe(j,"load",j._onImgLoad)}}},getSafeContentSize:function(f){f=f.clone();var g=this.getContentDivPadding(),h=g.left+g.right,i=g.top+g.bottom;this.fixPadding();h+=this.padding.left+this.padding.right;i+=this.padding.top+this.padding.bottom;if(this.closeDiv){var j=parseInt(this.closeDiv.style.width),h=h+(j+g.right)}this.minSize&&(f.w=Math.max(f.w,this.minSize.w-h),f.h=Math.max(f.h,this.minSize.h-i));this.maxSize&&(f.w=Math.min(f.w,this.maxSize.w-h),f.h=Math.min(f.h,this.maxSize.h-i));if(this.map&&this.map.size){j=g=0;if(this.keepInMap&&!this.panMapIfOutOfView){switch(j=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition){case"tr":g=j.x;j=this.map.size.h-j.y;break;case"tl":g=this.map.size.w-j.x;j=this.map.size.h-j.y;break;case"bl":g=this.map.size.w-j.x;j=j.y;break;case"br":g=j.x;j=j.y;break;default:g=j.x,j=this.map.size.h-j.y}}i=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-i-j;f.w=Math.min(f.w,this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-h-g);f.h=Math.min(f.h,i)}return f},getContentDivPadding:function(){var b=this._contentDivPadding;b||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),this._contentDivPadding=b=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display=""));return b},addCloseBox:function(c){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";var d=this.getContentDivPadding();this.closeDiv.style.right=d.right+"px";this.closeDiv.style.top=d.top+"px";this.groupDiv.appendChild(this.closeDiv);c=c||function(b){this.hide();OpenLayers.Event.stop(b)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(c,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(c,this))},panIntoView:function(){var d=this.map.getSize(),e=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),f=e.clone();e.x<this.map.paddingForPopups.left?f.x=this.map.paddingForPopups.left:e.x+this.size.w>d.w-this.map.paddingForPopups.right&&(f.x=d.w-this.map.paddingForPopups.right-this.size.w);e.y<this.map.paddingForPopups.top?f.y=this.map.paddingForPopups.top:e.y+this.size.h>d.h-this.map.paddingForPopups.bottom&&(f.y=d.h-this.map.paddingForPopups.bottom-this.size.h);this.map.pan(e.x-f.x,e.y-f.y)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(b){OpenLayers.Event.stop(b,!0)},scope:this})},onmousedown:function(b){this.mousedown=!0;OpenLayers.Event.stop(b,!0)},onmousemove:function(b){this.mousedown&&OpenLayers.Event.stop(b,!0)},onmouseup:function(b){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(b,!0))},onclick:function(b){OpenLayers.Event.stop(b,!0)},onmouseout:function(b){this.mousedown=!1},ondblclick:function(b){OpenLayers.Event.stop(b,!0)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible");this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(c){var d=parseInt(Math.log(c)/Math.log(10)),d=Math.pow(10,d);c=parseInt(c/d);return(5<c?5:2<c?2:1)*d},update:function(){var i=this.map.getResolution();if(i){var j=this.map.getUnits(),m=OpenLayers.INCHES_PER_UNIT,n=this.maxWidth*i*m[j],o=1;!0===this.geodesic&&(o=(this.map.getGeodesicPixelSize().w||1e-06)*this.maxWidth/(n/m.km),n*=o);var p,q;100000<n?(p=this.topOutUnits,q=this.bottomOutUnits):(p=this.topInUnits,q=this.bottomInUnits);var r=n/m[p],s=n/m[q],n=this.getBarLen(r),t=this.getBarLen(s),r=n/m[j]*m[p],s=t/m[j]*m[q],j=r/i/o,i=s/i/o;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(i)+"px",this.eBottom.innerHTML=t+" "+q);"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(j)+"px",this.eTop.innerHTML=n+" "+p)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,f,g,h){this.url=e;this.size=f||{w:20,h:20};this.offset=g||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=h;e=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(b){null!=b&&(this.size=b);this.draw()},setUrl:function(b){null!=b&&(this.url=b);this.draw()},draw:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(b);return this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,b)},moveTo:function(b){null!=b&&(this.px=b);null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(b){this.imageDiv.style.display=b?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(d,e){this.lonlat=d;var f=e?e:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=f:(this.icon.url=f.url,this.icon.size=f.size,this.icon.offset=f.offset,this.icon.calculateOffset=f.calculateOffset);this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(b){return this.icon.draw(b)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(b){null!=b&&null!=this.icon&&this.icon.moveTo(b);this.lonlat=this.map.getLonLatFromLayerPx(b)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var b=!1;this.map&&(b=this.map.getExtent().containsLonLat(this.lonlat));return b},inflate:function(b){this.icon&&this.icon.setSize({w:this.icon.size.w*b,h:this.icon.size.h*b})},setOpacity:function(b){this.icon.setOpacity(b)},setUrl:function(b){this.icon.setUrl(b)},display:function(b){this.icon.display(b)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(e,f,g,h){this.layername=g;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,f,{},h]);this.extension=this.format.split("/")[1].toLowerCase();this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(b){null==b&&(b=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(f){var g=this.getServerResolution(),h=this.maxExtent,i=this.tileSize,j=Math.round((f.left-h.left)/(g*i.w));f=Math.round((f.bottom-h.bottom)/(g*i.h));g=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,g):this.map.getZoom();j=[this.layername,OpenLayers.Number.zeroPad(g,2),OpenLayers.Number.zeroPad(parseInt(j/1000000),3),OpenLayers.Number.zeroPad(parseInt(j/1000)%1000,3),OpenLayers.Number.zeroPad(parseInt(j)%1000,3),OpenLayers.Number.zeroPad(parseInt(f/1000000),3),OpenLayers.Number.zeroPad(parseInt(f/1000)%1000,3),OpenLayers.Number.zeroPad(parseInt(f)%1000,3)+"."+this.extension].join("/");g=this.url;OpenLayers.Util.isArray(g)&&(g=this.selectUrl(j,g));g="/"==g.charAt(g.length-1)?g:g+"/";return g+j},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this})}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this}));return b},cacheFeatures:function(b){this.paging||(this.clearCache(),this.features=b.features,this.pageNext(b))},clearCache:function(){if(this.features){for(var b=0;b<this.features.length;++b){this.features[b].destroy()}}this.num=this.features=null},pageCount:function(){return Math.ceil((this.features?this.features.length:0)/this.length)},pageNum:function(){return this.num},pageLength:function(b){b&&0<b&&(this.length=b);return this.length},pageNext:function(c){var d=!1;this.features&&(null===this.num&&(this.num=-1),d=this.page((this.num+1)*this.length,c));return d},pagePrevious:function(){var b=!1;this.features&&(null===this.num&&(this.num=this.pageCount()),b=this.page((this.num-1)*this.length));return b},page:function(e,f){var g=!1;if(this.features&&0<=e&&e<this.features.length){var h=Math.floor(e/this.length);h!=this.num&&(this.paging=!0,g=this.features.slice(e,e+this.length),this.layer.removeFeatures(this.layer.features),this.num=h,f&&f.features?f.features=g:this.layer.addFeatures(g),this.paging=!1,g=!0)}return g},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(c,d){},onDrag:function(c,d){},onComplete:function(c,d){},onEnter:function(b){},onLeave:function(b){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(c,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);this.layer=c;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(b){this.handlers.feature.touch&&(!this.over&&this.overFeature(b))&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(b){this.handlers.feature.touch&&this.over&&(this.outFeature(b),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(c){var d=!1;this.handlers.drag.dragging?this.over=this.feature.id==c.id?!0:!1:(this.feature=c,this.handlers.drag.activate(),this.over=d=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(c));return d},downFeature:function(b){this.lastPixel=b;this.onStart(this.feature,b)},moveFeature:function(c){var d=this.map.getResolution();this.feature.geometry.move(d*(c.x-this.lastPixel.x),d*(this.lastPixel.y-c.y));this.layer.drawFeature(this.feature);this.lastPixel=c;this.onDrag(this.feature,c)},upFeature:function(b){this.over||this.handlers.drag.deactivate()},doneDragging:function(b){this.onComplete(this.feature,b)},outFeature:function(b){this.handlers.drag.dragging?this.feature.id==b.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(b),this.feature=null)},cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(b){this.handlers.drag.setMap(b);this.handlers.feature.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(c,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);this.layer=c;this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"});this.createBox();this.createControl()},activate:function(){var b=!1;OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),b=!0);return b},setMap:function(b){this.dragControl.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(f,g){g=OpenLayers.Util.applyDefaults(g,{rotation:0,scale:1,ratio:1});var h=this.rotation,i=this.center;OpenLayers.Util.extend(this,g);if(!1!==this.events.triggerEvent("beforesetfeature",{feature:f})){this.feature=f;this.activate();this._setfeature=!0;var j=this.feature.geometry.getBounds();this.box.move(j.getCenterLonLat());this.box.geometry.rotate(-h,i);this._angle=0;this.rotation?(h=f.geometry.clone(),h.rotate(-this.rotation,this.center),h=new OpenLayers.Feature.Vector(h.getBounds().toGeometry()),h.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(h.geometry.getBounds().getCenterLonLat()),h=h.geometry.components[0].components[0].getBounds().getCenterLonLat()):h=new OpenLayers.LonLat(j.left,j.bottom);this.handles[0].move(h);delete this._setfeature;this.events.triggerEvent("setfeature",{feature:f})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.ratio=this.scale=1)},createBox:function(){var i=this;this.center=new OpenLayers.Geometry.Point(0,0);this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent);this.box.geometry.move=function(a,d){i._moving=!0;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);i.center.move(a,d);delete i._moving};for(var j=function(c,d){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(c,d);this._handle.geometry.move(c,d)},o=function(d,e,f){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(d,e,f);this._handle.geometry.resize(d,e,f)},q=function(c,d){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(c,d);this._handle.geometry.rotate(c,d)},r=function(a,p){var A=this.x,B=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,a,p);if(!i._moving){var C=i.dragControl.handlers.drag.evt,D=!(!i._setfeature&&i.preserveAspectRatio)&&!(C&&C.shiftKey),E=new OpenLayers.Geometry.Point(A,B),C=i.center;this.rotate(-i.rotation,C);E.rotate(-i.rotation,C);var F=this.x-C.x,G=this.y-C.y,H=F-(this.x-E.x),I=G-(this.y-E.y);i.irregular&&!i._setfeature&&(F-=(this.x-E.x)/2,G-=(this.y-E.y)/2);this.x=A;this.y=B;E=1;D?(G=1e-05>Math.abs(I)?1:G/I,E=(1e-05>Math.abs(H)?1:F/H)/G):(H=Math.sqrt(H*H+I*I),G=Math.sqrt(F*F+G*G)/H);i._moving=!0;i.box.geometry.rotate(-i.rotation,C);delete i._moving;i.box.geometry.resize(G,C,E);i.box.geometry.rotate(i.rotation,C);i.transformFeature({scale:G,ratio:E});i.irregular&&!i._setfeature&&(F=C.clone(),F.x+=1e-05>Math.abs(A-C.x)?0:this.x-A,F.y+=1e-05>Math.abs(B-C.y)?0:this.y-B,i.box.geometry.move(this.x-A,this.y-B),i.transformFeature({center:F}))}},s=function(a,l){var m=this.x,n=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,a,l);if(!i._moving){var p=i.dragControl.handlers.drag.evt,p=p&&p.shiftKey?45:1,A=i.center,B=this.x-A.x,C=this.y-A.y;this.x=m;this.y=n;m=Math.atan2(C-l,B-a);m=Math.atan2(C,B)-m;m*=180/Math.PI;i._angle=(i._angle+m)%360;m=i.rotation%p;if(Math.abs(i._angle)>=p||0!==m){m=Math.round(i._angle/p)*p-m,i._angle=0,i.box.geometry.rotate(m,A),i.transformFeature({rotation:m})}}},t=Array(8),u=Array(4),v,w,x,y="sw s se e ne n nw w".split(" "),z=0;8>z;++z){v=this.box.geometry.components[z],w=new OpenLayers.Feature.Vector(v.clone(),{role:y[z]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),0==z%2&&(x=new OpenLayers.Feature.Vector(v.clone(),{role:y[z]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),x.geometry.move=s,v._rotationHandle=x,u[z/2]=x),v.move=j,v.resize=o,v.rotate=q,w.geometry.move=r,v._handle=w,t[z]=w}this.rotationHandles=u;this.handles=t},createControl:function(){var b=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(a){this.feature===b.feature&&(this.feature=b.box);OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(a,d){a===b.box&&b.transformFeature({center:b.center})},onStart:function(a,f){var g=!b.geometryTypes||-1!==OpenLayers.Util.indexOf(b.geometryTypes,a.geometry.CLASS_NAME),h=OpenLayers.Util.indexOf(b.handles,a),h=h+OpenLayers.Util.indexOf(b.rotationHandles,a);a!==b.feature&&(a!==b.box&&-2==h&&g)&&b.setFeature(a)},onComplete:function(a,d){b.events.triggerEvent("transformcomplete",{feature:b.feature})}})},drawHandles:function(){for(var c=this.layer,d=0;8>d;++d){this.rotate&&0===d%2&&c.drawFeature(this.rotationHandles[d/2],this.rotationHandleSymbolizer),c.drawFeature(this.handles[d],this.renderIntent)}},transformFeature:function(f){if(!this._setfeature){this.scale*=f.scale||1;this.ratio*=f.ratio||1;var g=this.rotation;this.rotation=(this.rotation+(f.rotation||0))%360;if(!1!==this.events.triggerEvent("beforetransform",f)){var h=this.feature,i=h.geometry,j=this.center;i.rotate(-g,j);f.scale||f.ratio?i.resize(f.scale,j,f.ratio):f.center&&h.move(f.center.getBounds().getCenterLonLat());i.rotate(this.rotation,j);this.layer.drawFeature(h);h.toState(OpenLayers.State.UPDATE);this.events.triggerEvent("transform",f)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){for(var c,d=0;8>d;++d){c=this.box.geometry.components[d],c._handle.destroy(),c._handle=null,c._rotationHandle&&c._rotationHandle.destroy(),c._rotationHandle=null}this.rotationHandles=this.rotationHandleSymbolizer=this.handles=this.feature=this.center=null;this.box.destroy();this.layer=this.box=null;this.dragControl.destroy();this.dragControl=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(d,e,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(b){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(b)},startBox:function(b){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(g){var h=this.dragHandler.start.x,i=this.dragHandler.start.y,j=Math.abs(h-g.x),k=Math.abs(i-g.y),l=this.getBoxOffsets();this.zoomBox.style.width=j+l.width+1+"px";this.zoomBox.style.height=k+l.height+1+"px";this.zoomBox.style.left=(g.x<h?h-j-l.left:h-l.left)+"px";this.zoomBox.style.top=(g.y<i?i-k-l.top:i-l.top)+"px"},endBox:function(f){var g;if(5<Math.abs(this.dragHandler.start.x-f.x)||5<Math.abs(this.dragHandler.start.y-f.y)){var h=this.dragHandler.start;g=Math.min(h.y,f.y);var i=Math.max(h.y,f.y),j=Math.min(h.x,f.x);f=Math.max(h.x,f.x);g=new OpenLayers.Bounds(j,i,f,g)}else{g=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[g])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.boxOffsets=this.zoomBox=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var f=document.createElement("div");f.style.position="absolute";f.style.border="1px solid black";f.style.width="3px";document.body.appendChild(f);var g=3==f.clientWidth;document.body.removeChild(f);var f=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),h=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),j=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:f,right:h,top:i,bottom:j,width:!1===g?f+h:0,height:!1===g?i+j:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(h){if(h instanceof OpenLayers.Bounds){var i,j=h.getCenterPixel();if(this.out){i=Math.min(this.map.size.h/(h.bottom-h.top),this.map.size.w/(h.right-h.left));var k=this.map.getExtent(),l=this.map.getLonLatFromPixel(j),m=l.lon-k.getWidth()/2*i;h=l.lon+k.getWidth()/2*i;var n=l.lat-k.getHeight()/2*i;i=l.lat+k.getHeight()/2*i;i=new OpenLayers.Bounds(m,n,h,i)}else{m=this.map.getLonLatFromPixel({x:h.left,y:h.bottom}),h=this.map.getLonLatFromPixel({x:h.right,y:h.top}),i=new OpenLayers.Bounds(m.lon,m.lat,h.lon,h.lat)}m=this.map.getZoom();n=this.map.getSize();h=n.w/2;n=n.h/2;i=this.map.getZoomForExtent(i);k=this.map.getResolution();l=this.map.getResolutionForZoom(i);k==l?this.map.setCenter(this.map.getLonLatFromPixel(j)):this.map.zoomTo(i,{x:(k*j.x-l*h)/(k-l),y:(k*j.y-l*n)/(k-l)});m==this.map.getZoom()&&!0==this.alwaysZoom&&this.map.zoomTo(m+(this.out?-1:1))}else{this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,h):this.map.zoomTo(this.map.getZoom()+1,h))}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var b={interval:this.kineticInterval};"object"===typeof this.enableKinetic&&(b=OpenLayers.Util.extend(b,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(b)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(b){this.kinetic&&this.kinetic.update(b);this.panned=!0;this.map.pan(this.handler.last.x-b.x,this.handler.last.y-b.y,{dragging:!0,animate:!1})},panMapDone:function(d){if(this.panned){var e=null;this.kinetic&&(e=this.kinetic.end(d));this.map.pan(this.handler.last.x-d.x,this.handler.last.y-d.y,{dragging:!!e,animate:!1});if(e){var f=this;this.kinetic.move(e,function(c,g,h){f.map.pan(c,g,{dragging:!h,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&&this.zoomBox.activate();this.pinchZoom&&this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.pinchZoom&&this.pinchZoom.deactivate();this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{"double":!0,stopDouble:!0});this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6},this.mouseWheelOptions));OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(b){b.lastTouches&&2==b.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(b){this.map.zoomTo(this.map.zoom+1,b.xy)},defaultDblRightClick:function(b){this.map.zoomTo(this.map.zoom-1,b.xy)},wheelChange:function(e,f){this.map.fractionalZoom||(f=Math.round(f));var g=this.map.getZoom(),h;h=Math.max(g+f,0);h=Math.min(h,this.map.getNumZoomLevels());h!==g&&this.map.zoomTo(h,e.xy)},wheelUp:function(c,d){this.wheelChange(c,d||1)},wheelDown:function(c,d){this.wheelChange(c,d||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(d,e,f){OpenLayers.Control.prototype.initialize.apply(this,[f]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(c,g){this.layer.events.triggerEvent("sketchmodified",{vertex:c,feature:g})},create:function(c,g){this.layer.events.triggerEvent("sketchstarted",{vertex:c,feature:g})}},this.callbacks);this.layer=d;this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:d.renderers,rendererOptions:d.rendererOptions});"multi" in this.handlerOptions||(this.handlerOptions.multi=this.multi);if(d=this.layer.styleMap&&this.layer.styleMap.styles.temporary){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":d})})}this.handler=new e(this,this.callbacks,this.handlerOptions)},drawFeature:function(b){b=new OpenLayers.Feature.Vector(b);!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:b})&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},insertXY:function(c,d){this.handler&&this.handler.line&&this.handler.insertXY(c,d)},insertDeltaXY:function(c,d){this.handler&&this.handler.line&&this.handler.insertDeltaXY(c,d)},insertDirectionLength:function(c,d){this.handler&&this.handler.line&&this.handler.insertDirectionLength(c,d)},insertDeflectionLength:function(c,d){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(c,d)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(f){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){for(var g=this.point.geometry,h=this.control.layer.features,i,j=h.length-1;0<=j;--j){if(i=h[j].geometry,(i instanceof OpenLayers.Geometry.Polygon||i instanceof OpenLayers.Geometry.MultiPolygon)&&i.intersects(g)){g=h[j];this.control.layer.removeFeatures([g],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);g.geometry.addComponent(this.line.geometry);this.polygon=g;this.drawingHole=!0;break}}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(c){c=c.vertex;var d=this.line.geometry.components;this.polygon.geometry.intersects(c)||(d=d[d.length-3],c.x=d.x,c.y=d.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var h=this.line.geometry,i=0!==h.getArea();if(i){for(var j=this.polygon.geometry.components,k=j.length-2;0<=k;--k){if(h.intersects(j[k])){i=!1;break}}if(i){h:for(k=j.length-2;0<k;--k){for(var l=j[k].components,m=0,n=l.length;m<n;++m){if(h.containsPoint(l[m])){i=!1;break h}}}}}i?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(h);this.restoreFeature();return !1},cancel:function(){this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0));return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(b){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=!1;b||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(b){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,b);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var b=this.polygon&&this.polygon.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiPolygon([b]));return b},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(d,e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]);this.addControls([new OpenLayers.Control.Navigation]);var f=[new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(f)},draw:function(){var b=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return b},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);b&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update());return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this});return b},update:function(c){var d=this.getMapBounds();null!==d&&(c&&c.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(d))&&(this.calculateBounds(d),this.resolution=this.layer.map.getResolution(),this.triggerRead(c))},getMapBounds:function(){if(null===this.layer.map){return null}var b=this.layer.map.getExtent();b&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(b=b.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection));return b},invalidBounds:function(b){b||(b=this.getMapBounds());b=!this.bounds||!this.bounds.containsBounds(b);!b&&this.resFactor&&(b=this.resolution/this.layer.map.getResolution(),b=b>=this.resFactor||b<=1/this.resFactor);return b},calculateBounds:function(d){d||(d=this.getMapBounds());var e=d.getCenterLonLat(),f=d.getWidth()*this.ratio;d=d.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(e.lon-f/2,e.lat-d/2,e.lon+f/2,e.lat+d/2)},triggerRead:function(c){!this.response||c&&!0===c.noAbort||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var d={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",d);this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:d.filter,callback:this.merge,scope:this},c))},createFilter:function(){var b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});this.layer.filter&&(b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,b]}));return b},merge:function(h){this.layer.destroyFeatures();if(h.success()){var i=h.features;if(i&&0<i.length){var j=this.layer.projection,k=this.layer.map.getProjectionObject();if(!k.equals(j)){for(var l,m=0,n=i.length;m<n;++m){(l=i[m].geometry)&&l.transform(j,k)}}this.layer.addFeatures(i)}}else{this.bounds=null}this.response=null;this.layer.events.triggerEvent("loadend",{response:h})},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(g,h,i,j,k,l){this.lzd=i;this.zoomLevels=j;i=[];i.push(g,h,k,l);OpenLayers.Layer.Grid.prototype.initialize.apply(this,i);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var b=this.map.getZoom();this.map.getMaxExtent();return b-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(f){f=this.adjustBounds(f);var g=this.getZoom(),h=this.map.getMaxExtent(),i=this.lzd/Math.pow(2,this.getZoom()),j=Math.floor((f.left-h.left)/i);f=Math.floor((f.bottom-h.bottom)/i);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:g,X:j,Y:f}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Protocol.CSW=function(c){c=OpenLayers.Util.applyDefaults(c,OpenLayers.Protocol.CSW.DEFAULTS);var d=OpenLayers.Protocol.CSW["v"+c.version.replace(/\./g,"_")];if(!d){throw"Unsupported CSW version: "+c.version}return new d(c)};OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"};OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(i,j){if(!("layer" in j)){throw Error("Missing property 'layer' in configuration.")}for(var o=i.contents,u,v=0,w=o.layers.length;v<w;++v){if(o.layers[v].identifier===j.layer){u=o.layers[v];break}}if(!u){throw Error("Layer not found")}var x=j.format;!x&&(u.formats&&u.formats.length)&&(x=u.formats[0]);var y;j.matrixSet?y=o.tileMatrixSets[j.matrixSet]:1<=u.tileMatrixSetLinks.length&&(y=o.tileMatrixSets[u.tileMatrixSetLinks[0].tileMatrixSet]);if(!y){throw Error("matrixSet not found")}for(var z,v=0,w=u.styles.length;v<w&&(z=u.styles[v],!z.isDefault);++v){}o=j.requestEncoding;if(!o&&(o="KVP",i.operationsMetadata.GetTile.dcp.http)){var A=i.operationsMetadata.GetTile.dcp.http;A.get[0].constraints&&(A=A.get[0].constraints.GetEncoding.allowedValues,A.KVP||!A.REST&&!A.RESTful||(o="REST"))}var A=[],B=j.params||{};delete j.params;for(var C=0,D=u.dimensions.length;C<D;C++){var E=u.dimensions[C];A.push(E.identifier);B.hasOwnProperty(E.identifier)||(B[E.identifier]=E["default"])}var C=j.projection||y.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),D=j.units||("EPSG:4326"===C?"degrees":"m"),E=[],F;for(F in y.matrixIds){y.matrixIds.hasOwnProperty(F)&&E.push(0.00028*y.matrixIds[F].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[D])}if("REST"===o&&u.resourceUrls){F=[];for(var w=0,G=u.resourceUrls.length;w<G;++w){v=u.resourceUrls[w],v.format===x&&"tile"===v.resourceType&&F.push(v.template)}}else{G=i.operationsMetadata.GetTile.dcp.http.get;F=[];for(var H,v=0,w=G.length;v<w;v++){H=G[v].constraints,(!H||H&&H.GetEncoding.allowedValues[o])&&F.push(G[v].url)}}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(j,{url:F,requestEncoding:o,name:u.title,style:z.identifier,format:x,matrixIds:y.matrixIds,matrixSet:y.identifier,projection:C,units:D,resolutions:!1===j.isBaseLayer?void 0:E,serverResolutions:E,tileFullExtent:y.bounds,dimensions:A,params:B}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var c,d=OpenLayers.Layer.Google.cache[this.map.id];d?(c=d.mapObject,++d.count):(c=this.map.getCenter(),d=document.createElement("div"),d.className="olForeignContainer",d.style.width="100%",d.style.height="100%",c=new google.maps.Map(d,{center:c?new google.maps.LatLng(c.lat,c.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),d=document.createElement("div"),d.style.width="100%",d.style.height="100%",c.controls[google.maps.ControlPosition.TOP_LEFT].push(d),d={googleControl:d,mapObject:c,count:1},OpenLayers.Layer.Google.cache[this.map.id]=d);this.mapObject=c;this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,"resize")},setGMapVisibility:function(i){var j=OpenLayers.Layer.Google.cache[this.map.id],k=this.map;if(j){for(var l=this.type,m=k.layers,n,o=m.length-1;0<=o;--o){if(n=m[o],n instanceof OpenLayers.Layer.Google&&!0===n.visibility&&!0===n.inRange){l=n.type;i=!0;break}}m=this.mapObject.getDiv();if(!0===i){if(m.parentNode!==k.div){if(j.rendered){k.div.appendChild(m),j.googleControl.appendChild(k.viewPortDiv),google.maps.event.trigger(this.mapObject,"resize")}else{var p=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){j.rendered=!0;p.setGMapVisibility(p.getVisibility());p.moveTo(p.map.getCenter())})}}this.mapObject.setMapTypeId(l)}else{j.googleControl.hasChildNodes()&&(k.div.appendChild(k.viewPortDiv),k.div.removeChild(m))}}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(c){var d=null;null!=c&&(d=this.sphericalMercator?this.inverseMercator(c.bottom,c.left):new OpenLayers.LonLat(c.bottom,c.left),c=this.sphericalMercator?this.inverseMercator(c.top,c.right):new OpenLayers.LonLat(c.top,c.right),d=new google.maps.LatLngBounds(new google.maps.LatLng(d.lat,d.lon),new google.maps.LatLng(c.lat,c.lon)));return d},getMapObjectLonLatFromMapObjectPixel:function(f){var g=this.map.getSize(),h=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),i=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),j=this.map.getResolution();f=new OpenLayers.LonLat(h+(f.x-g.w/2)*j,i-(f.y-g.h/2)*j);this.wrapDateLine&&(f=f.wrapDateLine(this.maxExtent));return this.getMapObjectLonLatFromLonLat(f.lon,f.lat)},getMapObjectPixelFromMapObjectLonLat:function(e){var f=this.getLongitudeFromMapObjectLonLat(e);e=this.getLatitudeFromMapObjectLonLat(e);var g=this.map.getResolution(),h=this.map.getExtent();return this.getMapObjectPixelFromXY(1/g*(f-h.left),1/g*(h.top-e))},setMapObjectCenter:function(d,e){if(!1===this.animationEnabled&&e!=this.mapObject.zoom){var f=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){f.style.visibility=""});f.style.visibility="hidden"}this.mapObject.setOptions({center:d,zoom:e})},getMapObjectZoomFromMapObjectBounds:function(b){return this.mapObject.getBoundsZoomLevel(b)},getMapObjectLonLatFromLonLat:function(d,e){var f;this.sphericalMercator?(f=this.inverseMercator(d,e),f=new google.maps.LatLng(f.lat,f.lon)):f=new google.maps.LatLng(e,d);return f},getMapObjectPixelFromXY:function(c,d){return new google.maps.Point(c,d)}};OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);return d},readers:{wps:{ProcessDescriptions:function(c,d){d.processDescriptions={};this.readChildNodes(c,d.processDescriptions)},ProcessDescription:function(d,e){var f={processVersion:this.getAttributeNS(d,this.namespaces.wps,"processVersion"),statusSupported:"true"===d.getAttribute("statusSupported"),storeSupported:"true"===d.getAttribute("storeSupported")};this.readChildNodes(d,f);e[f.identifier]=f},DataInputs:function(c,d){d.dataInputs=[];this.readChildNodes(c,d.dataInputs)},ProcessOutputs:function(c,d){d.processOutputs=[];this.readChildNodes(c,d.processOutputs)},Output:function(d,e){var f={};this.readChildNodes(d,f);e.push(f)},ComplexOutput:function(c,d){d.complexOutput={};this.readChildNodes(c,d.complexOutput)},LiteralOutput:function(c,d){d.literalOutput={};this.readChildNodes(c,d.literalOutput)},Input:function(d,e){var f={maxOccurs:parseInt(d.getAttribute("maxOccurs")),minOccurs:parseInt(d.getAttribute("minOccurs"))};this.readChildNodes(d,f);e.push(f)},BoundingBoxData:function(c,d){d.boundingBoxData={};this.readChildNodes(c,d.boundingBoxData)},CRS:function(c,d){d.CRSs||(d.CRSs={});d.CRSs[this.getChildValue(c)]=!0},LiteralData:function(c,d){d.literalData={};this.readChildNodes(c,d.literalData)},ComplexData:function(c,d){d.complexData={};this.readChildNodes(c,d.complexData)},Default:function(c,d){d["default"]={};this.readChildNodes(c,d["default"])},Supported:function(c,d){d.supported={};this.readChildNodes(c,d.supported)},Format:function(d,e){var f={};this.readChildNodes(d,f);e.formats||(e.formats={});e.formats[f.mimeType]=!0},MimeType:function(c,d){d.mimeType=this.getChildValue(c)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(b){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(d){var e,f;d=d.replace(/[\n\r]/g," ");if(f=this.regExes.typeStr.exec(d)){if(d=f[1].toLowerCase(),f=f[2],this.parse[d]&&(e=this.parse[d].apply(this,[f])),this.internalProjection&&this.externalProjection){if(e&&"OpenLayers.Feature.Vector"==e.CLASS_NAME){e.geometry.transform(this.externalProjection,this.internalProjection)}else{if(e&&"geometrycollection"!=d&&"object"==typeof e){for(d=0,f=e.length;d<f;d++){e[d].geometry.transform(this.externalProjection,this.internalProjection)}}}}}return e},write:function(g){var h,i;g.constructor==Array?i=!0:(g=[g],i=!1);var j=[];i&&j.push("GEOMETRYCOLLECTION(");for(var k=0,l=g.length;k<l;++k){i&&0<k&&j.push(","),h=g[k].geometry,j.push(this.extractGeometry(h))}i&&j.push(")");return j.join("")},extractGeometry:function(c){var d=c.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[d]){return null}this.internalProjection&&this.externalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));return("collection"==d?"GEOMETRYCOLLECTION":d.toUpperCase())+"("+this.extract[d].apply(this,[c])+")"},extract:{point:function(b){return b.x+" "+b.y},multipoint:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push("("+this.extract.point.apply(this,[e.components[g]])+")")}return f.join(",")},linestring:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push(this.extract.point.apply(this,[e.components[g]]))}return f.join(",")},multilinestring:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push("("+this.extract.linestring.apply(this,[e.components[g]])+")")}return f.join(",")},polygon:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push("("+this.extract.linestring.apply(this,[e.components[g]])+")")}return f.join(",")},multipolygon:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push("("+this.extract.polygon.apply(this,[e.components[g]])+")")}return f.join(",")},collection:function(e){for(var f=[],g=0,h=e.components.length;g<h;++g){f.push(this.extractGeometry.apply(this,[e.components[g]]))}return f.join(",")}},parse:{point:function(b){b=OpenLayers.String.trim(b).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(f){for(var g=OpenLayers.String.trim(f).split(","),h=[],i=0,j=g.length;i<j;++i){f=g[i].replace(this.regExes.trimParens,"$1"),h.push(this.parse.point.apply(this,[f]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(h))},linestring:function(e){e=OpenLayers.String.trim(e).split(",");for(var f=[],g=0,h=e.length;g<h;++g){f.push(this.parse.point.apply(this,[e[g]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(f))},multilinestring:function(f){for(var g=OpenLayers.String.trim(f).split(this.regExes.parenComma),h=[],i=0,j=g.length;i<j;++i){f=g[i].replace(this.regExes.trimParens,"$1"),h.push(this.parse.linestring.apply(this,[f]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(h))},polygon:function(f){var g;f=OpenLayers.String.trim(f).split(this.regExes.parenComma);for(var h=[],i=0,j=f.length;i<j;++i){g=f[i].replace(this.regExes.trimParens,"$1"),g=this.parse.linestring.apply(this,[g]).geometry,g=new OpenLayers.Geometry.LinearRing(g.components),h.push(g)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(h))},multipolygon:function(f){for(var g=OpenLayers.String.trim(f).split(this.regExes.doubleParenComma),h=[],i=0,j=g.length;i<j;++i){f=g[i].replace(this.regExes.trimParens,"$1"),h.push(this.parse.polygon.apply(this,[f]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(h))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");e=OpenLayers.String.trim(e).split("|");for(var f=[],g=0,h=e.length;g<h;++g){f.push(OpenLayers.Format.WKT.prototype.read.apply(this,[e[g]]))}return f}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(b){OpenLayers.Util.extend(this,b);this.executeCallbacks=[];this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(c){c=c||{};if(!this.description){this.client.describeProcess(this.server,this.identifier,function(a){this.description||this.parseDescription(a);c.callback&&c.callback.call(c.scope,this.description)},this)}else{if(c.callback){var d=this.description;window.setTimeout(function(){c.callback.call(c.scope,d)},0)}}},configure:function(b){this.describe({callback:function(){var a=this.description,g=b.inputs,h,i,j;i=0;for(j=a.dataInputs.length;i<j;++i){h=a.dataInputs[i],this.setInputData(h,g[h.identifier])}b.callback&&b.callback.call(b.scope)},scope:this});return this},execute:function(b){this.configure({inputs:b.inputs,callback:function(){var a=this,d=this.getOutputIndex(a.description.processOutputs,b.output);a.setResponseForm({outputIndex:d});(function f(){OpenLayers.Util.removeItem(a.executeCallbacks,f);0!==a.chained?a.executeCallbacks.push(f):OpenLayers.Request.POST({url:a.client.servers[a.server].url,data:(new OpenLayers.Format.WPSExecute).write(a.description),success:function(c){var h=a.findMimeType(a.description.processOutputs[d].complexOutput.supported.formats);c=a.formats[h].read(c.responseText);c instanceof OpenLayers.Feature.Vector&&(c=[c]);b.success&&(h={},h[b.output||"result"]=c,b.success.call(b.scope,h))},scope:a})})()},scope:this})},output:function(b){return new OpenLayers.WPSProcess.ChainLink({process:this,output:b})},parseDescription:function(b){b=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(b.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(d,e){delete d.data;delete d.reference;if(e instanceof OpenLayers.WPSProcess.ChainLink){++this.chained,d.reference={method:"POST",href:e.process.server===this.server?this.localWPS:this.client.servers[e.process.server].url},e.process.describe({callback:function(){--this.chained;this.chainProcess(d,e)},scope:this})}else{d.data={};var f=d.complexData;f?(f=this.findMimeType(f.supported.formats),d.data.complexData={mimeType:f,value:this.formats[f].write(this.toFeatures(e))}):d.data.literalData={value:e}}},setResponseForm:function(c){c=c||{};var d=this.description.processOutputs[c.outputIndex||0];this.description.responseForm={rawDataOutput:{identifier:d.identifier,mimeType:this.findMimeType(d.complexOutput.supported.formats,c.supportedFormats)}}},getOutputIndex:function(e,f){var g;if(f){for(var h=e.length-1;0<=h;--h){if(e[h].identifier===f){g=h;break}}}else{g=0}return g},chainProcess:function(e,f){var g=this.getOutputIndex(f.process.description.processOutputs,f.output);e.reference.mimeType=this.findMimeType(e.complexData.supported.formats,f.process.description.processOutputs[g].complexOutput.supported.formats);var h={};h[e.reference.mimeType]=!0;f.process.setResponseForm({outputIndex:g,supportedFormats:h});for(e.reference.body=f.process.description;0<this.executeCallbacks.length;){this.executeCallbacks[0]()}},toFeatures:function(g){var h=OpenLayers.Util.isArray(g);h||(g=[g]);for(var i=Array(g.length),j,k=0,l=g.length;k<l;++k){j=g[k],i[k]=j instanceof OpenLayers.Feature.Vector?j:new OpenLayers.Feature.Vector(j)}return h?i:i[0]},findMimeType:function(d,e){e=e||this.formats;for(var f in d){if(f in e){return f}}},CLASS_NAME:"OpenLayers.WPSProcess"});OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(b){OpenLayers.Util.extend(this,b)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"});OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(c){OpenLayers.Util.extend(this,c);this.events=new OpenLayers.Events(this);this.servers={};for(var d in c.servers){this.servers[d]="string"==typeof c.servers[d]?{url:c.servers[d],version:this.version,processDescription:{}}:c.servers[d]}},execute:function(b){this.getProcess(b.server,b.process).execute({inputs:b.inputs,success:b.success,scope:b.scope})},getProcess:function(d,e){var f=new OpenLayers.WPSProcess({client:this,server:d,identifier:e});this.lazy||f.describe();return f},describeProcess:function(f,h,i,j){var k=this.servers[f];k.processDescription[h]?window.setTimeout(function(){i.call(j,k.processDescription[h])},0):h in k.processDescription?this.events.register("describeprocess",this,function l(b){b.identifier===h&&(this.events.unregister("describeprocess",this,l),i.call(j,b.raw))}):(k.processDescription[h]=null,OpenLayers.Request.GET({url:k.url,params:{SERVICE:"WPS",VERSION:k.version,REQUEST:"DescribeProcess",IDENTIFIER:h},success:function(b){k.processDescription[h]=b.responseText;this.events.triggerEvent("describeprocess",{identifier:h,raw:b.responseText})},scope:this}))},destroy:function(){this.events.destroy();this.servers=this.events=null},CLASS_NAME:"OpenLayers.WPSClient"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);return d},readers:{csw:{GetRecordsResponse:function(d,e){e.records=[];this.readChildNodes(d,e);var f=this.getAttributeNS(d,"","version");""!=f&&(e.version=f)},RequestId:function(c,d){d.RequestId=this.getChildValue(c)},SearchStatus:function(d,e){e.SearchStatus={};var f=this.getAttributeNS(d,"","timestamp");""!=f&&(e.SearchStatus.timestamp=f)},SearchResults:function(g,h){this.readChildNodes(g,h);for(var i=g.attributes,j={},k=0,l=i.length;k<l;++k){j[i[k].name]="numberOfRecordsMatched"==i[k].name||"numberOfRecordsReturned"==i[k].name||"nextRecord"==i[k].name?parseInt(i[k].nodeValue):i[k].nodeValue}h.SearchResults=j},SummaryRecord:function(d,e){var f={type:"SummaryRecord"};this.readChildNodes(d,f);e.records.push(f)},BriefRecord:function(d,e){var f={type:"BriefRecord"};this.readChildNodes(d,f);e.records.push(f)},DCMIRecord:function(d,e){var f={type:"DCMIRecord"};this.readChildNodes(d,f);e.records.push(f)},Record:function(d,e){var f={type:"Record"};this.readChildNodes(d,f);e.records.push(f)},"*":function(d,e){var f=d.localName||d.nodeName.split(":").pop();e[f]=this.getChildValue(d)}},geonet:{info:function(d,e){var f={};this.readChildNodes(d,f);e.gninfo=f}},dc:{"*":function(h,i){var j=h.localName||h.nodeName.split(":").pop();OpenLayers.Util.isArray(i[j])||(i[j]=[]);for(var k={},l=h.attributes,m=0,n=l.length;m<n;++m){k[l[m].name]=l[m].nodeValue}k.value=this.getChildValue(h);""!=k.value&&i[j].push(k)}},dct:{"*":function(d,e){var f=d.localName||d.nodeName.split(":").pop();OpenLayers.Util.isArray(e[f])||(e[f]=[]);e[f].push(this.getChildValue(d))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(c,d){d.bounds&&(d.BoundingBox=[{crs:d.projection,value:[d.bounds.left,d.bounds.bottom,d.bounds.right,d.bounds.top]}],delete d.projection,delete d.bounds);OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(b){b=this.writeNode("csw:GetRecords",b);b.setAttribute("xmlns:gmd",this.namespaces.gmd);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetRecords:function(f){f||(f={});var g=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:f.requestId||this.requestId,resultType:f.resultType||this.resultType,outputFormat:f.outputFormat||this.outputFormat,outputSchema:f.outputSchema||this.outputSchema,startPosition:f.startPosition||this.startPosition,maxRecords:f.maxRecords||this.maxRecords}});(f.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",f.DistributedSearch||this.DistributedSearch,g);var h=f.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(h)&&0<h.length){for(var i=0,j=h.length;i<j;i++){this.writeNode("csw:ResponseHandler",h[i],g)}}this.writeNode("Query",f.Query||this.Query,g);return g},DistributedSearch:function(b){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:b.hopCount}})},ResponseHandler:function(b){return this.createElementNSPlus("csw:ResponseHandler",{value:b.value})},Query:function(f){f||(f={});var g=this.createElementNSPlus("csw:Query",{attributes:{typeNames:f.typeNames||"csw:Record"}}),h=f.ElementName;if(OpenLayers.Util.isArray(h)&&0<h.length){for(var i=0,j=h.length;i<j;i++){this.writeNode("csw:ElementName",h[i],g)}}else{this.writeNode("csw:ElementSetName",f.ElementSetName||{value:"summary"},g)}f.Constraint&&this.writeNode("csw:Constraint",f.Constraint,g);f.SortBy&&this.writeNode("ogc:SortBy",f.SortBy,g);return g},ElementName:function(b){return this.createElementNSPlus("csw:ElementName",{value:b.value})},ElementSetName:function(b){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:b.typeNames},value:b.value})},Constraint:function(d){var e=this.createElementNSPlus("csw:Constraint",{attributes:{version:d.version}});if(d.Filter){var f=new OpenLayers.Format.Filter({version:d.version});e.appendChild(f.write(d.Filter))}else{d.CqlText&&(d=this.createElementNSPlus("CqlText",{value:d.CqlText.value}),e.appendChild(d))}return e}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(d,e,f){this.bounds=d;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div);this.setBorder(e,f)},destroy:function(){this.div=this.bounds=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(c,d){c||(c="red");d||(d=2);this.div.style.border=d+"px solid "+c},draw:function(c,d){OpenLayers.Util.modifyDOMElement(this.div,null,c,d);return this.div},onScreen:function(){var b=!1;this.map&&(b=this.map.getExtent().containsBounds(this.bounds,!0,!0));return b},display:function(b){this.div.style.display=b?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(b){b=b||{};!1!==b.extractStyles&&(b.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5});OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(i){i=i.split("\n");for(var j,n=[],o=0;o<i.length-1;o++){var p=i[o].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=p.charAt(0)){if(j){for(var p=p.split("\t"),q=new OpenLayers.Geometry.Point(0,0),r={},s=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,t=!1,u=0;u<p.length;u++){if(p[u]){if("point"==j[u]){t=p[u].split(","),q.y=parseFloat(t[0]),q.x=parseFloat(t[1]),t=!0}else{if("lat"==j[u]){q.y=parseFloat(p[u]),t=!0}else{if("lon"==j[u]){q.x=parseFloat(p[u]),t=!0}else{if("title"==j[u]){r.title=p[u]}else{if("image"==j[u]||"icon"==j[u]&&s){s.externalGraphic=p[u]}else{if("iconSize"==j[u]&&s){var v=p[u].split(",");s.graphicWidth=parseFloat(v[0]);s.graphicHeight=parseFloat(v[1])}else{"iconOffset"==j[u]&&s?(v=p[u].split(","),s.graphicXOffset=parseFloat(v[0]),s.graphicYOffset=parseFloat(v[1])):"description"==j[u]?r.description=p[u]:"overflow"==j[u]?r.overflow=p[u]:r[j[u]]=p[u]}}}}}}}}t&&(this.internalProjection&&this.externalProjection&&q.transform(this.externalProjection,this.internalProjection),p=new OpenLayers.Feature.Vector(q,r,s),n.push(p))}else{j=p.split("\t")}}}return n},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(c,d){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){this.loaded||null==this.location||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:function(b){this.events.triggerEvent("loadend")},scope:this}),this.loaded=!0)},moveTo:function(d,e,f){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadText()},parseData:function(i){i=i.responseText;var j={};OpenLayers.Util.extend(j,this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(j.externalProjection=this.projection,j.internalProjection=this.map.getProjectionObject());i=(new OpenLayers.Format.Text(j)).read(i);for(var j=0,k=i.length;j<k;j++){var l={},m=i[j],n,o,p;n=new OpenLayers.LonLat(m.geometry.x,m.geometry.y);m.style.graphicWidth&&m.style.graphicHeight&&(o=new OpenLayers.Size(m.style.graphicWidth,m.style.graphicHeight));void 0!==m.style.graphicXOffset&&void 0!==m.style.graphicYOffset&&(p=new OpenLayers.Pixel(m.style.graphicXOffset,m.style.graphicYOffset));null!=m.style.externalGraphic?l.icon=new OpenLayers.Icon(m.style.externalGraphic,o,p):(l.icon=OpenLayers.Marker.defaultIcon(),null!=o&&l.icon.setSize(o));null!=m.attributes.title&&null!=m.attributes.description&&(l.popupContentHTML="<h2>"+m.attributes.title+"</h2><p>"+m.attributes.description+"</p>");l.overflow=m.attributes.overflow||"auto";l=new OpenLayers.Feature(this,n,l);this.features.push(l);n=l.createMarker();null!=m.attributes.title&&null!=m.attributes.description&&n.events.register("click",l,this.markerClick);this.addMarker(n)}this.events.triggerEvent("loadend")},markerClick:function(e){var f=this==this.layer.selectedFeature;this.layer.selectedFeature=f?null:this;for(var g=0,h=this.layer.map.popups.length;g<h;g++){this.layer.map.removePopup(this.layer.map.popups[g])}f||this.layer.map.addPopup(this.createPopup());OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features){for(;0<this.features.length;){var b=this.features[0];OpenLayers.Util.removeItem(this.features,b);b.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(d,e,f){f&&f.layerOptions&&f.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.Drag.prototype.initialize.apply(this,[d,e,f]);this.options=f?f:{}},setOptions:function(b){OpenLayers.Util.extend(this.options,b);OpenLayers.Util.extend(this,b)},activate:function(){var b=!1;OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b),this.map.addLayer(this.layer),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,b=!0);return b},down:function(b){this.fixedRadius=!!this.radius;b=this.layer.getLonLatFromViewPortPx(b.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}this.persist&&this.clear();this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:!0});this.layer.drawFeature(this.feature,this.style)},move:function(d){var e=this.layer.getLonLatFromViewPortPx(d.xy),e=new OpenLayers.Geometry.Point(e.lon,e.lat);this.irregular?(d=Math.sqrt(2)*Math.abs(e.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,d)):this.fixedRadius?this.origin=e:(this.calculateAngle(e,d),this.radius=Math.max(this.map.getResolution()/2,e.distanceTo(this.origin)));this.modifyGeometry();if(this.irregular){d=e.x-this.origin.x;var e=e.y-this.origin.y,f;f=0==e?d/(this.radius*Math.sqrt(2)):d/e;this.feature.geometry.resize(1,this.origin,f);this.feature.geometry.move(d/2,e/2)}this.layer.drawFeature(this.feature,this.style)},up:function(b){this.finalize();this.start==this.last&&this.callback("done",[b.xy])},out:function(b){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-0.5);this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180));this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,f,g=this.feature.geometry.components[0];g.components.length!=this.sides+1&&(this.createGeometry(),g=this.feature.geometry.components[0]);for(var h=0;h<this.sides;++h){f=g.components[h],e=this.angle+2*h*Math.PI/this.sides,f.x=this.origin.x+this.radius*Math.cos(e),f.y=this.origin.y+this.radius*Math.sin(e),f.clearBounds()}},calculateAngle:function(e,f){var g=Math.atan2(e.y-this.origin.y,e.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!f[this.snapToggle]){var h=Math.PI/180*this.snapAngle;this.angle=Math.round(g/h)*h}else{this.angle=g}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(c,d){this.callbacks[c]&&this.callbacks[c].apply(this.control,[this.feature.geometry.clone()]);this.persist||"done"!=c&&"cancel"!=c||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(c,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}});this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})}));this.handler=new c(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var b in this.layerCache){delete this.layerCache[b]}for(b in this.wfsCache){delete this.wfsCache[b]}OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(b){this.setVisibility(b.object.getVisibility())},createSelectionLayer:function(c){var d;if(this.layerCache[c.id]){d=this.layerCache[c.id]}else{d=new OpenLayers.Layer.WMS(c.name,c.url,c.params,OpenLayers.Util.applyDefaults(this.layerOptions,c.getOptions()));this.layerCache[c.id]=d;if(!1===this.layerOptions.displayInLayerSwitcher){c.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:d})}this.map.addLayer(d)}return d},createSLD:function(i,j,m){for(var n={version:"1.0.0",namedLayers:{}},o=(""+i.params.LAYERS).split(","),p=0,q=o.length;p<q;p++){var r=o[p];n.namedLayers[r]={name:r,userStyles:[]};var s=this.selectionSymbolizer,t=m[p];0<=t.type.indexOf("Polygon")?s={Polygon:this.selectionSymbolizer.Polygon}:0<=t.type.indexOf("LineString")?s={Line:this.selectionSymbolizer.Line}:0<=t.type.indexOf("Point")&&(s={Point:this.selectionSymbolizer.Point});n.namedLayers[r].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:s,filter:j[p],maxScaleDenominator:i.options.minScale})]})}return(new OpenLayers.Format.SLD({srsName:this.map.getProjection()})).write(n)},parseDescribeLayer:function(f){var g=new OpenLayers.Format.WMSDescribeLayer,h=f.responseXML;h&&h.documentElement||(h=f.responseText);f=g.read(h);for(var g=[],h=null,i=0,j=f.length;i<j;i++){"WFS"==f[i].owsType&&(g.push(f[i].typeName),h=f[i].owsURL)}OpenLayers.Request.GET({url:h,params:{SERVICE:"WFS",TYPENAME:g.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(d){var e=new OpenLayers.Format.WFSDescribeFeatureType,k=d.responseXML;k&&k.documentElement||(k=d.responseText);d=e.read(k);this.control.wfsCache[this.layer.id]=d;this.control._queue&&this.control.applySelection()},scope:this})},getGeometryAttributes:function(i){var j=[];i=this.wfsCache[i.id];for(var l=0,m=i.featureTypes.length;l<m;l++){for(var n=i.featureTypes[l].properties,o=0,p=n.length;o<p;o++){var q=n[o],r=q.type;(0<=r.indexOf("LineString")||0<=r.indexOf("GeometryAssociationType")||0<=r.indexOf("GeometryPropertyType")||0<=r.indexOf("Point")||0<=r.indexOf("Polygon"))&&j.push(q)}}return j},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);if(e){for(var f=0,g=this.layers.length;f<g;f++){var h=this.layers[f];h&&!this.wfsCache[h.id]&&OpenLayers.Request.GET({url:h.url,params:{SERVICE:"WMS",VERSION:h.params.VERSION,LAYERS:h.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:h,control:this}})}}return e},deactivate:function(){var g=OpenLayers.Control.prototype.deactivate.call(this);if(g){for(var h=0,i=this.layers.length;h<i;h++){var j=this.layers[h];if(j&&!0===this.clearOnDeactivate){var k=this.layerCache,l=k[j.id];l&&(j.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:l}),l.destroy(),delete k[j.id])}}}return g},setLayers:function(b){this.active?(this.deactivate(),this.layers=b,this.activate()):this.layers=b},createFilter:function(d,e){var f=null;this.handler instanceof OpenLayers.Handler.RegularPolygon?f=!0===this.handler.irregular?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:d.name,value:e.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:d.name,value:e}):this.handler instanceof OpenLayers.Handler.Polygon?f=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:d.name,value:e}):this.handler instanceof OpenLayers.Handler.Path?f=0<=d.type.indexOf("Point")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:d.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:e}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:d.name,value:e}):this.handler instanceof OpenLayers.Handler.Click&&(f=0<=d.type.indexOf("Polygon")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:d.name,value:e}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:d.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:e}));return f},select:function(b){this._queue=function(){for(var a=0,i=this.layers.length;a<i;a++){for(var j=this.layers[a],m=this.getGeometryAttributes(j),n=[],o=0,p=m.length;o<p;o++){var q=m[o];if(null!==q){if(!(b instanceof OpenLayers.Geometry)){var r=this.map.getLonLatFromPixel(b.xy);b=new OpenLayers.Geometry.Point(r.lon,r.lat)}q=this.createFilter(q,b);null!==q&&n.push(q)}}o=this.createSelectionLayer(j);this.events.triggerEvent("selected",{layer:j,filters:n});j=this.createSLD(j,n,m);o.mergeNewParams({SLD_BODY:j});delete this._queue}};this.applySelection()},applySelection:function(){for(var d=!0,e=0,f=this.layers.length;e<f;e++){if(!this.wfsCache[this.layers[e].id]){d=!1;break}}d&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(c,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);this.element=OpenLayers.Util.getElement(c)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element));this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var b;if(!0===this.geodesic){if(!this.map.getUnits()){return}b=OpenLayers.INCHES_PER_UNIT;b=(this.map.getGeodesicPixelSize().w||1e-06)*b.km*OpenLayers.DOTS_PER_INCH}else{b=this.map.getScale()}b&&(b=9500<=b&&950000>=b?Math.round(b/1000)+"K":950000<=b?Math.round(b/1000000)+"M":Math.round(b),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:b}))},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(e,f,g,h){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(null==h||null==h.isBaseLayer){this.isBaseLayer="true"!=this.transparent&&!0!=this.transparent}h&&null!=h.useOverlay&&(this.useOverlay=h.useOverlay);this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(b){null==b&&(b=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(d){var e;e=d.getCenterLonLat();var f=this.map.getSize();this.singleTile?(d={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:f.h*this.ratio,setdisplaywidth:f.w*this.ratio,setviewcenterx:e.lon,setviewcentery:e.lat,setviewscale:this.map.getScale()},this.useOverlay&&!this.useAsyncOverlay&&(e={},e=OpenLayers.Util.extend(e,d),e.operation="GETVISIBLEMAPEXTENT",e.version="1.0.0",e.session=this.params.session,e.mapName=this.params.mapName,e.format="text/xml",e=this.getFullRequestString(e),OpenLayers.Request.GET({url:e,async:!1})),e=this.getFullRequestString(d)):(f=this.map.getResolution(),e=Math.floor((d.left-this.maxExtent.left)/f),e=Math.round(e/this.tileSize.w),d=Math.floor((this.maxExtent.top-d.top)/f),d=Math.round(d/this.tileSize.h),e=this.useHttpTile?this.getImageFilePath({tilecol:e,tilerow:d,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:e,tilerow:d,scaleindex:this.resolutions.length-this.map.zoom-1}));return e},getFullRequestString:function(h,i){var j=null==i?this.url:i;"object"==typeof j&&(j=j[Math.floor(Math.random()*j.length)]);var k=j,l=OpenLayers.Util.extend({},this.params),l=OpenLayers.Util.extend(l,h),m=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(j)),n;for(n in l){n.toUpperCase() in m&&delete l[n]}l=OpenLayers.Util.getParameterString(l);l=l.replace(/,/g,"+");""!=l&&(m=j.charAt(j.length-1),k="&"==m||"?"==m?k+l:-1==j.indexOf("?")?k+("?"+l):k+("&"+l));return k},getImageFilePath:function(f,g){var h=null==g?this.url:g;"object"==typeof h&&(h=h[Math.floor(Math.random()*h.length)]);var i="",j="";0>f.tilerow&&(i="-");i=0==f.tilerow?i+"0":i+Math.floor(Math.abs(f.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder;0>f.tilecol&&(j="-");j=0==f.tilecol?j+"0":j+Math.floor(Math.abs(f.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;i="/S"+Math.floor(f.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+i+"/C"+j+"/"+f.tilerow%this.params.tileRowsPerFolder+"_"+f.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;this.params.querystring&&(i+="?"+this.params.querystring);return h+i},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(d,e){OpenLayers.Control.prototype.initialize.apply(this,[e]);var f={done:this.measureComplete,point:this.measurePartial};this.immediate&&(f.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(f,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new d(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(b){(this.immediate=b)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(d,e){var f=this.active;f&&this.deactivate();this.handler=new d(this,this.callbacks,e);f&&this.activate()},measureComplete:function(b){this.cancelDelay();this.measure(b,"measure")},measurePartial:function(c,d){this.cancelDelay();d=d.clone();this.handler.freehandMode(this.handler.evt)?this.measure(d,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(d,"measurepartial")},this),this.partialDelay)},measureImmediate:function(d,e,f){f&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(e.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(e,f){var g,h;-1<e.CLASS_NAME.indexOf("LineString")?(g=this.getBestLength(e),h=1):(g=this.getBestArea(e),h=2);this.events.triggerEvent(f,{measure:g[0],units:g[1],order:h,geometry:e})},getBestArea:function(g){for(var h=this.displaySystemUnits[this.displaySystem],i,j,k=0,l=h.length;k<l&&!(i=h[k],j=this.getArea(g,i),1<j);++k){}return[j,i]},getArea:function(f,g){var h,i;this.geodesic?(h=f.getGeodesicArea(this.map.getProjectionObject()),i="m"):(h=f.getArea(),i=this.map.getUnits());var j=OpenLayers.INCHES_PER_UNIT[g];j&&(h*=Math.pow(OpenLayers.INCHES_PER_UNIT[i]/j,2));return h},getBestLength:function(g){for(var h=this.displaySystemUnits[this.displaySystem],i,j,k=0,l=h.length;k<l&&!(i=h[k],j=this.getLength(g,i),1<j);++k){}return[j,i]},getLength:function(f,g){var h,i;this.geodesic?(h=f.getGeodesicLength(this.map.getProjectionObject()),i="m"):(h=f.getLength(),i=this.map.getUnits());var j=OpenLayers.INCHES_PER_UNIT[g];j&&(h*=OpenLayers.INCHES_PER_UNIT[i]/j);return h},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(b){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[b])},read_wmc_SRS:function(f,g){var h=this.getChildValue(g);"object"!=typeof f.projections&&(f.projections={});for(var h=h.split(/ +/),i=0,j=h.length;i<j;i++){f.projections[h[i]]=!0}},write_wmc_Layer:function(e){var f=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.srs){var g=[],h;for(h in e.srs){g.push(h)}f.appendChild(this.createElementDefaultNS("SRS",g.join(" ")))}f.appendChild(this.write_wmc_FormatList(e));f.appendChild(this.write_wmc_StyleList(e));e.dimensions&&f.appendChild(this.write_wmc_DimensionList(e));f.appendChild(this.write_wmc_LayerExtension(e))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(h,i,j,k,l,m,n){OpenLayers.Popup.prototype.initialize.apply(this,[h,i,j,k,m,n]);this.anchor=null!=l?l:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(c){var d=this.relativePosition;this.relativePosition=this.calculateRelativePosition(c);OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(c));this.relativePosition!=d&&this.updateRelativePosition()},setSize:function(c){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if(this.lonlat&&this.map){var d=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(d)}},calculateRelativePosition:function(b){b=this.map.getLonLatFromLayerPx(b);b=this.map.getExtent().determineQuadrant(b);return OpenLayers.Bounds.oppositeQuadrant(b)},updateRelativePosition:function(){},calculateNewPx:function(d){d=d.offset(this.anchor.offset);var e=this.size||this.contentSize,f="t"==this.relativePosition.charAt(0);d.y+=f?-e.h:this.anchor.size.h;f="l"==this.relativePosition.charAt(1);d.x+=f?-e.w:this.anchor.size.w;return d},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(h,i,j,k,l,m,n){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(b){return this.relativePosition});this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;m&&(this.closeDiv.style.zIndex=1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.isAlphaImage=this.imageSize=this.imageSrc=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var c=0;c<this.blocks.length;c++){var d=this.blocks[c];d.image&&d.div.removeChild(d.image);d.image=null;d.div&&this.groupDiv.removeChild(d.div);d.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(b){},setBorder:function(){},setOpacity:function(b){},setSize:function(b){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+this.padding.right+"px";this.closeDiv.style.top=b.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(c){var d=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return d=d.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var d=null,e;for(e in this.positionBlocks){d=e;break}d=this.positionBlocks[d];for(e=0;e<d.blocks.length;e++){var f={};this.blocks.push(f);f.div=OpenLayers.Util.createDiv(this.id+"_FrameDecorationDiv_"+e,null,null,null,"absolute",null,"hidden",null);f.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+"_FrameDecorationImg_"+e,null,this.imageSize,this.imageSrc,"absolute",null,null,null);f.div.appendChild(f.image);this.groupDiv.appendChild(f.div)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition){for(var i=this.positionBlocks[this.relativePosition],j=0;j<i.blocks.length;j++){var m=i.blocks[j],n=this.blocks[j],o=m.anchor.left,p=m.anchor.bottom,q=m.anchor.right,r=m.anchor.top,s=isNaN(m.size.w)?this.size.w-(q+o):m.size.w,t=isNaN(m.size.h)?this.size.h-(p+r):m.size.h;n.div.style.width=(0>s?0:s)+"px";n.div.style.height=(0>t?0:t)+"px";n.div.style.left=null!=o?o+"px":"";n.div.style.bottom=null!=p?p+"px":"";n.div.style.right=null!=q?q+"px":"";n.div.style.top=null!=r?r+"px":"";n.image.style.left=m.position.x+"px";n.image.style.top=m.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(h,i,j,k,l,m,n){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){if(OpenLayers.Tile.Image.prototype.shouldDraw.call(this)){var c=this.layer.getURL(this.bounds),d=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&c.length>this.maxGetUrlLength;c=d&&!this.useIFrame;d=!d&&this.useIFrame;if(c||d){this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,c&&this.frame.removeChild(this.frame.firstChild)}}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(!0===this.useIFrame){if(!this.frame.childNodes.length){var c=document.createElement("div"),d=c.style;d.position="absolute";d.width="100%";d.height="100%";d.zIndex=1;d.backgroundImage="url("+this.blankImageUrl+")";this.frame.appendChild(c)}c=this.id+"_iFrame";9>parseFloat(navigator.appVersion.split("MSIE")[1])?(d=document.createElement('<iframe name="'+c+'">'),d.style.backgroundColor="#FFFFFF",d.style.filter="chroma(color=#FFFFFF)"):(d=document.createElement("iframe"),d.style.backgroundColor="transparent",d.name=c);d.scrolling="no";d.marginWidth="0px";d.marginHeight="0px";d.frameBorder="0";d.style.position="absolute";d.style.width="100%";d.style.height="100%";1>this.layer.opacity&&OpenLayers.Util.modifyDOMElement(d,null,null,null,null,null,null,this.layer.opacity);this.frame.appendChild(d);return this.imgDiv=d}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var e=document.createElement("form");e.method="POST";var f=this.layer.params._OLSALT,f=(f?f+"_":"")+this.bounds.toBBOX();e.action=OpenLayers.Util.urlAppend(this.layer.url,f);e.target=this.id+"_iFrame";this.layer.getImageSize();var f=OpenLayers.Util.getParameters(this.url),g,h;for(h in f){g=document.createElement("input"),g.type="hidden",g.name=h,g.value=f[h],e.appendChild(g)}return e},setImgSrc:function(c){if(!0===this.useIFrame){if(c){var d=this.createRequestForm();this.frame.appendChild(d);d.submit();this.frame.removeChild(d)}else{this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null)}}else{OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)}},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments);!0===this.useIFrame&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var b;!1===this.useIFrame&&(b=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this));return b}};OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"});OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b},read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);return d},readers:{gml:OpenLayers.Util.applyDefaults({name:function(c,d){d.name=this.getChildValue(c)},TimePeriod:function(c,d){d.timePeriod={};this.readChildNodes(c,d.timePeriod)},beginPosition:function(c,d){d.beginPosition=this.getChildValue(c)},endPosition:function(c,d){d.endPosition=this.getChildValue(c)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(c,d){this.readChildNodes(c,d)},Contents:function(c,d){d.contents={};this.readChildNodes(c,d.contents)},ObservationOfferingList:function(c,d){d.offeringList={};this.readChildNodes(c,d.offeringList)},ObservationOffering:function(d,e){var f=this.getAttributeNS(d,this.namespaces.gml,"id");e[f]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};this.readChildNodes(d,e[f])},time:function(c,d){d.time={};this.readChildNodes(c,d.time)},procedure:function(c,d){d.procedures.push(this.getAttributeNS(c,this.namespaces.xlink,"href"))},observedProperty:function(c,d){d.observedProperties.push(this.getAttributeNS(c,this.namespaces.xlink,"href"))},featureOfInterest:function(c,d){d.featureOfInterestIds.push(this.getAttributeNS(c,this.namespaces.xlink,"href"))},responseFormat:function(c,d){d.responseFormats.push(this.getChildValue(c))},resultModel:function(c,d){d.resultModels.push(this.getChildValue(c))},responseMode:function(c,d){d.responseModes.push(this.getChildValue(c))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(c){var d=!0;this.pinching=!1;if(OpenLayers.Event.isMultiTouch(c)){this.started=!0,this.last=this.start={distance:this.getDistance(c.touches),delta:0,scale:1},this.callback("start",[c,this.start]),d=!this.stopDown}else{if(this.started){return !1}this.started=!1;this.last=this.start=null}OpenLayers.Event.preventDefault(c);return d},touchmove:function(c){if(this.started&&OpenLayers.Event.isMultiTouch(c)){this.pinching=!0;var d=this.getPinchData(c);this.callback("move",[c,d]);this.last=d;OpenLayers.Event.stop(c)}else{if(this.started){return !1}}return !0},touchend:function(b){return this.started&&!OpenLayers.Event.isMultiTouch(b)?(this.pinching=this.started=!1,this.callback("done",[b,this.start,this.last]),this.last=this.start=null,!1):!0},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,b=!0);return b},getDistance:function(c){var d=c[0];c=c[1];return Math.sqrt(Math.pow(d.olClientX-c.olClientX,2)+Math.pow(d.olClientY-c.olClientY,2))},getPinchData:function(b){b=this.getDistance(b.touches);return{distance:b,delta:this.last.distance-b,scale:b/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var b=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return b},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);b&&(!0===this.layer.visibility&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this}));return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&(this.stop(),this.layer.events.un({visibilitychanged:this.reset,scope:this}));return b},reset:function(){!0===this.layer.visibility?this.start():this.stop()},start:function(){this.interval&&("number"===typeof this.interval&&0<this.interval)&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&(this.layer.refresh&&"function"==typeof this.layer.refresh)&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"});OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(f,g,h,i){var j=[];h=OpenLayers.Util.upperCaseObject(h);j.push(f,g,h,i);OpenLayers.Layer.Grid.prototype.initialize.apply(this,j);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=i&&i.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(e){e=this.adjustBounds(e);var f=this.projection.getCode().split(":"),f=f[f.length-1],g=this.getImageSize();e={BBOX:e.toBBOX(),SIZE:g.w+","+g.h,F:"image",BBOXSR:f,IMAGESR:f};if(this.layerDefs){var f=[],h;for(h in this.layerDefs){this.layerDefs.hasOwnProperty(h)&&this.layerDefs[h]&&(f.push(h),f.push(":"),f.push(this.layerDefs[h]),f.push(";"))}0<f.length&&(e.LAYERDEFS=f.join(""))}return this.getFullRequestString(e)},setLayerFilter:function(c,d){this.layerDefs||(this.layerDefs={});d?this.layerDefs[c]=d:delete this.layerDefs[c]},clearLayerFilter:function(b){b?delete this.layerDefs[b]:delete this.layerDefs},mergeNewParams:function(b){b=[OpenLayers.Util.upperCaseObject(b)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(b){this.passesTolerance(b.xy)&&(this.clearTimer(),this.callback("move",[b]),this.px=b.xy,b=OpenLayers.Util.extend({},b),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay));return !this.stopMove},mouseout:function(b){OpenLayers.Util.mouseLeft(b,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[b]));return !0},passesTolerance:function(c){var d=!0;this.pixelTolerance&&this.px&&Math.sqrt(Math.pow(this.px.x-c.x,2)+Math.pow(this.px.y-c.y,2))<this.pixelTolerance&&(d=!1);return d},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(b){this.callback("pause",[b])},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),b=!0);return b},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(b){b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.features={};this.handlers={};this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{}));this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"})));this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active){for(var b in this.handlers){this.handlers[b].activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var b in this.handlers){this.handlers[b].deactivate()}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(c){var d=this.pixelToBounds(c.xy);this.setModifiers(c);this.request(d,{single:this.single})},selectBox:function(c){var d;if(c instanceof OpenLayers.Bounds){d=this.map.getLonLatFromPixel({x:c.left,y:c.bottom}),c=this.map.getLonLatFromPixel({x:c.right,y:c.top}),d=new OpenLayers.Bounds(d.lon,d.lat,c.lon,c.lat)}else{if(this.click){return}d=this.pixelToBounds(c)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(d)},selectHover:function(b){b=this.pixelToBounds(b.xy);this.request(b,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(d,e){e=e||{};var f=new OpenLayers.Filter.Spatial({type:this.filterType,value:d});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");f=this.protocol.read({maxFeatures:!0==e.single?this.maxFeatures:void 0,filter:f,callback:function(a){a.success()&&(a.features.length?!0==e.single?this.selectBestFeature(a.features,d.getCenterLonLat(),e):this.select(a.features):e.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll()));OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});!0==e.hover&&(this.hoverResponse=f)},selectBestFeature:function(i,j,k){k=k||{};if(i.length){j=new OpenLayers.Geometry.Point(j.lon,j.lat);for(var l,m,n,o=Number.MAX_VALUE,p=0;p<i.length&&!(l=i[p],l.geometry&&(n=j.distanceTo(l.geometry,{edge:!1}),n<o&&(o=n,m=l,0==o)));++p){}!0==k.hover?this.hoverSelect(m):this.select(m||i)}},setModifiers:function(b){this.modifiers={multiple:this.multiple||this.multipleKey&&b[this.multipleKey],toggle:this.toggle||this.toggleKey&&b[this.toggleKey]}},select:function(g){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll();OpenLayers.Util.isArray(g)||(g=[g]);var h=this.events.triggerEvent("beforefeaturesselected",{features:g});if(!1!==h){for(var i=[],j,k=0,l=g.length;k<l;++k){j=g[k],this.features[j.fid||j.id]?this.modifiers.toggle&&this.unselect(this.features[j.fid||j.id]):(h=this.events.triggerEvent("beforefeatureselected",{feature:j}),!1!==h&&(this.features[j.fid||j.id]=j,i.push(j),this.events.triggerEvent("featureselected",{feature:j})))}this.events.triggerEvent("featuresselected",{features:i})}},hoverSelect:function(d){var e=d?d.fid||d.id:null,f=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;f&&f!=e&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null);e&&e!=f&&(this.events.triggerEvent("hoverfeature",{feature:d}),this.hoverFeature=d)},unselect:function(b){delete this.features[b.fid||b.id];this.events.triggerEvent("featureunselected",{feature:b})},unselectAll:function(){for(var b in this.features){this.unselect(this.features[b])}},setMap:function(c){for(var d in this.handlers){this.handlers[d].setMap(c)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(c){var d=c.add(-this.clickTolerance/2,this.clickTolerance/2);c=c.add(this.clickTolerance/2,-this.clickTolerance/2);d=this.map.getLonLatFromPixel(d);c=this.map.getLonLatFromPixel(c);return new OpenLayers.Bounds(d.lon,d.lat,c.lon,c.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Format.QueryStringFilter=function(){function c(b){b=b.replace(/%/g,"\\%");b=b.replace(/\\\\\.(\*)?/g,function(e,f){return f?e:"\\\\_"});b=b.replace(/\\\\\.\*/g,"\\\\%");b=b.replace(/(\\)?\.(\*)?/g,function(e,f,g){return f||g?e:"_"});b=b.replace(/(\\)?\.\*/g,function(e,f){return f?e:"%"});b=b.replace(/\\\./g,".");return b=b.replace(/(\\)?\\\*/g,function(e,f){return f?e:"*"})}var d={};d[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";d[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";d[OpenLayers.Filter.Comparison.LESS_THAN]="lt";d[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";d[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";d[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";d[OpenLayers.Filter.Comparison.LIKE]="ilike";return OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(a,b){b=b||{};var g=a.CLASS_NAME,g=g.substring(g.lastIndexOf(".")+1);switch(g){case"Spatial":switch(a.type){case OpenLayers.Filter.Spatial.BBOX:b.bbox=a.value.toArray();this.srsInBBOX&&a.projection&&b.bbox.push(a.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:b.tolerance=a.distance;case OpenLayers.Filter.Spatial.WITHIN:b.lon=a.value.x;b.lat=a.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+a.type)}break;case"Comparison":g=d[a.type];if(void 0!==g){var h=a.value;a.type==OpenLayers.Filter.Comparison.LIKE&&(h=c(h),this.wildcarded&&(h="%"+h+"%"));b[a.property+"__"+g]=h;b.queryable=b.queryable||[];b.queryable.push(a.property)}else{OpenLayers.Console.warn("Unknown comparison filter type "+a.type)}break;case"Logical":if(a.type===OpenLayers.Filter.Logical.AND){for(g=0,h=a.filters.length;g<h;g++){b=this.write(a.filters[g],b)}}else{OpenLayers.Console.warn("Unsupported logical filter type "+a.type)}break;default:OpenLayers.Console.warn("Unknown filter type "+g)}return b},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}();OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.div.left="",this.div.top="",this.element=this.div);return this.div},redraw:function(c){var d;if(null==c){this.reset()}else{if(null==this.lastXy||Math.abs(c.xy.x-this.lastXy.x)>this.granularity||Math.abs(c.xy.y-this.lastXy.y)>this.granularity){this.lastXy=c.xy}else{if(d=this.map.getLonLatFromPixel(c.xy)){this.displayProjection&&d.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=c.xy,c=this.formatOutput(d),c!=this.element.innerHTML&&(this.element.innerHTML=c)}}}},reset:function(b){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(c){var d=parseInt(this.numDigits);return this.prefix+c.lon.toFixed(d)+this.separator+c.lat.toFixed(d)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:"geolocation" in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation);return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId);return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(c){var d=(new OpenLayers.LonLat(c.coords.longitude,c.coords.latitude)).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(d);this.events.triggerEvent("locationupdated",{position:c,point:new OpenLayers.Geometry.Point(d.lon,d.lat)})},getCurrentLocation:function(){if(!this.active||this.watch){return !1}this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return !0},failure:function(b){this.events.triggerEvent("locationfailed",{error:b})},CLASS_NAME:"OpenLayers.Control.Geolocate"});OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var c=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(c){if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var d=new OpenLayers.Protocol.Script({url:this.url,callback:function(b){this.isLoading=!1;this.events.triggerEvent("loadend");this.json=b.data},scope:this});d.read();this.request=d}else{this.request=OpenLayers.Request.GET({url:this.url,callback:function(b){this.isLoading=!1;this.events.triggerEvent("loadend");200===b.status&&this.parseData(b.responseText)},scope:this})}}else{this.unload()}return c},abortLoading:function(){this.request&&(this.request.abort(),delete this.request);this.isLoading=!1},getFeatureInfo:function(e,f){var g=null;if(this.json){var h=this.getFeatureId(e,f);null!==h&&(g={id:h,data:this.json.data[h]})}return g},getFeatureId:function(f,g){var h=null;if(this.json){var i=this.utfgridResolution,i=this.json.grid[Math.floor(g/i)].charCodeAt(Math.floor(f/i)),i=this.indexFromCharCode(i),j=this.json.keys;!isNaN(i)&&i in j&&(h=j[i])}return h},indexFromCharCode:function(b){93<=b&&b--;35<=b&&b--;return b-32},parseData:function(b){this.format||(this.format=new OpenLayers.Format.JSON);this.json=this.format.read(b)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(c){c=c||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var d=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(b,e){return d.write(b,e)}}},destroy:function(){this.headers=this.params=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(d){OpenLayers.Protocol.prototype.read.apply(this,arguments);d=d||{};d.params=OpenLayers.Util.applyDefaults(d.params,this.options.params);d=OpenLayers.Util.applyDefaults(d,this.options);d.filter&&this.filterToParams&&(d.params=this.filterToParams(d.filter,d.params));var e=void 0!==d.readWithPOST?d.readWithPOST:this.readWithPOST,f=new OpenLayers.Protocol.Response({requestType:"read"});e?(e=d.headers||{},e["Content-Type"]="application/x-www-form-urlencoded",f.priv=OpenLayers.Request.POST({url:d.url,callback:this.createCallback(this.handleRead,f,d),data:OpenLayers.Util.getParameterString(d.params),headers:e})):f.priv=OpenLayers.Request.GET({url:d.url,callback:this.createCallback(this.handleRead,f,d),params:d.params,headers:d.headers});return f},handleRead:function(c,d){this.handleResponse(c,d)},create:function(d,e){e=OpenLayers.Util.applyDefaults(e,this.options);var f=new OpenLayers.Protocol.Response({reqFeatures:d,requestType:"create"});f.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleCreate,f,e),headers:e.headers,data:this.format.write(d)});return f},handleCreate:function(c,d){this.handleResponse(c,d)},update:function(e,f){f=f||{};var g=f.url||e.url||this.options.url+"/"+e.fid;f=OpenLayers.Util.applyDefaults(f,this.options);var h=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"});h.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:g,callback:this.createCallback(this.handleUpdate,h,f),headers:f.headers,data:this.format.write(e)});return h},handleUpdate:function(c,d){this.handleResponse(c,d)},"delete":function(f,g){g=g||{};var h=g.url||f.url||this.options.url+"/"+f.fid;g=OpenLayers.Util.applyDefaults(g,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:f,requestType:"delete"}),j=this.deleteWithPOST?"POST":"DELETE",h={url:h,callback:this.createCallback(this.handleDelete,i,g),headers:g.headers};this.deleteWithPOST&&(h.data=this.format.write(f));i.priv=OpenLayers.Request[j](h);return i},handleDelete:function(c,d){this.handleResponse(c,d)},handleResponse:function(d,e){var f=d.priv;e.callback&&(200<=f.status&&300>f.status?("delete"!=d.requestType&&(d.features=this.parseFeatures(f)),d.code=OpenLayers.Protocol.Response.SUCCESS):d.code=OpenLayers.Protocol.Response.FAILURE,e.callback.call(e.scope,d))},parseFeatures:function(c){var d=c.responseXML;d&&d.documentElement||(d=c.responseText);return !d||0>=d.length?null:this.format.read(d)},commit:function(i,j){function o(d){for(var f=d.features?d.features.length:0,g=Array(f),h=0;h<f;++h){g[h]=d.features[h].fid}D.insertIds=g;s.apply(this,[d])}function s(b){this.callUserCallback(b,j);C=C&&b.success();u++;u>=B&&j.callback&&(D.code=C?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,j.callback.apply(j.scope,[D]))}j=OpenLayers.Util.applyDefaults(j,this.options);var t=[],u=0,v={};v[OpenLayers.State.INSERT]=[];v[OpenLayers.State.UPDATE]=[];v[OpenLayers.State.DELETE]=[];for(var w,x,y=[],z=0,A=i.length;z<A;++z){if(w=i[z],x=v[w.state]){x.push(w),y.push(w)}}var B=(0<v[OpenLayers.State.INSERT].length?1:0)+v[OpenLayers.State.UPDATE].length+v[OpenLayers.State.DELETE].length,C=!0,D=new OpenLayers.Protocol.Response({reqFeatures:y});w=v[OpenLayers.State.INSERT];0<w.length&&t.push(this.create(w,OpenLayers.Util.applyDefaults({callback:o,scope:this},j.create)));w=v[OpenLayers.State.UPDATE];for(z=w.length-1;0<=z;--z){t.push(this.update(w[z],OpenLayers.Util.applyDefaults({callback:s,scope:this},j.update)))}w=v[OpenLayers.State.DELETE];for(z=w.length-1;0<=z;--z){t.push(this["delete"](w[z],OpenLayers.Util.applyDefaults({callback:s,scope:this},j["delete"])))}return t},abort:function(b){b&&b.priv.abort()},callUserCallback:function(d,e){var f=e[d.requestType];f&&f.callback&&f.callback.call(f.scope,d)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this}));return b},cacheFeatures:function(c){var d=!0;this.clustering||(this.clearCache(),this.features=c.features,this.cluster(),d=!1);return d},clearCache:function(){this.clustering||(this.features=null)},cluster:function(g){if((!g||g.zoomChanged)&&this.features&&(g=this.layer.map.getResolution(),g!=this.resolution||!this.clustersExist())){this.resolution=g;g=[];for(var h,i,j,k=0;k<this.features.length;++k){if(h=this.features[k],h.geometry){i=!1;for(var l=g.length-1;0<=l;--l){if(j=g[l],this.shouldCluster(j,h)){this.addToCluster(j,h);i=!0;break}}i||g.push(this.createCluster(this.features[k]))}}this.clustering=!0;this.layer.removeAllFeatures();this.clustering=!1;if(0<g.length){if(1<this.threshold){for(h=g.slice(),g=[],k=0,j=h.length;k<j;++k){i=h[k],i.attributes.count<this.threshold?Array.prototype.push.apply(g,i.cluster):g.push(i)}}this.clustering=!0;this.layer.addFeatures(g);this.clustering=!1}this.clusters=g}},clustersExist:function(){var c=!1;if(this.clusters&&0<this.clusters.length&&this.clusters.length==this.layer.features.length){for(var c=!0,d=0;d<this.clusters.length;++d){if(this.clusters[d]!=this.layer.features[d]){c=!1;break}}}return c},shouldCluster:function(e,f){var g=e.geometry.getBounds().getCenterLonLat(),h=f.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(g.lon-h.lon,2)+Math.pow(g.lat-h.lat,2))/this.resolution<=this.distance},addToCluster:function(c,d){c.cluster.push(d);c.attributes.count+=1},createCluster:function(c){var d=c.geometry.getBounds().getCenterLonLat(),d=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(d.lon,d.lat),{count:1});d.cluster=[c];return d},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var b=OpenLayers.Strategy.prototype.activate.apply(this,arguments);b&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}));return b},deactivate:function(){this.cache=null;this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this});return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(f){if(!this.caching&&this.filter){var g=f.features;f.features=[];for(var h,i=0,j=g.length;i<j;++i){h=g[i],this.filter.evaluate(h)?f.features.push(h):this.cache.push(h)}}},handleRemove:function(b){this.caching||(this.cache=[])},setFilter:function(b){this.filter=b;b=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});0<this.cache.length&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1);0<b.length&&(b={features:b},this.handleAdd(b),0<b.features.length&&(this.caching=!0,this.layer.addFeatures(b.features),this.caching=!1))},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Protocol.SOS=function(c){c=OpenLayers.Util.applyDefaults(c,OpenLayers.Protocol.SOS.DEFAULTS);var d=OpenLayers.Protocol.SOS["v"+c.version.replace(/\./g,"_")];if(!d){throw"Unsupported SOS version: "+c.version}return new d(c)};OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(i,j){var l=[],m={},n,o;this.readChildNodes(i,{complexTypes:l,customTypes:m});var p=i.attributes,q,r;n=0;for(o=p.length;n<o;++n){q=p[n],r=q.name,0===r.indexOf("xmlns")?this.setNamespace(r.split(":")[1]||"",q.value):j[r]=q.value}j.featureTypes=l;j.targetPrefix=this.namespaceAlias[j.targetNamespace];n=0;for(o=l.length;n<o;++n){p=l[n],q=m[p.typeName],m[p.typeName]&&(p.typeName=q.name)}},complexType:function(d,e){var f={typeName:d.getAttribute("name")};this.readChildNodes(d,f);e.complexTypes.push(f)},complexContent:function(c,d){this.readChildNodes(c,d)},extension:function(c,d){this.readChildNodes(c,d)},sequence:function(d,e){var f={elements:[]};this.readChildNodes(d,f);e.properties=f.elements},element:function(h,i){var j;if(i.elements){var k={};j=h.attributes;for(var l,m=0,n=j.length;m<n;++m){l=j[m],k[l.name]=l.value}j=k.type;j||(j={},this.readChildNodes(h,j),k.restriction=j,k.type=j.base);k.localType=(j.base||j).split(":").pop();i.elements.push(k);this.readChildNodes(h,k)}i.complexTypes&&(j=h.getAttribute("type"),k=j.split(":").pop(),i.customTypes[k]={name:h.getAttribute("name"),type:j})},annotation:function(c,d){d.annotation={};this.readChildNodes(c,d.annotation)},appinfo:function(c,d){d.appinfo||(d.appinfo=[]);d.appinfo.push(this.getChildValue(c))},documentation:function(d,e){e.documentation||(e.documentation=[]);var f=this.getChildValue(d);e.documentation.push({lang:d.getAttribute("xml:lang"),textContent:f.replace(this.regExes.trimSpace,"")})},simpleType:function(c,d){this.readChildNodes(c,d)},restriction:function(c,d){d.base=c.getAttribute("base");this.readRestriction(c,d)}}},readRestriction:function(h,i){for(var j=h.childNodes,k,l,m=0,n=j.length;m<n;++m){k=j[m],1==k.nodeType&&(l=k.nodeName.split(":").pop(),k=k.getAttribute("value"),i[l]?("string"==typeof i[l]&&(i[l]=[i[l]]),i[l].push(k)):i[l]=k)}},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var e={};if("ExceptionReport"===d.nodeName.split(":").pop()){var f=new OpenLayers.Format.OGCExceptionReport;e.error=f.read(d)}else{this.readNode(d,e)}return e},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(i){var j=this.getElementsByTagNameNS(i,this.georssns,"point"),k=this.getElementsByTagNameNS(i,this.geons,"lat"),l=this.getElementsByTagNameNS(i,this.geons,"long"),m=this.getElementsByTagNameNS(i,this.georssns,"line"),n=this.getElementsByTagNameNS(i,this.georssns,"polygon"),o=this.getElementsByTagNameNS(i,this.georssns,"where");i=this.getElementsByTagNameNS(i,this.georssns,"box");if(0<j.length||0<k.length&&0<l.length){0<j.length?(k=OpenLayers.String.trim(j[0].firstChild.nodeValue).split(/\s+/),2!=k.length&&(k=OpenLayers.String.trim(j[0].firstChild.nodeValue).split(/\s*,\s*/))):k=[parseFloat(k[0].firstChild.nodeValue),parseFloat(l[0].firstChild.nodeValue)];var p=new OpenLayers.Geometry.Point(k[1],k[0])}else{if(0<m.length){k=OpenLayers.String.trim(this.getChildValue(m[0])).split(/\s+/);l=[];m=0;for(n=k.length;m<n;m+=2){j=new OpenLayers.Geometry.Point(k[m+1],k[m]),l.push(j)}p=new OpenLayers.Geometry.LineString(l)}else{if(0<n.length){k=OpenLayers.String.trim(this.getChildValue(n[0])).split(/\s+/);l=[];m=0;for(n=k.length;m<n;m+=2){j=new OpenLayers.Geometry.Point(k[m+1],k[m]),l.push(j)}p=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}else{0<o.length?(this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})),p=this.gmlParser.parseFeature(o[0]).geometry):0<i.length&&(k=OpenLayers.String.trim(i[0].firstChild.nodeValue).split(/\s+/),l=[],3<k.length&&(j=new OpenLayers.Geometry.Point(k[1],k[0]),l.push(j),j=new OpenLayers.Geometry.Point(k[1],k[2]),l.push(j),j=new OpenLayers.Geometry.Point(k[3],k[2]),l.push(j),j=new OpenLayers.Geometry.Point(k[3],k[0]),l.push(j),j=new OpenLayers.Geometry.Point(k[1],k[0]),l.push(j)),p=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)]))}}}p&&(this.internalProjection&&this.externalProjection)&&p.transform(this.externalProjection,this.internalProjection);return p},createFeatureFromItem:function(g){var h=this.createGeometryFromItem(g),i=this._getChildValue(g,"*","title",this.featureTitle),j=this._getChildValue(g,"*","description",this._getChildValue(g,"*","content",this._getChildValue(g,"*","summary",this.featureDescription))),k=this._getChildValue(g,"*","link");if(!k){try{k=this.getElementsByTagNameNS(g,"*","link")[0].getAttribute("href")}catch(l){k=null}}g=this._getChildValue(g,"*","id",null);h=new OpenLayers.Feature.Vector(h,{title:i,description:j,link:k});h.fid=g;return h},_getChildValue:function(e,f,g,h){return(e=this.getElementsByTagNameNS(e,f,g))&&e[0]&&e[0].firstChild&&e[0].firstChild.nodeValue?this.getChildValue(e[0]):void 0==h?"":h},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var f=null,f=this.getElementsByTagNameNS(e,"*","item");0==f.length&&(f=this.getElementsByTagNameNS(e,"*","entry"));e=f.length;for(var g=Array(e),h=0;h<e;h++){g[h]=this.createFeatureFromItem(f[h])}return g},write:function(e){var f;if(OpenLayers.Util.isArray(e)){f=this.createElementNS(this.rssns,"rss");for(var g=0,h=e.length;g<h;g++){f.appendChild(this.createFeatureXML(e[g]))}}else{f=this.createFeatureXML(e)}return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createFeatureXML:function(g){var h=this.buildGeometryNode(g.geometry),i=this.createElementNS(this.rssns,"item"),j=this.createElementNS(this.rssns,"title");j.appendChild(this.createTextNode(g.attributes.title?g.attributes.title:""));var k=this.createElementNS(this.rssns,"description");k.appendChild(this.createTextNode(g.attributes.description?g.attributes.description:""));i.appendChild(j);i.appendChild(k);g.attributes.link&&(j=this.createElementNS(this.rssns,"link"),j.appendChild(this.createTextNode(g.attributes.link)),i.appendChild(j));for(var l in g.attributes){"link"!=l&&("title"!=l&&"description"!=l)&&(j=this.createTextNode(g.attributes[l]),k=l,-1!=l.search(":")&&(k=l.split(":")[1]),k=this.createElementNS(this.featureNS,"feature:"+k),k.appendChild(j),i.appendChild(k))}i.appendChild(h);return i},buildGeometryNode:function(c){this.internalProjection&&this.externalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d;if("OpenLayers.Geometry.Polygon"==c.CLASS_NAME){d=this.createElementNS(this.georssns,"georss:polygon"),d.appendChild(this.buildCoordinatesNode(c.components[0]))}else{if("OpenLayers.Geometry.LineString"==c.CLASS_NAME){d=this.createElementNS(this.georssns,"georss:line"),d.appendChild(this.buildCoordinatesNode(c))}else{if("OpenLayers.Geometry.Point"==c.CLASS_NAME){d=this.createElementNS(this.georssns,"georss:point"),d.appendChild(this.buildCoordinatesNode(c))}else{throw"Couldn't parse "+c.CLASS_NAME}}}return d},buildCoordinatesNode:function(e){var f=null;e.components&&(f=e.components);if(f){e=f.length;for(var g=Array(e),h=0;h<e;h++){g[h]=f[h].y+" "+f[h].x}f=g.join(" ")}else{f=e.y+" "+e.x}return this.createTextNode(f)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"});OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);return d},readers:{wps:{Capabilities:function(c,d){this.readChildNodes(c,d)},ProcessOfferings:function(c,d){d.processOfferings={};this.readChildNodes(c,d.processOfferings)},Process:function(d,e){var f={processVersion:this.getAttributeNS(d,this.namespaces.wps,"processVersion")};this.readChildNodes(d,f);e[f.identifier]=f},Languages:function(c,d){d.languages=[];this.readChildNodes(c,d.languages)},Default:function(d,e){var f={isDefault:!0};this.readChildNodes(d,f);e.push(f)},Supported:function(d,e){var f={};this.readChildNodes(d,f);e.push(f)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(d,e){var f=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):d.xy;this.currentCenter=this.pinchOrigin=f},pinchMove:function(h,i){var j=i.scale,k=this.map.layerContainerOriginPx,l=this.pinchOrigin,m=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):h.xy,n=Math.round(k.x+m.x-l.x+(j-1)*(k.x-l.x)),k=Math.round(k.y+m.y-l.y+(j-1)*(k.y-l.y));this.map.applyTransform(n,k,j);this.currentCenter=m},pinchDone:function(f,g,h){this.map.applyTransform();f=this.map.getZoomForResolution(this.map.getResolution()/h.scale,!0);if(f!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){g=this.map.getResolutionForZoom(f);h=this.map.getLonLatFromPixel(this.pinchOrigin);var i=this.currentCenter,j=this.map.getSize();h.lon+=g*(j.w/2-i.x);h.lat-=g*(j.h/2-i.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(h,f)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom);OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var c={click:this.defaultClick,dblclick:this.defaultDblClick},d=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,c,d);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(b){b.lastTouches&&2==b.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(b){this.map.zoomTo(this.map.zoom+1,b.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(d,e,f){this.rgb={r:d,g:e,b:f}},setRed:function(b){this.rgb.r=b},setGreen:function(b){this.rgb.g=b},setBlue:function(b){this.rgb.b=b},setHue:function(c){var d=this.asHSB();d.h=c;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(d.h,d.s,d.b)},setSaturation:function(c){var d=this.asHSB();d.s=c;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(d.h,d.s,d.b)},setBrightness:function(c){var d=this.asHSB();d.b=c;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(d.h,d.s,d.b)},darken:function(c){var d=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(d.h,d.s,Math.max(d.b-c,0))},brighten:function(c){var d=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(d.h,d.s,Math.min(d.b+c,1))},blend:function(b){this.rgb.r=Math.floor((this.rgb.r+b.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+b.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+b.rgb.b)/2)},isBright:function(){this.asHSB();return 0.5<this.asHSB().b},isDark:function(){return !this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(d){if(4==d.length){var e=d;d="#";for(var f=1;4>f;f++){d+=e.charAt(f)+e.charAt(f)}}0==d.indexOf("#")&&(d=d.substring(1));e=d.substring(0,2);f=d.substring(2,4);d=d.substring(4,6);return new OpenLayers.Rico.Color(parseInt(e,16),parseInt(f,16),parseInt(d,16))};OpenLayers.Rico.Color.createColorFromBackground=function(c){var d=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(c),"backgroundColor");return"transparent"==d&&c.parentNode?OpenLayers.Rico.Color.createColorFromBackground(c.parentNode):null==d?new OpenLayers.Rico.Color(255,255,255):0==d.indexOf("rgb(")?(c=d.substring(4,d.length-1).split(","),new OpenLayers.Rico.Color(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]))):0==d.indexOf("#")?OpenLayers.Rico.Color.createFromHex(d):new OpenLayers.Rico.Color(255,255,255)};OpenLayers.Rico.Color.HSBtoRGB=function(i,j,l){var m=0,n=0,o=0;if(0==j){o=n=m=parseInt(255*l+0.5)}else{i=6*(i-Math.floor(i));var p=i-Math.floor(i),q=l*(1-j),r=l*(1-j*p);j=l*(1-j*(1-p));switch(parseInt(i)){case 0:m=255*l+0.5;n=255*j+0.5;o=255*q+0.5;break;case 1:m=255*r+0.5;n=255*l+0.5;o=255*q+0.5;break;case 2:m=255*q+0.5;n=255*l+0.5;o=255*j+0.5;break;case 3:m=255*q+0.5;n=255*r+0.5;o=255*l+0.5;break;case 4:m=255*j+0.5;n=255*q+0.5;o=255*l+0.5;break;case 5:m=255*l+0.5,n=255*q+0.5,o=255*r+0.5}}return{r:parseInt(m),g:parseInt(n),b:parseInt(o)}};OpenLayers.Rico.Color.RGBtoHSB=function(i,j,k){var l,m=i>j?i:j;k>m&&(m=k);var n=i<j?i:j;k<n&&(n=k);l=0!=m?(m-n)/m:0;if(0==l){i=0}else{var o=(m-i)/(m-n),p=(m-j)/(m-n);k=(m-k)/(m-n);i=(i==m?k-p:j==m?2+o-k:4+p-o)/6;0>i&&(i+=1)}return{h:i,s:l,b:m/255}};OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(b){OpenLayers.Util.extend(this,b);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var c=0,d=this.rules.length;c<d;c++){this.rules[c].destroy()}delete this.rules},clone:function(){var d=OpenLayers.Util.extend({},this);if(this.rules){d.rules=[];for(var e=0,f=this.rules.length;e<f;++e){d.rules.push(this.rules[e].clone())}}return new OpenLayers.Style2(d)},CLASS_NAME:"OpenLayers.Style2"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(c,d){OpenLayers.Format.GML.prototype.initialize.apply(this,[c]);this.layer=d;this.layer.featureNS&&(this.featureNS=this.layer.featureNS);this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column);this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(d){var e=this.createElementNS(this.wfsns,"wfs:Transaction");e.setAttribute("version","1.0.0");e.setAttribute("service","WFS");for(var f=0;f<d.length;f++){switch(d[f].state){case OpenLayers.State.INSERT:e.appendChild(this.insert(d[f]));break;case OpenLayers.State.UPDATE:e.appendChild(this.update(d[f]));break;case OpenLayers.State.DELETE:e.appendChild(this.remove(d[f]))}}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},createFeatureXML:function(f){var g=this.buildGeometryNode(f.geometry),h=this.createElementNS(this.featureNS,"feature:"+this.geometryName);h.appendChild(g);g=this.createElementNS(this.featureNS,"feature:"+this.featureName);g.appendChild(h);for(var i in f.attributes){var h=this.createTextNode(f.attributes[i]),j=i;-1!=i.search(":")&&(j=i.split(":")[1]);j=this.createElementNS(this.featureNS,"feature:"+j);j.appendChild(h);g.appendChild(j)}return g},insert:function(c){var d=this.createElementNS(this.wfsns,"wfs:Insert");d.appendChild(this.createFeatureXML(c));return d},update:function(g){g.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var h=this.createElementNS(this.wfsns,"wfs:Update");h.setAttribute("typeName",this.featurePrefix+":"+this.featureName);h.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=this.createElementNS(this.wfsns,"wfs:Property"),j=this.createElementNS(this.wfsns,"wfs:Name"),k=this.createTextNode(this.geometryName);j.appendChild(k);i.appendChild(j);j=this.createElementNS(this.wfsns,"wfs:Value");k=this.buildGeometryNode(g.geometry);g.layer&&k.setAttribute("srsName",g.layer.projection.getCode());j.appendChild(k);i.appendChild(j);h.appendChild(i);for(var l in g.attributes){i=this.createElementNS(this.wfsns,"wfs:Property"),j=this.createElementNS(this.wfsns,"wfs:Name"),j.appendChild(this.createTextNode(l)),i.appendChild(j),j=this.createElementNS(this.wfsns,"wfs:Value"),j.appendChild(this.createTextNode(g.attributes[l])),i.appendChild(j),h.appendChild(i)}i=this.createElementNS(this.ogcns,"ogc:Filter");l=this.createElementNS(this.ogcns,"ogc:FeatureId");l.setAttribute("fid",g.fid);i.appendChild(l);h.appendChild(i);return h},remove:function(e){if(!e.fid){return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1}var f=this.createElementNS(this.wfsns,"wfs:Delete");f.setAttribute("typeName",this.featurePrefix+":"+this.featureName);f.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var g=this.createElementNS(this.ogcns,"ogc:Filter"),h=this.createElementNS(this.ogcns,"ogc:FeatureId");h.setAttribute("fid",e.fid);g.appendChild(h);f.appendChild(g);return f},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(d,e){var f=this.readers.ogc._expression.call(this,d);f&&(e.priority=f)},VendorOption:function(c,d){d.vendorOptions||(d.vendorOptions={});d.vendorOptions[c.getAttribute("name")]=this.getChildValue(c)},TextSymbolizer:function(d,e){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var f=this.multipleSymbolizers?e.symbolizers[e.symbolizers.length-1]:e.symbolizer.Text;void 0===f.graphic&&(f.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Priority",b)},VendorOption:function(b){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:b.name},value:b.value})},TextSymbolizer:function(c){var d=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.TextSymbolizer.apply(this,arguments);!1!==c.graphic&&(c.externalGraphic||c.graphicName)&&this.writeNode("Graphic",c,d);"priority" in c&&this.writeNode("Priority",c.priority,d);return this.addVendorOptions(d,c)},PointSymbolizer:function(c){var d=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(d,c)},LineSymbolizer:function(c){var d=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(d,c)},PolygonSymbolizer:function(c){var d=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(d,c)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(d,e){if(e.vendorOptions){for(var f in e.vendorOptions){this.writeNode("VendorOption",{name:f,value:e.vendorOptions[f]},d)}}return d},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(d){var e=this.map.getLayerPxFromLonLat({lon:d.bounds.left,lat:d.bounds.top}),f=this.map.getLayerPxFromLonLat({lon:d.bounds.right,lat:d.bounds.bottom});null==f||null==e?d.display(!1):(e=d.draw(e,{w:Math.max(1,f.x-e.x),h:Math.max(1,f.y-e.y)}),d.drawn||(this.div.appendChild(e),d.drawn=!0))},removeMarker:function(b){OpenLayers.Util.removeItem(this.markers,b);null!=b.div&&b.div.parentNode==this.div&&this.div.removeChild(b.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(c,d){d.service={};this.readChildNodes(c,d.service)},Fees:function(d,e){var f=this.getChildValue(d);f&&"none"!=f.toLowerCase()&&(e.fees=f)},AccessConstraints:function(d,e){var f=this.getChildValue(d);f&&"none"!=f.toLowerCase()&&(e.accessConstraints=f)},OnlineResource:function(d,e){var f=this.getChildValue(d);f&&"none"!=f.toLowerCase()&&(e.onlineResource=f)},Keywords:function(d,e){var f=this.getChildValue(d);f&&"none"!=f.toLowerCase()&&(e.keywords=f.split(", "))},Capability:function(c,d){d.capability={};this.readChildNodes(c,d.capability)},Request:function(c,d){d.request={};this.readChildNodes(c,d.request)},GetFeature:function(c,d){d.getfeature={href:{},formats:[]};this.readChildNodes(c,d.getfeature)},ResultFormat:function(f,g){for(var h=f.childNodes,i,j=0;j<h.length;j++){i=h[j],1==i.nodeType&&g.formats.push(i.nodeName)}},DCPType:function(c,d){this.readChildNodes(c,d)},HTTP:function(c,d){this.readChildNodes(c,d.href)},Get:function(c,d){d.get=c.getAttribute("onlineResource")},Post:function(c,d){d.post=c.getAttribute("onlineResource")},SRS:function(d,e){var f=this.getChildValue(d);f&&(e.srs=f)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(c,d){this.readChildNodes(c,d)},LayerLimit:function(c,d){d.layerLimit=parseInt(this.getChildValue(c))},MaxWidth:function(c,d){d.maxWidth=parseInt(this.getChildValue(c))},MaxHeight:function(c,d){d.maxHeight=parseInt(this.getChildValue(c))},BoundingBox:function(d,e){var f=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[d,e]);f.srs=d.getAttribute("CRS");e.bbox[f.srs]=f},CRS:function(c,d){this.readers.wms.SRS.apply(this,[c,d])},EX_GeographicBoundingBox:function(c,d){d.llbbox=[];this.readChildNodes(c,d.llbbox)},westBoundLongitude:function(c,d){d[0]=this.getChildValue(c)},eastBoundLongitude:function(c,d){d[2]=this.getChildValue(c)},southBoundLatitude:function(c,d){d[1]=this.getChildValue(c)},northBoundLatitude:function(c,d){d[3]=this.getChildValue(c)},MinScaleDenominator:function(c,d){d.maxScale=parseFloat(this.getChildValue(c)).toPrecision(16)},MaxScaleDenominator:function(c,d){d.minScale=parseFloat(this.getChildValue(c)).toPrecision(16)},Dimension:function(d,e){var f={name:d.getAttribute("name").toLowerCase(),units:d.getAttribute("units"),unitsymbol:d.getAttribute("unitSymbol"),nearestVal:"1"===d.getAttribute("nearestValue"),multipleVal:"1"===d.getAttribute("multipleValues"),"default":d.getAttribute("default")||"",current:"1"===d.getAttribute("current"),values:this.getChildValue(d).split(",")};e.dimensions[f.name]=f},Keyword:function(d,e){var f={value:this.getChildValue(d),vocabulary:d.getAttribute("vocabulary")};e.keywords&&e.keywords.push(f)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(c,d){this.readers.wms.UserDefinedSymbolization.apply(this,[c,d]);d.userSymbols.inlineFeature=1==parseInt(c.getAttribute("InlineFeature"));d.userSymbols.remoteWCS=1==parseInt(c.getAttribute("RemoteWCS"))},DescribeLayer:function(c,d){this.readers.wms.DescribeLayer.apply(this,[c,d])},GetLegendGraphic:function(c,d){this.readers.wms.GetLegendGraphic.apply(this,[c,d])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(e,f,g,h){this.initializeZoomify(g);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,f,g,{},h])},initializeZoomify:function(c){var d=c.clone();this.size=c.clone();c=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize));this.tierSizeInTiles=[c];for(this.tierImageSize=[d];d.w>this.standardTileSize||d.h>this.standardTileSize;){d=new OpenLayers.Size(Math.floor(d.w/2),Math.floor(d.h/2)),c=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize)),this.tierSizeInTiles.push(c),this.tierImageSize.push(d)}this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;d=[1];this.tileCountUpToTier=[0];for(c=1;c<this.numberOfTiers;c++){d.unshift(Math.pow(2,c)),this.tileCountUpToTier.push(this.tierSizeInTiles[c-1].w*this.tierSizeInTiles[c-1].h+this.tileCountUpToTier[c-1])}this.serverResolutions||(this.serverResolutions=d)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(b){null==b&&(b=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(d){d=this.adjustBounds(d);var e=this.getServerResolution(),f=Math.round((d.left-this.tileOrigin.lon)/(e*this.tileSize.w));d=Math.round((this.tileOrigin.lat-d.top)/(e*this.tileSize.h));e=this.getZoomForResolution(e);f="TileGroup"+Math.floor((f+d*this.tierSizeInTiles[e].w+this.tileCountUpToTier[e])/256)+"/"+e+"-"+f+"-"+d+".jpg";e=this.url;OpenLayers.Util.isArray(e)&&(e=this.selectUrl(f,e));return e+f},getImageSize:function(){if(0<arguments.length){var f=this.adjustBounds(arguments[0]),g=this.getServerResolution(),h=Math.round((f.left-this.tileOrigin.lon)/(g*this.tileSize.w)),f=Math.round((this.tileOrigin.lat-f.top)/(g*this.tileSize.h)),g=this.getZoomForResolution(g),i=this.standardTileSize,j=this.standardTileSize;h==this.tierSizeInTiles[g].w-1&&(i=this.tierImageSize[g].w%this.standardTileSize);f==this.tierSizeInTiles[g].h-1&&(j=this.tierImageSize[g].h%this.standardTileSize);return new OpenLayers.Size(i,j)}return this.tileSize},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(e,f,g,h){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(null==h||null==h.isBaseLayer){this.isBaseLayer="true"!=this.params.transparent&&!0!=this.params.transparent}},clone:function(b){null==b&&(b=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(c){c=this.adjustBounds(c);c=[c.left,c.bottom,c.right,c.top];var d=this.getImageSize();return this.getFullRequestString({mapext:c,imgext:c,map_size:[d.w,d.h],imgx:d.w/2,imgy:d.h/2,imgxy:[d.w,d.h]})},getFullRequestString:function(g,h){var i=null==h?this.url:h,j=OpenLayers.Util.extend({},this.params),j=OpenLayers.Util.extend(j,g),k=OpenLayers.Util.getParameterString(j);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(k,i));var k=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i)),l;for(l in j){l.toUpperCase() in k&&delete j[l]}k=OpenLayers.Util.getParameterString(j);j=i;k=k.replace(/,/g,"+");""!=k&&(l=i.charAt(i.length-1),j="&"==l||"?"==l?j+k:-1==i.indexOf("?")?j+("?"+k):j+("&"+k));return j},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(f){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var g=document.createStyleSheet(),h="shape rect oval fill stroke imagedata group textbox".split(" "),i=0,j=h.length;i<j;i++){g.addRule("olv\\:"+h[i],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return !!document.namespaces},setExtent:function(h,i){var j=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),k=this.getResolution(),l=h.left/k|0,k=h.top/k-this.size.h|0;i||!this.offset?(this.offset={x:l,y:k},k=l=0):(l-=this.offset.x,k-=this.offset.y);this.root.coordorigin=l-this.xOffset+" "+k;for(var l=[this.root,this.vectorRoot,this.textRoot],m=0,n=l.length;m<n;++m){k=l[m],k.coordsize=this.size.w+" "+this.size.h}this.root.style.flip="y";return j},setSize:function(h){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var i=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],j=this.size.w+"px",k=this.size.h+"px",l,m=0,n=i.length;m<n;++m){l=i[m],l.style.width=j,l.style.height=k}},getNodeType:function(d,e){var f=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":f=e.externalGraphic?"olv:rect":this.isComplexSymbol(e.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":f="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":f="olv:shape"}return f},setStyle:function(i,j,l,m){j=j||i._style;l=l||i._options;var n=j.fillColor,o=j.title||j.graphicTitle;o&&(i.title=o);if("OpenLayers.Geometry.Point"===i._geometryClass){if(j.externalGraphic){l.isFilled=!0;var n=j.graphicWidth||j.graphicHeight,o=j.graphicHeight||j.graphicWidth,n=n?n:2*j.pointRadius,o=o?o:2*j.pointRadius,p=this.getResolution(),q=void 0!=j.graphicXOffset?j.graphicXOffset:-(0.5*n),r=void 0!=j.graphicYOffset?j.graphicYOffset:-(0.5*o);i.style.left=((m.x-this.featureDx)/p-this.offset.x+q|0)+"px";i.style.top=(m.y/p-this.offset.y-(r+o)|0)+"px";i.style.width=n+"px";i.style.height=o+"px";i.style.flip="y";n="none";l.isStroked=!1}else{this.isComplexSymbol(j.graphicName)?(o=this.importSymbol(j.graphicName),i.path=o.path,i.coordorigin=o.left+","+o.bottom,o=o.size,i.coordsize=o+","+o,this.drawCircle(i,m,j.pointRadius),i.style.flip="y"):this.drawCircle(i,m,j.pointRadius)}}l.isFilled?i.fillcolor=n:i.filled="false";m=i.getElementsByTagName("fill");m=0==m.length?null:m[0];l.isFilled?(m||(m=this.createNode("olv:fill",i.id+"_fill")),m.opacity=j.fillOpacity,"OpenLayers.Geometry.Point"===i._geometryClass&&j.externalGraphic&&(j.graphicOpacity&&(m.opacity=j.graphicOpacity),m.src=j.externalGraphic,m.type="frame",j.graphicWidth&&j.graphicHeight||(m.aspect="atmost")),m.parentNode!=i&&i.appendChild(m)):m&&i.removeChild(m);n=j.rotation;if(void 0!==n||void 0!==i._rotation){i._rotation=n,j.externalGraphic?(this.graphicRotate(i,q,r,j),m.opacity=0):"OpenLayers.Geometry.Point"===i._geometryClass&&(i.style.rotation=n||0)}q=i.getElementsByTagName("stroke");q=0==q.length?null:q[0];l.isStroked?(q||(q=this.createNode("olv:stroke",i.id+"_stroke"),i.appendChild(q)),q.on=!0,q.color=j.strokeColor,q.weight=j.strokeWidth+"px",q.opacity=j.strokeOpacity,q.endcap="butt"==j.strokeLinecap?"flat":j.strokeLinecap||"round",j.strokeDashstyle&&(q.dashstyle=this.dashStyle(j))):(i.stroked=!1,q&&(q.on=!1));"inherit"!=j.cursor&&null!=j.cursor&&(i.style.cursor=j.cursor);return i},graphicRotate:function(i,j,n,o){o=o||i._style;var p=o.rotation||0,q,r;if(o.graphicWidth&&o.graphicHeight){r=Math.max(o.graphicWidth,o.graphicHeight);q=o.graphicWidth/o.graphicHeight;var s=Math.round(o.graphicWidth||r*q),t=Math.round(o.graphicHeight||r);i.style.width=s+"px";i.style.height=t+"px";var u=document.getElementById(i.id+"_image");u||(u=this.createNode("olv:imagedata",i.id+"_image"),i.appendChild(u));u.style.width=s+"px";u.style.height=t+"px";u.src=o.externalGraphic;u.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";u=p*Math.PI/180;p=Math.sin(u);u=Math.cos(u);p="progid:DXImageTransform.Microsoft.Matrix(M11="+u+",M12="+-p+",M21="+p+",M22="+u+",SizingMethod='auto expand')\n";(u=o.graphicOpacity||o.fillOpacity)&&1!=u&&(p+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+u+")\n");i.style.filter=p;p=new OpenLayers.Geometry.Point(-j,-n);s=(new OpenLayers.Bounds(0,0,s,t)).toGeometry();s.rotate(o.rotation,p);s=s.getBounds();i.style.left=Math.round(parseInt(i.style.left)+s.left)+"px";i.style.top=Math.round(parseInt(i.style.top)-s.bottom)+"px"}else{var v=new Image;v.onreadystatechange=OpenLayers.Function.bind(function(){if("complete"==v.readyState||"interactive"==v.readyState){q=v.width/v.height,r=Math.max(2*o.pointRadius,o.graphicWidth||0,o.graphicHeight||0),j*=q,o.graphicWidth=r*q,o.graphicHeight=r,this.graphicRotate(i,j,n,o)}},this);v.src=o.externalGraphic}},postDraw:function(d){d.style.visibility="visible";var e=d._style.fillColor,f=d._style.strokeColor;"none"==e&&d.fillcolor!=e&&(d.fillcolor=e);"none"==f&&d.strokecolor!=f&&(d.strokecolor=f)},setNodeDimension:function(e,f){var g=f.getBounds();if(g){var h=this.getResolution(),g=new OpenLayers.Bounds((g.left-this.featureDx)/h-this.offset.x|0,g.bottom/h-this.offset.y|0,(g.right-this.featureDx)/h-this.offset.x|0,g.top/h-this.offset.y|0);e.style.left=g.left+"px";e.style.top=g.top+"px";e.style.width=g.getWidth()+"px";e.style.height=g.getHeight()+"px";e.coordorigin=g.left+" "+g.top;e.coordsize=g.getWidth()+" "+g.getHeight()}},dashStyle:function(b){b=b.strokeDashstyle;switch(b){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return b;default:return b=b.split(/[ ,]/),2==b.length?1*b[0]>=2*b[1]?"longdash":1==b[0]||1==b[1]?"dot":"dash":4==b.length?1*b[0]>=2*b[1]?"longdashdot":"dashdot":"solid"}},createNode:function(d,e){var f=document.createElement(d);e&&(f.id=e);f.unselectable="on";f.onselectstart=OpenLayers.Function.False;return f},nodeTypeCompare:function(f,g){var h=g,i=h.indexOf(":");-1!=i&&(h=h.substr(i+1));var j=f.nodeName,i=j.indexOf(":");-1!=i&&(j=j.substr(i+1));return h==j},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(b){return this.nodeFactory(this.container.id+b,"olv:group")},drawPoint:function(c,d){return this.drawCircle(c,d,1)},drawCircle:function(e,f,g){if(!isNaN(f.x)&&!isNaN(f.y)){var h=this.getResolution();e.style.left=((f.x-this.featureDx)/h-this.offset.x|0)-g+"px";e.style.top=(f.y/h-this.offset.y|0)-g+"px";f=2*g;e.style.width=f+"px";e.style.height=f+"px";return e}return !1},drawLineString:function(c,d){return this.drawLine(c,d,!1)},drawLinearRing:function(c,d){return this.drawLine(c,d,!0)},drawLine:function(i,j,l){this.setNodeDimension(i,j);for(var m=this.getResolution(),n=j.components.length,o=Array(n),p,q,r=0;r<n;r++){p=j.components[r],q=(p.x-this.featureDx)/m-this.offset.x|0,p=p.y/m-this.offset.y|0,o[r]=" "+q+","+p+" l "}j=l?" x e":" e";i.path="m"+o.join("")+j;return i},drawPolygon:function(i,j){this.setNodeDimension(i,j);var o=this.getResolution(),r=[],s,t,u,v,w,x,y,z,A,B;s=0;for(t=j.components.length;s<t;s++){r.push("m");u=j.components[s].components;v=0===s;x=w=null;y=0;for(z=u.length;y<z;y++){A=u[y],B=(A.x-this.featureDx)/o-this.offset.x|0,A=A.y/o-this.offset.y|0,B=" "+B+","+A,r.push(B),0==y&&r.push(" l"),v||(w?w!=B&&(x?x!=B&&(v=!0):x=B):w=B)}r.push(v?" x ":" ")}r.push("e");i.path=r.join("");return i},drawRectangle:function(d,e){var f=this.getResolution();d.style.left=((e.x-this.featureDx)/f-this.offset.x|0)+"px";d.style.top=(e.y/f-this.offset.y|0)+"px";d.style.width=(e.width/f|0)+"px";d.style.height=(e.height/f|0)+"px";return d},drawText:function(g,h,i){var j=this.nodeFactory(g+this.LABEL_ID_SUFFIX,"olv:rect"),k=this.nodeFactory(g+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),l=this.getResolution();j.style.left=((i.x-this.featureDx)/l-this.offset.x|0)+"px";j.style.top=(i.y/l-this.offset.y|0)+"px";j.style.flip="y";k.innerText=h.label;"inherit"!=h.cursor&&null!=h.cursor&&(k.style.cursor=h.cursor);h.fontColor&&(k.style.color=h.fontColor);h.fontOpacity&&(k.style.filter="alpha(opacity="+100*h.fontOpacity+")");h.fontFamily&&(k.style.fontFamily=h.fontFamily);h.fontSize&&(k.style.fontSize=h.fontSize);h.fontWeight&&(k.style.fontWeight=h.fontWeight);h.fontStyle&&(k.style.fontStyle=h.fontStyle);!0===h.labelSelect&&(j._featureId=g,k._featureId=g,k._geometry=i,k._geometryClass=i.CLASS_NAME);k.style.whiteSpace="nowrap";k.inset="1px,0px,0px,0px";j.parentNode||(j.appendChild(k),this.textRoot.appendChild(j));h=h.labelAlign||"cm";1==h.length&&(h+="m");g=k.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[h.substr(0,1)];k=k.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[h.substr(1,1)];j.style.left=parseInt(j.style.left)-g-1+"px";j.style.top=parseInt(j.style.top)+k+"px"},moveRoot:function(c){var d=this.map.getLayer(c.container.id);d instanceof OpenLayers.Layer.Vector.RootContainer&&(d=this.map.getLayer(this.container.id));d&&d.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);d&&d.redraw()},importSymbol:function(h){var i=this.container.id+"-"+h,j=this.symbolCache[i];if(j){return j}j=OpenLayers.Renderer.symbol[h];if(!j){throw Error(h+" is not a valid symbol name")}h=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);for(var k=["m"],l=0;l<j.length;l+=2){var m=j[l],n=j[l+1];h.left=Math.min(h.left,m);h.bottom=Math.min(h.bottom,n);h.right=Math.max(h.right,m);h.top=Math.max(h.top,n);k.push(m);k.push(n);0==l&&k.push("l")}k.push("x e");j=k.join(" ");k=(h.getWidth()-h.getHeight())/2;0<k?(h.bottom-=k,h.top+=k):(h.left+=k,h.right-=k);j={path:j,size:h.getWidth(),left:h.left,bottom:h.bottom};return this.symbolCache[i]=j},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(d){OpenLayers.Control.prototype.setMap.apply(this,arguments);var e,f=this.layers||d.layers;for(e=f.length-1;0<=e;--e){this.addLayer({layer:f[e]})}if(!this.layers){d.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(b){b.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(b){b.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(d){if(this.active&&window.localStorage&&d.tile instanceof OpenLayers.Tile.Image){var e=d.tile,f=e.url;!e.layer.crossOriginKeyword&&(OpenLayers.ProxyHost&&0===f.indexOf(OpenLayers.ProxyHost))&&(f=OpenLayers.Control.CacheWrite.urlMap[f]);if(f=window.localStorage.getItem("olCache_"+f)){e.url=f,"tileerror"===d.type&&e.setImgSrc(f)}}},destroy:function(){if(this.layers||this.map){var c,d=this.layers||this.map.layers;for(c=d.length-1;0<=c;--c){this.removeLayer({layer:d[c]})}}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));var e=d.documentElement;if(e){var f=this["read_"+e.nodeName];d=f?f.call(this,e):(new OpenLayers.Format.GML(this.options?this.options:{})).read(d)}return d},read_msGMLOutput:function(i){var j=[];if(i=this.getSiblingNodesByTagCriteria(i,this.layerIdentifier)){for(var l=0,m=i.length;l<m;++l){var n=i[l],o=n.nodeName;n.prefix&&(o=o.split(":")[1]);o=o.replace(this.layerIdentifier,"");if(n=this.getSiblingNodesByTagCriteria(n,this.featureIdentifier)){for(var p=0;p<n.length;p++){var q=n[p],r=this.parseGeometry(q),q=this.parseAttributes(q),q=new OpenLayers.Feature.Vector(r.geometry,q,null);q.bounds=r.bounds;q.type=o;j.push(q)}}}}return j},read_FeatureInfoResponse:function(i){var j=[];i=this.getElementsByTagNameNS(i,"*","FIELDS");for(var l=0,m=i.length;l<m;l++){var n=i[l],o={},p,q=n.attributes.length;if(0<q){for(p=0;p<q;p++){var r=n.attributes[p];o[r.nodeName]=r.nodeValue}}else{for(n=n.childNodes,p=0,q=n.length;p<q;++p){r=n[p],3!=r.nodeType&&(o[r.getAttribute("name")]=r.getAttribute("value"))}}j.push(new OpenLayers.Feature.Vector(null,o,null))}return j},getSiblingNodesByTagCriteria:function(i,j){var k=[],l,m,n,o;if(i&&i.hasChildNodes()){l=i.childNodes;n=l.length;for(var p=0;p<n;p++){for(o=l[p];o&&1!=o.nodeType;){o=o.nextSibling,p++}m=o?o.nodeName:"";0<m.length&&-1<m.indexOf(j)?k.push(o):(m=this.getSiblingNodesByTagCriteria(o,j),0<m.length&&(0==k.length?k=m:k.push(m)))}}return k},parseAttributes:function(g){var h={};if(1==g.nodeType){g=g.childNodes;for(var i=g.length,j=0;j<i;++j){var k=g[j];if(1==k.nodeType){var l=k.childNodes,k=k.prefix?k.nodeName.split(":")[1]:k.nodeName;0==l.length?h[k]=null:1==l.length&&(l=l[0],3==l.nodeType||4==l.nodeType)&&(l=l.nodeValue.replace(this.regExes.trimSpace,""),h[k]=l)}}}return h},parseGeometry:function(d){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);d=this.gmlFormat.parseFeature(d);var e,f=null;d&&(e=d.geometry&&d.geometry.clone(),f=d.bounds&&d.bounds.clone(),d.destroy());return{geometry:e,bounds:f}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(b.formatOptions));!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(b={},b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{}))},getInfoForClick:function(b){this.request(b.xy,{})},getInfoForHover:function(b){this.request(b.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var e=this.layers||this.map.layers,f=[],g,h=e.length-1;0<=h&&(g=e[h],!(g instanceof OpenLayers.Layer.WMTS)||(g.requestEncoding!==this.requestEncoding||this.queryVisible&&!g.getVisibility())||(f.push(g),this.drillDown&&!this.hover));--h){}return f},buildRequestOptions:function(e,f){var g=this.map.getLonLatFromPixel(f),h=e.getURL(new OpenLayers.Bounds(g.lon,g.lat,g.lon,g.lat)),h=OpenLayers.Util.getParameters(h),g=e.getTileInfo(g);OpenLayers.Util.extend(h,{service:"WMTS",version:e.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:g.i,j:g.j});OpenLayers.Util.applyDefaults(h,this.vendorParams);return{url:OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,params:OpenLayers.Util.upperCaseObject(h),callback:function(a){this.handleResponse(f,a,e)},scope:this}},request:function(h,i){i=i||{};var j=this.findLayers();if(0<j.length){for(var k,l,m=0,n=j.length;m<n;m++){l=j[m],k=this.events.triggerEvent("beforegetfeatureinfo",{xy:h,layer:l}),!1!==k&&(++this.pending,k=this.buildRequestOptions(l,h),k=OpenLayers.Request.GET(k),!0===i.hover&&(this.hoverRequest=k))}0<this.pending&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(h,i,j){--this.pending;0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0);if(i.status&&(200>i.status||300<=i.status)){this.events.triggerEvent("exception",{xy:h,request:i,layer:j})}else{var k=i.responseXML;k&&k.documentElement||(k=i.responseText);var l,m;try{l=this.format.read(k)}catch(n){m=!0,this.events.triggerEvent("exception",{xy:h,request:i,error:n,layer:j})}m||this.events.triggerEvent("getfeatureinfo",{text:i.responseText,features:l,request:i,xy:h,layer:j})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"});OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(d){d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options||{});var e=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.format.write(d.params||d);e.priv=OpenLayers.Request.POST({url:d.url,callback:this.createCallback(this.handleRead,e,d),params:d.params,headers:d.headers,data:f});return e},handleRead:function(d,e){if(e.callback){var f=d.priv;200<=f.status&&300>f.status?(d.data=this.parseData(f),d.code=OpenLayers.Protocol.Response.SUCCESS):d.code=OpenLayers.Protocol.Response.FAILURE;e.callback.call(e.scope,d)}},parseData:function(c){var d=c.responseXML;d&&d.documentElement||(d=c.responseText);return !d||0>=d.length?null:this.format.read(d)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"});OpenLayers.Format.WCSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"},errorProperty:"operationsMetadata",readers:{wcs:OpenLayers.Util.applyDefaults({Capabilities:function(c,d){this.readChildNodes(c,d)},Contents:function(c,d){d.contentMetadata=[];this.readChildNodes(c,d.contentMetadata)},CoverageSummary:function(d,e){var f={};this.readChildNodes(d,f);e.push(f)},Identifier:function(c,d){d.identifier=this.getChildValue(c)},Title:function(c,d){d.title=this.getChildValue(c)},Abstract:function(c,d){d["abstract"]=this.getChildValue(c)},SupportedCRS:function(d,e){var f=this.getChildValue(d);f&&(e.supportedCRS||(e.supportedCRS=[]),e.supportedCRS.push(f))},SupportedFormat:function(d,e){var f=this.getChildValue(d);f&&(e.supportedFormat||(e.supportedFormat=[]),e.supportedFormat.push(f))}},OpenLayers.Format.WCSCapabilities.v1.prototype.readers.wcs),ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_1_0"});OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:0.5},labelSymbolizer:{},gratLayer:null,initialize:function(b){b=b||{};b.layerName=b.layerName||OpenLayers.i18n("Graticule");OpenLayers.Control.prototype.initialize.apply(this,[b]);this.labelSymbolizer.stroke=!1;this.labelSymbolizer.fill=!1;this.labelSymbolizer.label="${label}";this.labelSymbolizer.labelAlign="${labelAlign}";this.labelSymbolizer.labelXOffset="${xOffset}";this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.gratLayer){var b=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":b}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var i=this.map.getExtent();if(i){this.gratLayer.destroyFeatures();var j=new OpenLayers.Projection("EPSG:4326"),o=this.map.getProjectionObject(),r=this.map.getResolution();o.proj&&"longlat"==o.proj.projName&&(this.numPoints=1);var s=this.map.getCenter(),t=new OpenLayers.Pixel(s.lon,s.lat);OpenLayers.Projection.transform(t,o,j);for(var s=this.targetSize*r,s=s*s,u,r=0;r<this.intervals.length;++r){u=this.intervals[r];var v=u/2,w=t.offset({x:-v,y:-v}),v=t.offset({x:v,y:v});OpenLayers.Projection.transform(w,j,o);OpenLayers.Projection.transform(v,j,o);if((w.x-v.x)*(w.x-v.x)+(w.y-v.y)*(w.y-v.y)<=s){break}}t.x=Math.floor(t.x/u)*u;t.y=Math.floor(t.y/u)*u;var r=0,s=[t.clone()],v=t.clone(),x;do{v=v.offset({x:0,y:u}),x=OpenLayers.Projection.transform(v.clone(),j,o),s.unshift(v)}while(i.containsPixel(x)&&1000>++r);v=t.clone();do{v=v.offset({x:0,y:-u}),x=OpenLayers.Projection.transform(v.clone(),j,o),s.push(v)}while(i.containsPixel(x)&&1000>++r);r=0;w=[t.clone()];v=t.clone();do{v=v.offset({x:-u,y:0}),x=OpenLayers.Projection.transform(v.clone(),j,o),w.unshift(v)}while(i.containsPixel(x)&&1000>++r);v=t.clone();do{v=v.offset({x:u,y:0}),x=OpenLayers.Projection.transform(v.clone(),j,o),w.push(v)}while(i.containsPixel(x)&&1000>++r);u=[];for(r=0;r<w.length;++r){x=w[r].x;for(var t=[],y=null,z=Math.min(s[0].y,90),v=Math.max(s[s.length-1].y,-90),A=(z-v)/this.numPoints,z=v,v=0;v<=this.numPoints;++v){var B=new OpenLayers.Geometry.Point(x,z);B.transform(j,o);t.push(B);z+=A;B.y>=i.bottom&&!y&&(y=B)}this.labelled&&(y=new OpenLayers.Geometry.Point(y.x,i.bottom),x={value:x,label:this.labelled?OpenLayers.Util.getFormattedLonLat(x,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(y,x)));t=new OpenLayers.Geometry.LineString(t);u.push(new OpenLayers.Feature.Vector(t))}for(v=0;v<s.length;++v){if(z=s[v].y,!(-90>z||90<z)){t=[];r=w[0].x;A=(w[w.length-1].x-r)/this.numPoints;x=r;y=null;for(r=0;r<=this.numPoints;++r){B=new OpenLayers.Geometry.Point(x,z),B.transform(j,o),t.push(B),x+=A,B.x<i.right&&(y=B)}this.labelled&&(y=new OpenLayers.Geometry.Point(i.right,y.y),x={value:z,label:this.labelled?OpenLayers.Util.getFormattedLonLat(z,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(y,x)));t=new OpenLayers.Geometry.LineString(t);u.push(new OpenLayers.Feature.Vector(t))}}this.gratLayer.addFeatures(u)}},CLASS_NAME:"OpenLayers.Control.Graticule"});OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Corner={round:function(e,f){e=OpenLayers.Util.getElement(e);this._setOptions(f);var g=this.options.color;"fromElement"==this.options.color&&(g=this._background(e));var h=this.options.bgColor;"fromParent"==this.options.bgColor&&(h=this._background(e.offsetParent));this._roundCornersImpl(e,g,h)},changeColor:function(e,f){e.style.backgroundColor=f;for(var g=e.parentNode.getElementsByTagName("span"),h=0;h<g.length;h++){g[h].style.backgroundColor=f}},changeOpacity:function(f,g){var h="alpha(opacity="+100*g+")";f.style.opacity=g;f.style.filter=h;for(var i=f.parentNode.getElementsByTagName("span"),j=0;j<i.length;j++){i[j].style.opacity=g,i[j].style.filter=h}},reRound:function(d,e){var f=d.parentNode.childNodes[2];d.parentNode.removeChild(d.parentNode.childNodes[0]);d.parentNode.removeChild(f);this.round(d.parentNode,e)},_roundCornersImpl:function(d,e,f){this.options.border&&this._renderBorder(d,f);this._isTopRounded()&&this._roundTopCorners(d,e,f);this._isBottomRounded()&&this._roundBottomCorners(d,e,f)},_renderBorder:function(d,e){var f="1px solid "+this._borderColor(e);d.innerHTML="<div "+("style='border-left: "+f+";"+("border-right: "+f)+"'")+">"+d.innerHTML+"</div>"},_roundTopCorners:function(f,g,h){for(var i=this._createCorner(h),j=0;j<this.options.numSlices;j++){i.appendChild(this._createCornerSlice(g,h,j,"top"))}f.style.paddingTop=0;f.insertBefore(i,f.firstChild)},_roundBottomCorners:function(f,g,h){for(var i=this._createCorner(h),j=this.options.numSlices-1;0<=j;j--){i.appendChild(this._createCornerSlice(g,h,j,"bottom"))}f.style.paddingBottom=0;f.appendChild(i)},_createCorner:function(c){var d=document.createElement("div");d.style.backgroundColor=this._isTransparent()?"transparent":c;return d},_createCornerSlice:function(g,h,i,j){var k=document.createElement("span"),l=k.style;l.backgroundColor=g;l.display="block";l.height="1px";l.overflow="hidden";l.fontSize="1px";g=this._borderColor(g,h);this.options.border&&0==i?(l.borderTopStyle="solid",l.borderTopWidth="1px",l.borderLeftWidth="0px",l.borderRightWidth="0px",l.borderBottomWidth="0px",l.height="0px",l.borderColor=g):g&&(l.borderColor=g,l.borderStyle="solid",l.borderWidth="0px 1px");this.options.compact||i!=this.options.numSlices-1||(l.height="2px");this._setMargin(k,i,j);this._setBorder(k,i,j);return k},_setOptions:function(b){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1};OpenLayers.Util.extend(this.options,b||{});this.options.numSlices=this.options.compact?2:4;this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")||0<=this.options.corners.indexOf("tl")&&0<=this.options.corners.indexOf("tr")?"":0<=this.options.corners.indexOf("tl")?"left":0<=this.options.corners.indexOf("tr")?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")||0<=this.options.corners.indexOf("bl")&&0<=this.options.corners.indexOf("br")?"":0<=this.options.corners.indexOf("bl")?"left":0<=this.options.corners.indexOf("br")?"right":""},_borderColor:function(c,d){return"transparent"==c?d:this.options.border?this.options.border:this.options.blend?this._blend(d,c):""},_setMargin:function(d,e,f){e=this._marginSize(e);f="top"==f?this._whichSideTop():this._whichSideBottom();"left"==f?(d.style.marginLeft=e+"px",d.style.marginRight="0px"):"right"==f?(d.style.marginRight=e+"px",d.style.marginLeft="0px"):(d.style.marginLeft=e+"px",d.style.marginRight=e+"px")},_setBorder:function(d,e,f){e=this._borderSize(e);f="top"==f?this._whichSideTop():this._whichSideBottom();"left"==f?(d.style.borderLeftWidth=e+"px",d.style.borderRightWidth="0px"):"right"==f?(d.style.borderRightWidth=e+"px",d.style.borderLeftWidth="0px"):(d.style.borderLeftWidth=e+"px",d.style.borderRightWidth=e+"px");!1!=this.options.border&&(d.style.borderLeftWidth=e+"px",d.style.borderRightWidth=e+"px")},_marginSize:function(f){if(this._isTransparent()){return 0}var g=[5,3,2,1],h=[3,2,1,0],i=[2,1],j=[1,0];return this.options.compact&&this.options.blend?j[f]:this.options.compact?i[f]:this.options.blend?h[f]:g[f]},_borderSize:function(f){var g=[5,3,2,1],h=[2,1,1,1],i=[1,0],j=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?i[f]:this.options.blend?h[f]:this.options.border?j[f]:this._isTransparent()?g[f]:0},_hasString:function(c){for(var d=1;d<arguments.length;d++){if(0<=c.indexOf(arguments[d])){return !0}}return !1},_blend:function(d,e){var f=OpenLayers.Rico.Color.createFromHex(d);f.blend(OpenLayers.Rico.Color.createFromHex(e));return f},_background:function(c){try{return OpenLayers.Rico.Color.createColorFromBackground(c).asHex()}catch(d){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(b){return 1==b.childNodes.length&&3==b.childNodes[0].nodeType}};OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions);this.previous=new OpenLayers.Control.Button(b);b={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(b,this.nextOptions);this.next=new OpenLayers.Control.Button(b);this.clear()},onPreviousChange:function(c,d){c&&!this.previous.active?this.previous.activate():!c&&this.previous.active&&this.previous.deactivate()},onNextChange:function(c,d){c&&!this.next.active?this.next.activate():!c&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var b in this){this[b]=null}},setMap:function(b){this.map=b;this.next.setMap(b);this.previous.setMap(b)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var c=this.previousStack.shift(),d=this.previousStack.shift();void 0!=d?(this.nextStack.unshift(c),this.previousStack.unshift(d),this.restoring=!0,this.restore(d),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(c);return d},nextTrigger:function(){var b=this.nextStack.shift();void 0!=b&&(this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1));return b},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var f,g;if(this.map.getProjectionObject()==e.projection){g=this.map.getZoomForResolution(e.resolution),f=e.center}else{f=e.center.clone();f.transform(e.projection,this.map.getProjectionObject());g=e.units;var h=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;g=this.map.getZoomForResolution((g&&h?OpenLayers.INCHES_PER_UNIT[g]/OpenLayers.INCHES_PER_UNIT[h]:1)*e.resolution)}this.map.setCenter(f,g)},setListeners:function(){this.listeners={};for(var b in this.registry){this.listeners[b]=OpenLayers.Function.bind(function(){if(!this.restoring){var a=this.registry[b].apply(this,arguments);this.previousStack.unshift(a);if(1<this.previousStack.length){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}this.previousStack.length>this.limit+1&&this.previousStack.pop();0<this.nextStack.length&&(this.nextStack=[],this.onNextChange(null,0))}return !0},this)}},activate:function(){var c=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var d in this.listeners){this.map.events.register(d,this,this.listeners[d])}c=!0;0==this.previousStack.length&&this.initStack()}return c},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var c=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var d in this.listeners){this.map.events.unregister(d,this,this.listeners[d])}this.clearOnDeactivate&&this.clear();c=!0}return c},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(b){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[b.name,b.url,{},b]);this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},createBackBuffer:function(){},clone:function(b){null==b&&(b=new OpenLayers.Layer.UTFGrid(this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getFeatureInfo:function(c){var d=null;(c=this.getTileData(c))&&c.tile&&(d=c.tile.getFeatureInfo(c.i,c.j));return d},getFeatureId:function(c){var d=null;c=this.getTileData(c);c.tile&&(d=c.tile.getFeatureId(c.i,c.j));return d},CLASS_NAME:"OpenLayers.Layer.UTFGrid"});OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(b){OpenLayers.Util.extend(this,b);this.maps=[];this.tileQueueId={};this.tileQueue={};this.tileCache={};this.tileCacheIndex=[]},addMap:function(d){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(d);this.tileQueue[d.id]=[];for(var e=0,f=d.layers.length;e<f;++e){this.addLayer({layer:d.layers[e]})}d.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(d){if(!this._destroyed&&OpenLayers.Layer.Grid){window.clearTimeout(this.tileQueueId[d.id]);if(d.layers){for(var e=0,f=d.layers.length;e<f;++e){this.removeLayer({layer:d.layers[e]})}}d.events&&d.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this});delete this.tileQueue[d.id];delete this.tileQueueId[d.id];OpenLayers.Util.removeItem(this.maps,d)}},move:function(b){this.updateTimeout(b.object,this.moveDelay,!0)},zoomEnd:function(b){this.updateTimeout(b.object,this.zoomDelay)},changeLayer:function(b){"visibility"!==b.property&&"params"!==b.property||this.updateTimeout(b.object,0)},addLayer:function(e){e=e.layer;if(e instanceof OpenLayers.Layer.Grid){e.events.on({addtile:this.addTile,retile:this.clearTileQueue,scope:this});var f,g,h;for(f=e.grid.length-1;0<=f;--f){for(g=e.grid[f].length-1;0<=g;--g){h=e.grid[f][g],this.addTile({tile:h}),h.url&&!h.imgDiv&&this.manageTileCache({object:h})}}}},removeLayer:function(e){e=e.layer;if(e instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:e}),e.events&&e.events.un({addtile:this.addTile,retile:this.clearTileQueue,scope:this}),e.grid)){var f,g,h;for(f=e.grid.length-1;0<=f;--f){for(g=e.grid[f].length-1;0<=g;--g){h=e.grid[f][g],this.unloadTile({object:h})}}}},updateTimeout:function(e,f,g){window.clearTimeout(this.tileQueueId[e.id]);var h=this.tileQueue[e.id];if(!g||h.length){this.tileQueueId[e.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(e);h.length&&this.updateTimeout(e,this.frameDelay)},this),f)}},addTile:function(b){if(b.tile instanceof OpenLayers.Tile.Image){b.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this})}else{this.removeLayer({layer:b.tile.layer})}},unloadTile:function(b){b=b.object;b.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this});OpenLayers.Util.removeItem(this.tileQueue[b.layer.map.id],b)},queueTileDraw:function(f){f=f.object;var g=!1,h=f.layer,i=h.getURL(f.bounds),j=this.tileCache[i];j&&"olTileImage"!==j.className&&(delete this.tileCache[i],OpenLayers.Util.removeItem(this.tileCacheIndex,i),j=null);!h.url||!h.async&&j||(g=this.tileQueue[h.map.id],~OpenLayers.Util.indexOf(g,f)||g.push(f),g=!0);return !g},drawTilesFromQueue:function(d){var e=this.tileQueue[d.id],f=this.tilesPerFrame;for(d=d.zoomTween&&d.zoomTween.playing;!d&&e.length&&f;){e.shift().draw(!0),--f}},manageTileCache:function(c){c=c.object;var d=this.tileCache[c.url];d&&(d.parentNode&&OpenLayers.Element.hasClass(d.parentNode,"olBackBuffer")&&(d.parentNode.removeChild(d),d.id=null),d.parentNode||(d.style.visibility="hidden",d.style.opacity=0,c.setImage(d),OpenLayers.Util.removeItem(this.tileCacheIndex,c.url),this.tileCacheIndex.push(c.url)))},addToCache:function(b){b=b.object;this.tileCache[b.url]||OpenLayers.Element.hasClass(b.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[b.url]=b.imgDiv,this.tileCacheIndex.push(b.url))},clearTileQueue:function(d){d=d.object;for(var e=this.tileQueue[d.map.id],f=e.length-1;0<=f;--f){e[f].layer===d&&e.splice(f,1)}},destroy:function(){for(var b=this.maps.length-1;0<=b;--b){this.removeMap(this.maps[b])}this.tileCacheIndex=this.tileCache=this.tileQueueId=this.tileQueue=this.maps=null;this._destroyed=!0}});OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(i,j,l){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0]));if(this.layerInfo){var m=this.layerInfo,n=new OpenLayers.Bounds(m.fullExtent.xmin,m.fullExtent.ymin,m.fullExtent.xmax,m.fullExtent.ymax);this.projection="EPSG:"+m.spatialReference.wkid;this.sphericalMercator=102100==m.spatialReference.wkid;this.units="esriFeet"==m.units?"ft":"m";if(m.tileInfo){this.tileSize=new OpenLayers.Size(m.tileInfo.width||m.tileInfo.cols,m.tileInfo.height||m.tileInfo.rows);this.tileOrigin=new OpenLayers.LonLat(m.tileInfo.origin.x,m.tileInfo.origin.y);var o=new OpenLayers.Geometry.Point(n.left,n.top),n=new OpenLayers.Geometry.Point(n.right,n.bottom);this.useScales?this.scales=[]:this.resolutions=[];this.lods=[];for(var p in m.tileInfo.lods){if(m.tileInfo.lods.hasOwnProperty(p)){var q=m.tileInfo.lods[p];this.useScales?this.scales.push(q.scale):this.resolutions.push(q.resolution);var r=this.getContainingTileCoords(o,q.resolution);q.startTileCol=r.x;q.startTileRow=r.y;r=this.getContainingTileCoords(n,q.resolution);q.endTileCol=r.x;q.endTileRow=r.y;this.lods.push(q)}}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;this.overrideDPI&&m.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=m.tileInfo.dpi)}}},getContainingTileCoords:function(c,d){return new OpenLayers.Pixel(Math.max(Math.floor((c.x-this.tileOrigin.lon)/(this.tileSize.w*d)),0),Math.max(Math.floor((this.tileOrigin.lat-c.y)/(this.tileSize.h*d)),0))},calculateMaxExtentWithLOD:function(d){var e=this.tileOrigin.lon+d.startTileCol*this.tileSize.w*d.resolution,f=this.tileOrigin.lat-d.startTileRow*this.tileSize.h*d.resolution;return new OpenLayers.Bounds(e,f-(d.endTileRow-d.startTileRow+1)*this.tileSize.h*d.resolution,e+(d.endTileCol-d.startTileCol+1)*this.tileSize.w*d.resolution,f)},calculateMaxExtentWithExtent:function(e,f){var g=new OpenLayers.Geometry.Point(e.left,e.top),h=new OpenLayers.Geometry.Point(e.right,e.bottom),g=this.getContainingTileCoords(g,f),h=this.getContainingTileCoords(h,f);return this.calculateMaxExtentWithLOD({resolution:f,startTileCol:g.x,startTileRow:g.y,endTileCol:h.x,endTileRow:h.y})},getUpperLeftTileCoord:function(c){var d=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(d,c)},getLowerRightTileCoord:function(c){var d=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(d,c)},getMaxExtentForResolution:function(f){var g=this.getUpperLeftTileCoord(f),h=this.getLowerRightTileCoord(f),i=this.tileOrigin.lon+g.x*this.tileSize.w*f,j=this.tileOrigin.lat-g.y*this.tileSize.h*f;return new OpenLayers.Bounds(i,j-(h.y-g.y+1)*this.tileSize.h*f,i+(h.x-g.x+1)*this.tileSize.w*f,j)},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options));return OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},initGriddedTiles:function(b){delete this._tileOrigin;OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var b=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(b)},getTileOrigin:function(){if(!this._tileOrigin){var b=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(b.left,b.bottom)}return this._tileOrigin},getURL:function(f){var g=this.getResolution(),h=this.tileOrigin.lon+g*this.tileSize.w/2,i=this.tileOrigin.lat-g*this.tileSize.h/2;f=f.getCenterLonLat();h=Math.round(Math.abs((f.lon-h)/(g*this.tileSize.w)));i=Math.round(Math.abs((i-f.lat)/(g*this.tileSize.h)));f=this.map.getZoom();if(this.lods){if(g=this.lods[this.map.getZoom()],h<g.startTileCol||h>g.endTileCol||i<g.startTileRow||i>g.endTileRow){return null}}else{var j=this.getUpperLeftTileCoord(g),g=this.getLowerRightTileCoord(g);if(h<j.x||h>=g.x||i<j.y||i>=g.y){return null}}g=this.url;j=""+h+i+f;OpenLayers.Util.isArray(g)&&(g=this.selectUrl(j,g));this.useArcGISServer?g+="/tile/${z}/${y}/${x}":(h="C"+OpenLayers.Number.zeroPad(h,8,16),i="R"+OpenLayers.Number.zeroPad(i,8,16),f="L"+OpenLayers.Number.zeroPad(f,2,10),g=g+"/${z}/${y}/${x}."+this.type);g=OpenLayers.String.format(g,{x:h,y:i,z:f});return OpenLayers.Util.urlAppend(g,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(b.formatOptions));!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(b={},b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{}))},getInfoForClick:function(b){this.events.triggerEvent("beforegetfeatureinfo",{xy:b.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(b.xy,{})},getInfoForHover:function(b){this.events.triggerEvent("beforegetfeatureinfo",{xy:b.xy});this.request(b.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var f=this.layers||this.map.layers,g=[],h,i,j=f.length-1;0<=j;--j){h=f[j],h instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||h.getVisibility())&&(i=OpenLayers.Util.isArray(h.url)?h.url[0]:h.url,!1!==this.drillDown||this.url||(this.url=i),(!0===this.drillDown||this.urlMatches(i))&&g.push(h))}return g},urlMatches:function(e){var f=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!f&&this.layerUrls){for(var g=0,h=this.layerUrls.length;g<h;++g){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[g],e)){f=!0;break}}}return f},buildWMSOptions:function(i,j,k,l){for(var m=[],n=[],o=0,p=j.length;o<p;o++){null!=j[o].params.LAYERS&&(m=m.concat(j[o].params.LAYERS),n=n.concat(this.getStyleNames(j[o])))}j=j[0];o=this.map.getProjection();(p=j.projection)&&p.equals(this.map.getProjectionObject())&&(o=p.getCode());l=OpenLayers.Util.extend({service:"WMS",version:j.params.VERSION,request:"GetFeatureInfo",exceptions:j.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,j.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:l,info_format:j.params.INFO_FORMAT||this.infoFormat},1.3<=parseFloat(j.params.VERSION)?{crs:o,i:parseInt(k.x),j:parseInt(k.y)}:{srs:o,x:parseInt(k.x),y:parseInt(k.y)});0!=m.length&&(l=OpenLayers.Util.extend({layers:m,query_layers:m,styles:n},l));OpenLayers.Util.applyDefaults(l,this.vendorParams);return{url:i,params:OpenLayers.Util.upperCaseObject(l),callback:function(a){this.handleResponse(k,a,i)},scope:this}},getStyleNames:function(b){return b.params.STYLES?b.params.STYLES:OpenLayers.Util.isArray(b.params.LAYERS)?Array(b.params.LAYERS.length):b.params.LAYERS.replace(/[^,]/g,"")},request:function(i,j){var k=this.findLayers();if(0==k.length){this.events.triggerEvent("nogetfeatureinfo"),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}else{if(j=j||{},!1===this.drillDown){var k=this.buildWMSOptions(this.url,k,i,k[0].params.FORMAT),l=OpenLayers.Request.GET(k);!0===j.hover&&(this.hoverRequest=l)}else{this._numRequests=this._requestCount=0;this.features=[];for(var l={},m,n=0,o=k.length;n<o;n++){var p=k[n];m=OpenLayers.Util.isArray(p.url)?p.url[0]:p.url;m in l?l[m].push(p):(this._numRequests++,l[m]=[p])}for(m in l){k=l[m],k=this.buildWMSOptions(m,k,i,k[0].params.FORMAT),OpenLayers.Request.GET(k)}}}},triggerGetFeatureInfo:function(d,e,f){this.events.triggerEvent("getfeatureinfo",{text:d.responseText,features:f,request:d,xy:e});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,f,g){var h=f.responseXML;h&&h.documentElement||(h=f.responseText);h=this.format.read(h);!1===this.drillDown?this.triggerGetFeatureInfo(f,e,h):(this._requestCount++,this._features="object"===this.output?(this._features||[]).concat({url:g,features:h}):(this._features||[]).concat(h),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(f,e,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(f){"string"==typeof f&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));f&&9==f.nodeType&&(f=f.documentElement);var g={features:[]};this.readNode(f,g);f=[];for(var h=0,i=g.features.length;h<i;h++){var j=g.features[h];this.internalProjection&&(this.externalProjection&&j.components[0])&&j.components[0].transform(this.externalProjection,this.internalProjection);j=new OpenLayers.Feature.Vector(j.components[0],j.attributes);f.push(j)}return f},readers:{sa:{SamplingPoint:function(d,e){if(!e.attributes){var f={attributes:{}};e.features.push(f);e=f}e.attributes.id=this.getAttributeNS(d,this.namespaces.gml,"id");this.readChildNodes(d,e)},position:function(c,d){this.readChildNodes(c,d)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(c,d){this.readChildNodes(c,d)},featureMember:function(d,e){var f={attributes:{}};e.features.push(f);this.readChildNodes(d,f)},name:function(c,d){d.attributes.name=this.getChildValue(c)},pos:function(c,d){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(c.getAttribute("srsName")));OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c,d])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(e){for(var f=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),g=0,h=e.fois.length;g<h;g++){this.writeNode("FeatureOfInterestId",{foi:e.fois[g]},f)}return f},FeatureOfInterestId:function(b){return this.createElementNSPlus("FeatureOfInterestId",{value:b.foi})}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"});OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={measurements:[],observations:[]};this.readNode(c,d);return d},write:function(b){b=this.writeNode("sos:GetObservation",b);b.setAttribute("xmlns:om",this.namespaces.om);b.setAttribute("xmlns:ogc",this.namespaces.ogc);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},readers:{om:{ObservationCollection:function(c,d){d.id=this.getAttributeNS(c,this.namespaces.gml,"id");this.readChildNodes(c,d)},member:function(c,d){this.readChildNodes(c,d)},Measurement:function(d,e){var f={};e.measurements.push(f);this.readChildNodes(d,f)},Observation:function(d,e){var f={};e.observations.push(f);this.readChildNodes(d,f)},samplingTime:function(d,e){var f={};e.samplingTime=f;this.readChildNodes(d,f)},observedProperty:function(c,d){d.observedProperty=this.getAttributeNS(c,this.namespaces.xlink,"href");this.readChildNodes(c,d)},procedure:function(c,d){d.procedure=this.getAttributeNS(c,this.namespaces.xlink,"href");this.readChildNodes(c,d)},featureOfInterest:function(h,i){var j={features:[]};i.fois=[];i.fois.push(j);this.readChildNodes(h,j);for(var k=[],l=0,m=j.features.length;l<m;l++){var n=j.features[l];k.push(new OpenLayers.Feature.Vector(n.components[0],n.attributes))}j.features=k},result:function(d,e){var f={};e.result=f;""!==this.getChildValue(d)?(f.value=this.getChildValue(d),f.uom=d.getAttribute("uom")):this.readChildNodes(d,f)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(d,e){var f={};e.timeInstant=f;this.readChildNodes(d,f)},timePosition:function(c,d){d.timePosition=this.getChildValue(c)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(e){var f=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",e,f);e.eventTime&&this.writeNode("eventTime",e,f);for(var g in e.procedures){this.writeNode("procedure",e.procedures[g],f)}for(var h in e.observedProperties){this.writeNode("observedProperty",e.observedProperties[h],f)}e.foi&&this.writeNode("featureOfInterest",e.foi,f);this.writeNode("responseFormat",e,f);e.resultModel&&this.writeNode("resultModel",e,f);e.responseMode&&this.writeNode("responseMode",e,f);return f},featureOfInterest:function(c){var d=this.createElementNSPlus("featureOfInterest");this.writeNode("ObjectID",c.objectId,d);return d},ObjectID:function(b){return this.createElementNSPlus("ObjectID",{value:b})},responseFormat:function(b){return this.createElementNSPlus("responseFormat",{value:b.responseFormat})},procedure:function(b){return this.createElementNSPlus("procedure",{value:b})},offering:function(b){return this.createElementNSPlus("offering",{value:b.offering})},observedProperty:function(b){return this.createElementNSPlus("observedProperty",{value:b})},eventTime:function(c){var d=this.createElementNSPlus("eventTime");"latest"===c.eventTime&&this.writeNode("ogc:TM_Equals",c,d);return d},resultModel:function(b){return this.createElementNSPlus("resultModel",{value:b.resultModel})},responseMode:function(b){return this.createElementNSPlus("responseMode",{value:b.responseMode})}},ogc:{TM_Equals:function(c){var d=this.createElementNSPlus("ogc:TM_Equals");this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},d);"latest"===c.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},d);return d},PropertyName:function(b){return this.createElementNSPlus("ogc:PropertyName",{value:b.property})}},gml:{TimeInstant:function(c){var d=this.createElementNSPlus("gml:TimeInstant");this.writeNode("gml:timePosition",c,d);return d},timePosition:function(b){return this.createElementNSPlus("gml:timePosition",{value:b.value})}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"});OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(b){this.handlerMode=b;this.resetHandler()},resetHandler:function(){this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null);"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions));return this.handler?!0:!1},initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||this.defaultHandlerOptions;OpenLayers.Control.prototype.initialize.apply(this,[b]);this.resetHandler()},handleEvent:function(i){if(null==i){this.reset()}else{var j=this.map.getLonLatFromPixel(i.xy);if(j){var k=this.findLayers();if(0<k.length){for(var l={},m,n,o=0,p=k.length;o<p;o++){m=k[o],n=OpenLayers.Util.indexOf(this.map.layers,m),l[n]=m.getFeatureInfo(j)}this.callback(l,j,i.xy)}}}},callback:function(b){},reset:function(b){this.callback(null)},findLayers:function(){for(var e=this.layers||this.map.layers,f=[],g,h=e.length-1;0<=h;--h){g=e[h],g instanceof OpenLayers.Layer.UTFGrid&&f.push(g)}return f},CLASS_NAME:"OpenLayers.Control.UTFGrid"});OpenLayers.Format.CQL=function(){function i(d){function f(){var b=s.pop();switch(b.type){case"LOGICAL":var e=f(),v=f();return new OpenLayers.Filter.Logical({filters:[v,e],type:o[b.text.toUpperCase()]});case"NOT":return b=f(),new OpenLayers.Filter.Logical({filters:[b],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":return s.pop(),v=f(),b=f(),e=f(),new OpenLayers.Filter.Comparison({property:e,lowerBoundary:b,upperBoundary:v,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":return v=f(),e=f(),new OpenLayers.Filter.Comparison({property:e,value:v,type:m[b.text.toUpperCase()]});case"IS_NULL":return e=f(),new OpenLayers.Filter.Comparison({property:e,type:m[b.text.toUpperCase()]});case"VALUE":return(e=b.text.match(/^'(.*)'$/))?e[1].replace(/''/g,"'"):Number(b.text);case"SPATIAL":switch(b.text.toUpperCase()){case"BBOX":var b=f(),e=f(),v=f(),w=f(),x=f();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:x,value:OpenLayers.Bounds.fromArray([w,v,e,b])});case"INTERSECTS":return v=f(),e=f(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e,value:v});case"WITHIN":return v=f(),e=f(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:e,value:v});case"CONTAINS":return v=f(),e=f(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:e,value:v});case"DWITHIN":return b=f(),v=f(),e=f(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:v,property:e,distance:Number(b)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(b.text);default:return b.text}}for(var h=[],s=[];d.length;){var t=d.shift();switch(t.type){case"PROPERTY":case"GEOMETRY":case"VALUE":s.push(t);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var u=q[t.type];0<h.length&&q[h[h.length-1].type]<=u;){s.push(h.pop())}h.push(t);break;case"SPATIAL":case"NOT":case"LPAREN":h.push(t);break;case"RPAREN":for(;0<h.length&&"LPAREN"!=h[h.length-1].type;){s.push(h.pop())}h.pop();0<h.length&&"SPATIAL"==h[h.length-1].type&&s.push(h.pop());case"COMMA":case"END":break;default:throw Error("Unknown token type "+t.type)}}for(;0<h.length;){s.push(h.pop())}d=f();if(0<s.length){d="Remaining tokens after building AST: \n";for(h=s.length-1;0<=h;h--){d+=s[h].type+": "+s[h].text+"\n"}throw Error(d)}return d}var j={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(e){var f=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(e);if(f){var g=e.length,f=e.indexOf("(",f[0].length);if(-1<f){for(var h=1;f<g&&0<h;){switch(f++,e.charAt(f)){case"(":h++;break;case")":h--}}}return[e.substr(0,f+1)]}},END:/^$/},l={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},m={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},n={},o={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},p={},q={RPAREN:3,LOGICAL:2,COMPARISON:1},r;for(r in m){m.hasOwnProperty(r)&&(n[m[r]]=r)}for(r in o){o.hasOwnProperty(r)&&(p[o[r]]=r)}return OpenLayers.Class(OpenLayers.Format,{read:function(a){var b=a;a=[];var c,t=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{i:{c=t;for(var u=void 0,t=void 0,v=c.length,u=0;u<v;u++){var t=c[u],w=j[t] instanceof RegExp?j[t].exec(b):(0,j[t])(b);if(w){c=w[0];b=b.substr(c.length).replace(/^\s*/,"");c={type:t,text:c,remainder:b};break i}}a="ERROR: In parsing: ["+b+"], expected one of: ";for(u=0;u<v;u++){t=c[u],a+="\n    "+t+": "+j[t]}throw Error(a)}b=c.remainder;t=l[c.type];if("END"!=c.type&&!t){throw Error("No follows list for "+c.type)}a.push(c)}while("END"!=c.type);a=i(a);this.keepData&&(this.data=a);return a},write:function(e){if(e instanceof OpenLayers.Geometry){return e.toString()}switch(e.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(e.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+e.property+","+e.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+e.property+", "+this.write(e.value)+", "+e.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+e.property+", "+this.write(e.value)+")";default:throw Error("Unknown spatial filter type: "+e.type)}case"OpenLayers.Filter.Logical":if(e.type==OpenLayers.Filter.Logical.NOT){return"NOT ("+this.write(e.filters[0])+")"}for(var f="(",g=!0,h=0;h<e.filters.length;h++){g?g=!1:f+=") "+p[e.type]+" (",f+=this.write(e.filters[h])}return f+")";case"OpenLayers.Filter.Comparison":return e.type==OpenLayers.Filter.Comparison.BETWEEN?e.property+" BETWEEN "+this.write(e.lowerBoundary)+" AND "+this.write(e.upperBoundary):null!==e.value?e.property+" "+n[e.type]+" "+this.write(e.value):e.property+" "+n[e.type];case void 0:if("string"===typeof e){return"'"+e.replace(/'/g,"''")+"'"}if("number"===typeof e){return String(e)}default:throw Error("Can't encode: "+e.CLASS_NAME+" "+e)}},CLASS_NAME:"OpenLayers.Format.CQL"})}();OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.options=b||{};this.options.source&&this.setSource(this.options.source)},setSource:function(b){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=b,this.activate()):this.source=b},activate:function(){var b=OpenLayers.Control.prototype.activate.call(this);if(b){if(!this.source){this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(c){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(c)})}},{layerOptions:this.sourceOptions})),this.handler.activate()}else{if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}}return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.call(this);b&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this});return b},onSketchComplete:function(b){this.feature=null;return !this.considerSplit(b.feature)},afterFeatureModified:function(b){b.modified&&"function"===typeof b.feature.geometry.split&&(this.feature=b.feature,this.considerSplit(b.feature))},removeByGeometry:function(e,f){for(var g=0,h=e.length;g<h;++g){if(e[g].geometry===f){e.splice(g,1);break}}},isEligible:function(b){return b.geometry?b.state!==OpenLayers.State.DELETE&&"function"===typeof b.geometry.split&&this.feature!==b&&(!this.targetFilter||this.targetFilter.evaluate(b.attributes)):!1},considerSplit:function(i){var j=!1,o=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(i.attributes)){for(var v=this.layer&&this.layer.features||[],w,x,y=[],z=[],A=this.layer===this.source&&this.mutual,B={edge:this.edge,tolerance:this.tolerance,mutual:A},C=[i.geometry],D,E,F,G=0,H=v.length;G<H;++G){if(D=v[G],this.isEligible(D)){E=[D.geometry];for(var I=0;I<C.length;++I){F=C[I];for(var J=0;J<E.length;++J){if(w=E[J],F.getBounds().intersectsBounds(w.getBounds())&&(w=F.split(w,B))){x=this.events.triggerEvent("beforesplit",{source:i,target:D}),!1!==x&&(A&&(x=w[0],1<x.length&&(x.unshift(I,1),Array.prototype.splice.apply(C,x),I+=x.length-3),w=w[1]),1<w.length&&(w.unshift(J,1),Array.prototype.splice.apply(E,w),J+=w.length-3))}}}E&&1<E.length&&(this.geomsToFeatures(D,E),this.events.triggerEvent("split",{original:D,features:E}),Array.prototype.push.apply(y,E),z.push(D),o=!0)}}C&&1<C.length&&(this.geomsToFeatures(i,C),this.events.triggerEvent("split",{original:i,features:C}),Array.prototype.push.apply(y,C),z.push(i),j=!0);if(j||o){if(this.deferDelete){v=[];G=0;for(H=z.length;G<H;++G){o=z[G],o.state===OpenLayers.State.INSERT?v.push(o):(o.state=OpenLayers.State.DELETE,this.layer.drawFeature(o))}this.layer.destroyFeatures(v,{silent:!0});G=0;for(H=y.length;G<H;++G){y[G].state=OpenLayers.State.INSERT}}else{this.layer.destroyFeatures(z,{silent:!0})}this.layer.addFeatures(y,{silent:!0});this.events.triggerEvent("aftersplit",{source:i,features:y})}}return j},geomsToFeatures:function(g,h){var i=g.clone();delete i.geometry;for(var j,k=0,l=h.length;k<l;++k){j=i.clone(),j.geometry=h[k],j.state=OpenLayers.State.INSERT,h[k]=j}},destroy:function(){this.active&&this.deactivate();OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(d){var e={url:!0,layer:!0,style:!0,matrixSet:!0},f;for(f in e){if(!(f in d)){throw Error("Missing property '"+f+"' in layer configuration.")}}d.params=OpenLayers.Util.upperCaseObject(d.params);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[d.name,d.url,d.params,d]);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds&&(d=this.matrixIds.length)&&"string"===typeof this.matrixIds[0]){for(e=this.matrixIds,this.matrixIds=Array(d),f=0;f<d;++f){this.matrixIds[f]={identifier:e[f]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){if(this.matrix=this.getMatrix()){this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent)}},moveTo:function(d,e,f){!e&&this.matrix||this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.WMTS(this.options));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var g;if(this.matrixIds&&0!==this.matrixIds.length){if("scaleDenominator" in this.matrixIds[0]){for(var h=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/0.00028,i=Number.POSITIVE_INFINITY,j,k=0,l=this.matrixIds.length;k<l;++k){j=Math.abs(1-this.matrixIds[k].scaleDenominator/h),j<i&&(i=j,g=this.matrixIds[k])}}else{g=this.matrixIds[this.getIdentifier()]}}else{g={identifier:this.getIdentifier()}}return g},getTileInfo:function(e){var f=this.getServerResolution(),g=(e.lon-this.tileOrigin.lon)/(f*this.tileSize.w);e=(this.tileOrigin.lat-e.lat)/(f*this.tileSize.h);var f=Math.floor(g),h=Math.floor(e);return{col:f,row:h,i:Math.floor((g-f)*this.tileSize.w),j:Math.floor((e-h)*this.tileSize.h)}},getURL:function(g){g=this.adjustBounds(g);var h="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(g)){g=g.getCenterLonLat();var i=this.getTileInfo(g);g=this.dimensions;var j,h=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,i.row,i.col].join(),this.url):this.url;if("REST"===this.requestEncoding.toUpperCase()){if(j=this.params,-1!==h.indexOf("{")){h=h.replace(/\{/g,"${");i={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:i.row,TileCol:i.col};if(g){var k,l;for(l=g.length-1;0<=l;--l){k=g[l],i[k]=j[k.toUpperCase()]}}h=OpenLayers.String.format(h,i)}else{k=this.version+"/"+this.layer+"/"+this.style+"/";if(g){for(l=0;l<g.length;l++){j[g[l]]&&(k=k+j[g[l]]+"/")}}k=k+this.matrixSet+"/"+this.matrix.identifier+"/"+i.row+"/"+i.col+"."+this.formatSuffix;h.match(/\/$/)||(h+="/");h+=k}}else{"KVP"===this.requestEncoding.toUpperCase()&&(j={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:i.row,TILECOL:i.col,FORMAT:this.format},h=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[j]))}}return h},mergeNewParams:function(b){if("KVP"===this.requestEncoding.toUpperCase()){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(b)])}},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(d){d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options||{});var e=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.format,f=OpenLayers.Format.XML.prototype.write.apply(f,[f.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);e.priv=OpenLayers.Request.POST({url:d.url,callback:this.createCallback(this.handleRead,e,d),data:f});return e},handleRead:function(d,e){if(e.callback){var f=d.priv;200<=f.status&&300>f.status?(d.features=this.parseFeatures(f),d.code=OpenLayers.Protocol.Response.SUCCESS):d.code=OpenLayers.Protocol.Response.FAILURE;e.callback.call(e.scope,d)}},parseFeatures:function(c){var d=c.responseXML;d&&d.documentElement||(d=c.responseText);return !d||0>=d.length?null:this.format.read(d)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(e,f,g,h){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(f){f=this.adjustBounds(f);var g=this.map.getResolution(),h=Math.round(10000*this.map.getScale())/10000,i=Math.round(f.left/g);f=-Math.round(f.top/g);var g=Math.floor(i/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,j=Math.floor(f/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,h=["/",this.params.map,"/",h,"/",this.params.g.replace(/\s/g,"_"),"/def/t",j,"/l",g,"/t",f,"l",i,".",this.extension],i=this.url;OpenLayers.Util.isArray(i)&&(i=this.selectUrl(h.join(""),i));return i+h.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(b){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(c,d){d.srs[this.getChildValue(c)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(c,d){d.vendorSpecific={tileSets:[]};this.readChildNodes(c,d.vendorSpecific)},TileSet:function(d,e){var f={srs:{},bbox:{},resolutions:[]};this.readChildNodes(d,f);e.tileSets.push(f)},Resolutions:function(f,g){for(var h=this.getChildValue(f).split(" "),i=0,j=h.length;i<j;i++){""!=h[i]&&g.resolutions.push(parseFloat(h[i]))}},Width:function(c,d){d.width=parseInt(this.getChildValue(c))},Height:function(c,d){d.height=parseInt(this.getChildValue(c))},Layers:function(c,d){d.layers=this.getChildValue(c)},Styles:function(c,d){d.styles=this.getChildValue(c)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();this.outsideViewport||this.minimizeControl();this.redraw();return this.div},onButtonClick:function(b){b=b.buttonElement;b===this.minimizeDiv?this.minimizeControl():b===this.maximizeDiv?this.maximizeControl():b._layerSwitcher===this.id&&(b["for"]&&(b=document.getElementById(b["for"])),b.disabled||("radio"==b.type?(b.checked=!0,this.map.setBaseLayer(this.map.getLayer(b._layer))):(b.checked=!b.checked,this.updateMap())))},clearLayersArray:function(b){this[b+"LayersDiv"].innerHTML="";this[b+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length){return !0}for(var e=0,f=this.layerStates.length;e<f;e++){var g=this.layerStates[e],h=this.map.layers[e];if(g.name!=h.name||g.inRange!=h.inRange||g.id!=h.id||g.visibility!=h.visibility){return !0}}return !1},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var i=!1,j=!1,m=this.map.layers.length;this.layerStates=Array(m);for(var n=0;n<m;n++){var o=this.map.layers[n];this.layerStates[n]={name:o.name,visibility:o.visibility,inRange:o.inRange,id:o.id}}var p=this.map.layers.slice();this.ascending||p.reverse();n=0;for(m=p.length;n<m;n++){var o=p[n],q=o.isBaseLayer;if(o.displayInLayerSwitcher){q?j=!0:i=!0;var r=q?o==this.map.baseLayer:o.getVisibility(),s=document.createElement("input"),t=OpenLayers.Util.createUniqueID(this.id+"_input_");s.id=t;s.name=q?this.id+"_baseLayers":o.name;s.type=q?"radio":"checkbox";s.value=o.name;s.checked=r;s.defaultChecked=r;s.className="olButton";s._layer=o.id;s._layerSwitcher=this.id;q||o.inRange||(s.disabled=!0);r=document.createElement("label");r["for"]=s.id;OpenLayers.Element.addClass(r,"labelSpan olButton");r._layer=o.id;r._layerSwitcher=this.id;q||o.inRange||(r.style.color="gray");r.innerHTML=o.name;r.style.verticalAlign=q?"bottom":"baseline";t=document.createElement("br");(q?this.baseLayers:this.dataLayers).push({layer:o,inputElem:s,labelSpan:r});o=q?this.baseLayersDiv:this.dataLayersDiv;o.appendChild(s);o.appendChild(r);o.appendChild(t)}}this.dataLbl.style.display=i?"":"none";this.baseLbl.style.display=j?"":"none";return this.div},updateMap:function(){for(var d=0,e=this.baseLayers.length;d<e;d++){var f=this.baseLayers[d];f.inputElem.checked&&this.map.setBaseLayer(f.layer,!1)}d=0;for(e=this.dataLayers.length;d<e;d++){f=this.dataLayers[d],f.layer.setVisibility(f.inputElem.checked)}},maximizeControl:function(b){this.div.style.width="";this.div.style.height="";this.showControls(!1);null!=b&&OpenLayers.Event.stop(b)},minimizeControl:function(b){this.div.style.width="0px";this.div.style.height="0px";this.showControls(!0);null!=b&&OpenLayers.Event.stop(b)},showControls:function(b){this.maximizeDiv.style.display=b?"":"none";this.minimizeDiv.style.display=b?"none":"";this.layersDiv.style.display=b?"none":""},loadContents:function(){this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";OpenLayers.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer");OpenLayers.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("Overlays");OpenLayers.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv");this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv));this.div.appendChild(this.layersDiv);var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,b,"absolute");OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");this.maximizeDiv.style.display="none";this.div.appendChild(this.maximizeDiv);b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,b,"absolute");OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");this.minimizeDiv.style.display="none";this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(b){"string"==typeof b&&(b=OpenLayers.Format.XML.prototype.read.apply(this,[b]));return this.parseFeatures(b)},write:function(e){var f;if(OpenLayers.Util.isArray(e)){f=this.createElementNSPlus("atom:feed");f.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var g=0,h=e.length;g<h;g++){f.appendChild(this.buildEntryNode(e[g]))}}else{f=this.buildEntryNode(e)}return OpenLayers.Format.XML.prototype.write.apply(this,[f])},buildContentNode:function(c){var d=this.createElementNSPlus("atom:content",{attributes:{type:c.type||null}});if(c.src){d.setAttribute("src",c.src)}else{if("text"==c.type||null==c.type){d.appendChild(this.createTextNode(c.value))}else{if("html"==c.type){if("string"!=typeof c.value){throw"HTML content must be in form of an escaped string"}d.appendChild(this.createTextNode(c.value))}else{"xhtml"==c.type?d.appendChild(c.value):"xhtml"==c.type||c.type.match(/(\+|\/)xml$/)?d.appendChild(c.value):d.appendChild(this.createTextNode(c.value))}}}return d},buildEntryNode:function(i){var j=i.attributes,k=j.atom||{},l=this.createElementNSPlus("atom:entry");if(k.authors){for(var m=OpenLayers.Util.isArray(k.authors)?k.authors:[k.authors],n=0,o=m.length;n<o;n++){l.appendChild(this.buildPersonConstructNode("author",m[n]))}}if(k.categories){for(var m=OpenLayers.Util.isArray(k.categories)?k.categories:[k.categories],p,n=0,o=m.length;n<o;n++){p=m[n],l.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:p.term,scheme:p.scheme||null,label:p.label||null}}))}}k.content&&l.appendChild(this.buildContentNode(k.content));if(k.contributors){for(m=OpenLayers.Util.isArray(k.contributors)?k.contributors:[k.contributors],n=0,o=m.length;n<o;n++){l.appendChild(this.buildPersonConstructNode("contributor",m[n]))}}i.fid&&l.appendChild(this.createElementNSPlus("atom:id",{value:i.fid}));if(k.links){for(m=OpenLayers.Util.isArray(k.links)?k.links:[k.links],n=0,o=m.length;n<o;n++){p=m[n],l.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:p.href,rel:p.rel||null,type:p.type||null,hreflang:p.hreflang||null,title:p.title||null,length:p.length||null}}))}}k.published&&l.appendChild(this.createElementNSPlus("atom:published",{value:k.published}));k.rights&&l.appendChild(this.createElementNSPlus("atom:rights",{value:k.rights}));(k.summary||j.description)&&l.appendChild(this.createElementNSPlus("atom:summary",{value:k.summary||j.description}));l.appendChild(this.createElementNSPlus("atom:title",{value:k.title||j.title||this.defaultEntryTitle}));k.updated&&l.appendChild(this.createElementNSPlus("atom:updated",{value:k.updated}));i.geometry&&(j=this.createElementNSPlus("georss:where"),j.appendChild(this.buildGeometryNode(i.geometry)),l.appendChild(j));return l},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(b){this.gmlParser||this.initGmlParser();return this.gmlParser.writeNode("feature:_geometry",b).firstChild},buildPersonConstructNode:function(g,h){var i=["uri","email"],j=this.createElementNSPlus("atom:"+g);j.appendChild(this.createElementNSPlus("atom:name",{value:h.name}));for(var k=0,l=i.length;k<l;k++){h[i[k]]&&j.appendChild(this.createElementNSPlus("atom:"+i[k],{value:h[i[k]]}))}return j},getFirstChildValue:function(e,f,g,h){return(e=this.getElementsByTagNameNS(e,f,g))&&0<e.length?this.getChildValue(e[0],h):h},parseFeature:function(i){var j={},n=null,o=null,p=null,q=this.namespaces.atom;this.parsePersonConstructs(i,"author",j);o=this.getElementsByTagNameNS(i,q,"category");0<o.length&&(j.categories=[]);for(var r=0,s=o.length;r<s;r++){n={};n.term=o[r].getAttribute("term");if(p=o[r].getAttribute("scheme")){n.scheme=p}if(p=o[r].getAttribute("label")){n.label=p}j.categories.push(n)}o=this.getElementsByTagNameNS(i,q,"content");if(0<o.length){n={};if(p=o[0].getAttribute("type")){n.type=p}(p=o[0].getAttribute("src"))?n.src=p:("text"==n.type||"html"==n.type||null==n.type?n.value=this.getFirstChildValue(i,q,"content",null):"xhtml"==n.type||n.type.match(/(\+|\/)xml$/)?n.value=this.getChildEl(o[0]):n.value=this.getFirstChildValue(i,q,"content",null),j.content=n)}this.parsePersonConstructs(i,"contributor",j);j.id=this.getFirstChildValue(i,q,"id",null);o=this.getElementsByTagNameNS(i,q,"link");0<o.length&&(j.links=Array(o.length));for(var t=["rel","type","hreflang","title","length"],r=0,s=o.length;r<s;r++){n={};n.href=o[r].getAttribute("href");for(var u=0,v=t.length;u<v;u++){(p=o[r].getAttribute(t[u]))&&(n[t[u]]=p)}j.links[r]=n}if(n=this.getFirstChildValue(i,q,"published",null)){j.published=n}if(n=this.getFirstChildValue(i,q,"rights",null)){j.rights=n}if(n=this.getFirstChildValue(i,q,"summary",null)){j.summary=n}j.title=this.getFirstChildValue(i,q,"title",null);j.updated=this.getFirstChildValue(i,q,"updated",null);n={title:j.title,description:j.summary,atom:j};i=this.parseLocations(i)[0];i=new OpenLayers.Feature.Vector(i,n);i.fid=j.id;return i},parseFeatures:function(e){var f=[],g=this.getElementsByTagNameNS(e,this.namespaces.atom,"entry");0==g.length&&(g=[e]);e=0;for(var h=g.length;e<h;e++){f.push(this.parseFeature(g[e]))}return f},parseLocations:function(i){var j=this.namespaces.georss,n={components:[]},o=this.getElementsByTagNameNS(i,j,"where");if(o&&0<o.length){this.gmlParser||this.initGmlParser();for(var p=0,q=o.length;p<q;p++){this.gmlParser.readChildNodes(o[p],n)}}n=n.components;if((o=this.getElementsByTagNameNS(i,j,"point"))&&0<o.length){for(p=0,q=o.length;p<q;p++){var r=OpenLayers.String.trim(o[p].firstChild.nodeValue).split(/\s+/);2!=r.length&&(r=OpenLayers.String.trim(o[p].firstChild.nodeValue).split(/\s*,\s*/));n.push(new OpenLayers.Geometry.Point(r[1],r[0]))}}var s=this.getElementsByTagNameNS(i,j,"line");if(s&&0<s.length){for(var t,p=0,q=s.length;p<q;p++){o=OpenLayers.String.trim(s[p].firstChild.nodeValue).split(/\s+/);t=[];for(var u=0,v=o.length;u<v;u+=2){r=new OpenLayers.Geometry.Point(o[u+1],o[u]),t.push(r)}n.push(new OpenLayers.Geometry.LineString(t))}}if((i=this.getElementsByTagNameNS(i,j,"polygon"))&&0<i.length){for(p=0,q=i.length;p<q;p++){o=OpenLayers.String.trim(i[p].firstChild.nodeValue).split(/\s+/);t=[];u=0;for(v=o.length;u<v;u+=2){r=new OpenLayers.Geometry.Point(o[u+1],o[u]),t.push(r)}n.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(t)]))}}if(this.internalProjection&&this.externalProjection){for(p=0,q=n.length;p<q;p++){n[p]&&n[p].transform(this.externalProjection,this.internalProjection)}}return n},parsePersonConstructs:function(i,j,o){var p=[],q=this.namespaces.atom;i=this.getElementsByTagNameNS(i,q,j);for(var r=["uri","email"],s=0,t=i.length;s<t;s++){var u={};u.name=this.getFirstChildValue(i[s],q,"name",null);for(var v=0,w=r.length;v<w;v++){var x=this.getFirstChildValue(i[s],q,r[v],null);x&&(u[r[v]]=x)}p.push(u)}0<p.length&&(o[j+"s"]=p)},CLASS_NAME:"OpenLayers.Format.Atom"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:this.observeElement||document})},defaultKeyPress:function(d){var e,f=!0;e=OpenLayers.Event.element(d);if(!e||"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName&&"SELECT"!=e.tagName){switch(d.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:e=this.map.getSize();this.map.pan(0,-0.75*e.h);break;case 34:e=this.map.getSize();this.map.pan(0,0.75*e.h);break;case 35:e=this.map.getSize();this.map.pan(0.75*e.w,0);break;case 36:e=this.map.getSize();this.map.pan(-0.75*e.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:f=!1}f&&OpenLayers.Event.stop(d)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;b=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(b,this.yx)},read:function(c){"string"==typeof c&&(c=OpenLayers.Format.XML.prototype.read.apply(this,[c]));c&&9==c.nodeType&&(c=c.documentElement);var d={};this.readNode(c,d);d.version=this.version;return d},readers:{wmts:{Capabilities:function(c,d){this.readChildNodes(c,d)},Contents:function(c,d){d.contents={};d.contents.layers=[];d.contents.tileMatrixSets={};this.readChildNodes(c,d.contents)},Layer:function(d,e){var f={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]};this.readChildNodes(d,f);e.layers.push(f)},Style:function(d,e){var f={};f.isDefault="true"===d.getAttribute("isDefault");this.readChildNodes(d,f);e.styles.push(f)},Format:function(c,d){d.formats.push(this.getChildValue(c))},TileMatrixSetLink:function(d,e){var f={};this.readChildNodes(d,f);e.tileMatrixSetLinks.push(f)},TileMatrixSet:function(d,e){if(e.layers){var f={matrixIds:[]};this.readChildNodes(d,f);e.tileMatrixSets[f.identifier]=f}else{e.tileMatrixSet=this.getChildValue(d)}},TileMatrix:function(d,e){var f={supportedCRS:e.supportedCRS};this.readChildNodes(d,f);e.matrixIds.push(f)},ScaleDenominator:function(c,d){d.scaleDenominator=parseFloat(this.getChildValue(c))},TopLeftCorner:function(e,f){var g=this.getChildValue(e).split(" "),h;f.supportedCRS&&(h=f.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2"),h=!!this.yx[h]);f.topLeftCorner=h?new OpenLayers.LonLat(g[1],g[0]):new OpenLayers.LonLat(g[0],g[1])},TileWidth:function(c,d){d.tileWidth=parseInt(this.getChildValue(c))},TileHeight:function(c,d){d.tileHeight=parseInt(this.getChildValue(c))},MatrixWidth:function(c,d){d.matrixWidth=parseInt(this.getChildValue(c))},MatrixHeight:function(c,d){d.matrixHeight=parseInt(this.getChildValue(c))},ResourceURL:function(d,e){e.resourceUrl=e.resourceUrl||{};var f=d.getAttribute("resourceType");e.resourceUrls||(e.resourceUrls=[]);f=e.resourceUrl[f]={format:d.getAttribute("format"),template:d.getAttribute("template"),resourceType:f};e.resourceUrls.push(f)},WSDL:function(c,d){d.wsdl={};d.wsdl.href=c.getAttribute("xlink:href")},ServiceMetadataURL:function(c,d){d.serviceMetadataUrl={};d.serviceMetadataUrl.href=c.getAttribute("xlink:href")},LegendURL:function(c,d){d.legend={};d.legend.href=c.getAttribute("xlink:href");d.legend.format=c.getAttribute("format")},Dimension:function(d,e){var f={values:[]};this.readChildNodes(d,f);e.dimensions.push(f)},Default:function(c,d){d["default"]=this.getChildValue(c)},Value:function(c,d){d.values.push(this.getChildValue(c))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});var englishTextStrings={dealsSection:"Deals",noRestaurants:"There are no restaurants",hPhone:"Tel. ",hDeliveryAreaButton:"Check if you're in our delivery area",hChangeStoreButton:"Select a different store",hOrderNowButton:"Order now",hHomeButon:"Home",hReturnToParentWebsiteButton:"Return home",hTwitter:"@pizzalille",hFacebook:"/speedrabbitpizzadouai",hSiteSelectorPostcodeExample:"e.g N5 2AB",hShowAllRestaurants:"Show all restaurants",mmOptions:"OPTIONS",mMenuSections:"Menu Sections",sMyOrder:"My order",sDeliverToDoor:"Deliver to door",sCollectFromStore:"Collect from store",sModifyOrder:"Modify Order",sReturnToCheckout:"Return to checkout",sOffline:"This store is not currently taking online orders.  Please check back later or order directly from the store.",sEmpty1:"There are no items in your order",sEmpty2:'Use the "Add to order" buttons to add items to your order',sItemCount1:"There are ",sItemCount2:" item/s in your order",sOrderTotal:"Order Total",sInvalid:"One or more item in your order is not valid and will be automatically removed on checkout",sClear:"Clear",sCheckout:"Checkout",sBackToMenu:"Back to Menu",sRemove:"Click an item to modify or remove it",sMinimumDelivOrder:"Minimum delivery order ",ivClose:"Click/tap on the image to hide it",miQuantity:"Quantity",miAdd:"Add to order",dAdd:"Add to order",dCollectOnly:"Collect from store only",dDeliverOnly:"Deliver to door only",dNotToday:"This deal is not available today",dMinSpend:"Minimum spend ",pwOneMomentPlease:"One moment please",ssStoreSelector:"The following restaurants deliver to your postcode",ssShowMeAllTheRestaurants:"Show me all the restaurants",ssCollect:"You can also collect from the following restaurants",slChooseRestaurant:"Please choose your local restaurant",sselStoreSelector:"Store selector",homeDeliveryTimes:"We deliver at the following times",homeMonday:"Monday:",homeTuesday:"Tuesday:",homeWednesday:"Wednesday:",homeThursday:"Thursday:",homeFriday:"Friday:",homeSaturday:"Saturday:",homeSunday:"Sunday:",ciCollectOnly:"Collect from store only",ciDeliverOnly:"Deliver to door only",dciCollectOnly:"Collect from store only",dciDeliverOnly:"Deliver to door only",cdMinSpend:"Not eligible for deal.  Minimum spend ",cddMinSpend:"Not eligible for deal.  Minimum spend ",tpAdd:"Add to order",tpOk:"OK",tpRemove:"Remove from order",tpCancel:"Cancel",tpCancelDeal:"Cancel",tpAddedCharges:"Additional charges",tpItemPrice:"Item price",tpQuantity:"Quantity",tpItemType:"Item type",tpCustomize:"Customize your item",tpTickPrompt:"Highlighted options are included free with this item.  Untick the options if you want to remove them.",tpFreeItems1:"You have ",tpFreeItems2:"free option/s remaining",tpSingle:"single",tpDouble:"double",tpCommentsForChef:"Comments for the Chef",tpExtraBits:"Let us know if there are any special cooking requirements for this item:",tpForPeson:"Who's this item for?",tpPerson:"If you're ordering for multiple people let us know who this item is for:",dpPrompt:"Please choose your deal items",dpMissing:"Missing information!  Please select items highlighted in red.",pdlItem:"Item ",pdlCustomize:"Customize",pdlCustomizeFree:"Press customize to choose your free options",pdlpCustomize:"Customize",dptOk:"Ok",dptRemove:"Remove from order",dptAdd:"Add to order",dptCancel:"Cancel",pdtItem:"Item ",checkCheckout:"Checkout",checkWhoAreYou:"Who are you?",checkFirstName:"First name: ",checkSurname:"Surname / family name: ",checkTel:"Telephone number: ",checkEmail:"Email address: ",checkMarketing:"Let me know about new products and special offers",checkRememberContact:"Remember my contact details for next time",checkMissing:"Missing information!  Please enter details in the boxes highlighted in red.",checkCollectTime:"When do you want to collect your order?",checkDeliverTime:"When do you want your order delivered?",checkSlotWarning:"Please note that your delivery may be moved into the next delivery slot if you take longer than 15 minutes to complete your order.",checkMissing:"Missing information!  Please enter details in the boxes highlighted in red.",checkDeliveryAddress:"Where do you want your order delivered to?",checkRememberAddress:"Remember this address for next time",checkExtraInfo:"Is there anything you need to tell us about this order?",checkDirections:"Directions: ",checkDirectionsEx:"E.g. Turn left at the newsagents",checkDelivNotes:"Delivery notes:",checkDelivNotesEx:"E.g. baby sleeping don't use doorbell",checkChefNotes:"Chef notes: ",checkChefNotesEx:"E.g. make everything spicy please",checkRequired:"* Required",checkMissingInfoError:"Missing information!  Please enter details in the boxes highlighted in red.",checkRequired:"* Required",checkBadPostcode:"Sorry, this store doesn't deliver to your postcode.",org1_FR:"Activit",org1_eg_FR:"E.g. Service des ventes",org2_FR:"Socit",org2_eg_FR:"E.g. Andromeda Trading Ltd.",prem1_FR:"Appartement",prem1_eg_FR:"E.g. 34",prem2_FR:"Btiment",prem2_eg_FR:"E.g. C",prem3_FR:"Rsidence",prem3_eg_FR:"E.g. Le Grand Chne",roadNumber_FR:"Numro de rue",roadNumber_eg_FR:"E.g. 4",roadName_FR:"Nom de rue",roadName_eg_FR:"E.g. Rue Salvador Allende",userLocality1_FR:"Etage",userLocality1_eg_FR:"E.g. 1",userLocality2_FR:"Digiphone",userLocality2_eg_FR:"E.g. 555",userLocality3_FR:"Interphone",userLocality3_eg_FR:"E.g. 23",town_FR:"Ville",town_eg_FR:"E.g. Paris",zipCode_FR:"Code postal",zipCode_eg_FR:"E.g. 92100",tncTitle:"Terms and conditions",tncNoTNC:"There are currently no terms and conditions",payTitle:"Payment",payPrompt:"When would you like to pay for this order?",payAtDoor:"Pay at door",payOnCollection:"Pay on collection",payNow:"Pay now",payTNC1:"I have read and agree to the ",payTNC2:"terms and conditions",payTNCWarn:"You must agree to the terms and conditions before proceeding",mercanetTitle:"Payment",mercanetIntro:"Please select a payment type and you will be re-directed to the payment providers' web site.  Please note that you will no longer be able to modify your order after you have been re-directed.",mercanetiFrameWarn:"Your browser does not support iFrames. To view this content, please download and use the latest version of one of the following browsers: Internet Explorer, Firefox, Google Chrome or Safari.",pmmOptions:"OPTIONS",pmmHome:"HOME",pmmOrderNow:"ORDER NOW",pmmMyOrder:"MY ORDER",pmmPostcode:"POSTCODE CHECK",mmHome:"HOME",mmOrderNow:"ORDER NOW",mmMyOrder:"MY ORDER",mmPostcodeCheck:"POSTCODE CHECK",pmmReturnToParentWebsite:"RETURN HOME",footPoweredBy1:"Powered by ",footPoweredBy2:"Andromeda POS",sovOneMoment:"One moment please",oavOrderAcepted:"Your order has been accepted by the store",oavThanks:"Thanks for your order!",oavReturnToMenu:"Return to the menu",wfopConnecting:"Please wait.  Connecting to server...",wfopPleaseWait:"Please wait.  Sending you order to the store...",wfopOrderAccepted:"Your order has been accepted by the store",wfopACSFailed:"Sorry, there was a problem sending your order to the store.  Please contact the store to check that they have received it.  Error code ",wfopServerFailed:"Sorry, there was a problem sending your order to the store.  Please contact the store to check that they have received it.",wfopConnectionLost:"Connection to server lost.  Trying to reconnect...",wfopConnectionLostWaiting:"Connection to server lost.  Waiting to reconnect...",pleaseSelectAnItem:"-- Please select an item --",gettingStoreDetails:"Getting store details",problemGettingSiteDetails:"There was a problem getting the site details",loadingMenu:"Loading menu",downloadingStoreMenu:"Downloading store menu",savingMenuToDevice:"Saving menu to your device",renderingMenu:"Rendering menu",prefixAddTopping:"Add ",prefixAddDoubleTopping:"Add double ",prefixRemove:"Remove ",defaultWebErrorMessage:"Sorry, there was a technical glitch!  If the problem persists please contact the store directly to place your order and let them know there is a problem with the website",defaultInternalErrorMessage:"Sorry, there was a technical glitch!  If the problem persists please contact the store directly to place your order and let them know there is a problem with the website. (internal)",defaultPaymentErrorMessage:"Sorry, there was a payment problem!  If the problem persists please contact the store directly to place your order and let them know there is a problem with the website",commsProblem:"Sorry, there was a communications problem!  If the problem persists please contact the store directly to place your order and let them know there is a problem with the website. (comms error)",whoAreYou:"Who are you?",collectionTime:"Collection time",deliveryTime:"Delivery time",deliveryAddress:"Delivery address",orderNotes:"Order notes",placeOrder:"Place order",next:"Next",back:"Back",pleaseSelectATime:"--- Please select a time ---",asSoonAsPossibleNoETD:"As soon as possible (30-40 mins)",asSoonAsPossible:"As soon as possible",preparingForPayment:"Preparing for payment",sendingOrderToStore:"Sending your order to the store",problemInitialisingPayment:"There was a problem initialising the payment",appendErrorCode:". Error code ",appendUnknownErrorCode:". Error code unknown",orderRejected:"Sorry, the store automatically rejected your order due to a technical problem.  If the problem persists please contact the store directly to place your order and let them know there is a problem with the website.  Error code ",cantDeliverOrder:"Sorry, there may have been a problem sending your order to the store.  Please contact the store to check that they have received it.  Error code ",apiProblem:"Sorry, there was a problem sending your order to the store.  Please try again.  If the problem persists please contact the store directly to place your order and let them know there is a problem with the website.  Error code ",cardProcessingError:"Sorry, there was a payment problem!  The card payment provider returned the following message {ErrorMessage}.  If the problem persists please contact the store directly to place your order.",appendOffline:" - Sorry, not taking online orders right now",openAllDay:"Open all day",closed:"Closed",fromTo:"{from} to {to}",minimumOrderValue:"Deal not allowed - order price must be at least {price}",premiumChargeFor:"Premium charge for {item}",prem1Prefix:"",prem2Prefix:"",prem3Prefix:"",userLocality1Prefix:"",userLocality2Prefix:"",userLocality3Prefix:""};var frenchTextStrings={dealsSection:"Promos",noRestaurants:"Il n'y a pas de restaurants",hPhone:"Tel. ",hDeliveryAreaButton:"Vrifiez si vous tes dans notre zone de livraison",hChangeStoreButton:"Slectionnez un autre restaurant",hOrderNowButton:"Commandez",hHomeButon:"Acceuil",hReturnToParentWebsiteButton:"Retourner  l'accueil",hTwitter:"@pizzalille",hFacebook:"/speedrabbitpizzadouai",hSiteSelectorPostcodeExample:"ex. 75016",hShowAllRestaurants:"Montrer tous les restaurants",mmOptions:"OPTIONS",mMenuSections:"Sections du menu",sMyOrder:"Mon Panier",sDeliverToDoor:"Me faire livrer",sCollectFromStore:"Aller chercher en boutique",sModifyOrder:"Modifier commande",sReturnToCheckout:"Retour au paiement",sOffline:"Ce restaurant n'accepte pas les commandes en lignes actuellement. Veuillez verifier ulterieurement ou commander directement en boutique.",sEmpty1:"Pas de produits dans votre commande",sEmpty2:"Utiliser les touches ajouter  la commande pour ajouter les produits  votre commande",sItemCount1:"Il y a ",sItemCount2:" article/s dans votre commande",sOrderTotal:"Total commande",sInvalid:"Un ou plusieurs articles dans votre commande n'est pas valuable et sera automatiquement enlev de la commande lors de la validation",sClear:"Effacer",sCheckout:"Validation",sBackToMenu:"Retour au menu",sRemove:"Cliquez sur un produit pour le modifier ou enlever",sMinimumDelivOrder:"Minimum de commande ",ivClose:"Cliquez sur l'image pour la cacher",miQuantity:"Quantit",miAdd:"Ajouter  la commande",dAdd:"Ajouter  la commande",dCollectOnly:"Seulement venir chercher en boutique",dDeliverOnly:"Seulement me faire livrer",dNotToday:"Cette promo n'est pas disponible aujourd'hui",dMinSpend:"Minimum commande ",pwOneMomentPlease:"Un instant svp",ssStoreSelector:"Les restaurants suivants livrent dans votre code postal",ssShowMeAllTheRestaurants:"Montrer tous les restaurants",ssCollect:"Vous pouvez aussi chercher votre commande dans les boutiques suivantes",slChooseRestaurant:"Veuillez choisir votre restaurant",sselStoreSelector:"Choisir restaurant",homeDeliveryTimes:"Nous livrons entre les horaires suivants",homeMonday:"Lundi",homeTuesday:"Mardi",homeWednesday:"Mercredi",homeThursday:"Jeudi",homeFriday:"Vendredi",homeSaturday:"Samedi",homeSunday:"Dimanche",ciCollectOnly:"Seulement venir chercher en boutique",ciDeliverOnly:"Seulement me faire livrer",dciCollectOnly:"Seulement venir chercher en boutique",dciDeliverOnly:"Deliver to door only",cdMinSpend:"Pas ligible pour la promo. Minimum commande ",cddMinSpend:"Pas ligible pour la promo. Minimum commande ",tpAdd:"Ajouter  la commande",tpOk:"OK",tpRemove:"Enlever de la commande",tpCancel:"Annuler",tpCancelDeal:"Annuler",tpAddedCharges:"Frais additionnels",tpItemPrice:"Prix produit",tpQuantity:"Quantit",tpItemType:"Type de produit",tpCustomize:"Personnalisez votre produit",tpTickPrompt:"Les options soulignes sont incluses gratis avec ce produit. Dcochez les options si vous voulez les enlever",tpFreeItems1:"Vous avez ",tpFreeItems2:"option/s gratuites restantes",tpSingle:"simple",tpDouble:"double",tpCommentsForChef:"Commentaires pour le chef",tpExtraBits:"Veuillez nous informer si vous auriez des remarques pour cuisson de ce produit:",tpForPeson:"Pour qui est ce produit?",tpPerson:"Si vous commandez pour plusieurs personnes, veuillez nous indiquer pour qui est ce produit:",dpPrompt:"Slectionnez les produits de votre promo",dpMissing:"Informations manquantes! Veuillez slectionner les produits souligns en rouge.",pdlItem:"Produit ",pdlCustomize:"Personnaliser",pdlCustomizeFree:"Appuyez personnaliser pour slectionner vos options gratuites",pdlpCustomize:"Personnaliser",dptOk:"Ok",dptRemove:"Enlever de la commande",dptAdd:"Ajouter  la commande",dptCancel:"Annuler",pdtItem:"Produit",checkCheckout:"Validation",checkWhoAreYou:"Qui tes-vous?",checkFirstName:"Prnom: ",checkSurname:"Nom de famille: ",checkTel:"Numro tlphone: ",checkEmail:"Adresse email: ",checkMarketing:"M'informer au sujet de nouveaux produits et offres spciales",checkRememberContact:"Sauvegarder mes coordonnes pour la prochaine fois",checkMissing:"Informations manquantes! Veuillez remplir les champs souligns en rouge.",checkCollectTime:"Quand voulez-vous venir chercher votre commande?",checkDeliverTime:"Quand voulez-vous vous faire livrer votre commande?",checkSlotWarning:"Veuillez noter que votre commande peut tre dplace vers un nouveau crneau horaire si vous dpassez 15 minutes pour la saisir.",checkMissing:"Informations manquantes! Veuillez remplir les champs souligns en rouge.",checkMissingInfoError:"Informations manquantes! Veuillez remplir les cases soulignes en rouge.",checkRequired:"* Obligatoire",checkBadPostcode:"sol, cette boutique ne livre pas  votre adresse.",org1_FR:"Activit",org1_eg_FR:"Ex Service des ventes",org2_FR:"Socit",org2_eg_FR:"Ex Andromeda Trading Ltd.",prem1_FR:"Appartement",prem1_eg_FR:"Ex 34",prem2_FR:"Btiment",prem2_eg_FR:"Ex C",prem3_FR:"Rsidence",prem3_eg_FR:"Ex Le Grand Chne",roadNumber_FR:"Numro de rue",roadNumber_eg_FR:"Ex 4",roadName_FR:"Nom de rue",roadName_eg_FR:"Ex Rue Salvador Allende",userLocality1_FR:"Etage",userLocality1_eg_FR:"Ex 1",userLocality2_FR:"Digiphone",userLocality2_eg_FR:"Ex 555",userLocality3_FR:"Interphone",userLocality3_eg_FR:"Ex 23",town_FR:"Ville",town_eg_FR:"Ex Paris",zipCode_FR:"Code postal",zipCode_eg_FR:"Ex 92100",checkDeliveryAddress:"O voulez-vous que votre commande soit livre?",checkRememberAddress:"Sauvegarder cette adresse pour la prochaine fois",checkExtraInfo:"Avez vous des remarques additionnelles pour cette commande?",checkDirections:"Indications pour livreur: ",checkDirectionsEx:"Ex. tourner  gauche prs du kiosque  journaux",checkDelivNotes:"Notes pour livraison: ",checkDelivNotesEx:"Ex. bb dort, ne pas sonner",checkChefNotes:"Notes pour chef: ",checkChefNotesEx:"Ex. bien pimenter svp",checkRequired:"* Requis",tncTitle:"Termes et conditions",tncNoTNC:"Pas de termes et conditions actuellement",payTitle:"Paiement",payPrompt:"Quand voudriez-vous payer pour cette commande?",payAtDoor:"Payer au livreur",payOnCollection:"Payer en boutique",payNow:"Payer maintenant",payTNC1:"Lu et approuv ",payTNC2:"Termes et conditions",payTNCWarn:"Vous devez approuver les termes et conditions avant de procder",mercanetTitle:"Paiement",mercanetIntro:"Veuillez slectionner un type de paiement et vous serez redirigs au sites marchands. Veuillez noter quil ne vous sera plus possible de modifier votre commande aprs tre redirigs.",mercanetiFrameWarn:"Votre browser ne supporte pas iFrames. Pour voir ce contenu veuillez svp tlcharger et utiliser la dernire version dun des browsers suivants : Explorer, Firefox, Google Chrome ou Safari.",pmmOptions:"OPTIONS",pmmHome:"ACCEUIL",pmmOrderNow:"COMMANDER MAINTENANT",pmmMyOrder:"MA COMMANDE",pmmPostcode:"VERIFICATION CODE POSTAL",pmmReturnToParentWebsite:"RETOURNET  L'ACCUEIL",mmHome:"ACCEUIL",mmOrderNow:"COMMANDER MAINTENANT",mmMyOrder:"MA COMMANDE",mmPostcodeCheck:"VERIFICATION CODE POSTAL",footPoweredBy1:"Propuls par ",footPoweredBy2:"Andromeda POS",sovOneMoment:"Un moment svp",oavOrderAcepted:"Votre commande a t accepte au restaurant",oavThanks:"Nous vous remercions pour votre commande!",oavReturnToMenu:"Retour au menu",wfopConnecting:"Veuillez patienter.  Connexion au serveur...",wfopPleaseWait:"Veuillez patienter.  Commande envoye au restaurant...",wfopOrderAccepted:"Votre commande a t accepte au restaurant",wfopACSFailed:"Dsol, il y a eu un problme avec votre commande.  Veuillez svp appeler le restaurant et vrifier si elle a t reue.  Code Erreur ",wfopServerFailed:"Dsol, il y a eu un problme avec votre commande.  Veuillez svp appeler le restaurant et vrifier si elle a t reue.",wfopConnectionLost:"Connexion au serveur perdue.  Essai de rconnexion...",wfopConnectionLostWaiting:"Connexion au serveur perdue.  En attentei de rconnexion...",pleaseSelectAnItem:"--Veuillez slectionner un produit -",gettingStoreDetails:"Obtenir coordonnes boutique",problemGettingSiteDetails:"Il y a eu un problme pour obtenir les coordonnes boutique",loadingMenu:"Tlchargement du menu",downloadingStoreMenu:"Tlchargement du menu du restaurant",savingMenuToDevice:"Sauvegarde du menu sur votre terminal",renderingMenu:"Traduction menu",prefixAddTopping:"Ajouter ",prefixAddDoubleTopping:"Ajouter double ",prefixRemove:"Enlever ",defaultWebErrorMessage:"Dsol, il y a un problme technique. S'il persiste veuillez svp contacter directement le restaurant pour commander et prvenir au sujet du problme en ligne",defaultInternalErrorMessage:"Dsol, il y a un problme technique. S'il persiste veuillez svp contacter directement le restaurant pour commander et prvenir au sujet du problme en ligne. (interne)",defaultPaymentErrorMessage:"Dsol, il y a un problme avec le paiement. S'il persiste veuillez svp contacter directement le restaurant pour commander et prvenir au sujet du problme en ligne",commsProblem:"Dsol, il y a un problme de communication. S'il persiste veuillez svp contacter directement le restaurant pour commander et prvenir au sujet du problme en ligne (erreur comm.)",whoAreYou:"Qui tes-vous?",collectionTime:"Heure de rcupration",deliveryTime:"Heure de livraison",deliveryAddress:"Adresse de livraison",orderNotes:"Notes commandes",placeOrder:"Commander",next:"Suivant",back:"Retour",pleaseSelectATime:"--- Veuillez slectionner une heure ---",asSoonAsPossibleNoETD:"Au plus vite (30-40 min)",asSoonAsPossible:"Au plus vite",preparingForPayment:"Prparation paiement",sendingOrderToStore:"Envoi de commande au restaurant",problemInitialisingPayment:"Il y a eu un problme avec l'initialisation du paiement",appendErrorCode:". Code erreur ",appendUnknownErrorCode:". Code erreur inconnu",orderRejected:"Dsol, il y a un problme  votre commande a t automatiquement rejete. Si le problme persiste veuillez svp contacter directement le restaurant pour commander et prvenir au sujet du problme en ligne. Code erreur ",cantDeliverOrder:"Dsol, il y a un problme avec envoi de votre commande. Si le problme persiste veuillez svp contacter directement le restaurant pour commander et prvenir au sujet du problme en ligne. Code erreur ",apiProblem:"Dsol, il y a un problme avec envoi de votre commande. Ressayez svp et si le problme persiste veuillez svp contacter directement le restaurant pour commander et prvenir au sujet du problme en ligne. Code erreur ",cardProcessingError:"Dsol, il y a un problme avec le paiement. Le site marchand a envoy le message suivant {ErrorMessage}. Si le problme persiste veuillez svp contacter directement le restaurant pour commander et prvenir au sujet du problme en ligne. Code erreur ",appendOffline:"  Desol, pas de commandes en ligne en ce moment",openAllDay:"Ouvert toute lq journe",closed:"Ferm",fromTo:"{from}  {to}",minimumOrderValue:"Promo  non permise  la valeur de la commande doit tre au moins {price}",premiumChargeFor:"Supplement pour {item}",prem1Prefix:"Appt. ",prem2Prefix:"Bat. ",prem3Prefix:"Rs. ",userLocality1Prefix:"Etg. ",userLocality2Prefix:"Digi. ",userLocality3Prefix:"Iphone. "};settings={alwaysOnline:false,showMenuIds:false,logoClickUrl:"#",customerAddressCountryCode:"UK",culture:"en-GB",mapMarker:"",defaultETD:15,minimumDeliveryOrder:1000,storeSelectorMode:false,useAddThis:false,twitter:"",facebook:"",mobileWidth:600,tabletWidth:1024,isHomePageDisabled:false,showDeliveryCheckButton:true,showSelectStoresButton:true,showOrderNowButton:true,showReturnToParentWebsite:false,returnToParentWebsiteAfterOrder:false,parentWebsite:undefined,requireCustomerDetailsPassthrough:false,hidePassthroughQueryString:true,facebookAppId:0,facebookAppChannel:"",customerAccountsEnabled:true,displayCustomerDetailsPage:true,lockCustomerDetailsPage:false,displayCustomerAddressPage:true,lockCustomerAddressPage:false,termsAndConditionsEnabled:true,invertItems:false,menuItemOverlayTag:undefined};var acsapi={getSiteList:function(a,b){var c=$.ajax(viewModel.serverUrl+"/SiteList?deliveryZone="+(b==undefined?"":b)+"&key=x").done(function(d,g,f){try{if(d==null||g!="success"){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.chooseStore,e)}else{viewModel.sites(d);a()}}catch(e){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.chooseStore,e)}}).fail(function(e,f,d){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.chooseStore,d)})},getSite:function(d,b,a){viewModel.sitesMode("pleaseWait");var c=$.ajax({url:viewModel.serverUrl+"/sites/"+d+"?key=x&gotMenuVersion="+b,xhr:function(){var e=new window.XMLHttpRequest();e.addEventListener("progress",function(f){try{if(f.lengthComputable){var h=(f.loaded/f.total)*100;var i=parseInt(h)+"%";viewModel.pleaseWaitProgress(i);setTimeout(function(){},0)}}catch(g){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,g)}},false);return e}}).always(function(e,h,g){try{if(h==="error"){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)}else{a(e)}}catch(f){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,f)}}).fail(function(){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)})},getSiteDetails:function(c,a){var b=$.ajax(viewModel.serverUrl+"/SiteDetails/"+c+"?key=x").done(function(d,g,f){try{if(d==null||g!="success"){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)}else{viewModel.siteDetails(d);a()}}catch(e){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,e)}}).fail(function(e,f,d){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,d)})},getMenu:function(c,a){viewModel.sitesMode("pleaseWait");var b=$.ajax({url:viewModel.serverUrl+"/menu/"+c+"?key=x",xhr:function(){var d=new window.XMLHttpRequest();d.addEventListener("progress",function(e){try{if(e.lengthComputable){var g=(e.loaded/e.total)*100;var h=parseInt(g)+"%";viewModel.pleaseWaitProgress(h);setTimeout(function(){},0)}}catch(f){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,f)}},false);return d}}).always(function(d,g,f){try{if(g==="error"){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)}else{a(d)}}catch(e){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,e)}}).fail(function(){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)})},putMercuryPayment:function(c,a){var b=$.ajax({url:viewModel.serverUrl+"/MercuryPayment/"+c+"?key=x",type:"PUT",contentType:"application/json",data:'{ "amount": "'+cartHelper.cart().totalPrice()+'", "returnUrl": "'+window.location.href+'/Done.html"}'}).done(function(d,g,f){try{if(d==null||g!="success"){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,e)}else{cartHelper.cart().mercuryPaymentId(d.paymentId);a()}}catch(e){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,e)}}).fail(function(e,f,d){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,d)})},putDataCashPayment:function(c,a){var b=$.ajax({url:viewModel.serverUrl+"/DataCashPayment/"+c+"?key=x",type:"PUT",contentType:"application/json",data:'{ "amount": "'+cartHelper.cart().totalPrice()+'", "returnUrl": "'+window.location.href+'/Done.html"}'}).done(function(d,g,f){try{if(d==null||g!="success"){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,e)}else{cartHelper.cart().dataCashPaymentDetails(d);a()}}catch(e){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,e)}}).fail(function(e,f,d){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,d)})},putMercanetPayment:function(d,c,a){var b=$.ajax({url:viewModel.serverUrl+"/MercanetPayment/"+d+"?key=x",type:"PUT",contentType:"application/json",data:JSON.stringify(c)}).done(function(e,h,g){try{if(e==null||h!="success"){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,f)}else{a(e)}}catch(f){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,f)}}).fail(function(f,g,e){guiHelper.showError(textStrings.problemInitialisingPayment,guiHelper.showCheckoutAfterError,e)})},putOrder:function(c,b){var a=$.ajax({url:viewModel.serverUrl+"/Order/"+c+"?key=x",type:"PUT",contentType:"application/json",data:JSON.stringify(b)}).done(function(d,h,g){try{var e=acsapi.checkForError(d,false);if(e.length>0){guiHelper.showError(e,undefined,guiHelper.showCheckoutAfterError,errorThrown)}else{checkoutMenuHelper.showMenu("menu",true);checkoutMenuHelper.hideMenu();guiHelper.showView("orderAcceptedView")}}catch(f){guiHelper.showError(guiHelper.defaultInternalErrorMessage,guiHelper.showCheckoutAfterError,f)}}).fail(function(f,g,e){var d=acsapi.checkForError(f.responseText,true);guiHelper.showError(d,guiHelper.showCheckoutAfterError,e)})},checkForError:function(b,a){var d="";if(typeof(b)==="string"){var c=undefined;try{c=JSON.parse(b)}catch(c){}if(c!=undefined&&c.errorCode!=undefined){switch(c.errorCode){case"-1000":case"-1001":case"-1002":if(c.errorMessage!=undefined){d=textStrings.cardProcessingError.replace("{ErrorMessage}",c.errorMessage)}else{d=guiHelper.defaultPaymentErrorMessage+textStrings.appendErrorCode+c.errorCode}break;case"-1004":d=textStrings.commsProblem;break;case"1":case"-1":d=guiHelper.defaultWebErrorMessage+textStrings.appendErrorCode+c.errorCode;break;case"1000":case"1001":case"1002":case"1003":case"1004":case"1005":case"1006":case"1007":case"1008":case"1014":case"1015":case"1016":case"1017":case"1019":case"1028":case"2501":case"2502":d=guiHelper.defaultWebErrorMessage+textStrings.appendErrorCode+c.errorCode;break;case"2010":case"2020":case"2100":case"2125":case"2300":d=textStrings.apiProblem+c.errorCode;break;case"2150":case"2200":d=textStrings.cantDeliverOrder+c.errorCode;break;case"2101":case"2260":case"2270":d=textStrings.orderRejected+c.errorCode;break;default:d=guiHelper.defaultWebErrorMessage+textStrings.appendErrorCode+c.errorCode}}else{d=guiHelper.defaultWebErrorMessage}}if(a&&d.length==0){d=guiHelper.defaultWebErrorMessage+textStrings.appendUnknownErrorCode}return d},getDeliveryZones:function(c,a){var b=$.ajax(viewModel.serverUrl+"/DeliveryZones/"+c+"?key=x").done(function(d,g,f){try{if(d==null||g!="success"){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)}else{deliveryZoneHelper.deliveryZones(d);a()}}catch(e){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,e)}}).fail(function(e,f,d){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,d)})},getCustomer:function(d,c,a){var b=$.ajax({type:"GET",url:viewModel.serverUrl+"/Customers/"+d+"?key=x",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+acsapi.encode64(c))}}).done(function(e,h,g){try{if(e==null||h!="success"){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)}else{a(e)}}catch(f){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,f)}}).fail(function(h,j,g){if(h!=undefined&&h.responseText!=undefined){var i=undefined;try{i=JSON.parse(h.responseText)}catch(f){}a(i)}else{guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,g)}})},putCustomer:function(e,d,b,a){var c=$.ajax({type:"PUT",url:viewModel.serverUrl+"/Customers/"+e+"?key=x",beforeSend:function(f){f.setRequestHeader("Authorization","Basic "+acsapi.encode64(d))},contentType:"application/json",data:JSON.stringify(b)}).done(function(f,i,h){try{if(i!="success"){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)}else{a(undefined)}}catch(g){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,g)}}).fail(function(h,j,g){if(h!=undefined&&h.responseText!=undefined){var i=undefined;if(h.responseText.length>0){var i=undefined;try{i=JSON.parse(h.responseText)}catch(f){}}a(i)}else{guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,g)}})},postCustomer:function(e,d,b,a){var c=$.ajax({type:"POST",url:viewModel.serverUrl+"/Customers/"+e+"?key=x",beforeSend:function(f){f.setRequestHeader("Authorization","Basic "+acsapi.encode64(d))},contentType:"application/json",data:JSON.stringify(b)}).done(function(f,i,h){try{if(i!="success"){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)}else{a(undefined)}}catch(g){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,g)}}).fail(function(h,j,g){if(h!=undefined&&h.responseText!=undefined){var i=undefined;if(h.responseText.length>0){var i=undefined;try{i=JSON.parse(h.responseText)}catch(f){}}a(i)}else{guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,g)}})},encode64:function(d){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var l,m,n,f,g,h,j,c,k=0,a=0,e="",p=[];if(!d){return d}do{l=d.charCodeAt(k++);m=d.charCodeAt(k++);n=d.charCodeAt(k++);c=l<<16|m<<8|n;f=c>>18&63;g=c>>12&63;h=c>>6&63;j=c&63;p[a++]=b.charAt(f)+b.charAt(g)+b.charAt(h)+b.charAt(j)}while(k<d.length);e=p.join("");var o=d.length%3;return(o?e.slice(0,o-3):e)+"===".slice(o||3)}};function ViewModel(){var a=this;a.queryString={};a.initialise=function(){ko.setTemplateEngine(new ko.nativeTemplateEngine());$("#popupMobileMenu").on("click",function(b){b.stopPropagation();return false});$(window).resize(guiHelper.resize);guiHelper.refreshIsMobileMode();queryStringHelper.initialise();if(settings.requireCustomerDetailsPassthrough&&settings.parentWebsite.length>0){if(queryStringHelper.externalSiteId==undefined||queryStringHelper.externalSiteId.length==0||queryStringHelper.firstName==undefined||queryStringHelper.firstName.length==0||queryStringHelper.lastName==undefined||queryStringHelper.lastName.length==0||queryStringHelper.telephoneNumber==undefined||queryStringHelper.telephoneNumber.length==0||queryStringHelper.postcode==undefined||queryStringHelper.postcode.length==0||queryStringHelper.roadName==undefined||queryStringHelper.roadName.length==0||queryStringHelper.town==undefined||queryStringHelper.town.length==0){window.location.href=settings.parentWebsite;return}}setTimeout(function(){viewModel.defaultWebErrorMessage=textStrings.defaultWebErrorMessage;viewModel.defaultInternalErrorMessage=textStrings.defaultInternalErrorMessage;viewModel.defaultPaymentErrorMessage=textStrings.defaultPaymentErrorMessage;ko.applyBindings(viewModel);viewModel.chooseStore()},0)};a.serverUrl="http://"+location.host+"/Services/WebOrdering/webordering";a.viewName=ko.observable(undefined);a.pleaseWaitMessage=ko.observable("");a.pleaseWaitProgress=ko.observable(undefined);a.sitesMode=ko.observable("pleaseWait");a.sites=ko.observableArray();a.deliverySites=ko.observableArray();a.collectionOnlySites=ko.observableArray();a.selectedSite=ko.observable();a.siteDetails=ko.observable();a.sitesError=ko.observable(false);a.error={message:ko.observable(),showReturn:ko.observable(false),returnCallback:undefined};a.displayAddress=ko.observable();a.displayAddressMultiLine=ko.observable();a.chooseStore=function(){try{viewModel.menu=undefined;cartHelper.clearCart();guiHelper.isMobileMenuVisible(false);if(settings.storeSelectorMode){siteSelectorHelper.isPostcodeTextboxVisible(true);guiHelper.showView("siteSelectorView")}else{guiHelper.showPleaseWait(textStrings.gettingStoreDetails,undefined,function(){viewModel.siteDetails(undefined);acsapi.getSiteList(function(){helper.markOfflineStores();var d=undefined;if(queryStringHelper.externalSiteId!=undefined){if(viewModel.sites()!=undefined){for(var e=0;e<viewModel.sites().length;e++){var c=viewModel.sites()[e];if(c.siteId==queryStringHelper.externalSiteId){d=c;break}}}}if(d!=undefined){viewModel.selectedSite(d);guiHelper.showStoreMenu()}else{if(viewModel.sites()===undefined||viewModel.sites().length===0){guiHelper.showError("No stores!",function(){viewModel.chooseStore()},undefined)}else{if(viewModel.sites().length==1){viewModel.selectedSite(viewModel.sites()[0]);guiHelper.showStoreMenu()}else{guiHelper.showView("sitesView")}}}})})}}catch(b){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.chooseStore,b)}};a.storeSelected=function(b){siteSelectorHelper.isPostcodeTextboxVisible(false);viewModel.selectedSite(b);guiHelper.showStoreMenu()};a.isTakingOrders=ko.observable(false);a.menu=undefined;a.menuViewName=ko.observable("");a.sections=ko.observableArray();a.deals=ko.observableArray();a.visibleSection=ko.observable("");a.pickToppings=ko.observable(false);a.selectedItem={menuItem:ko.observable(undefined),menuItems:ko.observableArray(),name:ko.observable(""),description:ko.observable(""),quantity:ko.observable(1),price:ko.observable(undefined),category1:ko.observable(undefined),category2:ko.observable(undefined),freeToppings:ko.observable(0),freeToppingsRemaining:ko.observable(0),toppings:ko.observableArray(),instructions:ko.observable(""),person:ko.observable(""),category1s:ko.observableArray(),category2s:ko.observableArray(),selectedCategory1:ko.observable(),selectedCategory2:ko.observable(),price:ko.observable(undefined)};a.orderType=ko.observable("delivery");a.maxSectionHeight=ko.observable(0);a.changeSection=function(){if(this!=undefined&&this.Index!=undefined){guiHelper.showSection(this.Index)}else{if(viewModel.selectedSection()!=undefined){guiHelper.showSection(viewModel.selectedSection().Index)}}$("#mobileMenuSectionsSelect").blur();return true};a.addItemToCart=function(){var e=menuHelper.getSelectedMenuItem(this);if(e!=null){var b=helper.findById(e.Cat1==undefined?e.Category1:e.Cat1,viewModel.menu.Category1);var c=helper.findById(e.Cat2==undefined?e.Category2:e.Cat2,viewModel.menu.Category2);viewModel.selectedItem.name(this.name);viewModel.selectedItem.menuItems.removeAll();for(var d=0;d<this.menuItems().length;d++){viewModel.selectedItem.menuItems.push(this.menuItems()[d])}viewModel.selectedItem.description(this.description);viewModel.selectedItem.quantity(this.quantity);viewModel.selectedItem.menuItem(e);viewModel.selectedItem.freeToppings(e.FreeTops);viewModel.selectedItem.freeToppingsRemaining(e.FreeTops);viewModel.selectedItem.instructions("");viewModel.selectedItem.person("");viewModel.selectedItem.price(helper.formatPrice(this.price()));viewModel.ignoreEvents=true;viewModel.selectedItem.category1s.removeAll();for(var d=0;d<this.category1s().length;d++){viewModel.selectedItem.category1s.push(this.category1s()[d])}viewModel.selectedItem.category2s.removeAll();for(var d=0;d<this.category2s().length;d++){viewModel.selectedItem.category2s.push(this.category2s()[d])}viewModel.ignoreEvents=false;viewModel.selectedItem.category1(b);viewModel.selectedItem.category2(c);viewModel.selectedItem.selectedCategory1(this.selectedCategory1());viewModel.selectedItem.selectedCategory2(this.selectedCategory2());viewModel.selectedItem.toppings(menuHelper.getItemToppings(viewModel.selectedItem.menuItem()));var f=menuHelper.calculateItemPrice(e,this.quantity,viewModel.selectedItem.toppings());viewModel.selectedItem.price(helper.formatPrice(f));if(viewModel.selectedItem.toppings().length==0){popupHelper.commitToCart();if(guiHelper.isMobileMode()){guiHelper.showCart()}}else{popupHelper.returnToCart=false;popupHelper.showPopup("addItem")}}};a.selectedItemChanged=function(){if(!viewModel.ignoreEvents){guiHelper.selectedItemChanged(this)}};a.category1Changed=function(f){if(!viewModel.ignoreEvents&&f!=undefined){f.category2s.removeAll();for(var e=0;e<f.menuItems().length;e++){var d=f.menuItems()[e];if(f.selectedCategory1().Id==(d.Cat1==undefined?d.Category1:d.Cat1)){var c=helper.findById(d.Cat2==undefined?d.Category2:d.Cat2,viewModel.menu.Category2);if(c!=undefined&&!helper.findCategory(c,f.category2s)){f.category2s.push(c)}}}if(f.category2s().length>0){var g=false;for(var e=0;e<f.category2s().length;e++){var b=f.category2s()[e];if(b.Id==f.selectedCategory2().Id){g=true;break}}if(!g){f.selectedCategory2(f.category2s()[0])}}else{f.selectedCategory2(undefined)}guiHelper.selectedItemChanged(f)}};a.currentSectionIndex=0;a.changeDeliveryTime=function(){};a.timer=undefined;a.addressType=ko.observable();a.showCheckoutSection=function(b){checkoutHelper.showCheckoutSection(b.index)};a.selectedSection=ko.observable(undefined);a.ignoreEvents=false;a.etd=function(){var b=settings.defaultETD;if(viewModel.selectedSite().estDelivTime!=undefined&&viewModel.selectedSite().estDelivTime>0){b=viewModel.selectedSite().estDelivTime}return b};a.resetOrderType=function(){if(queryStringHelper.orderType==undefined){guiHelper.canChangeOrderType(true);viewModel.orderType("delivery")}else{if(queryStringHelper.orderType.toUpperCase()=="D"){viewModel.orderType("delivery");guiHelper.canChangeOrderType(false)}else{if(queryStringHelper.orderType.toUpperCase()=="C"){viewModel.orderType("collection");guiHelper.canChangeOrderType(false)}else{viewModel.orderType("delivery");guiHelper.canChangeOrderType(true)}}}};a.returnToHostWebsite=function(){window.location.href=settings.parentWebsite}}var viewModel=new ViewModel();var accountHelper={customerDetails:undefined,emailAddress:undefined,password:undefined,loggedInCallback:undefined,loginDetails:{errorMessage:ko.observable(""),emailAddress:ko.observable(""),password:ko.observable("")},newAccount:{errorMessage:ko.observable(""),firstName:ko.observable(""),surname:ko.observable(""),emailAddress:ko.observable(""),phoneNumber:ko.observable(""),password:ko.observable(""),reenterPassword:ko.observable(""),marketing:ko.observable(true),firstNameHasError:ko.observable(false),surnameHasError:ko.observable(false),emailAddressHasError:ko.observable(false),phoneNumberHasError:ko.observable(false),passwordHasError:ko.observable(false)},isRegisterOpen:false,isLoggedIn:ko.observable(false),loginRegister:function(){accountHelper.showPopup()},isPopupVisible:ko.observable(false),showPopup:function(a){if(guiHelper.isMobileMode()){accountHelper.loggedInCallback=a;guiHelper.showView("loginRegisterView");guiHelper.isMobileMenuVisible(false)}else{$(window).scrollTop(0);accountHelper.isRegisterOpen=false;$("#loginRegister").css("height","260px");$("#registerContainer").css("paddingTop","45px");accountHelper.loggedInCallback=a;popupHelper.isBackgroundVisible(true);accountHelper.isPopupVisible(true);if(guiHelper.isMobileMode()){guiHelper.isViewVisible(false);guiHelper.isInnerMenuVisible(false)}}},hidePopup:function(a){if(!guiHelper.isMobileMode()){popupHelper.isBackgroundVisible(false);accountHelper.isPopupVisible(false)}if(typeof(a)=="function"){a()}accountHelper.loggedInCallback=undefined},normalLogin:function(){accountHelper.login(accountHelper.loginDetails.emailAddress(),accountHelper.loginDetails.password())},login:function(a,b){accountHelper.loginDetails.errorMessage("");if(a==undefined||a.length==0){accountHelper.loginDetails.errorMessage("Please enter an email address");return}if(b==undefined||b.length==0){accountHelper.loginDetails.errorMessage("Please enter a password");return}acsapi.getCustomer(a,b,function(c){if(c==undefined){accountHelper.loginDetails.errorMessage("Unable to login");return}else{if(c.errorCode==undefined){accountHelper.isLoggedIn(true);accountHelper.customerDetails=c;accountHelper.emailAddress=a;accountHelper.password=b;accountHelper.hidePopup(accountHelper.loggedInCallback)}else{if(c.errorCode==1036){accountHelper.loginDetails.errorMessage("Invalid username or password");return}else{if(c.errorCode==1042){accountHelper.loginDetails.errorMessage("Invalid username or password");return}else{accountHelper.loginDetails.errorMessage("Unable to login");return}}}}})},facebookLogin:function(){accountHelper.loginDetails.errorMessage("");FB.login(function(a){if(a.authResponse){FB.api("/me",function(b){acsapi.getCustomer(b.email,b.id,function(c){if(c==undefined){accountHelper.loginDetails.errorMessage("Unable to login");return}else{if(c.errorCode==undefined){accountHelper.isLoggedIn(true);accountHelper.customerDetails=c;accountHelper.emailAddress=b.email;accountHelper.password=b.id;accountHelper.hidePopup(accountHelper.loggedInCallback)}else{if(c.errorCode==1036||c.errorCode==1042){acsapi.putCustomer(b.email,b.id,{title:"",firstname:b.first_name,surname:b.last_name,contacts:undefined,address:undefined},function(d){if(d==undefined){accountHelper.isLoggedIn(true);accountHelper.customerDetails=c;accountHelper.emailAddress=email;accountHelper.password=password;accountHelper.hidePopup(accountHelper.loggedInCallback)}});return}else{accountHelper.loginDetails.errorMessage("Unable to login");return}}}})})}},{scope:"email"})},myAccount:function(){alert("my account")},register:function(){accountHelper.newAccount.errorMessage("");accountHelper.newAccount.firstNameHasError(false);accountHelper.newAccount.surnameHasError(false);accountHelper.newAccount.emailAddressHasError(false);accountHelper.newAccount.phoneNumberHasError(false);accountHelper.newAccount.passwordHasError(false);if(accountHelper.newAccount.firstName().length==0){accountHelper.newAccount.errorMessage("Please enter your first name");accountHelper.newAccount.firstNameHasError(true);return}if(accountHelper.newAccount.surname().length==0){accountHelper.newAccount.errorMessage("Please enter your surname");accountHelper.newAccount.surnameHasError(true);return}if(accountHelper.newAccount.emailAddress().length==0){accountHelper.newAccount.errorMessage("Please enter your email address");accountHelper.newAccount.emailAddressHasError(true);return}if(accountHelper.newAccount.phoneNumber().length==0){accountHelper.newAccount.errorMessage("Please enter your phone number");accountHelper.newAccount.phoneNumberHasError(true);return}if(accountHelper.newAccount.password().length==0){accountHelper.newAccount.errorMessage("Please enter a password");accountHelper.newAccount.passwordHasError(true);return}var b=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;accountHelper.newAccount.emailAddressHasError(!b.test(accountHelper.newAccount.emailAddress()));if(accountHelper.newAccount.emailAddressHasError()){accountHelper.newAccount.errorMessage("Please enter a valid email address");return}if(accountHelper.newAccount.password()!=accountHelper.newAccount.reenterPassword()){accountHelper.newAccount.errorMessage("Passwords do not match");accountHelper.newAccount.passwordHasError(true);return}if(accountHelper.newAccount.password().length<8){accountHelper.newAccount.errorMessage("Password must be at least 8 characters");accountHelper.newAccount.passwordHasError(true);return}var a={title:"",firstname:accountHelper.newAccount.firstName(),surname:accountHelper.newAccount.surname(),contacts:[{type:"Email",value:accountHelper.newAccount.emailAddress(),marketingLevel:accountHelper.newAccount.marketing()?"3rdParty":"OrderOnly"},{type:"Mobile",value:accountHelper.newAccount.phoneNumber(),marketingLevel:accountHelper.newAccount.marketing()?"3rdParty":"OrderOnly"}],address:undefined};acsapi.putCustomer(accountHelper.newAccount.emailAddress(),accountHelper.newAccount.password(),a,function(c){if(c!=undefined&&c.errorCode!=undefined){if(c.errorCode==1041){accountHelper.newAccount.errorMessage("This email address has already been used");accountHelper.newAccount.emailAddressHasError(true);return}else{accountHelper.newAccount.errorMessage("Unable to create account")}}else{accountHelper.customerDetails=a;accountHelper.isLoggedIn(true);accountHelper.emailAddress=accountHelper.newAccount.emailAddress();accountHelper.password=accountHelper.newAccount.password();accountHelper.hidePopup(accountHelper.loggedInCallback)}})},showRegister:function(){if(accountHelper.isRegisterOpen){accountHelper.register()}else{$("#loginRegister").animate({height:430},{duration:500,queue:false});$("#registerContainer").animate({paddingTop:10},{duration:500,queue:false});accountHelper.isRegisterOpen=true}},cancel:function(){if(guiHelper.isMobileMode()){accountHelper.hidePopup(guiHelper.showCart)}else{accountHelper.hidePopup()}}};var cacheHelper={loadCachedMenuForSiteId:function(c){var b=undefined;try{guiHelper.showPleaseWait(textStrings.loadingMenu,undefined,function(){var e=amplify.store("menuIndex");if(e!=undefined){var f=undefined;for(var d=0;d<e.length;d++){f=e[d];if(f.siteId===c&&f.menuVersion===viewModel.selectedSite().menuVersion){b=amplify.store("m_"+c)}}}})}catch(a){}return b},cacheMenu:function(c){var f=false;var d=amplify.store("menuIndex");if(d===undefined){d=[]}var e=undefined;for(var b=0;b<d.length;b++){var a=d[b];if(a.siteId===viewModel.selectedSite().siteId){e=a;break}}if(e===undefined){e={siteId:viewModel.selectedSite().siteId,lastUsed:new Date(),menuVersion:viewModel.selectedSite().menuVersion};d.push(e)}else{e.menuVersion=viewModel.selectedSite().menuVersion;e.lastUsed=new Date()}if(cacheHelper.cacheObject("m_"+viewModel.selectedSite().siteId,c,d)){if(cacheHelper.cacheObject("menuIndex",d,d)){f=true}}return f},cacheObject:function(c,e,d){var b=true;var f=false;while(b){b=false;try{amplify.store(c,e);f=true}catch(a){if(a=="amplify.store quota exceeded"){if(cacheHelper.removeOldestMenuFromCache(d)){b=true}}}}return f},removeOldestMenuFromCache:function(c){var d=undefined;for(var b=0;b<c.length;b++){var a=c[b];if(d===undefined||a.lastUsed<d.lastUsed){d=a}}if(d!=undefined){amplify.store("m_"+d.siteId,null);c.splice(d,1);amplify.store("menuIndex",c);return true}else{return false}}};function CartHelper(){var a=this;a.cart=ko.observable({displayTotalPrice:ko.observable(),cartItems:ko.observableArray(),totalPrice:ko.observable(),selectedCartItem:ko.observable({}),mercuryPaymentId:ko.observable(),dataCashPaymentDetails:ko.observable(),deals:ko.observableArray(),areDisabledItems:ko.observable(),checkoutEnabled:ko.observable(),hasItems:ko.observable(),displaySubTotalPrice:ko.observable(),subTotalPrice:ko.observable(),discountName:ko.observable(),discountAmount:ko.observable(),displayDiscountAmount:ko.observable()});a.refreshCart=function(){menuHelper.refreshDealsAvailabilty();var r=cartHelper.getOrderValueExcludingDealsWithAMinimumPrice();var w=0;var b=false;var f=false;for(var n=0;n<cartHelper.cart().deals().length;n++){var g=cartHelper.cart().deals()[n];var q=r>=g.deal.deal.MinimumOrderValue;g.minimumOrderValueNotMet(!q);g.isEnabled(menuHelper.isDealItemEnabledForCart(g));if(g.isEnabled()){f=true}else{b=true}g.displayPrice(helper.formatPrice(g.price));var k=0;if(g.dealLines!=undefined){for(var i=0;i<g.dealLines().length;i++){var h=g.dealLines()[i];var j=menuHelper.calculateDealLinePrice(h);var c=helper.findById(h.selectedMenuItem.Cat1==undefined?h.selectedMenuItem.Category1:h.selectedMenuItem.Cat1,viewModel.menu.Category1);var d=helper.findById(h.selectedMenuItem.Cat2==undefined?h.selectedMenuItem.Category2:h.selectedMenuItem.Cat2,viewModel.menu.Category2);var e=((c==undefined?0:c.DealPremium)+(d==undefined?0:d.DealPremium));if(e==undefined||e==0){h.categoryPremium(undefined);h.categoryPremiumName(undefined)}else{h.categoryPremium(helper.formatPrice(e));h.categoryPremiumName(textStrings.premiumChargeFor.replace("{item}",d.Name))}var p=h.selectedMenuItem.DealPricePremiumOverride==0?h.selectedMenuItem.DealPricePremium:h.selectedMenuItem.DealPricePremiumOverride;if(p==undefined||p==0){h.itemPremium(undefined);h.itemPremiumName(undefined)}else{h.itemPremium(helper.formatPrice(premium));h.itemPremiumName(textStrings.premiumChargeFor.replace("{item}",h.selectedMenuItem.Name))}k+=j;if(g.isEnabled()){w+=j+e+p}if(h.displayToppings!=undefined){for(var t=0;t<h.displayToppings().length;t++){var s=h.displayToppings()[t];var u=menuHelper.calculateToppingPrice(s);s.cartPrice(helper.formatPrice(u));if(g.isEnabled()){w+=u}}}}g.price=k;g.displayPrice(helper.formatPrice(k))}}var x=0;for(var n=0;n<cartHelper.cart().cartItems().length;n++){var o=cartHelper.cart().cartItems()[n];o.isEnabled(menuHelper.isItemEnabledForCart(o.menuItem));if(o.isEnabled()){f=true}o.price=menuHelper.calculateItemPrice(o.menuItem,o.quantity(),undefined);if(o.isEnabled()){w+=o.price;x+=o.price}else{b=true}o.displayPrice(helper.formatPrice(o.price));if(o.displayToppings!=undefined){var v=0;for(var t=0;t<o.displayToppings().length;t++){var s=o.displayToppings()[t];var u=menuHelper.calculateToppingPrice(s);s.cartPrice(helper.formatPrice(u*o.quantity()));v+=u}if(o.isEnabled()){w+=(v*o.quantity());x+=(v*o.quantity())}}}cartHelper.cart().areDisabledItems(b);var m=cartHelper.calculateFullOrderDiscount(x);cartHelper.cart().displaySubTotalPrice(helper.formatPrice(w));cartHelper.cart().subTotalPrice(w);var l=menuHelper.fullOrderDiscountDeal==undefined?undefined:menuHelper.fullOrderDiscountDeal.DealName;cartHelper.cart().discountName(l);cartHelper.cart().discountAmount(m);cartHelper.cart().displayDiscountAmount(helper.formatPrice(m*-1));w-=m;cartHelper.cart().displayTotalPrice(helper.formatPrice(w));cartHelper.cart().totalPrice(w);cartHelper.cart().hasItems(cartHelper.cart().cartItems().length!=0||cartHelper.cart().deals().length!=0);if(f&&viewModel.orderType()=="delivery"){f=cartHelper.cart().totalPrice()>=settings.minimumDeliveryOrder}cartHelper.cart().checkoutEnabled(f)};a.getOrderValueExcludingDealsWithAMinimumPrice=function(){var l=0;for(var f=0;f<cartHelper.cart().deals().length;f++){var b=cartHelper.cart().deals()[f];if(b.deal.deal.MinimumOrderValue==0){if(b.dealLines!=undefined){for(var d=0;d<b.dealLines().length;d++){var c=b.dealLines()[d];var e=menuHelper.calculateDealLinePrice(c);l+=e}}}}var m=0;for(var f=0;f<cartHelper.cart().cartItems().length;f++){var g=cartHelper.cart().cartItems()[f];var h=menuHelper.calculateItemPrice(g.menuItem,g.quantity(),undefined);if(menuHelper.isItemAvailable(g.menuItem)){l+=h;m+=h}if(g.displayToppings!=undefined){for(var j=0;j<g.displayToppings().length;j++){var i=g.displayToppings()[j];var k=menuHelper.calculateToppingPrice(i);if(menuHelper.isItemAvailable(g.menuItem)){l+=k;m+=k}}}}l-=cartHelper.calculateFullOrderDiscount(m);if(l<0){l=0}return l};a.calculateFullOrderDiscount=function(c){var b=0;if(menuHelper.fullOrderDiscountDeal!=undefined){switch(menuHelper.fullOrderDiscountDeal.FullOrderDiscountType.toLowerCase()){case"percentage":var d=100;if(viewModel.orderType().toLowerCase()=="collection"){d=menuHelper.fullOrderDiscountDeal.FullOrderDiscountCollectionAmount/100}else{d=menuHelper.fullOrderDiscountDeal.FullOrderDiscountDeliveryAmount/100}b=c-(c*d);break;case"discount":if(viewModel.orderType().toLowerCase()=="collection"){b=menuHelper.fullOrderDiscountDeal.FullOrderDiscountCollectionAmount}else{b=menuHelper.fullOrderDiscountDeal.FullOrderDiscountDeliveryAmount}b=c-b;break}}return Math.round(b)};a.clearCart=function(){cartHelper.cart().cartItems.removeAll();cartHelper.cart().deals.removeAll();cartHelper.refreshCart();viewModel.timer=new Date()};a.checkout=function(){if(settings.customerAccountsEnabled&&!accountHelper.isLoggedIn()){accountHelper.showPopup(cartHelper.checkout);return}checkoutHelper.refreshTimes();if(guiHelper.isMobileMode()){guiHelper.isMobileMenuVisible(false);checkoutMenuHelper.showMenu("menu",true);guiHelper.showView("checkoutView")}else{guiHelper.showMenuView("checkoutView")}checkoutHelper.initialiseCheckout();guiHelper.isMobileMenuVisible(false);guiHelper.canChangeOrderType(false);guiHelper.cartActions(guiHelper.cartActionsCheckout)};a.getDealTemplate=function(b){if(guiHelper.isCartLocked()){return"disabledCartDeal-template"}else{return"cartDeal-template"}};a.getItemTemplate=function(b){if(guiHelper.isCartLocked()){return"disabledCartItem-template"}else{return"cartItem-template"}};a.editCartItem=function(){cartHelper.cart().selectedCartItem(this);var c=menuHelper.calculateItemPrice(this.menuItem,this.quantity(),this.toppings);viewModel.selectedItem.name(this.name);viewModel.selectedItem.description(menuHelper.fixName(this.menuItem.Desc==undefined?this.menuItem.Description:this.menuItem.Desc));viewModel.selectedItem.quantity(this.quantity());viewModel.selectedItem.menuItem(this.menuItem);viewModel.selectedItem.instructions(this.instructions);viewModel.selectedItem.person(this.person);viewModel.selectedItem.menuItems.removeAll();for(var b=0;b<this.menuItems.length;b++){viewModel.selectedItem.menuItems.push(this.menuItems[b])}viewModel.ignoreEvents=true;viewModel.selectedItem.category1s.removeAll();for(var b=0;b<this.category1s().length;b++){viewModel.selectedItem.category1s.push(this.category1s()[b])}viewModel.selectedItem.category2s.removeAll();for(var b=0;b<this.category2s().length;b++){viewModel.selectedItem.category2s.push(this.category2s()[b])}viewModel.ignoreEvents=false;viewModel.selectedItem.toppings(this.toppings());viewModel.selectedItem.selectedCategory1(this.selectedCategory1);viewModel.selectedItem.selectedCategory2(this.selectedCategory2);viewModel.selectedItem.price(helper.formatPrice(c));popupHelper.returnToCart=true;popupHelper.showPopup("editItem")};a.editCartDeal=function(){cartHelper.cart().selectedCartItem(this);dealHelper.mode("editDeal");dealHelper.hasError(false);dealHelper.selectedDeal.name(this.name);dealHelper.selectedDeal.description(this.deal.description);dealHelper.selectedDeal.bindableDealLines.removeAll();for(var d=0;d<this.dealLines.length;d++){var b=this.dealLines[d];var c={dealLine:b.dealLine,items:undefined,selectedItem:ko.observable(),selectedMenuItem:b.selectedMenuItem,hasError:ko.observable(false),toppings:b.toppings};var h=[];for(var f=0;f<b.dealLine.items.length;f++){var e=b.dealLine.items[f];var g={dealLine:c,item:f==0?undefined:e,name:e.name};h.push(g)}c.items=h;dealHelper.selectedDeal.dealLines.push(c)}dealPopupHelper.returnToCart=true;dealPopupHelper.showDealPopup("editDeal",true);dealHelper.selectedDeal.deal=this.deal;setTimeout(function(){dealHelper.subscribeToDealLineChanges()},0)};a.getCartItemName=function(c,d,e){var b="";if(d!=undefined){b+=" ("+d.Name}if(e!=undefined){if(b.length>0){b+=", "}b+=e.Name}if(b.length>0){b+=")"}return(typeof(c.name)=="function"?c.name():c.name)+b};a.orderTypeChanged=function(){cartHelper.refreshCart();return true}}var cartHelper=new CartHelper();var checkoutHelper={clearCheckout:function(){checkoutHelper.checkoutDetails.firstName("");checkoutHelper.checkoutDetails.surname("");checkoutHelper.checkoutDetails.telephoneNumber("");checkoutHelper.checkoutDetails.emailAddress("");checkoutHelper.checkoutDetails.deliveryTime("");checkoutHelper.checkoutDetails.payNow=false;checkoutHelper.checkoutDetails.address.prem1("");checkoutHelper.checkoutDetails.address.prem2("");checkoutHelper.checkoutDetails.address.prem3("");checkoutHelper.checkoutDetails.address.prem4("");checkoutHelper.checkoutDetails.address.prem5("");checkoutHelper.checkoutDetails.address.prem6("");checkoutHelper.checkoutDetails.address.org1("");checkoutHelper.checkoutDetails.address.org2("");checkoutHelper.checkoutDetails.address.org3("");checkoutHelper.checkoutDetails.address.roadNumber("");checkoutHelper.checkoutDetails.address.roadName("");checkoutHelper.checkoutDetails.address.city("");checkoutHelper.checkoutDetails.address.town("");checkoutHelper.checkoutDetails.address.zipCode("");checkoutHelper.checkoutDetails.address.county("");checkoutHelper.checkoutDetails.address.state("");checkoutHelper.checkoutDetails.address.locality("");checkoutHelper.checkoutDetails.address.country("");checkoutHelper.checkoutDetails.address.directions("");checkoutHelper.checkoutDetails.address.userLocality1("");checkoutHelper.checkoutDetails.address.userLocality2("");checkoutHelper.checkoutDetails.address.userLocality3("");checkoutHelper.checkoutDetails.orderNotes("");checkoutHelper.checkoutDetails.chefNotes("")},initialiseCheckout:function(){checkoutHelper.nextButton.displayText(textStrings.next);checkoutHelper.backButton.displayText(textStrings.back);if(settings.customerAccountsEnabled&&accountHelper.customerDetails!=undefined){checkoutHelper.checkoutDetails.firstName(accountHelper.customerDetails.firstname);checkoutHelper.checkoutDetails.surname(accountHelper.customerDetails.surname);checkoutHelper.checkoutDetails.emailAddress(accountHelper.emailAddress);if(accountHelper.customerDetails.contacts!=undefined){for(var b=0;b<accountHelper.customerDetails.contacts.length;b++){var a=accountHelper.customerDetails.contacts[b];if(a.type=="Email"){checkoutHelper.checkoutDetails.emailAddress(a.value)}else{if(a.type=="Mobile"){checkoutHelper.checkoutDetails.telephoneNumber(a.value);checkoutHelper.checkoutDetails.marketing(a.marketingLevel=="3rdParty")}}}}if(viewModel.orderType()=="delivery"&&accountHelper.customerDetails.address!=undefined){checkoutHelper.checkoutDetails.address.prem1(accountHelper.customerDetails.address.prem1);checkoutHelper.checkoutDetails.address.prem2(accountHelper.customerDetails.address.prem2);checkoutHelper.checkoutDetails.address.prem3(accountHelper.customerDetails.address.prem3);checkoutHelper.checkoutDetails.address.prem4(accountHelper.customerDetails.address.prem4);checkoutHelper.checkoutDetails.address.prem5(accountHelper.customerDetails.address.prem5);checkoutHelper.checkoutDetails.address.prem6(accountHelper.customerDetails.address.prem6);checkoutHelper.checkoutDetails.address.org1(accountHelper.customerDetails.address.org1);checkoutHelper.checkoutDetails.address.org2(accountHelper.customerDetails.address.org2);checkoutHelper.checkoutDetails.address.org3(accountHelper.customerDetails.address.org3);checkoutHelper.checkoutDetails.address.roadNumber(accountHelper.customerDetails.address.roadNum);checkoutHelper.checkoutDetails.address.roadName(accountHelper.customerDetails.address.roadName);checkoutHelper.checkoutDetails.address.city(accountHelper.customerDetails.address.city);checkoutHelper.checkoutDetails.address.town(accountHelper.customerDetails.address.town);checkoutHelper.checkoutDetails.address.zipCode(accountHelper.customerDetails.address.postcode);checkoutHelper.checkoutDetails.address.county(accountHelper.customerDetails.address.county);checkoutHelper.checkoutDetails.address.state(accountHelper.customerDetails.address.state);checkoutHelper.checkoutDetails.address.locality(accountHelper.customerDetails.address.locality);checkoutHelper.checkoutDetails.address.directions(accountHelper.customerDetails.address.directions);checkoutHelper.checkoutDetails.address.userLocality1(accountHelper.customerDetails.address.userLocality1);checkoutHelper.checkoutDetails.address.userLocality2(accountHelper.customerDetails.address.userLocality2);checkoutHelper.checkoutDetails.address.userLocality3(accountHelper.customerDetails.address.userLocality3)}}else{checkoutHelper.checkoutDetails.firstName(queryStringHelper.firstName==undefined?"":queryStringHelper.firstName);checkoutHelper.checkoutDetails.surname(queryStringHelper.lastName==undefined?"":queryStringHelper.lastName);checkoutHelper.checkoutDetails.emailAddress(queryStringHelper.email==undefined?"":queryStringHelper.email);checkoutHelper.checkoutDetails.telephoneNumber(queryStringHelper.telephoneNumber==undefined?"":queryStringHelper.telephoneNumber);checkoutHelper.checkoutDetails.marketing(queryStringHelper.marketing==undefined?"":queryStringHelper.marketing);checkoutHelper.checkoutDetails.address.town(queryStringHelper.town==undefined?"":queryStringHelper.town);checkoutHelper.checkoutDetails.address.city(queryStringHelper.town==undefined?"":queryStringHelper.town);checkoutHelper.checkoutDetails.address.zipCode(queryStringHelper.postcode==undefined?"":queryStringHelper.postcode);checkoutHelper.checkoutDetails.address.roadNumber(queryStringHelper.houseNumber==undefined?"":queryStringHelper.houseNumber);checkoutHelper.checkoutDetails.address.roadName(queryStringHelper.roadName==undefined?"":queryStringHelper.roadName)}checkoutHelper.checkoutDetails.address.country(viewModel.siteDetails().address.country);checkoutHelper.checkoutSections.removeAll();var b=0;if(settings.displayCustomerDetailsPage){checkoutHelper.checkoutSections.push({id:"checkoutContactDetailsContainer",index:b,templateName:"checkoutContactDetails-template",displayName:(b+1)+") "+textStrings.whoAreYou,validate:checkoutHelper.validateContactDetails});b++}if(viewModel.orderType()=="collection"){checkoutHelper.checkoutSections.push({id:"checkoutDeliveryTimeContainer",index:b,templateName:"checkoutDeliveryTime-template",displayName:(b+1)+") "+textStrings.collectionTime,validate:checkoutHelper.validateDeliveryTime});b++}else{checkoutHelper.checkoutSections.push({id:"checkoutDeliveryTimeContainer",index:b,templateName:"checkoutDeliveryTime-template",displayName:(b+1)+") "+textStrings.deliveryTime,validate:checkoutHelper.validateDeliveryTime});b++}if(viewModel.orderType()=="delivery"&&settings.displayCustomerAddressPage){checkoutHelper.checkoutSections.push({id:"checkoutDeliveryAddressContainer",index:b,templateName:"checkoutDeliveryAddress-template",displayName:(b+1)+") "+textStrings.deliveryAddress,validate:checkoutHelper.validateAddress});b++}checkoutHelper.checkoutSections.push({id:"checkoutOrderNotesContainer",index:b,templateName:"checkoutOrderNotes-template",displayName:(b+1)+") "+textStrings.orderNotes,validate:function(){return true}});b++;checkoutHelper.showCheckoutSection(0)},showCheckoutSection:function(c){if(c==0){checkoutHelper.backButton.visible(false);checkoutHelper.backButton.action="none"}else{checkoutHelper.backButton.visible(true);checkoutHelper.backButton.action=c-1}if(c==checkoutHelper.checkoutSections().length-1){checkoutHelper.nextButton.displayText(textStrings.placeOrder);checkoutHelper.nextButton.action="placeorder"}else{checkoutHelper.nextButton.displayText(textStrings.next);checkoutHelper.nextButton.action=c+1}for(var b=0;b<checkoutHelper.checkoutSections().length;b++){var a=checkoutHelper.checkoutSections()[b];if(a.index==c||guiHelper.isMobileMode()){$("#"+a.id).css("display","block")}else{$("#"+a.id).css("display","none")}}checkoutHelper.visibleCheckoutSection(c);guiHelper.isCartLocked(true)},refreshTimes:function(){checkoutHelper.times.removeAll();checkoutHelper.times.push({mode:undefined,time:undefined,text:textStrings.pleaseSelectATime});var h=openingTimesHelper.getTodaysOpeningTimes();var n=[];var q=new Date();var g=settings.defaultETD;if(viewModel.selectedSite().estDelivTime!=undefined&&viewModel.selectedSite().estDelivTime>0){g=viewModel.selectedSite().estDelivTime}var q=new Date(new Date().getTime()+g*60000);var e=q.getHours();var f=q.getMinutes();for(var p=0;p<h.length;p++){var o=h[p];if(o.openAllDay){n.push({startHour:e,startMinute:f,endHour:0,endMinute:0});break}else{var j=o.startTime.split(":");var k=Number(j[0]);var l=Number(j[1]);var a=o.endTime.split(":");var b=Number(a[0]);var c=Number(a[1]);if(k>e||(k==e&&l>f)){n.push({startHour:k,startMinute:l,endHour:b,endMinute:c})}else{if(b>e||(b==e&&c>f)){n.push({startHour:e,startMinute:f,endHour:b,endMinute:c})}}}}var i=15;for(var m=0;m<n.length;m++){var o=n[m];checkoutHelper.addDeliveryHourSlots(o.startHour,o.startMinute,o.endHour==o.startHour?o.endMinute:60,i);var b=o.endHour==0?24:o.endHour;for(var d=o.startHour+1;d<b;d++){checkoutHelper.addDeliveryHourSlots(d,0,60,i)}if(o.endHour>o.startHour){checkoutHelper.addDeliveryHourSlots(o.endHour,0,o.endMinute,i)}}},addDeliveryHourSlots:function(c,f,a,e){var g=Math.ceil(f/e)*e;var b=Math.ceil(a/e)*e;for(var d=g;d<b;d+=e){checkoutHelper.addDeliverySlot(c,d,e)}},addDeliverySlot:function(a,g,h){var b=a>12?a-12:a;var c=a>12?"pm":"am";var d=(a+1)>23?0:(a+1);var e=d>12?d-12:d;var f=d>12?"pm":"am";if(g+h>59){checkoutHelper.times.push({mode:"TIMED",time:a+":"+g,text:checkoutHelper.formatHour(helper.use24hourClock?a:b)+":"+checkoutHelper.formatMinute(g)+(helper.use24hourClock?"":c)+" - "+checkoutHelper.formatHour(helper.use24hourClock?a:e)+":"+checkoutHelper.formatMinute((h-(60-g)))+(helper.use24hourClock?"":f)})}else{checkoutHelper.times.push({mode:"TIMED",time:a+":"+g,text:checkoutHelper.formatHour(helper.use24hourClock?a:b)+":"+checkoutHelper.formatMinute(g)+(helper.use24hourClock?"":c)+" - "+checkoutHelper.formatHour(helper.use24hourClock?a:b)+":"+checkoutHelper.formatMinute((g+h))+(helper.use24hourClock?"":c)})}},formatMinute:function(a){if(a<10){return"0"+a}else{return a}},formatHour:function(a){if(a<10){return" "+a}else{return a}},visibleCheckoutSection:ko.observable(0),times:ko.observableArray(),checkoutDetails:{firstName:ko.observable(""),surname:ko.observable(""),telephoneNumber:ko.observable(""),emailAddress:ko.observable(""),deliveryTime:ko.observable(undefined),address:{prem1:ko.observable(""),prem2:ko.observable(""),prem3:ko.observable(""),prem4:ko.observable(""),prem5:ko.observable(""),prem6:ko.observable(""),org1:ko.observable(""),org2:ko.observable(""),org3:ko.observable(""),roadNumber:ko.observable(""),roadName:ko.observable(""),city:ko.observable(""),town:ko.observable(""),zipCode:ko.observable(""),county:ko.observable(""),state:ko.observable(""),locality:ko.observable(""),country:ko.observable(""),directions:ko.observable(""),userLocality1:ko.observable(""),userLocality2:ko.observable(""),userLocality3:ko.observable("")},payNow:false,marketing:ko.observable("true"),wantedTime:ko.observable(undefined),orderNotes:ko.observable(""),chefNotes:ko.observable(""),rememberAddress:true,rememberContactDetails:true},placeOrder:function(){if(checkoutHelper.validate()){if(settings.customerAccountsEnabled&&checkoutHelper.checkoutDetails.rememberContactDetails){accountHelper.customerDetails.firstName=checkoutHelper.checkoutDetails.firstName();accountHelper.customerDetails.surname=checkoutHelper.checkoutDetails.surname();accountHelper.customerDetails.telephoneNumber=checkoutHelper.checkoutDetails.telephoneNumber()}if(settings.customerAccountsEnabled&&checkoutHelper.checkoutDetails.rememberAddress){accountHelper.customerDetails.address={prem1:checkoutHelper.checkoutDetails.address.prem1(),prem2:checkoutHelper.checkoutDetails.address.prem2(),prem3:checkoutHelper.checkoutDetails.address.prem3(),prem4:checkoutHelper.checkoutDetails.address.prem4(),prem5:checkoutHelper.checkoutDetails.address.prem5(),prem6:checkoutHelper.checkoutDetails.address.prem6(),org1:checkoutHelper.checkoutDetails.address.org1(),org2:checkoutHelper.checkoutDetails.address.org2(),org3:checkoutHelper.checkoutDetails.address.org3(),roadNum:checkoutHelper.checkoutDetails.address.roadNumber(),roadName:checkoutHelper.checkoutDetails.address.roadName(),city:checkoutHelper.checkoutDetails.address.city(),town:checkoutHelper.checkoutDetails.address.town(),postcode:checkoutHelper.checkoutDetails.address.zipCode(),county:checkoutHelper.checkoutDetails.address.county(),state:checkoutHelper.checkoutDetails.address.state(),locality:checkoutHelper.checkoutDetails.address.locality(),country:checkoutHelper.checkoutDetails.address.country(),directions:checkoutHelper.checkoutDetails.address.directions(),userLocality1:checkoutHelper.checkoutDetails.address.userLocality1(),userLocality2:checkoutHelper.checkoutDetails.address.userLocality2(),userLocality3:checkoutHelper.checkoutDetails.address.userLocality3()};var b="3rdParty";for(var c=0;c<accountHelper.customerDetails.contacts.length;c++){var a=accountHelper.customerDetails.contacts[c];if(a.type=="Email"){b=a.marketingLevel;break}}accountHelper.customerDetails.contacts=[];accountHelper.customerDetails.contacts.push({type:"Email",value:accountHelper.emailAddress,marketingLevel:b});if(checkoutHelper.checkoutDetails.telephoneNumber()!=undefined&&checkoutHelper.checkoutDetails.telephoneNumber().length>0){accountHelper.customerDetails.contacts.push({type:"Mobile",value:checkoutHelper.checkoutDetails.telephoneNumber(),marketingLevel:checkoutHelper.checkoutDetails.marketing()?"3rdParty":"OrderOnly"})}acsapi.postCustomer(accountHelper.emailAddress,accountHelper.password,accountHelper.customerDetails,checkoutHelper.showPaymentPicker)}else{checkoutHelper.showPaymentPicker()}}},showPaymentPicker:function(){if(guiHelper.isMobileMode()){guiHelper.isMobileMenuVisible(false);checkoutMenuHelper.showMenu("checkout",false);guiHelper.showView("paymentView")}else{guiHelper.showMenuView("paymentView")}guiHelper.cartActions(guiHelper.cartActionsCheckout);if(settings.termsAndConditionsEnabled){tandcHelper.agree(undefined)}else{tandcHelper.agree(true)}guiHelper.canChangeOrderType(false)},payAtDoor:function(){if(!tandcHelper.hasAgreed()){return}checkoutMenuHelper.hideMenu();checkoutHelper.checkoutDetails.payNow=false;checkoutHelper.sendOrderToStore()},payNow:function(){if(!tandcHelper.hasAgreed()){return}guiHelper.canChangeOrderType(false);checkoutHelper.checkoutDetails.payNow=true;viewModel.pleaseWaitMessage(textStrings.preparingForPayment);viewModel.pleaseWaitProgress("");guiHelper.showView("pleaseWaitView");if(viewModel.siteDetails().paymentProvider.toUpperCase()=="MERCURY"){acsapi.putMercuryPayment(viewModel.selectedSite().siteId,function(){if(guiHelper.isMobileMode()){guiHelper.isMobileMenuVisible(false);checkoutMenuHelper.showMenu("pay",false);guiHelper.showView("mercuryPaymentView")}else{guiHelper.showMenuView("mercuryPaymentView")}var b=$("#mercuryPaymentIFrame");b.attr("src","https://hc.mercurydev.net/CheckoutIFrame.aspx?pid="+cartHelper.cart().mercuryPaymentId());b.load(function(){if(b.contents().get(0)!=undefined){if(b.contents().get(0).location.href){checkoutHelper.sendOrderToStore()}}})})}else{if(viewModel.siteDetails().paymentProvider.toUpperCase()=="DATACASHLIVE"||viewModel.siteDetails().paymentProvider.toUpperCase()=="DATACASHTEST"){acsapi.putDataCashPayment(viewModel.selectedSite().siteId,function(){if(guiHelper.isMobileMode()){guiHelper.isMobileMenuVisible(false);checkoutMenuHelper.showMenu("pay",false);guiHelper.showView("dataCashPaymentView")}else{guiHelper.showMenuView("dataCashPaymentView")}var b=$("#dataCashPaymentIFrame");b.attr("src",cartHelper.cart().dataCashPaymentDetails().url+"?HPS_SessionID="+cartHelper.cart().dataCashPaymentDetails().sessionId);b.load(function(){if(b.contents().get(0)!=undefined){if(b.contents().get(0).location.href){checkoutHelper.sendOrderToStore()}}})})}else{if(viewModel.siteDetails().paymentProvider.toUpperCase()=="MERCANETLIVE"||viewModel.siteDetails().paymentProvider.toUpperCase()=="MERCANETTEST"){var a=checkoutHelper.generateOrderJson();acsapi.putMercanetPayment(viewModel.selectedSite().siteId,a,function(e){var f=jQuery.parseJSON(e);var b=f.Html;var g=f.OrderReference;cookieHelper.setCookie("or",f.OrderReference);if(guiHelper.isMobileMode()){guiHelper.isMobileMenuVisible(false);checkoutMenuHelper.showMenu("pay",false);guiHelper.showView("mercanetPaymentView")}else{guiHelper.showMenuView("mercanetPaymentView")}var c=$("#mercanetPaymentIFrame");if(b==undefined||b.length==0){b="Sorry there was problem.  Payment is unavailable at this time."}var d=c[0].contentDocument||c[0].contentWindow.document;d.write(b);d.close()})}else{guiHelper.showHome()}}}},sendOrderToStore:function(){checkoutMenuHelper.hideMenu();viewModel.pleaseWaitMessage(textStrings.sendingOrderToStore);viewModel.pleaseWaitProgress("");guiHelper.showView("pleaseWaitView");var a=checkoutHelper.generateOrderJson();acsapi.putOrder(viewModel.selectedSite().siteId,a)},generateOrderJson:function(){var i=new Date();var j=Math.abs(i-viewModel.timer);var k=Math.round(j/1000);var f={toSiteId:viewModel.selectedSite().siteId,paymentType:checkoutHelper.checkoutDetails.payNow?viewModel.siteDetails().paymentProvider:"PayLater",paymentData:undefined,order:{partnerReference:"",type:viewModel.orderType(),orderTimeType:checkoutHelper.checkoutDetails.wantedTime().mode,orderWantedTime:checkoutHelper.checkoutDetails.wantedTime().mode=="ASAP"?helper.formatUTCDate(new Date()):helper.formatUTCSlot(checkoutHelper.checkoutDetails.wantedTime().time),orderPlacedTime:helper.formatUTCDate(new Date()),timeToTake:k,chefNotes:checkoutHelper.checkoutDetails.chefNotes(),oneOffDirections:checkoutHelper.checkoutDetails.orderNotes(),estimatedDeliveryTime:0,customer:{title:"",firstName:checkoutHelper.checkoutDetails.firstName(),surname:checkoutHelper.checkoutDetails.surname(),contacts:[{type:"Mobile",value:checkoutHelper.checkoutDetails.telephoneNumber(),marketingLevel:checkoutHelper.checkoutDetails.marketing()?"OrderOnly":"None"},{type:"Email",value:checkoutHelper.checkoutDetails.emailAddress(),marketingLevel:checkoutHelper.checkoutDetails.marketing()?"OrderOnly":"None"}],address:{prem1:textStrings.prem1Prefix+checkoutHelper.checkoutDetails.address.prem1(),prem2:textStrings.prem2Prefix+checkoutHelper.checkoutDetails.address.prem2(),prem3:textStrings.prem3Prefix+checkoutHelper.checkoutDetails.address.prem3(),prem4:checkoutHelper.checkoutDetails.address.prem4(),prem5:checkoutHelper.checkoutDetails.address.prem5(),prem6:checkoutHelper.checkoutDetails.address.prem6(),org1:checkoutHelper.checkoutDetails.address.org1(),org2:checkoutHelper.checkoutDetails.address.org2(),org3:checkoutHelper.checkoutDetails.address.org3(),roadNumber:checkoutHelper.checkoutDetails.address.roadNumber(),roadName:checkoutHelper.checkoutDetails.address.roadName(),city:checkoutHelper.checkoutDetails.address.city(),town:checkoutHelper.checkoutDetails.address.town(),zipCode:checkoutHelper.checkoutDetails.address.zipCode(),county:checkoutHelper.checkoutDetails.address.county(),state:checkoutHelper.checkoutDetails.address.state(),locality:checkoutHelper.checkoutDetails.address.locality(),directions:checkoutHelper.checkoutDetails.address.directions(),userLocality1:textStrings.userLocality1Prefix+checkoutHelper.checkoutDetails.address.userLocality1(),userLocality2:textStrings.userLocality2Prefix+checkoutHelper.checkoutDetails.address.userLocality2(),userLocality3:textStrings.userLocality3Prefix+checkoutHelper.checkoutDetails.address.userLocality3(),country:settings.customerAddressCountryCode},accountNumber:accountHelper.customerDetails==undefined?"":accountHelper.customerDetails.accountNumber},pricing:{priceBeforeDiscount:cartHelper.cart().totalPrice(),pricesIncludeTax:"false",priceAfterDiscount:cartHelper.cart().totalPrice()},orderLines:[],orderPayments:[]}};if(cartHelper.cart().discountAmount()!=undefined&&cartHelper.cart().discountAmount()>0&&menuHelper.fullOrderDiscountDeal!=undefined){f.order.pricing.priceBeforeDiscount=cartHelper.cart().subTotalPrice();f.order.pricing.discountType=menuHelper.fullOrderDiscountDeal.FullOrderDiscountType;if(viewModel.orderType()=="collection"){f.order.pricing.discountTypeAmount=menuHelper.fullOrderDiscountDeal.FullOrderDiscountCollectionAmount}else{f.order.pricing.discountTypeAmount=menuHelper.fullOrderDiscountDeal.FullOrderDiscountDeliveryAmount}f.order.pricing.discountAmount=cartHelper.cart().discountAmount();f.order.pricing.initialDiscountReason=cartHelper.cart().discountName()}if(viewModel.siteDetails().paymentProvider.toUpperCase()=="MERCURY"){f.paymentData=cartHelper.cart().mercuryPaymentId()}else{if(viewModel.siteDetails().paymentProvider.toUpperCase()=="DATACASHLIVE"||viewModel.siteDetails().paymentProvider.toUpperCase()=="DATACASHTEST"){f.paymentData=cartHelper.cart().dataCashPaymentDetails()}}var h=0;for(var e=0;e<cartHelper.cart().deals().length;e++){var b=cartHelper.cart().deals()[e];if(b.isEnabled()){var g={productId:b.deal.deal.Id,quantity:1,price:b.price,name:b.name,orderLineIndex:h,lineType:0,instructions:"",person:"",inDealFlag:false,addToppings:[],removeToppings:[]};f.order.orderLines.push(g);h++;for(var d=0;d<b.dealLines().length;d++){var c=b.dealLines()[d];var g={productId:c.selectedMenuItem.Id,quantity:1,price:c.price,name:c.name,orderLineIndex:h,lineType:0,instructions:c.instructions,person:c.person,inDealFlag:true,addToppings:[],removeToppings:[]};for(var m=0;m<c.displayToppings().length;m++){var l=c.displayToppings()[m];if(l.cartQuantity()<0){g.removeToppings.push({productId:l.topping.Id,quantity:1,name:l.topping.ToppingName,price:0})}else{if(l.cartQuantity()>0){g.addToppings.push({productId:l.topping.Id,quantity:l.cartQuantity(),name:l.topping.ToppingName,price:menuHelper.getToppingPrice(l.topping)*l.quantity})}}}f.order.orderLines.push(g);h++}}}for(var e=0;e<cartHelper.cart().cartItems().length;e++){var a=cartHelper.cart().cartItems()[e];if(a.isEnabled()){var g={productId:a.menuItem.Id==undefined?a.menuItem.MenuId:a.menuItem.Id,quantity:a.quantity(),price:a.price,name:a.name,orderLineIndex:h,lineType:1,instructions:a.instructions,person:a.person,inDealFlag:false,addToppings:[],removeToppings:[]};for(var m=0;m<a.displayToppings().length;m++){var l=a.displayToppings()[m];if(l.cartQuantity()<0){g.removeToppings.push({productId:l.topping.Id,quantity:1,name:l.topping.ToppingName,price:0})}else{if(l.cartQuantity()>0){g.addToppings.push({productId:l.topping.Id,quantity:l.cartQuantity(),name:l.topping.ToppingName,price:menuHelper.getToppingPrice(l.topping)*l.quantity})}}}f.order.orderLines.push(g);h++}}return f},checkoutSections:ko.observableArray(),getTemplateName:function(a){return a.templateName},nextButton:{displayText:ko.observable(""),action:"none"},backButton:{visible:ko.observable(false),displayText:ko.observable(""),action:"none"},nextButtonClicked:function(){if(checkoutHelper.nextButton.action!=undefined){if(checkoutHelper.nextButton.action=="placeorder"){checkoutHelper.placeOrder()}else{var a=checkoutHelper.checkoutSections()[Number(checkoutHelper.nextButton.action)-1];if(a.validate()){checkoutHelper.showCheckoutSection(Number(checkoutHelper.nextButton.action))}}}},backButtonClicked:function(){if(checkoutHelper.backButton.action!=undefined&&checkoutHelper.backButton.action!="none"){checkoutHelper.showCheckoutSection(Number(checkoutHelper.backButton.action))}},errors:{contactDetailsHasError:ko.observable(false),firstNameHasError:ko.observable(false),surnameHasError:ko.observable(false),telephoneHasError:ko.observable(false),emailHasError:ko.observable(false),deliveryTimeHasError:ko.observable(false),deliveryTimeError:ko.observable(false),addressHasError:ko.observable(false),roadNameHasError:ko.observable(false),townHasError:ko.observable(false),zipCodeHasError:ko.observable(false),addressMissingDetails:ko.observable(false),outOfDeliveryArea:ko.observable(false)},validateContactDetails:function(){checkoutHelper.errors.firstNameHasError(checkoutHelper.checkoutDetails.firstName().length==0);checkoutHelper.errors.surnameHasError(checkoutHelper.checkoutDetails.surname().length==0);checkoutHelper.errors.telephoneHasError(checkoutHelper.checkoutDetails.telephoneNumber().length==0);if(checkoutHelper.checkoutDetails.emailAddress().length==0){checkoutHelper.errors.emailHasError(false)}else{var a=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;checkoutHelper.errors.emailHasError(!a.test(checkoutHelper.checkoutDetails.emailAddress()))}checkoutHelper.errors.contactDetailsHasError(checkoutHelper.errors.firstNameHasError()||checkoutHelper.errors.surnameHasError()||checkoutHelper.errors.telephoneHasError()||checkoutHelper.errors.emailHasError());return !checkoutHelper.errors.contactDetailsHasError()},validateDeliveryTime:function(){checkoutHelper.errors.deliveryTimeError(checkoutHelper.checkoutDetails.wantedTime().mode==undefined);checkoutHelper.errors.deliveryTimeHasError(checkoutHelper.errors.deliveryTimeError());return !checkoutHelper.errors.deliveryTimeHasError()},validateAddress:function(){if(viewModel.siteDetails().address.country=="United Kingdom"){return checkoutHelper.validateUKAddress()}else{if(viewModel.siteDetails().address.country=="France"){return checkoutHelper.validateFrenchAddress()}else{return self.validateUKAddress()}}},validateUKAddress:function(){checkoutHelper.errors.roadNameHasError(checkoutHelper.checkoutDetails.address.roadName().length==0);checkoutHelper.errors.townHasError(checkoutHelper.checkoutDetails.address.town().length==0);checkoutHelper.errors.addressMissingDetails(checkoutHelper.errors.roadNameHasError()||checkoutHelper.errors.townHasError());var a=checkoutHelper.validatePostcode();checkoutHelper.errors.outOfDeliveryArea(!a);checkoutHelper.errors.zipCodeHasError(!a);checkoutHelper.errors.addressHasError(checkoutHelper.errors.addressMissingDetails()||checkoutHelper.errors.outOfDeliveryArea());return !checkoutHelper.errors.addressHasError()},validateFrenchAddress:function(){checkoutHelper.errors.roadNameHasError(checkoutHelper.checkoutDetails.address.roadName().length==0);checkoutHelper.errors.townHasError(checkoutHelper.checkoutDetails.address.town().length==0);checkoutHelper.errors.addressMissingDetails(checkoutHelper.errors.roadNameHasError()||checkoutHelper.errors.townHasError());checkoutHelper.errors.addressHasError(checkoutHelper.errors.addressMissingDetails());return !checkoutHelper.errors.addressHasError()},validate:function(){for(var a=0;a<checkoutHelper.checkoutSections().length;a++){var b=checkoutHelper.checkoutSections()[Number(a)];if(!b.validate()){if(guiHelper.isMobileMode()){var c=$("#"+b.id).offset().top;$(window).scrollTop(c)}else{checkoutHelper.showCheckoutSection(Number(b.index))}return false}}return true},validatePostcode:function(){var b=false;if(deliveryZoneHelper.deliveryZones()==undefined||deliveryZoneHelper.deliveryZones().length==0){b=true}else{var a=checkoutHelper.checkoutDetails.address.zipCode().replace(/\s+/g,"");b=deliveryZoneHelper.isInDeliveryZone(a)}return b},deliveryTimeChanged:function(){$("#deliveryTime").blur()},modifyOrder:function(){viewModel.resetOrderType();guiHelper.cartActions(guiHelper.cartActionsMenu);guiHelper.isCartLocked(false);if(guiHelper.isMobileMode()){guiHelper.isMobileMenuVisible(true);checkoutMenuHelper.hideMenu();guiHelper.showCart()}else{guiHelper.showMenuView("menuSectionsView")}setTimeout(function(){guiHelper.resize()},0)}};var checkoutMenuHelper={showMenu:function(a,b){if(guiHelper.isMobileMode()){checkoutMenuHelper.isVisible(true);checkoutMenuHelper.backTo(a);checkoutMenuHelper.isPlaceOrderEnabled(b)}},hideMenu:function(){if(guiHelper.isMobileMode()){checkoutMenuHelper.isVisible(false)}},isVisible:ko.observable(false),backTo:ko.observable("menu"),isPlaceOrderEnabled:ko.observable(true)};var cookieHelper={setCookie:function(b,c){var a=new Date();a.setTime(a.getTime()+(1*24*60*60*1000));document.cookie=b+"="+c+";expires="+a.toUTCString()},getCookie:function(a){var b=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)");return b?b[2]:null}};var dealHelper={returnToCart:false,mode:ko.observable("addDeal"),subscriptions:[],hasError:ko.observable(false),addToCart:function(){dealHelper.mode("addDeal");dealHelper.hasError(false);dealHelper.selectedDeal.name(this.deal.DealName);dealHelper.selectedDeal.description(this.deal.Description);dealHelper.selectedDeal.deal=this.deal;dealHelper.selectedDeal.bindableDealLines.removeAll();for(var c=0;c<this.dealLineWrappers.length;c++){var b=this.dealLineWrappers[c];var a={dealLineWrapper:b,itemWrappers:undefined,selectedItemWrapper:ko.observable(undefined),previouslySelectedItemWrapper:undefined,selectedMenuItem:undefined,hasError:ko.observable(false),toppings:undefined,instructions:"",person:"",id:"dl_"+c};var g=[];for(var e=0;e<b.items.length;e++){var d=b.items[e];var f={bindableDealLine:a,item:d,name:d.name};g.push(f)}a.itemWrappers=g;if(a.itemWrappers.length==1){a.selectedItemWrapper(a.itemWrappers[0]);a.selectedMenuItem=a.selectedItemWrapper().item.menuItems()[0];a.toppings=menuHelper.getItemToppings(a.selectedMenuItem)}dealHelper.selectedDeal.bindableDealLines.push(a)}dealPopupHelper.returnToCart=false;dealPopupHelper.showDealPopup("addDeal",true);setTimeout(function(){dealHelper.subscribeToDealLineChanges()},0)},subscribeToDealLineChanges:function(){for(var a=0;a<dealHelper.selectedDeal.bindableDealLines().length;a++){dealHelper.subscriptions.push(dealHelper.selectedDeal.bindableDealLines()[a].selectedItemWrapper.subscribe(dealHelper.selectedDealLineChanged))}},unSubscribeToDealLineChanges:function(){for(var a=0;a<dealHelper.subscriptions.length;a++){var b=dealHelper.subscriptions[a];b.dispose()}},selectedDeal:{name:ko.observable(""),description:ko.observable(""),bindableDealLines:ko.observableArray(),deal:undefined},selectedBindableDealLine:undefined,dealPopupCancel:function(){dealPopupHelper.hideDealPopup()},getDealLineTemplateName:function(a){return a==undefined?"popupDealLine-template":a.dealLineWrapper.templateName},selectedDealLineChanged:function(a){if(a.bindableDealLine!=undefined){a.bindableDealLine.toppings=undefined;a.bindableDealLine.menuItem=undefined;a.bindableDealLine.selectedMenuItem=undefined;dealHelper.showToppingsPopupForDealLine(a.bindableDealLine,"addDealItem",true);$("#"+a.bindableDealLine.dealLineWrapper.id).blur()}},customizeDealLine:function(a){dealHelper.showToppingsPopupForDealLine(a,"addDealItem",false)},showToppingsPopupForDealLine:function(a,f,g){var h=a.selectedItemWrapper();if(h!=undefined&&h.name!=textStrings.pleaseSelectAnItem){dealHelper.unSubscribeToDealLineChanges();a.price=menuHelper.calculateDealLinePrice(h.bindableDealLine.dealLineWrapper.dealLine);dealHelper.selectedBindableDealLine=a;var e=a.selectedItemWrapper().item;if(a.selectedMenuItem==undefined){a.selectedMenuItem=e.menuItems()[0]}var b=helper.findById(a.selectedMenuItem.Cat1==undefined?a.selectedMenuItem.Category1:a.selectedMenuItem.Cat1,viewModel.menu.Category1);var c=helper.findById(a.selectedMenuItem.Cat2==undefined?a.selectedMenuItem.Category2:a.selectedMenuItem.Cat2,viewModel.menu.Category2);viewModel.selectedItem.name(e.name);viewModel.selectedItem.menuItems.removeAll();for(var d=0;d<e.menuItems().length;d++){viewModel.selectedItem.menuItems.push(e.menuItems()[d])}viewModel.selectedItem.description(e.description);viewModel.selectedItem.quantity(1);viewModel.selectedItem.menuItem(a.selectedMenuItem);viewModel.selectedItem.freeToppings(a.selectedMenuItem.FreeTops);viewModel.selectedItem.freeToppingsRemaining(a.selectedMenuItem.FreeTops);viewModel.selectedItem.instructions(a.instructions);viewModel.selectedItem.person(a.person);viewModel.selectedItem.price(helper.formatPrice(0));viewModel.ignoreEvents=true;viewModel.selectedItem.category1s.removeAll();for(var d=0;d<e.category1s().length;d++){viewModel.selectedItem.category1s.push(e.category1s()[d])}viewModel.selectedItem.category2s.removeAll();for(var d=0;d<e.category2s().length;d++){viewModel.selectedItem.category2s.push(e.category2s()[d])}viewModel.ignoreEvents=false;viewModel.selectedItem.selectedCategory1(b);viewModel.selectedItem.selectedCategory2(c);if(dealHelper.selectedBindableDealLine.toppings==undefined){viewModel.selectedItem.toppings(menuHelper.getItemToppings(viewModel.selectedItem.menuItem()))}else{viewModel.selectedItem.toppings(dealHelper.cloneToppings(dealHelper.selectedBindableDealLine.toppings))}if(g&&viewModel.selectedItem.toppings().length==0&&viewModel.selectedItem.category1s().length<2&&viewModel.selectedItem.category2s().length<2){popupHelper.commitToDeal()}else{dealPopupHelper.hideDealPopup();popupHelper.showPopup(f)}}},cloneToppings:function(d){var a=[];for(var c=0;c<d.length;c++){var e=d[c];var b={type:e.type,selectedSingle:ko.observable(e.selectedSingle()),selectedDouble:ko.observable(e.selectedDouble()),topping:e.topping,price:e.price,doublePrice:e.doublePrice,freeQuantity:e.freeQuantity,quantity:e.quantity,cartPrice:ko.observable(""),cartName:ko.observable(""),cartQuantity:ko.observable("")};a.push(b)}return a},acceptChanges:function(){dealPopupHelper.hideDealPopup()},commitToCart:function(){if(!dealHelper.checkForErrors()){if(dealHelper.selectedDeal.deal.ForceCheapestFree&&dealHelper.selectedDeal.dealLines().length>1){var g=dealHelper.selectedDeal.dealLines()[0];var h=dealHelper.selectedDeal.dealLines()[1];var i=menuHelper.calculateDealLinePrice(g,true);var j=menuHelper.calculateDealLinePrice(h,true);if(j>i){dealHelper.selectedDeal.dealLines.splice(0,1);dealHelper.selectedDeal.dealLines.splice(0,1);dealHelper.selectedDeal.dealLines.push(h);dealHelper.selectedDeal.dealLines.push(g)}}var f={name:dealHelper.selectedDeal.name(),price:0,displayPrice:ko.observable("-"),dealLines:ko.observableArray(),deal:{name:dealHelper.selectedDeal.name(),description:dealHelper.selectedDeal.description(),deal:dealHelper.selectedDeal.deal},minimumOrderValue:helper.formatPrice(dealHelper.selectedDeal.deal.MinimumOrderValue),minimumOrderValueNotMet:ko.observable(true),isEnabled:ko.observable()};for(var k=0;k<dealHelper.selectedDeal.bindableDealLines().length;k++){var a=dealHelper.selectedDeal.bindableDealLines()[k];var c=[];for(var m=0;m<a.toppings.length;m++){var l=a.toppings[m];var b={type:l.type,selectedSingle:ko.observable(l.selectedSingle()),selectedDouble:ko.observable(l.selectedDouble()),topping:l.topping,price:l.price,doublePrice:l.doublePrice,freeQuantity:l.freeQuantity,quantity:l.quantity,cartPrice:ko.observable(""),cartName:ko.observable(""),cartQuantity:ko.observable("")};c.push(b)}var d=helper.findById(a.selectedMenuItem.Cat1==undefined?a.selectedMenuItem.Category1:a.selectedMenuItem.Cat1,viewModel.menu.Category1);var e=helper.findById(a.selectedMenuItem.Cat2==undefined?a.selectedMenuItem.Category2:a.selectedMenuItem.Cat2,viewModel.menu.Category2);f.dealLines.push({name:cartHelper.getCartItemName(a.selectedItemWrapper().item,d,e),price:0,cartPrice:0,displayPrice:ko.observable("-"),dealLine:a.dealLineWrapper.dealLine,selectedMenuItem:a.selectedMenuItem,displayToppings:ko.observableArray(menuHelper.getCartDisplayToppings(c)),toppings:a.toppings,categoryPremiumName:ko.observable(undefined),categoryPremium:ko.observable(undefined),itemPremiumName:ko.observable(undefined),itemPremium:ko.observable(undefined),instructions:a.instructions,person:a.person})}cartHelper.cart().deals.push(f);cartHelper.refreshCart();dealPopupHelper.hideDealPopup();if(guiHelper.isMobileMode()){guiHelper.showCart()}}},removeFromCart:function(){cartHelper.cart().deals.remove(cartHelper.cart().selectedCartItem());cartHelper.refreshCart();dealPopupHelper.hideDealPopup()},checkForErrors:function(){var b=false;for(var c=0;c<dealHelper.selectedDeal.bindableDealLines().length;c++){var a=dealHelper.selectedDeal.bindableDealLines()[c];a.hasError(false);if(a.itemWrappers.length>0){if(a.selectedMenuItem==undefined){a.hasError(true);b=true}}}dealHelper.hasError(b);return b}};var dealPopupHelper={isBackgroundVisible:ko.observable(false),isPopupVisible:ko.observable(false),showDealPopup:function(a,b){if(b){$(window).scrollTop(0)}if(guiHelper.isMobileMode()){guiHelper.isViewVisible(false);guiHelper.isInnerMenuVisible(false)}dealHelper.mode(a);dealPopupHelper.isBackgroundVisible(true);dealPopupHelper.isPopupVisible(true)},hideDealPopup:function(){dealPopupHelper.isBackgroundVisible(false);dealPopupHelper.isPopupVisible(false);if(guiHelper.isMobileMode()){if(dealPopupHelper.returnToCart){guiHelper.isViewVisible(true);guiHelper.isInnerMenuVisible(false)}else{guiHelper.isViewVisible(false);guiHelper.isInnerMenuVisible(true)}}setTimeout(function(){guiHelper.resize()},0)},};var deliveryZoneHelper={deliveryZones:ko.observable(undefined),isInDeliveryZone:function(c){if(deliveryZoneHelper.deliveryZones()!=undefined){for(var a=0;a<deliveryZoneHelper.deliveryZones().length;a++){var b=deliveryZoneHelper.deliveryZones()[a];return c.toUpperCase().slice(0,b.length)==b.toUpperCase()}return false}}};var guiHelper={isMainMenuVisible:ko.observable(false),isCartLocked:ko.observable(false),isMobileMenuVisible:ko.observable(true),canChangeOrderType:ko.observable(false),cartActionsCheckout:"Checkout",cartActionsPayment:"Payment",cartActionsMenu:"Menu",cartActions:ko.observable("Menu"),isMobileMode:ko.observable(false),refreshIsMobileMode:function(){var a=$(window).width();if(Number(a)<settings.mobileWidth){guiHelper.isMobileMode(true);$("body").on("touchstart",function(b){b.stopPropagation();$(this).click()})}else{guiHelper.isMobileMode(false);settings.useSlideMenu=false}},isMenuBuilt:false,isViewVisible:ko.observable(true),isMenuVisible:ko.observable(false),isInnerMenuVisible:ko.observable(false),showHome:function(){mobileMenuHelper.title(textStrings.mmHome);mobileMenuHelper.titleClass("popupMobileMenuHomeButton");guiHelper.isMobileMenuVisible(true);guiHelper.showView("homeView");viewModel.resetOrderType();guiHelper.isMainMenuVisible(true);setTimeout(function(){mapHelper.initialiseMap()},0)},showCart:function(){$(window).scrollTop(0);guiHelper.showView("cartView")},showPostcodeCheck:function(){guiHelper.showView("postcodeCheckView");guiHelper.isMobileMenuVisible(true)},showSection:function(d,a){if(d!=undefined){d=typeof(d)=="number"?d:0;var c=viewModel.sections()[d];viewModel.selectedSection(c);viewModel.currentSectionIndex=d;viewModel.visibleSection(c.display.Name);for(var b=0;b<viewModel.sections().length;b++){if(b==d){$("#section"+b).css("display","block")}else{$("#section"+b).css("display","none")}}$("#sections").scrollTop(0)}else{if(a!=undefined){a()}}},showView:function(a){viewModel.viewName(a);if(a=="menuView"){guiHelper.isViewVisible(false);guiHelper.isMenuVisible(true)}else{guiHelper.isMenuVisible(false);guiHelper.isInnerMenuVisible(false);guiHelper.isViewVisible(true)}$(window).scrollTop(0)},showMenuView:function(a){guiHelper.isViewVisible(false);guiHelper.isMenuVisible(true);if(a=="menuSectionsView"){guiHelper.isInnerMenuVisible(true)}else{guiHelper.isInnerMenuVisible(false);viewModel.menuViewName(a)}},defaultWebErrorMessage:"",defaultInternalErrorMessage:"",defaultPaymentErrorMessage:"",showError:function(b,c,a){viewModel.error.message(b);viewModel.error.showReturn(c!=undefined);viewModel.error.returnCallback=c;guiHelper.showView("errorView")},errorReturn:function(){if(typeof(viewModel.error.returnCallback)==="function"){viewModel.error.returnCallback()}},showCheckoutAfterError:function(){cartHelper.checkout()},resize:function(){guiHelper.refreshIsMobileMode();var b=0;var a=$(window).width();var c=$("#"+css_menu).width();$("."+css_sections).css("width",c+"px");$("."+css_section).css("width",c+"px")},showStoreMenu:function(){try{if(settings.alwaysOnline){viewModel.isTakingOrders(true)}else{viewModel.isTakingOrders(viewModel.selectedSite().isOpen)}viewModel.menu=undefined;var b=cacheHelper.loadCachedMenuForSiteId(viewModel.selectedSite().siteId);viewModel.menu=b;guiHelper.showPleaseWait(textStrings.gettingStoreDetails,"0%",function(){var c=(viewModel.menu==undefined?-1:viewModel.selectedSite().menuVersion);acsapi.getSite(viewModel.selectedSite().siteId,c,function(d){try{viewModel.pleaseWaitMessage(textStrings.savingMenuToDevice);viewModel.pleaseWaitProgress("");setTimeout(function(){try{if(d==undefined||d.Menu==undefined){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,undefined)}else{if(d.Menu.MenuData!=undefined){var h=JSON.parse(d.Menu.MenuData);cacheHelper.cacheMenu(h);viewModel.menu=h}if(d.Menu.MenuDataThumbnails!=undefined){try{menuHelper.menuDataThumbnails=JSON.parse(d.Menu.MenuDataThumbnails)}catch(f){}}if(d.Menu.MenuDataExtended!=undefined){try{menuHelper.menuDataExtended=JSON.parse(d.Menu.MenuDataExtended)}catch(f){}}try{deliveryZoneHelper.deliveryZones(JSON.parse(d.DeliveryZones))}catch(f){}viewModel.siteDetails(d.Details);viewModel.pleaseWaitMessage(textStrings.loadingMenu);viewModel.pleaseWaitProgress("");setTimeout(function(){try{guiHelper.renderMenu(viewModel.menu,function(){if(settings.isHomePageDisabled){guiHelper.showMenu()}else{guiHelper.showHome()}})}catch(i){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,i)}},0)}}catch(g){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,g)}},0)}catch(e){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,e)}})})}catch(a){guiHelper.showError(textStrings.problemGettingSiteDetails,viewModel.storeSelected,a)}},showPleaseWait:function(b,c,a){viewModel.pleaseWaitMessage(b);viewModel.pleaseWaitProgress(c);guiHelper.showView("pleaseWaitView");if(typeof(a)=="function"){setTimeout(function(){a()},0)}},renderMenu:function(b,a){guiHelper.showPleaseWait(textStrings.renderingMenu,undefined,function(){viewModel.menu=b;if(viewModel.siteDetails().address.country=="United Kingdom"){viewModel.addressType("ukAddress-template")}else{if(viewModel.siteDetails().address.country=="United States"){viewModel.addressType("usAddress-template")}else{if(viewModel.siteDetails().address.country=="France"){viewModel.addressType("frenchAddress-template")}else{viewModel.addressType("genericAddress-template")}}}var d="";d+=viewModel.siteDetails().address.roadNum!=null&&viewModel.siteDetails().address.roadNum.length>0?viewModel.siteDetails().address.roadNum+" ":"";d+=viewModel.siteDetails().address.roadName!=null&&viewModel.siteDetails().address.roadName.length>0?viewModel.siteDetails().address.roadName+", ":"";d+=viewModel.siteDetails().address.org1!=null&&viewModel.siteDetails().address.org1.length>0?viewModel.siteDetails().address.org1+", ":"";d+=viewModel.siteDetails().address.org2!=null&&viewModel.siteDetails().address.org2.length>0?viewModel.siteDetails().address.org2+", ":"";d+=viewModel.siteDetails().address.org3!=null&&viewModel.siteDetails().address.org3.length>0?viewModel.siteDetails().address.org3+", ":"";d+=viewModel.siteDetails().address.prem1!=null&&viewModel.siteDetails().address.prem1.length>0?viewModel.siteDetails().address.prem1+", ":"";d+=viewModel.siteDetails().address.prem2!=null&&viewModel.siteDetails().address.prem2.length>0?viewModel.siteDetails().address.prem2+", ":"";d+=viewModel.siteDetails().address.prem3!=null&&viewModel.siteDetails().address.prem3.length>0?viewModel.siteDetails().address.prem3+", ":"";d+=viewModel.siteDetails().address.prem4!=null&&viewModel.siteDetails().address.prem4.length>0?viewModel.siteDetails().address.prem4+", ":"";d+=viewModel.siteDetails().address.prem5!=null&&viewModel.siteDetails().address.prem5.length>0?viewModel.siteDetails().address.prem5+", ":"";d+=viewModel.siteDetails().address.prem6!=null&&viewModel.siteDetails().address.prem6.length>0?viewModel.siteDetails().address.prem6+", ":"";d+=viewModel.siteDetails().address.locality!=null&&viewModel.siteDetails().address.locality.length>0?viewModel.siteDetails().address.locality+", ":"";d+=viewModel.siteDetails().address.town!=null&&viewModel.siteDetails().address.town.length>0?viewModel.siteDetails().address.town+", ":"";d+=viewModel.siteDetails().address.county!=null&&viewModel.siteDetails().address.county.length>0?viewModel.siteDetails().address.county+", ":"";d+=viewModel.siteDetails().address.state!=null&&viewModel.siteDetails().address.state.length>0?viewModel.siteDetails().address.state+", ":"";d+=viewModel.siteDetails().address.postcode!=null&&viewModel.siteDetails().address.postcode.length>0?viewModel.siteDetails().address.postcode+", ":"";if(d[d.length-2]==","){d=d.substr(0,d.length-2)}var e="";e+=viewModel.siteDetails().address.roadNum!=null&&viewModel.siteDetails().address.roadNum.length>0?viewModel.siteDetails().address.roadNum+" ":"";e+=viewModel.siteDetails().address.roadName!=null&&viewModel.siteDetails().address.roadName.length>0?viewModel.siteDetails().address.roadName+"<br />":"";e+=viewModel.siteDetails().address.org1!=null&&viewModel.siteDetails().address.org1.length>0?viewModel.siteDetails().address.org1+"<br />":"";e+=viewModel.siteDetails().address.org2!=null&&viewModel.siteDetails().address.org2.length>0?viewModel.siteDetails().address.org2+"<br />":"";e+=viewModel.siteDetails().address.org3!=null&&viewModel.siteDetails().address.org3.length>0?viewModel.siteDetails().address.org3+"<br />":"";e+=viewModel.siteDetails().address.prem1!=null&&viewModel.siteDetails().address.prem1.length>0?viewModel.siteDetails().address.prem1+"<br />":"";e+=viewModel.siteDetails().address.prem2!=null&&viewModel.siteDetails().address.prem2.length>0?viewModel.siteDetails().address.prem2+"<br />":"";e+=viewModel.siteDetails().address.prem3!=null&&viewModel.siteDetails().address.prem3.length>0?viewModel.siteDetails().address.prem3+"<br />":"";e+=viewModel.siteDetails().address.prem4!=null&&viewModel.siteDetails().address.prem4.length>0?viewModel.siteDetails().address.prem4+"<br />":"";e+=viewModel.siteDetails().address.prem5!=null&&viewModel.siteDetails().address.prem5.length>0?viewModel.siteDetails().address.prem5+"<br />":"";e+=viewModel.siteDetails().address.prem6!=null&&viewModel.siteDetails().address.prem6.length>0?viewModel.siteDetails().address.prem6+"<br />":"";e+=viewModel.siteDetails().address.locality!=null&&viewModel.siteDetails().address.locality.length>0?viewModel.siteDetails().address.locality+"<br />":"";e+=viewModel.siteDetails().address.town!=null&&viewModel.siteDetails().address.town.length>0?viewModel.siteDetails().address.town+"<br />":"";e+=viewModel.siteDetails().address.county!=null&&viewModel.siteDetails().address.county.length>0?viewModel.siteDetails().address.county+"<br />":"";e+=viewModel.siteDetails().address.state!=null&&viewModel.siteDetails().address.state.length>0?viewModel.siteDetails().address.state+"<br />":"";e+=viewModel.siteDetails().address.postcode!=null&&viewModel.siteDetails().address.postcode.length>0?viewModel.siteDetails().address.postcode+"<br />":"";switch(viewModel.siteDetails().address.country){case"Austria":case"Belgium":case"Cyprus":case"Germany":case"Estonia":case"Spain":case"Finland":case"France":case"Greece":case"Ireland":case"Italy":case"Luxembourg":case"Malta":case"Netherlands":case"Monaco":case"Portugal":case"Slovakia":case"Slovenia":case"Holy See (Vatican City State)":case"San Marino":helper.useCommaDecimalPoint=true;helper.curencyAfter=true;helper.use24hourClock=true;helper.currencySymbol="&euro;";break;case"Canada":case"Australia":case"New Zealand":case"United States":helper.useCommaDecimalPoint=false;helper.currencySymbol="$";break;case"Russian Federation":helper.useCommaDecimalPoint=false;helper.currencySymbol="?";break;default:helper.useCommaDecimalPoint=false;helper.currencySymbol="&pound;";break}openingTimesHelper.getToday();openingTimesHelper.getOpeningHours(openingTimesHelper.openingTimes.monday,"Monday");openingTimesHelper.getOpeningHours(openingTimesHelper.openingTimes.tuesday,"Tuesday");openingTimesHelper.getOpeningHours(openingTimesHelper.openingTimes.wednesday,"Wednesday");openingTimesHelper.getOpeningHours(openingTimesHelper.openingTimes.thursday,"Thursday");openingTimesHelper.getOpeningHours(openingTimesHelper.openingTimes.friday,"Friday");openingTimesHelper.getOpeningHours(openingTimesHelper.openingTimes.saturday,"Saturday");openingTimesHelper.getOpeningHours(openingTimesHelper.openingTimes.sunday,"Sunday");var g=openingTimesHelper.getTodaysOpeningTimes();if(g.length==0&&!settings.alwaysOnline){viewModel.isTakingOrders(false)}viewModel.displayAddress(d);viewModel.displayAddressMultiLine(e);viewModel.sections.removeAll();for(var f=0;f<viewModel.menu.Display.length;f++){var c=viewModel.menu.Display[f];c.displayOrder=f+1}menuHelper.fixNames();menuHelper.buildItemLookup();menuHelper.buildDealLookup();menuHelper.lookupItemImages();menuHelper.lookupItemExtensions();menuHelper.lookupDealExtensions();menuHelper.buildDealsSection();menuHelper.buildItemsSections(function(){viewModel.visibleSection(viewModel.sections()[0].display.Name);a()})})},showMenu:function(a){var b=new Date();mobileMenuHelper.title(textStrings.mmOrderNow);mobileMenuHelper.titleClass("popupMobileMenuOrderNowButton");guiHelper.isMainMenuVisible(true);guiHelper.showMenuView("menuSectionsView");guiHelper.isMobileMenuVisible(true);viewModel.resetOrderType();guiHelper.cartActions(guiHelper.cartActionsMenu);guiHelper.isCartLocked(false);setTimeout(function(){var d=new Date();var c=Math.abs(d-b);guiHelper.resize();guiHelper.showSection(typeof(a)=="number"?a:undefined,function(){viewModel.timer=new Date();d=new Date();var e=Math.abs(d-b)})},0)},selectedItemChanged:function(a,c){if(a!=undefined){var b=menuHelper.getSelectedMenuItem(a);if(b!=undefined){var d=(typeof(a.quantity)=="function"?a.quantity():a.quantity);var e=(typeof(a.toppings)=="function"?a.toppings():undefined);a.price(helper.formatPrice(menuHelper.calculateItemPrice(b,d,e)))}}},showMenuSection:function(){if(guiHelper.isMobileMode()){mobileMenuHelper.showMenu(this.Index)}else{viewModel.selectedSection(this);guiHelper.showMenu(this.Index)}},enableUI:function(a){var c=$("#viewContainer");guiHelper.enableDisableElement(c,a);var b=$("#menuSection");guiHelper.enableDisableElement(b,a)},enableDisableElement:function(a,b){if(b){a.find("*").removeClass("disabled")}else{a.find("*").addClass("disabled")}}};var helper={markOfflineStores:function(){for(var b=0;b<viewModel.sites().length;b++){var c=viewModel.sites()[b];var a=c.name;if(!c.isOpen){a+=textStrings.appendOffline}c.displayText=ko.observable(a)}},newOrder:function(){if(settings.returnToParentWebsiteAfterOrder){viewModel.returnToHostWebsite()}else{checkoutHelper.clearCheckout();cartHelper.clearCart();guiHelper.showHome()}},formatUTCDate:function(a){return a.getUTCFullYear()+"-"+helper.pad(a.getUTCMonth()+1)+"-"+helper.pad(a.getUTCDate())+"T"+helper.pad(a.getUTCHours())+":"+helper.pad(a.getUTCMinutes())+":"+helper.pad(a.getUTCSeconds())+"Z"},formatUTCSlot:function(e){var b=e.indexOf(":");var c=e.substring(0,b);var d=e.substring(b+1);var f=new Date();f.setHours(c);f.setMinutes(d);var a=helper.formatUTCDate(f);return a},pad:function(a){if((typeof(a)=="number"&&a<10)||(typeof(a)=="string"&&a.length==1)){return"0"+a}else{return a}},formatPrice:function(a){if(a==undefined){if(helper.curencyAfter){return"- "+helper.currencySymbol}else{return helper.currencySymbol+" -"}}else{var b=Number(a);var c=b/100;var a=undefined;if(helper.curencyAfter){a=c.toFixed(2)+helper.currencySymbol}else{a=helper.currencySymbol+c.toFixed(2)}if(helper.useCommaDecimalPoint){a=a.replace(".",",")}return a}},currencySymbol:"&pound;",useCommaDecimalPoint:false,curencyAfter:false,use24hourClock:false,findById:function(a,d){for(var b=0;b<d.length;b++){var c=d[b];if(c.Id==a){return c}}return undefined},findCategory:function(b,a){for(var d=0;d<a().length;d++){var c=a()[d];if(c.Name==b.Name){return true}}return false},findByMenuId:function(a,d){for(var b=0;b<d.length;b++){var c=d[b];if((c.Id==undefined?c.MenuId:c.Id)==a){return c}}return undefined}};var imageHelper={isPopupVisible:ko.observable(false),topOffset:ko.observable(false),leftOffset:ko.observable(false),image:ko.observable({Src:"",Height:130,Width:130}),showPopup:function(a){imageHelper.image(a.image);if(guiHelper.isMobileMode()){$(window).scrollTop(0);guiHelper.showView("imageView");mobileMenuHelper.isMobileMenuVisible(false)}else{imageHelper.topOffset("-"+(a.image.Height/2)+"px");imageHelper.leftOffset("-"+(a.image.Width/2)+"px");popupHelper.isBackgroundVisible(true);imageHelper.isPopupVisible(true)}},hidePopup:function(){if(guiHelper.isMobileMode()){mobileMenuHelper.isMobileMenuVisible(true);guiHelper.showMenu(undefined)}else{popupHelper.isBackgroundVisible(false);imageHelper.isPopupVisible(false)}}};var mapHelper={map:undefined,storeMarker:undefined,markersLayer:undefined,urls:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],initialiseMap:function(){try{mapHelper.map=new OpenLayers.Map({div:"map",layers:[new OpenLayers.Layer.XYZ("OSM (with buffer)",mapHelper.urls,{transitionEffect:"resize",buffer:2,sphericalMercator:true,attribution:""}),new OpenLayers.Layer.XYZ("OSM (without buffer)",mapHelper.urls,{transitionEffect:"resize",buffer:0,sphericalMercator:true,attribution:""})],controls:[new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:true}}),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.Attribution()],center:[0,0],zoom:3});var b=new OpenLayers.Projection("EPSG:4326");var g=new OpenLayers.Projection("EPSG:900913");var f=OpenLayers.Util.getParameters(window.location.href).renderer;f=(f)?[f]:OpenLayers.Layer.Vector.prototype.renderers;var h=new OpenLayers.Projection("EPSG:4326");mapHelper.markersLayer=new OpenLayers.Layer.Vector("Markers",{styleMap:new OpenLayers.StyleMap({externalGraphic:settings.mapMarker,graphicOpacity:1,graphicWidth:32,graphicHeight:37,graphicYOffset:-37}),projection:h});window.mapped="yes";mapHelper.map.addLayer(mapHelper.markersLayer);var d=0;if(viewModel.siteDetails().address["long"]==undefined){d=viewModel.siteDetails().address.longitude}else{d=viewModel.siteDetails().address["long"]}var c=viewModel.siteDetails().address.lat==undefined?viewModel.siteDetails().address.latitude:viewModel.siteDetails().address.lat;mapHelper.setStoreMarker(d,c);var e=new OpenLayers.LonLat(d,c).transform(b,g);mapHelper.map.setCenter(e,17)}catch(a){}},setStoreMarker:function(f,c){if(typeof(mapHelper.storeMarker)=="object"){mapHelper.markersLayer.removeAllFeatures();mapHelper.markersLayer.destroyFeatures();mapHelper.storeMarker=undefined}var b=new OpenLayers.Projection("EPSG:4326");var i=new OpenLayers.Projection("EPSG:900913");var g=new OpenLayers.LonLat(f,c).transform(b,i);mapHelper.storeMarker={type:"Feature",geometry:{type:"Point",coordinates:[g.lon,g.lat]}};var a={type:"FeatureCollection",features:[mapHelper.storeMarker]};var h=new OpenLayers.Format.GeoJSON();var e=h.read(a);mapHelper.markersLayer.addFeatures(e);var d=new OpenLayers.Bounds();d.extend(new OpenLayers.LonLat(f,c).transform(b,i))}};function MenuHelper(){var a=this;a.menuDataThumbnails=undefined;a.menuDataExtended=undefined;a.fixName=function(b){if(b==undefined){return""}return b.replace("&#146;","'")};a.refreshItemPrices=function(){for(var f=0;f<viewModel.sections().length;f++){var e=viewModel.sections()[f];if(e.items!=undefined){for(var c=0;c<e.items().length;c++){var b=e.items()[c];b.price(helper.formatPrice(menuHelper.getItemPrice(b.menuItem)));b.isEnabled(menuHelper.isItemEnabledForMenu(b.menuItem));if(b.toppings!=undefined){for(var h=0;h<b.toppings().length;h++){var g=b.toppings()[c];var d=menuHelper.getToppingPrice(g);g.price(helper.formatPrice(d));g.doublePrice(helper.formatPrice(d*2))}}}}}};a.refreshDealsAvailabilty=function(){for(var b=0;b<viewModel.deals().length;b++){var c=viewModel.deals()[b];c.isEnabled(menuHelper.isDealItemEnabledForMenu(c.deal))}};a.calculateItemPrice=function(d,f,k,b,g){var e=menuHelper.getItemPrice(d);if(e==undefined){return}if(k!=undefined){var j=[];for(var c=0;c<k.length;c++){var h=k[c];if(g){h.freeQuantity=0}menuHelper.calculateToppingPrice(h,j)}if(d.FreeTops>0){if(j.length>d.FreeTops){j.sort(function(l,m){return l.price-m.price});for(var c=0;c<d.FreeTops;c++){j[c].toppingWrapper.freeQuantity++}for(var c=d.FreeTops;c<j.length;c++){var i=j[c];if(b){e+=i.price}}}else{for(var c=0;c<k.length;c++){var h=k[c];h.freeQuantity=h.quantity}}}else{for(var c=0;c<j.length;c++){var i=j[c];if(b){e+=i.price}}}}e=e*f;return e};a.calculateToppingPrice=function(d,c){var b=0;if(d.type=="removable"){if(d.selectedDouble()&&d.freeQuantity==0){b=(menuHelper.getToppingPrice(d.topping));if(c!=undefined&&b>0){c.push({price:menuHelper.getToppingPrice(d.topping),toppingWrapper:d})}}}else{if(d.selectedSingle()){if(d.freeQuantity==0){b=menuHelper.getToppingPrice(d.topping);if(c!=undefined&&b>0){c.push({price:menuHelper.getToppingPrice(d.topping),toppingWrapper:d})}}}else{if(d.selectedDouble()){b=(menuHelper.getToppingPrice(d.topping)*(2-d.freeQuantity));if(c!=undefined&&b>0){if(d.freeQuantity<=1){c.push({price:menuHelper.getToppingPrice(d.topping),toppingWrapper:d})}if(d.freeQuantity==0){c.push({price:menuHelper.getToppingPrice(d.topping),toppingWrapper:d})}}}}}return b};a.calculateDealItemPrice=function(e,k,g){var f=0;var b=helper.findById(e.Cat1==undefined?e.Category1:e.Cat1,viewModel.menu.Category1);var c=helper.findById(e.Cat2==undefined?e.Category2:e.Cat2,viewModel.menu.Category2);f+=((b==undefined?0:b.DealPremium)+(c==undefined?0:c.DealPremium));f+=e.DealPricePremiumOverride==0?e.DealPricePremium:e.DealPricePremiumOverride;if(k!=undefined){var j=[];for(var d=0;d<k.length;d++){var h=k[d];if(g){h.freeQuantity=0}menuHelper.calculateToppingPrice(h,j)}if(e.FreeTops>0){if(j.length>e.FreeTops){j.sort(function(l,m){return l.price-m.price});for(var d=0;d<e.FreeTops;d++){j[d].toppingWrapper.freeQuantity++}for(var d=e.FreeTops;d<j.length;d++){var i=j[d];f+=i.price}}else{for(var d=0;d<k.length;d++){var h=k[d];h.freeQuantity=h.quantity}}}else{for(var d=0;d<j.length;d++){var i=j[d];f+=i.price}}}return f};a.calculateDealLinePrice=function(c,e){var g=0;if(c.selectedMenuItem!=undefined){var b=menuHelper.getItemPrice(c.selectedMenuItem);if(e!=undefined&&e==true){g=b}else{switch(c.dealLine.Type){case"Fixed":g=menuHelper.getDealLinePrice(c);break;case"Discount":var d=menuHelper.getDealLinePrice(c);g=b-d;if(g<0){g=0}break;case"Percentage":var f=menuHelper.getDealLinePrice(c)/100;g=b*f;break}}}return g};a.getItemPrice=function(b){if(viewModel.orderType().toLowerCase()=="delivery"){return b.DelPrice==undefined?b.DeliveryPrice:b.DelPrice==undefined?b.DeliveryPrice:b.DelPrice}else{return b.ColPrice==undefined?b.CollectionPrice:b.ColPrice==undefined?b.CollectionPrice:b.ColPrice}};a.getDealLinePrice=function(b){if(viewModel.orderType().toLowerCase()=="delivery"){return b.dealLine.DelAmount==undefined?b.dealLine.DeliveryAmount:b.dealLine.DelAmount}else{return b.dealLine.ColAmount==undefined?b.dealLine.CollectionAmount:b.dealLine.ColAmount}};a.getToppingPrice=function(b){if(viewModel.orderType().toLowerCase()=="delivery"){return b.DelPrice==undefined?b.DeliveryPrice:b.DelPrice}else{return b.ColPrice==undefined?b.CollectionPrice:b.ColPrice}};a.isItemAvailable=function(b){if((viewModel.orderType().toLowerCase()=="delivery"&&b.DelPrice==undefined&&b.DeliveryPrice==undefined)||(viewModel.orderType().toLowerCase()=="collection"&&b.ColPrice==undefined&&b.CollectionPrice==undefined)){return false}else{return true}};a.isDealAvailable=function(b){if((viewModel.orderType()=="delivery"&&b.ForDelivery!=true)||(viewModel.orderType()=="collection"&&b.ForCollection!=true)){return false}else{return true}};a.areDeals=function(){return viewModel.menu==undefined?false:(viewModel.menu.Deals!=undefined&&viewModel.menu.Deals.length>0)};a.getTemplateName=function(b){return b.templateName};a.getSelectedMenuItem=function(d){if(d.menuItems().length==1){return d.menuItems()[0]}else{for(var c=0;c<d.menuItems().length;c++){var b=d.menuItems()[c];if((d.selectedCategory1()==undefined||d.selectedCategory1().Id==(b.Cat1==undefined?b.Category1:b.Cat1))&&(d.selectedCategory2()==undefined||d.selectedCategory2().Id==(b.Cat2==undefined?b.Category2:b.Cat2))){return b}}}};a.menuItemLookup=undefined;a.dealLookup=undefined;a.dealSectionCount=0;a.buildDealsSection=function(){viewModel.deals.removeAll();if(menuHelper.areDeals()){var l=[];for(var e=0;e<viewModel.menu.Deals.length;e++){var d=viewModel.menu.Deals[e];var i=[];for(var g=0;g<d.DealLines.length;g++){var f=d.DealLines[g];var h={itemNo:g+1,dealLine:f,templateName:"",items:[],id:"dl_"+g+1};if(f.AllowableItemsIds!=undefined&&f.AllowableItemsIds.length>1){h.templateName="popupDealLinePicker-template";h.items.push({menuItem:undefined,name:textStrings.pleaseSelectAnItem});menuHelper.addItemsToDealLine(h)}else{if(f.AllowableItemsIds!=undefined&&f.AllowableItemsIds.length==1){menuHelper.addItemsToDealLine(h);h.templateName="popupDealLineFixed-template"}else{h.templateName="popupDealLine-template"}}i.push(h)}var n=true;var b=d.AvailableTimes[openingTimesHelper.todayPropertyName];if(b!=undefined&&b!=null&&b.length==1){if(b[0].NotAvailableToday){n=false}}var m={deal:d,isEnabled:ko.observable(menuHelper.isDealItemEnabledForMenu(d)),isAvailableToday:n,dealLineWrappers:i,minimumOrderValue:d.MinimumOrderValue>0?helper.formatPrice(d.MinimumOrderValue):""};viewModel.deals.push(m);var o=menuHelper.dealLookup[d.Id];var r=undefined;if(o.extension!=undefined){if(o.extension.moveToSection!=undefined){r=o.extension.moveToSection}}if(r==undefined){r=textStrings.dealsSection}var j=undefined;for(var q=0;q<l.length;q++){var c=l[q];if(c.name==r){j=c;break}}if(j==undefined){j={name:r,deals:[]};l.push(j)}j.deals.push(m)}for(var k=0;k<l.length;k++){var j=l[k];var p={templateName:"dealsSection-template",display:{Name:j.name,displayOrder:k},deals:j.deals,Index:viewModel.sections().length,Left:ko.observable(0)};viewModel.sections.push(p)}menuHelper.dealSectionCount=l.length}};a.addItemsToDealLine=function(g){for(var i=0;i<g.dealLine.AllowableItemsIds.length;i++){var k=g.dealLine.AllowableItemsIds[i];var l=menuHelper.menuItemLookup[k];if(l!=undefined){var j=viewModel.menu.ItemNames[l.menuItem.Name==undefined?l.menuItem.ItemName:l.menuItem.Name];var h=undefined;for(var f=0;f<g.items.length;f++){var e=g.items[f];if(e.name==j){h=e;break}}if(h==undefined){h={name:j,isEnabled:ko.observable(menuHelper.isItemEnabledForMenu(l.menuItem)),displayOrder:l.menuItem.DispOrder,description:menuHelper.fixName(l.menuItem.Desc==undefined?l.menuItem.Description:l.menuItem.Desc),category1s:ko.observableArray(),category2s:ko.observableArray(),menuItems:ko.observableArray(),selectedCategory1:ko.observable(),selectedCategory2:ko.observable(),price:ko.observable(helper.formatPrice(menuHelper.getItemPrice(l.menuItem))),quantity:1,selectedMenuItem:undefined};g.items.push(h)}var b=l.menuItem.Cat1==undefined?l.menuItem.Category1:l.menuItem.Cat1;if(b!=undefined&&b!=-1){var d=helper.findById(b,viewModel.menu.Category1);if(d!=undefined&&!helper.findCategory(d,h.category1s)){h.category1s.push(d)}}var c=l.menuItem.Cat2==undefined?l.menuItem.Category2:l.menuItem.Cat2;if(c!=undefined&&c!=-1){var d=helper.findById(c,viewModel.menu.Category2);if(d!=undefined&&!helper.findCategory(d,h.category2s)){h.category2s.push(d)}}h.menuItems.push(l.menuItem)}}};a.buildItemLookup=function(){menuHelper.menuItemLookup={};for(var b=0;b<viewModel.menu.Items.length;b++){var c=viewModel.menu.Items[b];menuHelper.menuItemLookup[c.Id==undefined?c.MenuId:c.Id]={name:viewModel.menu.ItemNames[c.Name==undefined?c.ItemName:c.Name],menuItem:c,thumbnailHeight:0,thumbnailWidth:0,thumbnail:undefined,image:undefined,overlayImage:undefined,extension:undefined}}};a.buildDealLookup=function(){menuHelper.dealLookup={};for(var c=0;c<viewModel.menu.Deals.length;c++){var b=viewModel.menu.Deals[c];menuHelper.dealLookup[b.Id]={extension:undefined,deal:b,thumbnailHeight:0,thumbnailWidth:0,thumbnail:undefined,image:undefined,overlayImage:undefined}}};a.lookupItemImages=function(){if(menuHelper.menuDataThumbnails!=undefined){if(menuHelper.menuDataThumbnails.MenuItemThumbnails!=undefined){for(var c=0;c<menuHelper.menuDataThumbnails.MenuItemThumbnails.length;c++){var b=menuHelper.menuDataThumbnails.MenuItemThumbnails[c];if(b.Height<=130&&b.Width<=130){if(b.ItemIds!=undefined){for(var d=0;d<b.ItemIds.length;d++){var f=b.ItemIds[d];var e=menuHelper.menuItemLookup[f];if(e!=null){if(e.thumbnail==undefined||(b.Height>e.thumbnail.Height&&b.Width>e.thumbnail.Width)){e.thumbnail=b;e.thumbnailWidth=e.thumbnail.Width;e.thumbnailHeight=e.thumbnail.Height}}}}}else{if(b.Height>=130&&b.Width>=130&&b.Height<=800&&b.Width<=800){if(b.ItemIds!=undefined){for(var d=0;d<b.ItemIds.length;d++){var f=b.ItemIds[d];var e=menuHelper.menuItemLookup[f];if(e!=null){if(e.image==undefined||(b.Height>e.image.Height&&b.Width>e.image.Width)){e.image=b}}}}}}}}}};a.lookupItemExtensions=function(){if(menuHelper.menuDataExtended!=undefined){if(menuHelper.menuDataExtended.items!=undefined){for(var b=0;b<menuHelper.menuDataExtended.items.length;b++){var d=menuHelper.menuDataExtended.items[b];var c=menuHelper.menuItemLookup[d.id];if(c!=undefined){c.extension=d;if(d.tags!=undefined){for(var f=0;f<d.tags.length;f++){var e=d.tags[f];if(settings.menuItemOverlayTag!=undefined&&e.toLowerCase()==settings.menuItemOverlayTag.toLowerCase()){c.overlayImage=true;break}}}}}}}};a.lookupDealExtensions=function(){if(menuHelper.menuDataExtended!=undefined&&menuHelper.dealLookup){if(menuHelper.menuDataExtended.deals!=undefined){for(var d=0;d<menuHelper.menuDataExtended.deals.length;d++){var c=menuHelper.menuDataExtended.deals[d];var b=menuHelper.dealLookup[c.id];if(b!=undefined){b.extension=c}}}}};a.fixNames=function(){for(var f=0;f<viewModel.menu.ItemNames.length;f++){viewModel.menu.ItemNames[f]=menuHelper.fixName($.trim(viewModel.menu.ItemNames[f]))}for(var e=0;e<viewModel.menu.Items.length;e++){var d=viewModel.menu.Items[e];if(d.Description!=undefined){d.Description=menuHelper.fixName($.trim(d.Description))}else{d.Desc=menuHelper.fixName($.trim(d.Desc))}}for(var h=0;h<viewModel.menu.Toppings.length;h++){var g=viewModel.menu.Toppings[h];if(g.Name!=undefined){g.Name=menuHelper.fixName($.trim(g.Name))}else{g.ToppingName=menuHelper.fixName($.trim(g.ToppingName))}}for(var c=0;c<viewModel.deals.length;c++){var b=viewModel.deals[c];b.DealName=menuHelper.fixName($.trim(b.DealName));b.Description=menuHelper.fixName($.trim(b.Description))}};a.buildItemsSections=function(b){var j=[];for(var c=0;c<viewModel.menu.Items.length;c++){var g=viewModel.menu.Items[c];menuHelper.addItemToSection(j,g)}var k=[];for(var i=0;i<j.length;i++){var h=j[i];var e=false;for(var f=0;f<k.length;f++){var d=k[f];if(h.display.displayOrder<d.display.displayOrder){k.splice(f,0,h);e=true;break}}if(!e){h.Index=k.length;k.push(h)}}for(var i=0;i<k.length;i++){var h=k[i];h.Index=i+menuHelper.dealSectionCount}menuHelper.commitSection(0,k,function(){menuHelper.sortItemSections();b()})};a.commitSection=function(c,f,b){if(c>=f.length){b()}else{var e=f[c];viewModel.sections.push(e);var d=Math.round(((c+1)/f.length)*100);viewModel.pleaseWaitProgress(d+"%");setTimeout(function(){menuHelper.commitSection(c+1,f,b)},0)}};a.addItemToSection=function(q,m){var g=helper.findById(m.Display,viewModel.menu.Display);if(g.Name.toUpperCase()=="DEALSONLY"){return}var o=undefined;for(var p=0;p<q.length;p++){var f=q[p];if(f==undefined||f.display==undefined||m.Display==undefined){return}else{if(f.display.displayId==m.Display){o=f;break}}}if(g==undefined){g={Name:"?"}}if(o==undefined){g.displayOrder=menuHelper.dealSectionCount+g.displayOrder;g.displayId=m.Display;o={templateName:"menuSection-template",display:g,items:ko.observableArray(),Index:undefined,Left:ko.observable(0)};q.push(o)}var n=viewModel.menu.ItemNames[m.Name==undefined?m.ItemName:m.Name];var k=n;var i=undefined;var b=m.Cat1==undefined?m.Category1:m.Cat1;if(b!=undefined&&b!=-1){i=helper.findById(b,viewModel.menu.Category1);if(i!=undefined&&settings.invertItems){k=menuHelper.fixName($.trim(i.Name))}}var h=undefined;for(var j=0;j<o.items().length;j++){var e=o.items()[j];if(e.name==k){h=e;break}}if(h==undefined){h={name:k,isEnabled:ko.observable(menuHelper.isItemEnabledForMenu(m)),menuItem:m,displayOrder:m.DispOrder,description:menuHelper.fixName(m.Desc==undefined?m.Description:m.Desc),category1s:ko.observableArray(),category2s:ko.observableArray(),menuItems:ko.observableArray(),selectedCategory1:ko.observable(),selectedCategory2:ko.observable(),price:ko.observable(helper.formatPrice(menuHelper.getItemPrice(m))),quantity:1,isAvailableForDelivery:function(){return viewModel.orderType()=="delivery"&&this.DelPrice==undefined&&this.DeliveryPrice==undefined},isAvailableForCollection:function(){return viewModel.orderType()=="collection"&&this.ColPrice==undefined&&this.CollectionPrice==undefined},thumbnail:undefined,thumbnailWidth:0,thumbnailHeight:0,image:undefined,overlayImage:undefined};o.items.push(h)}if(settings.showMenuIds){h.description+=" "+m.Id}if(i!=undefined&&settings.invertItems){i={Id:i.Id,Name:n,AddHAndHCat:i.AddHAndHCat,DealPremium:i.DealPremium,Parent:i.Parent}}if(i!=undefined&&!helper.findCategory(i,h.category1s)){h.category1s.push(i)}var c=m.Cat2==undefined?m.Category2:m.Cat2;if(c!=undefined&&c!=-1){var d=helper.findById(c,viewModel.menu.Category2);if(d!=undefined&&!helper.findCategory(d,h.category2s)){h.category2s.push(d)}}h.menuItems.push(m);if(h.thumbnail==undefined||h.image==undefined){var l=menuHelper.menuItemLookup[m.MenuId==undefined?m.Id:m.MenuId];h.thumbnail=l.thumbnail;h.thumbnailWidth=l.thumbnailWidth;h.thumbnailHeight=l.thumbnailHeight;h.image=l.image}if(h.overlayImage==undefined||h.overlayImage==undefined){var l=menuHelper.menuItemLookup[m.MenuId==undefined?m.Id:m.MenuId];h.overlayImage=l.overlayImage}};a.sortItemSections=function(){for(var c=0;c<viewModel.sections().length;c++){var b=viewModel.sections()[c];if(b.items!=undefined){b.items.sort(menuHelper.sortByDisplayOrder)}}};a.sortByDisplayOrder=function(c,d){return Number(c.displayOrder)>Number(d.displayOrder)?1:-1};a.isItemEnabledForMenu=function(b){return menuHelper.isItemAvailable(b)};a.isDealItemEnabledForMenu=function(b){return menuHelper.isDealAvailable(b)};a.isItemEnabledForCart=function(b){return menuHelper.isItemAvailable(b)};a.isDealItemEnabledForCart=function(b){return menuHelper.isDealAvailable(b.deal.deal)&&!b.minimumOrderValueNotMet()};a.getItemToppings=function(d){var g=[];for(var c=0;c<d.DefTopIds.length;c++){var b=d.DefTopIds[c];var f=helper.findByMenuId(b,viewModel.menu.Toppings);var e=menuHelper.getToppingPrice(f);var h={type:"removable",selectedSingle:ko.observable(true),selectedDouble:ko.observable(false),topping:f,price:helper.formatPrice(0),doublePrice:helper.formatPrice(e),cartPrice:f.price,quantity:ko.observable(1)};menuHelper.addTopping(h,g)}for(var c=0;c<d.OptTopIds.length;c++){var b=d.OptTopIds[c];var f=helper.findByMenuId(b,viewModel.menu.Toppings);var e=menuHelper.getToppingPrice(f);var h={type:"additional",selectedSingle:ko.observable(false),selectedDouble:ko.observable(false),topping:f,price:helper.formatPrice(e),doublePrice:helper.formatPrice(e*2),cartPrice:f.price,quantity:ko.observable(0)};menuHelper.addTopping(h,g)}g.sort(function(i,k){var j=(i.ToppingName==undefined?(i.topping.Name==undefined?i.topping.ToppingName:i.topping.Name):i.ToppingName).toLowerCase();var l=(k.ToppingName==undefined?(k.topping.Name==undefined?k.topping.ToppingName:k.topping.Name):k.ToppingName).toLowerCase();if(j<l){return -1}else{if(j>l){return 1}else{return 0}}});return g};a.addTopping=function(e,f){var c=false;for(var d=0;d<f.length;d++){var b=f[d];if((b.topping.Id==undefined?b.topping.MenuId:b.topping.Id)==(e.topping.Id==undefined?e.topping.MenuId:e.topping.Id)){c=true;break}}if(!c){f.push(e)}};a.getCartDisplayToppings=function(e){var b=[];var f=0;for(var c=0;c<e.length;c++){var d=e[c];if(d.type=="removable"){if(!d.selectedSingle()&&!d.selectedDouble()){d.cartName(textStrings.prefixRemove+(d.topping.Name==undefined?d.topping.ToppingName:d.topping.Name));d.cartPrice(helper.formatPrice(0));d.cartQuantity("-1");b.push(d)}else{if(d.selectedDouble()){d.cartName(textStrings.prefixAddTopping+(d.topping.Name==undefined?d.topping.ToppingName:d.topping.Name));d.cartPrice(helper.formatPrice(menuHelper.getToppingPrice(d.topping)*d.quantity));d.cartQuantity(d.quantity);b.push(d)}}}else{if(d.selectedSingle()||d.selectedDouble()){d.cartName((d.selectedDouble()?textStrings.prefixAddDoubleTopping:textStrings.prefixAddTopping)+(d.topping.Name==undefined?d.topping.ToppingName:d.topping.Name));d.cartPrice(helper.formatPrice(menuHelper.getToppingPrice(d.topping)*d.quantity));d.cartQuantity(d.quantity);b.push(d)}}}return b};a.getCartItemDisplayName=function(c){var b=c.quantity()+" x ";if(c.selectedCategory1()!=undefined){b+=c.selectedCategory1().Name}if(c.selectedCategory2()!=undefined){if(b.length>0){b+=" "}b+=c.selectedCategory2().Name}if(b.length>0){b+=" "}b+=c.name();return b}}var menuHelper=new MenuHelper();var mobileMenuHelper={isMobileMenuVisible:ko.observable(true),isPopupVisible:ko.observable(false),showPopup:function(){guiHelper.enable(true);mobileMenuHelper.isPopupVisible(true)},showHome:function(){guiHelper.enableDisableUI(true);mobileMenuHelper.title(textStrings.mmHome);mobileMenuHelper.titleClass("popupMobileMenuHomeButton");mobileMenuHelper.isPopupVisible(false);guiHelper.showHome()},showMenu:function(a){mobileMenuHelper.title(textStrings.mmOrderNow);mobileMenuHelper.titleClass("popupMobileMenuOrderNowButton");mobileMenuHelper.isPopupVisible(false);guiHelper.showMenu(a)},showCart:function(){mobileMenuHelper.title(textStrings.mmMyOrder);mobileMenuHelper.titleClass("popupMobileMenuCartButton");mobileMenuHelper.isPopupVisible(false);guiHelper.showCart()},showPostcodeCheck:function(){mobileMenuHelper.title(textStrings.mmPostcodeCheck);mobileMenuHelper.titleClass("popupMobileMenuPostcodeCheckButton");mobileMenuHelper.isPopupVisible(false);guiHelper.showPostcodeCheck()},close:function(){mobileMenuHelper.isPopupVisible(false)},title:ko.observable(""),titleClass:ko.observable("popupMobileMenuHomeButton")};var openingTimesHelper={openingTimes:{monday:{openingTimes:[],displayText:ko.observable()},tuesday:{openingTimes:[],displayText:ko.observable()},wednesday:{openingTimes:[],displayText:ko.observable()},thursday:{openingTimes:[],displayText:ko.observable()},friday:{openingTimes:[],displayText:ko.observable()},saturday:{openingTimes:[],displayText:ko.observable()},sunday:{openingTimes:[],displayText:ko.observable()}},todayPropertyName:"",getToday:function(){var b=new Date();var a=b.getDay();switch(a){case 0:openingTimesHelper.todayPropertyName="Sun";break;case 1:openingTimesHelper.todayPropertyName="Mon";break;case 2:openingTimesHelper.todayPropertyName="Tue";break;case 3:openingTimesHelper.todayPropertyName="Wed";break;case 4:openingTimesHelper.todayPropertyName="Thu";break;case 5:openingTimesHelper.todayPropertyName="Fri";break;case 6:openingTimesHelper.todayPropertyName="Sat";break}},getOpeningHours:function(d,a){for(var c=0;c<viewModel.siteDetails().openingHours.length;c++){var e=viewModel.siteDetails().openingHours[c];if(e.day==a){d.openingTimes.push(e)}}d.openingTimes.sort(function(f,g){return f.startTime>g.startTime?1:-1});var b="";for(var c=0;c<d.openingTimes.length;c++){var e=d.openingTimes[c];if(e.openAllDay){b=textStrings.openAllDay;break}else{if(b.length>0){b+="<br />"}b+=textStrings.fromTo.replace("{from}",e.startTime).replace("{to}",e.endTime)}}if(b.length==0){d.displayText(textStrings.closed)}else{d.displayText(b)}},getTodaysOpeningTimes:function(){var c=new Date();var a=c.getDay();var b;switch(a){case 0:b=openingTimesHelper.openingTimes.sunday.openingTimes;break;case 1:b=openingTimesHelper.openingTimes.monday.openingTimes;break;case 2:b=openingTimesHelper.openingTimes.tuesday.openingTimes;break;case 3:b=openingTimesHelper.openingTimes.wednesday.openingTimes;break;case 4:b=openingTimesHelper.openingTimes.thursday.openingTimes;break;case 5:b=openingTimesHelper.openingTimes.friday.openingTimes;break;case 6:b=openingTimesHelper.openingTimes.saturday.openingTimes;break}return b}};var popupHelper={returnToCart:false,isBackgroundVisible:ko.observable(false),isPopupVisible:ko.observable(false),mode:ko.observable("addItem"),cancel:function(){popupHelper.hidePopup()},cancelDeal:function(){popupHelper.hidePopup();dealPopupHelper.showDealPopup("addDeal",false);if(popupHelper.mode()=="addDealItem"){if(dealHelper.selectedBindableDealLine.itemWrappers.length>1){if(dealHelper.selectedBindableDealLine.previouslySelectedItemWrapper==undefined){dealHelper.selectedBindableDealLine.selectedItemWrapper(dealHelper.selectedBindableDealLine.itemWrappers[0]);dealHelper.selectedBindableDealLine.selectedMenuItem=undefined}else{dealHelper.selectedBindableDealLine.selectedItemWrapper(dealHelper.selectedBindableDealLine.previouslySelectedItemWrapper)}}dealHelper.subscribeToDealLineChanges()}},commitToDeal:function(){popupHelper.hidePopup();dealPopupHelper.showDealPopup("addDeal",false);dealHelper.selectedBindableDealLine.previouslySelectedItemWrapper=dealHelper.selectedBindableDealLine.selectedItemWrapper();dealHelper.selectedBindableDealLine.selectedMenuItem=viewModel.selectedItem.menuItem();dealHelper.checkForErrors();dealHelper.selectedBindableDealLine.toppings=dealHelper.cloneToppings(viewModel.selectedItem.toppings());dealHelper.selectedBindableDealLine.instructions=viewModel.selectedItem.instructions();dealHelper.selectedBindableDealLine.person=viewModel.selectedItem.person();dealHelper.subscribeToDealLineChanges()},acceptChanges:function(){cartHelper.cart().selectedCartItem().quantity(viewModel.selectedItem.quantity());cartHelper.cart().selectedCartItem().selectedCategory1=viewModel.selectedItem.selectedCategory1();cartHelper.cart().selectedCartItem().selectedCategory2=viewModel.selectedItem.selectedCategory2();cartHelper.cart().selectedCartItem().menuItem=viewModel.selectedItem.menuItem();cartHelper.cart().selectedCartItem().instructions=viewModel.selectedItem.instructions();cartHelper.cart().selectedCartItem().person=viewModel.selectedItem.person();var b=[];for(var c=0;c<viewModel.selectedItem.toppings().length;c++){var e=viewModel.selectedItem.toppings()[c];var a={type:e.type,selectedSingle:ko.observable(e.selectedSingle()),selectedDouble:ko.observable(e.selectedDouble()),topping:e.topping,price:e.price,doublePrice:e.doublePrice,freeQuantity:e.freeQuantity,quantity:e.quantity,cartPrice:ko.observable(""),cartName:ko.observable(""),cartQuantity:ko.observable("")};b.push(a)}cartHelper.cart().selectedCartItem().toppings.removeAll();cartHelper.cart().selectedCartItem().toppings(b);cartHelper.cart().selectedCartItem().displayName(menuHelper.getCartItemDisplayName(viewModel.selectedItem,viewModel.selectedItem.selectedCategory1(),viewModel.selectedItem.selectedCategory2()));var d=menuHelper.calculateItemPrice(cartHelper.cart().selectedCartItem().menuItem,cartHelper.cart().selectedCartItem().quantity(),viewModel.selectedItem.toppings());cartHelper.cart().selectedCartItem().price=d;cartHelper.cart().selectedCartItem().displayPrice(helper.formatPrice(d));cartHelper.cart().selectedCartItem().displayToppings(menuHelper.getCartDisplayToppings(b));cartHelper.refreshCart();popupHelper.hidePopup()},removeFromCart:function(){cartHelper.cart().cartItems.remove(cartHelper.cart().selectedCartItem());cartHelper.refreshCart();popupHelper.hidePopup()},quantityChanged:function(){var a=menuHelper.calculateItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.quantity(),viewModel.selectedItem.toppings(),true,true);viewModel.selectedItem.price(helper.formatPrice(a));return true},singleChanged:function(){popupHelper.popupToppingChanged("single",this);return true},doubleChanged:function(){popupHelper.popupToppingChanged("double",this);return true},showPopup:function(a){$(window).scrollTop(0);popupHelper.mode(a);viewModel.pickToppings(true);popupHelper.isBackgroundVisible(true);popupHelper.isPopupVisible(true);if(guiHelper.isMobileMode()){guiHelper.isViewVisible(false);guiHelper.isInnerMenuVisible(false)}setTimeout(function(){var b=0;if(popupHelper.mode()=="addDealItem"||popupHelper.mode()=="editDealItem"){b=menuHelper.calculateDealItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.toppings(),true)}else{b=menuHelper.calculateItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.quantity(),viewModel.selectedItem.toppings(),true,true)}viewModel.selectedItem.price(helper.formatPrice(b))},0)},hidePopup:function(){popupHelper.isBackgroundVisible(false);popupHelper.isPopupVisible(false);if(!dealPopupHelper.isPopupVisible()){guiHelper.isInnerMenuVisible(true);if(guiHelper.isMobileMode()){if(popupHelper.returnToCart){guiHelper.isViewVisible(true);guiHelper.isInnerMenuVisible(false)}else{guiHelper.isViewVisible(false);guiHelper.isInnerMenuVisible(true)}}}setTimeout(function(){guiHelper.resize()},0)},commitToCart:function(){var f=menuHelper.calculateItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.quantity(),viewModel.selectedItem.toppings(),false,true);var e=cartHelper.getCartItemName(viewModel.selectedItem,viewModel.selectedItem.selectedCategory1(),viewModel.selectedItem.selectedCategory2());var c=[];for(var d=0;d<viewModel.selectedItem.toppings().length;d++){var g=viewModel.selectedItem.toppings()[d];var b={type:g.type,selectedSingle:ko.observable(g.selectedSingle()),selectedDouble:ko.observable(g.selectedDouble()),topping:g.topping,price:g.price,doublePrice:g.doublePrice,freeQuantity:g.freeQuantity,quantity:g.quantity,cartPrice:ko.observable(""),cartName:ko.observable(""),cartQuantity:ko.observable("")};c.push(b)}var a={menuItem:viewModel.selectedItem.menuItem(),name:viewModel.selectedItem.name(),displayName:ko.observable(menuHelper.getCartItemDisplayName(viewModel.selectedItem)),quantity:ko.observable(viewModel.selectedItem.quantity()),displayPrice:ko.observable(helper.formatPrice(f)),price:f,instructions:viewModel.selectedItem.instructions(),person:viewModel.selectedItem.person(),toppings:viewModel.selectedItem.toppings(),displayToppings:ko.observableArray(menuHelper.getCartDisplayToppings(c)),selectedCategory1:viewModel.selectedItem.selectedCategory1(),selectedCategory2:viewModel.selectedItem.selectedCategory2(),category1s:ko.observableArray(),category2s:ko.observableArray(),toppings:ko.observableArray(c),isEnabled:ko.observable(),menuItems:undefined};viewModel.ignoreEvents=true;for(var d=0;d<viewModel.selectedItem.category1s().length;d++){a.category1s.push(viewModel.selectedItem.category1s()[d])}for(var d=0;d<viewModel.selectedItem.category2s().length;d++){a.category2s.push(viewModel.selectedItem.category2s()[d])}viewModel.ignoreEvents=false;a.menuItems=[];for(var d=0;d<viewModel.selectedItem.menuItems().length;d++){a.menuItems.push(viewModel.selectedItem.menuItems()[d])}cartHelper.cart().cartItems.push(a);cartHelper.refreshCart();popupHelper.hidePopup();if(guiHelper.isMobileMode()){guiHelper.showCart()}},popupToppingChanged:function(b,c){if(b=="single"&&c.selectedSingle()){c.selectedDouble(false)}else{if(b=="double"&&c.selectedSingle()){c.selectedSingle(false)}}if(c.type=="removable"){if(!c.selectedDouble()&&!c.selectedSingle()){c.quantity=-1}else{if(c.selectedDouble()){c.quantity=1}}}else{if(c.selectedSingle()){c.quantity=1}else{if(c.selectedDouble()){c.quantity=2}}}var a=0;if(popupHelper.mode()=="addDealItem"||popupHelper.mode()=="editDealItem"){a=menuHelper.calculateDealItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.toppings(),true)}else{a=menuHelper.calculateItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.quantity(),viewModel.selectedItem.toppings(),true,true)}viewModel.selectedItem.price(helper.formatPrice(a));popupHelper.refeshFreeToppings()},refeshFreeToppings:function(){var b=0;if(viewModel.selectedItem.freeToppings()>0){if(viewModel.selectedItem.toppings()!=undefined){var d=0;for(var a=0;a<viewModel.selectedItem.toppings().length;a++){var c=viewModel.selectedItem.toppings()[a];if(c.type=="removable"){if(c.selectedDouble()){d++}}else{if(c.selectedDouble()){d+=2}else{if(c.selectedSingle()){d++}}}}b=viewModel.selectedItem.freeToppings()-d;if(b<0){b=0}}}viewModel.selectedItem.freeToppingsRemaining(b)},popupCategory1Changed:function(){if(!viewModel.ignoreEvents&&viewModel.pickToppings()){viewModel.category1Changed(viewModel.selectedItem);var a=menuHelper.getSelectedMenuItem(viewModel.selectedItem);if(a==undefined){return}viewModel.selectedItem.menuItem(a);viewModel.selectedItem.toppings(menuHelper.getItemToppings(viewModel.selectedItem.menuItem()));var b=0;if(popupHelper.mode()=="addDealItem"||popupHelper.mode()=="editDealItem"){b=menuHelper.calculateDealItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.toppings())}else{b=menuHelper.calculateItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.quantity(),viewModel.selectedItem.toppings())}viewModel.selectedItem.price(helper.formatPrice(b))}},popupSelectedItemChanged:function(){if(!viewModel.ignoreEvents&&viewModel.pickToppings()){var a=menuHelper.getSelectedMenuItem(viewModel.selectedItem);viewModel.selectedItem.menuItem(a);viewModel.selectedItem.toppings(menuHelper.getItemToppings(viewModel.selectedItem.menuItem()));if(popupHelper.mode()=="addItem"||popupHelper.mode()=="editItem"){guiHelper.selectedItemChanged(viewModel.selectedItem)}else{var b=menuHelper.calculateDealItemPrice(viewModel.selectedItem.menuItem(),viewModel.selectedItem.toppings());viewModel.selectedItem.price(helper.formatPrice(b))}}}};var postcodeCheckHelper={isPopupVisible:ko.observable(false),isInDeliveryZone:ko.observable(undefined),showPopup:function(){if(deliveryZoneHelper.deliveryZones!=undefined){$(window).scrollTop(0);popupHelper.isBackgroundVisible(true);postcodeCheckHelper.isPopupVisible(true)}},hidePopup:function(a){if(!guiHelper.isMobileMode()){popupHelper.isBackgroundVisible(false);postcodeCheckHelper.isPopupVisible(false)}if(a!=undefined){a()}},checkPostcode:function(){postcodeCheckHelper.isInDeliveryZone(checkoutHelper.validatePostcode())},showMenu:function(){if(guiHelper.isMobileMode()){postcodeCheckHelper.hidePopup(guiHelper.showHome)}else{postcodeCheckHelper.hidePopup()}},changeStore:function(){postcodeCheckHelper.hidePopup(viewModel.chooseStore)},checkPostcodeKeypress:function(a,b){if(b.which==13){var c=$("#postcodeCheckTextbox").val();checkoutHelper.checkoutDetails.address.zipCode(c);setTimeout(postcodeCheckHelper.checkPostcode(),0)}else{postcodeCheckHelper.isInDeliveryZone(undefined)}return true}};var queryStringHelper={queryString:{},email:undefined,firstName:undefined,lastName:undefined,telephoneNumber:undefined,marketing:undefined,city:undefined,postcode:undefined,houseNumber:undefined,roadName:undefined,orderType:undefined,initialise:function(){queryStringHelper.queryString={};location.search.substr(1).split("&").forEach(function(a){if(a===""){return}var b=a.split("=");queryStringHelper.queryString[b[0]]=b[1]&&decodeURIComponent(b[1].replace(/\+/g," "))});queryStringHelper.extractData()},extractData:function(){queryStringHelper.externalSiteId=queryStringHelper.queryString.s;queryStringHelper.email=queryStringHelper.queryString.e;queryStringHelper.firstName=queryStringHelper.queryString.f;queryStringHelper.lastName=queryStringHelper.queryString.l;queryStringHelper.telephoneNumber=queryStringHelper.queryString.t;queryStringHelper.marketing=queryStringHelper.queryString.m=="y"?true:false;queryStringHelper.town=queryStringHelper.queryString.c;queryStringHelper.postcode=queryStringHelper.queryString.p;queryStringHelper.houseNumber=queryStringHelper.queryString.n;queryStringHelper.roadName=queryStringHelper.queryString.r;queryStringHelper.orderType=queryStringHelper.queryString.ot;var b=window.location.href;var a=b.indexOf("/?");if(queryStringHelper.externalSiteId!=undefined&&a!=-1){b=b.substring(0,a);if(settings.hidePassthroughQueryString){History.pushState(null,document.title,b)}}}};var siteSelectorHelper={isPostcodeTextboxVisible:ko.observable(false),postcode:ko.observable(""),checkPostcode:function(){siteSelectorHelper.isBadPostcode(false);if(siteSelectorHelper.postcode().length==0){siteSelectorHelper.isBadPostcode(true);return}guiHelper.showPleaseWait(textStrings.gettingStoreDetails,undefined,function(){viewModel.siteDetails(undefined);acsapi.getSiteList(function(){helper.markOfflineStores();if(viewModel.sites()===undefined||viewModel.sites().length==0){siteSelectorHelper.isBadPostcode(true);guiHelper.showView("siteSelectorView")}else{if(viewModel.sites().length==1){viewModel.storeSelected(viewModel.sites()[0])}else{viewModel.deliverySites(viewModel.sites());guiHelper.showView("storeSelectorSitesView")}}},siteSelectorHelper.postcode())})},siteSelectorPostcodeKeypress:function(a,b){if(b.which==13){var c=$("#siteSelectorPostcodeInput").val();siteSelectorHelper.postcode(c);setTimeout(siteSelectorHelper.checkPostcode(),0)}return true},isBadPostcode:ko.observable(false),hideBadPostcode:function(){siteSelectorHelper.isBadPostcode(false)},showAllSites:function(){guiHelper.showPleaseWait(textStrings.gettingStoreDetails,undefined,function(){viewModel.siteDetails(undefined);acsapi.getSiteList(function(){if(viewModel.sites()===undefined||viewModel.sites().length==0){guiHelper.showError(textStrings.noRestaurants,function(){guiHelper.showView("siteSelectorView")},undefined)}else{helper.markOfflineStores();guiHelper.showView("sitesView")}},undefined)})}};var tandcHelper={isPopupVisible:ko.observable(false),hasAgreed:function(){if(tandcHelper.agree()==undefined){tandcHelper.agree(false)}return tandcHelper.agree()},agree:ko.observable(undefined),showPopup:function(){if(guiHelper.isMobileMode()){guiHelper.isMobileMenuVisible(false);checkoutMenuHelper.showMenu("pay",false);guiHelper.showView("tandcView")}else{$(window).scrollTop(0);popupHelper.isBackgroundVisible(true);tandcHelper.isPopupVisible(true)}guiHelper.canChangeOrderType(false);guiHelper.cartActions(guiHelper.cartActionsCheckout)},hidePopup:function(a){if(guiHelper.isMobileMode()){checkoutHelper.showPaymentPicker()}else{popupHelper.isBackgroundVisible(false);tandcHelper.isPopupVisible(false)}}};